"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2533],{62533:function(e,t,o){o.r(t),o.d(t,{AnyCollider:function(){return ce},BallCollider:function(){return ue},CapsuleCollider:function(){return de},CoefficientCombineRule:function(){return n.CoefficientCombineRule},ConeCollider:function(){return me},ConvexHullCollider:function(){return be},CuboidCollider:function(){return se},CylinderCollider:function(){return ye},HeightfieldCollider:function(){return fe},InstancedRigidBodies:function(){return Fe},MeshCollider:function(){return Me},Physics:function(){return ee},RapierCollider:function(){return n.Collider},RapierRigidBody:function(){return n.RigidBody},RigidBody:function(){return Re},RoundConeCollider:function(){return ve},RoundCuboidCollider:function(){return ae},RoundCylinderCollider:function(){return ge},TrimeshCollider:function(){return pe},euler:function(){return ie},interactionGroups:function(){return ze},quat:function(){return re},useAfterPhysicsStep:function(){return U},useBeforePhysicsStep:function(){return Q},useFixedJoint:function(){return Pe},useImpulseJoint:function(){return Be},usePrismaticJoint:function(){return De},useRapier:function(){return H},useRevoluteJoint:function(){return Ae},useSphericalJoint:function(){return Ie},vec3:function(){return ne}});var n=o(60415),r=o(70162),i=o(2265),l=o(21247),c=o(87047),s=o.n(c);const a=[];function u(e,t,o,n=0,r=!1){for(const l of t)if(s()(o,l.args)){if(r)return;if(l.error)throw l.error;if(l.response)return l.response;throw l.promise}const i={args:o,promise:e(...o).then((e=>i.response=null==e||e)).catch((e=>i.error=null!=e?e:"unknown error")).then((()=>{n>0&&setTimeout((()=>{const e=t.indexOf(i);-1!==e&&t.splice(e,1)}),n)}))};if(t.push(i),!r)throw i.promise}function d(e,...t){if(void 0===t||0===t.length)e.splice(0,e.length);else{const o=e.find((e=>s()(t,e.args)));if(o){const t=e.indexOf(o);-1!==t&&e.splice(t,1)}}}function f(e,...t){return u(e,a,t,f.lifespan)}f.lifespan=0,f.clear=(...e)=>d(a,...e),f.preload=(e,...t)=>{u(e,a,t,f.lifespan,!0)},f.peek=(...e)=>{var t;return null==(t=a.find((t=>s()(e,t.args))))?void 0:t.response};function p(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function m(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function v(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?m(Object(o),!0).forEach((function(t){p(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):m(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const y=new l.Quaternion;new l.Euler;const g=new l.Vector3;new l.Object3D;const b=new l.Matrix4,h=new l.Vector3,E=new l.Quaternion,x=new l.Vector3,C=e=>{const[t,o,n]=e;return new l.Vector3(t,o,n)},w=(e,t)=>t.reduce(((t,o,n)=>(t[o]=e[n],t)),{}),S=({x:e,y:t,z:o,w:n})=>y.set(e,t,o,n),j={fixed:1,dynamic:0,kinematicPosition:2,kinematicVelocity:3},R=e=>j[e],M=e=>e?e instanceof l.Quaternion?[e.x,e.y,e.z,e.w]:e instanceof l.Vector3||e instanceof l.Euler?[e.x,e.y,e.z]:Array.isArray(e)?e:[e]:[0];function O(e){const t=(0,i.useRef)();return void 0===t.current&&(t.current={value:"function"===typeof e?e():e}),t.current.value}const F=({onStep:e,updatePriority:t})=>((0,r.F)(((t,o)=>{e(o)}),t),null),B=({onStep:e})=>((e=>{const t=(0,i.useRef)(e),o=(0,i.useRef)(0),n=(0,i.useRef)(0);(0,i.useEffect)((()=>{t.current=e}),[e]),(0,i.useEffect)((()=>{const e=()=>{const r=performance.now(),i=r-n.current;o.current=requestAnimationFrame(e),t.current(i/1e3),n.current=r};return o.current=requestAnimationFrame(e),()=>cancelAnimationFrame(o.current)}),[])})((t=>{e(t)})),null),P=({onStep:e,type:t,updatePriority:o})=>"independent"===t?i.createElement(B,{onStep:e}):i.createElement(F,{onStep:e,updatePriority:o});var I=(0,i.memo)(P);function A(e,t){if(null==e)return{};var o,n,r=function(e,t){if(null==e)return{};var o,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)o=i[n],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)o=i[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}const D=["mass","linearDamping","angularDamping","type","onCollisionEnter","onCollisionExit","onIntersectionEnter","onIntersectionExit","onContactForce","children","canSleep","ccd","gravityScale"],z=(e,t,o)=>{const n=t.slice();if("heightfield"===e){const e=n[3];return e.x*=o.x,e.x*=o.y,e.x*=o.z,n}if("trimesh"===e||"convexHull"===e)return n[0]=((e,t)=>{const o=Array.from(e);for(let n=0;n<e.length/3;n++)o[3*n]*=t.x,o[3*n+1]*=t.y,o[3*n+2]*=t.z;return o})(n[0],o),n;const r=[o.x,o.y,o.z,o.x,o.x];return n.map(((e,t)=>r[t]*e))},k=["shape","args"],N="Please pick ONLY ONE of the `density`, `mass` and `massProperties` options.",T={sensor:(e,t)=>{e.setSensor(t)},collisionGroups:(e,t)=>{e.setCollisionGroups(t)},solverGroups:(e,t)=>{e.setSolverGroups(t)},friction:(e,t)=>{e.setFriction(t)},frictionCombineRule:(e,t)=>{e.setFrictionCombineRule(t)},restitution:(e,t)=>{e.setRestitution(t)},restitutionCombineRule:(e,t)=>{e.setRestitutionCombineRule(t)},quaternion:()=>{},position:()=>{},rotation:()=>{},scale:()=>{}},W=Object.keys(T),V=(e,t,o)=>{const n=o.get(e.handle);if(n){var r;const o=n.object.parent.getWorldScale(g),i=null===(r=n.worldParent)||void 0===r?void 0:r.matrixWorld.clone().invert();n.object.updateWorldMatrix(!0,!1),b.copy(n.object.matrixWorld),i&&b.premultiply(i),b.decompose(h,E,x),e.parent()?(e.setTranslationWrtParent({x:h.x*o.x,y:h.y*o.y,z:h.z*o.z}),e.setRotationWrtParent(E)):(e.setTranslation({x:h.x*o.x,y:h.y*o.y,z:h.z*o.z}),e.setRotation(E)),W.forEach((o=>{if(o in t){const n=t[o];T[o](e,n,t)}})),((e,t)=>{if(void 0===t.density)if(void 0===t.mass)void 0!==t.massProperties&&e.setMassProperties(t.massProperties.mass,t.massProperties.centerOfMass,t.massProperties.principalAngularInertia,t.massProperties.angularInertiaLocalFrame);else{if(void 0!==t.massProperties)throw new Error(N);e.setMass(t.mass)}else{if(void 0!==t.mass||void 0!==t.massProperties)throw new Error(N);e.setDensity(t.density)}})(e,t)}},q={cuboid:"cuboid",ball:"ball",hull:"convexHull",trimesh:"trimesh"},J=(e,t)=>{switch(t){case"cuboid":{e.computeBoundingBox();const{boundingBox:t}=e,o=t.getSize(new l.Vector3);return{args:[o.x/2,o.y/2,o.z/2],offset:t.getCenter(new l.Vector3)}}case"ball":{e.computeBoundingSphere();const{boundingSphere:t}=e;return{args:[t.radius],offset:t.center}}case"trimesh":{var o;const t=e.index?e.clone():function(e,t=1e-4){t=Math.max(t,Number.EPSILON);const o={},n=e.getIndex(),r=e.getAttribute("position"),i=n?n.count:r.count;let c=0;const s=Object.keys(e.attributes),a={},u={},d=[],f=["getX","getY","getZ","getW"];for(let l=0,y=s.length;l<y;l++){const t=s[l];a[t]=[];const o=e.morphAttributes[t];o&&(u[t]=new Array(o.length).fill(0).map((()=>[])))}const p=Math.log10(1/t),m=Math.pow(10,p);for(let l=0;l<i;l++){const t=n?n.getX(l):l;let r="";for(let o=0,n=s.length;o<n;o++){const n=s[o],i=e.getAttribute(n),l=i.itemSize;for(let e=0;e<l;e++)r+=~~(i[f[e]](t)*m)+","}if(r in o)d.push(o[r]);else{for(let o=0,n=s.length;o<n;o++){const n=s[o],r=e.getAttribute(n),i=e.morphAttributes[n],l=r.itemSize,c=a[n],d=u[n];for(let e=0;e<l;e++){const o=f[e];if(c.push(r[o](t)),i)for(let e=0,n=i.length;e<n;e++)d[e].push(i[e][o](t))}}o[r]=c,d.push(c),c++}}const v=e.clone();for(let y=0,g=s.length;y<g;y++){const t=s[y],o=e.getAttribute(t),n=new o.array.constructor(a[t]),r=new l.BufferAttribute(n,o.itemSize,o.normalized);if(v.setAttribute(t,r),t in u)for(let i=0;i<u[t].length;i++){const o=e.morphAttributes[t][i],n=new o.array.constructor(u[t][i]),r=new l.BufferAttribute(n,o.itemSize,o.normalized);v.morphAttributes[t][i]=r}}return v.setIndex(d),v}(e);return{args:[t.attributes.position.array,null===(o=t.index)||void 0===o?void 0:o.array],offset:new l.Vector3}}case"hull":return{args:[e.clone().attributes.position.array],offset:new l.Vector3}}return{args:[],offset:new l.Vector3}},L=e=>({collision:!!(null!==e&&void 0!==e&&e.onCollisionEnter||null!==e&&void 0!==e&&e.onCollisionExit||null!==e&&void 0!==e&&e.onIntersectionEnter||null!==e&&void 0!==e&&e.onIntersectionExit),contactForce:!(null===e||void 0===e||!e.onContactForce)}),_=(e={})=>A(e,D),G=e=>{const t=(0,i.useRef)(e);return(0,i.useEffect)((()=>{t.current=e}),[e]),t},H=()=>(0,i.useContext)(Z),Q=e=>{const{beforeStepCallbacks:t}=H(),o=G(e);(0,i.useEffect)((()=>(t.add(o),()=>{t.delete(o)})),[])},U=e=>{const{afterStepCallbacks:t}=H(),o=G(e);(0,i.useEffect)((()=>(t.add(o),()=>{t.delete(o)})),[])},X=(e,t,o=!0)=>{const[n,r]=(0,i.useState)([]);return(0,i.useEffect)((()=>{e.current&&!1!==t.colliders&&r((({object:e,ignoreMeshColliders:t=!0,options:o})=>{const n=[];e.updateWorldMatrix(!0,!1);const r=e.matrixWorld.clone().invert(),i=e=>{if("isMesh"in e){if(t&&(e=>{let t=!1;return e.traverseAncestors((e=>{"MeshCollider"===e.userData.r3RapierType&&(t=!0)})),t})(e))return;const i=e.getWorldScale(x),c=q[o.colliders||"cuboid"];e.updateWorldMatrix(!0,!1),b.copy(e.matrixWorld).premultiply(r).decompose(h,E,x);const s=(new l.Euler).setFromQuaternion(E,"XYZ"),{geometry:a}=e,{args:u,offset:d}=J(a,o.colliders||"cuboid"),f=v(v({},_(o)),{},{args:u,shape:c,rotation:[s.x,s.y,s.z],position:[h.x+d.x*i.x,h.y+d.y*i.y,h.z+d.z*i.z],scale:[i.x,i.y,i.z]});n.push(f)}};return o.includeInvisible?e.traverse(i):e.traverseVisible(i),n})({object:e.current,options:t,ignoreMeshColliders:o}))}),[t.colliders]),n},Y=(0,i.memo)((()=>{const{world:e}=H(),t=(0,i.useRef)(null);return(0,r.F)((()=>{const o=t.current;if(!o)return;const n=e.debugRender();o.geometry.setAttribute("position",new l.BufferAttribute(n.vertices,3)),o.geometry.setAttribute("color",new l.BufferAttribute(n.colors,4))})),i.createElement("group",null,i.createElement("lineSegments",{ref:t,frustumCulled:!1},i.createElement("lineBasicMaterial",{color:16777215,vertexColors:!0}),i.createElement("bufferGeometry",null)))})),Z=(0,i.createContext)(void 0),K=(e,t)=>{var o,n,r,i,l,c;return{target:{rigidBody:e.rigidBody.object,collider:e.collider.object,colliderObject:null===(o=e.collider.state)||void 0===o?void 0:o.object,rigidBodyObject:null===(n=e.rigidBody.state)||void 0===n?void 0:n.object},other:{rigidBody:t.rigidBody.object,collider:t.collider.object,colliderObject:null===(r=t.collider.state)||void 0===r?void 0:r.object,rigidBodyObject:null===(i=t.rigidBody.state)||void 0===i?void 0:i.object},rigidBody:t.rigidBody.object,collider:t.collider.object,colliderObject:null===(l=t.collider.state)||void 0===l?void 0:l.object,rigidBodyObject:null===(c=t.rigidBody.state)||void 0===c?void 0:c.object}},$=async()=>{let e=await Promise.resolve().then(o.bind(o,60415));return await e.init(),e},ee=e=>{const{colliders:t="cuboid",children:o,timeStep:c=1/60,paused:s=!1,interpolate:a=!0,updatePriority:u,updateLoop:d="follow",debug:p=!1,gravity:m=[0,-9.81,0],maxStabilizationIterations:y=1,maxVelocityFrictionIterations:g=8,maxVelocityIterations:w=4,predictionDistance:j=.002,erp:R=.8}=e,M=f($),{invalidate:F}=(0,r.D)(),B=O((()=>new Map)),P=O((()=>new Map)),A=O((()=>new Map)),D=O((()=>new Map)),z=O((()=>new n.EventQueue(!1))),k=O((()=>new Set)),N=O((()=>new Set)),{proxy:T,reset:W}=O((()=>(e=>{let t;return{proxy:new Proxy({},{get:(o,n)=>(t||(t=e()),Reflect.get(t,n)),set:(o,n,r)=>(t||(t=e()),Reflect.set(t,n,r))}),reset:()=>{t=void 0}}})((()=>new M.World(C(m))))));(0,i.useEffect)((()=>()=>{T.free(),W()}),[]),(0,i.useEffect)((()=>{T.gravity=C(m),T.integrationParameters.maxStabilizationIterations=y,T.integrationParameters.maxVelocityFrictionIterations=g,T.integrationParameters.maxVelocityIterations=w,T.integrationParameters.predictionDistance=j,T.integrationParameters.erp=R}),[T,...m,y,w,g,j,R]);const V=(0,i.useCallback)((e=>{var t;const o=T.getCollider(e),n=D.get(e),r=P.get(e),i=null===o||void 0===o||null===(t=o.parent())||void 0===t?void 0:t.handle,l=void 0!==i?T.getRigidBody(i):void 0;return{collider:{object:o,events:n,state:r},rigidBody:{object:l,events:l&&void 0!==i?A.get(i):void 0,state:void 0!==i?B.get(i):void 0}}}),[]),[q]=(0,i.useState)({previousState:{},accumulator:0}),J=(0,i.useCallback)((e=>{const t=T,o="vary"===c,n=l.MathUtils.clamp(e,0,.5),r=e=>{k.forEach((e=>{e.current(t)})),t.timestep=e,t.step(z),N.forEach((e=>{e.current(t)}))};if(o)r(n);else for(q.accumulator+=n;q.accumulator>=c;)a&&(q.previousState={},t.forEachRigidBody((e=>{q.previousState[e.handle]={position:e.translation(),rotation:e.rotation()}}))),r(c),q.accumulator-=c;const i=o||!a||s?1:q.accumulator/c;B.forEach(((e,o)=>{const n=t.getRigidBody(o),r=A.get(o);if(null!==r&&void 0!==r&&r.onSleep||null!==r&&void 0!==r&&r.onWake){var l,c;if(n.isSleeping()&&!e.isSleeping)null===r||void 0===r||null===(l=r.onSleep)||void 0===l||l.call(r);if(!n.isSleeping()&&e.isSleeping)null===r||void 0===r||null===(c=r.onWake)||void 0===c||c.call(r);e.isSleeping=n.isSleeping()}if(!n||n.isSleeping()&&!("isInstancedMesh"in e.object)||!e.setMatrix)return;let s=n.translation(),a=n.rotation(),u=q.previousState[o];u&&(b.compose(u.position,S(u.rotation),e.scale).premultiply(e.invertedWorldMatrix).decompose(h,E,x),"mesh"==e.meshType&&(e.object.position.copy(h),e.object.quaternion.copy(E))),b.compose(s,S(a),e.scale).premultiply(e.invertedWorldMatrix).decompose(h,E,x),"instancedMesh"==e.meshType?e.setMatrix(b):(e.object.position.lerp(h,i),e.object.quaternion.slerp(E,i))})),z.drainCollisionEvents(((e,o,n)=>{const r=V(e),i=V(o);if(null===r||void 0===r||!r.collider.object||null===i||void 0===i||!i.collider.object)return;const l=K(r,i),c=K(i,r);var s,a,u,d,f,p,m,y,g,b,h,E,x,C,w,S,j,R,M,O,F,B,P,I;n?t.contactPair(r.collider.object,i.collider.object,((e,t)=>{var o,n,s,a,u,d,f,p;null===(o=r.rigidBody.events)||void 0===o||null===(n=o.onCollisionEnter)||void 0===n||n.call(o,v(v({},l),{},{manifold:e,flipped:t})),null===(s=i.rigidBody.events)||void 0===s||null===(a=s.onCollisionEnter)||void 0===a||a.call(s,v(v({},c),{},{manifold:e,flipped:t})),null===(u=r.collider.events)||void 0===u||null===(d=u.onCollisionEnter)||void 0===d||d.call(u,v(v({},l),{},{manifold:e,flipped:t})),null===(f=i.collider.events)||void 0===f||null===(p=f.onCollisionEnter)||void 0===p||p.call(f,v(v({},c),{},{manifold:e,flipped:t}))})):(null===(s=r.rigidBody.events)||void 0===s||null===(a=s.onCollisionExit)||void 0===a||a.call(s,l),null===(u=i.rigidBody.events)||void 0===u||null===(d=u.onCollisionExit)||void 0===d||d.call(u,c),null===(f=r.collider.events)||void 0===f||null===(p=f.onCollisionExit)||void 0===p||p.call(f,l),null===(m=i.collider.events)||void 0===m||null===(y=m.onCollisionExit)||void 0===y||y.call(m,c));n?t.intersectionPair(r.collider.object,i.collider.object)&&(null===(g=r.rigidBody.events)||void 0===g||null===(b=g.onIntersectionEnter)||void 0===b||b.call(g,l),null===(h=i.rigidBody.events)||void 0===h||null===(E=h.onIntersectionEnter)||void 0===E||E.call(h,c),null===(x=r.collider.events)||void 0===x||null===(C=x.onIntersectionEnter)||void 0===C||C.call(x,l),null===(w=i.collider.events)||void 0===w||null===(S=w.onIntersectionEnter)||void 0===S||S.call(w,c)):(null===(j=r.rigidBody.events)||void 0===j||null===(R=j.onIntersectionExit)||void 0===R||R.call(j,l),null===(M=i.rigidBody.events)||void 0===M||null===(O=M.onIntersectionExit)||void 0===O||O.call(M,c),null===(F=r.collider.events)||void 0===F||null===(B=F.onIntersectionExit)||void 0===B||B.call(F,l),null===(P=i.collider.events)||void 0===P||null===(I=P.onIntersectionExit)||void 0===I||I.call(P,c))})),z.drainContactForceEvents((e=>{var t,o,n,r,i,l,c,s;const a=V(e.collider1()),u=V(e.collider2());if(null===a||void 0===a||!a.collider.object||null===u||void 0===u||!u.collider.object)return;const d=K(a,u),f=K(u,a);null===(t=a.rigidBody.events)||void 0===t||null===(o=t.onContactForce)||void 0===o||o.call(t,v(v({},d),{},{totalForce:e.totalForce(),totalForceMagnitude:e.totalForceMagnitude(),maxForceDirection:e.maxForceDirection(),maxForceMagnitude:e.maxForceMagnitude()})),null===(n=u.rigidBody.events)||void 0===n||null===(r=n.onContactForce)||void 0===r||r.call(n,v(v({},f),{},{totalForce:e.totalForce(),totalForceMagnitude:e.totalForceMagnitude(),maxForceDirection:e.maxForceDirection(),maxForceMagnitude:e.maxForceMagnitude()})),null===(i=a.collider.events)||void 0===i||null===(l=i.onContactForce)||void 0===l||l.call(i,v(v({},d),{},{totalForce:e.totalForce(),totalForceMagnitude:e.totalForceMagnitude(),maxForceDirection:e.maxForceDirection(),maxForceMagnitude:e.maxForceMagnitude()})),null===(c=u.collider.events)||void 0===c||null===(s=c.onContactForce)||void 0===s||s.call(c,v(v({},f),{},{totalForce:e.totalForce(),totalForceMagnitude:e.totalForceMagnitude(),maxForceDirection:e.maxForceDirection(),maxForceMagnitude:e.maxForceMagnitude()}))})),t.forEachActiveRigidBody((()=>{F()}))}),[s,c,a,T]),L=(0,i.useMemo)((()=>({rapier:M,world:T,physicsOptions:{colliders:t,gravity:m},rigidBodyStates:B,colliderStates:P,rigidBodyEvents:A,colliderEvents:D,beforeStepCallbacks:k,afterStepCallbacks:N,isPaused:s,isDebug:p,step:J})),[s,J,p,t,m]),_=(0,i.useCallback)((e=>{s||J(e)}),[s,J]);return i.createElement(Z.Provider,{value:L},i.createElement(I,{onStep:_,type:d,updatePriority:u}),p&&i.createElement(Y,null),o)};function te(){return te=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},te.apply(this,arguments)}const oe=(e,t,o)=>{const n=(0,i.useRef)(),r=(0,i.useCallback)((()=>(n.current||(n.current=e()),n.current)),o);return(0,i.useEffect)((()=>{const e=r();return()=>{t(e),n.current=void 0}}),[r]),r},ne=({x:e,y:t,z:o}={x:0,y:0,z:0})=>new l.Vector3(e,t,o),re=({x:e,y:t,z:o,w:n}={x:0,y:0,z:0,w:1})=>new l.Quaternion(e,t,o,n),ie=({x:e,y:t,z:o}={x:0,y:0,z:0})=>new l.Euler(e,t,o),le=(e,t=null)=>{const o=(0,i.useRef)(t);return e&&"function"!==typeof e?(e.current||(e.current=o.current),e):o},ce=(0,i.memo)((0,i.forwardRef)(((e,t)=>{const{children:o,position:r,rotation:l,quaternion:c,scale:s,name:a}=e,{world:u,colliderEvents:d,colliderStates:f}=H(),p=je(),m=le(t),y=(0,i.useRef)(null),g=k.flatMap((t=>Array.isArray(e[t])?[...e[t]]:e[t])),b=oe((()=>{const o=y.current.getWorldScale(ne()),r=((e,t,o,r)=>{const i=z(e.shape,e.args,o),l=n.ColliderDesc[e.shape](...i);return t.createCollider(l,null===r||void 0===r?void 0:r())})(e,u,o,null===p||void 0===p?void 0:p.getRigidBody);return"function"==typeof t&&t(r),m.current=r,r}),(e=>{u.getCollider(e.handle)&&u.removeCollider(e,!0)}),[...g,p]);(0,i.useEffect)((()=>{const e=b();return f.set(e.handle,((e,t,o)=>({collider:e,worldParent:o||void 0,object:t}))(e,y.current,null===p||void 0===p?void 0:p.ref.current)),()=>{f.delete(e.handle)}}),[b]);const h=(0,i.useMemo)((()=>v(v({},_(null===p||void 0===p?void 0:p.options)),e)),[e,null===p||void 0===p?void 0:p.options]);return((e,t,o)=>{const n=(0,i.useMemo)((()=>W.flatMap((e=>M(t[e])))),[t]);(0,i.useEffect)((()=>{const n=e();V(n,t,o)}),[...n,e])})(b,h,f),((e,t,o,r={})=>{const{onCollisionEnter:l,onCollisionExit:c,onIntersectionEnter:s,onIntersectionExit:a,onContactForce:u}=t;(0,i.useEffect)((()=>{const i=e();if(i){const{collision:e,contactForce:d}=L(t),f=e||r.collision,p=d||r.contactForce;f&&p?i.setActiveEvents(n.ActiveEvents.COLLISION_EVENTS|n.ActiveEvents.CONTACT_FORCE_EVENTS):f?i.setActiveEvents(n.ActiveEvents.COLLISION_EVENTS):p&&i.setActiveEvents(n.ActiveEvents.CONTACT_FORCE_EVENTS),o.set(i.handle,{onCollisionEnter:l,onCollisionExit:c,onIntersectionEnter:s,onIntersectionExit:a,onContactForce:u})}return()=>{i&&o.delete(i.handle)}}),[l,c,s,a,u,r])})(b,h,d,L(null===p||void 0===p?void 0:p.options)),i.createElement("object3D",{position:r,rotation:l,quaternion:c,scale:s,ref:y,name:a},o)}))),se=i.forwardRef(((e,t)=>i.createElement(ce,te({},e,{shape:"cuboid",ref:t}))));se.displayName="CuboidCollider";const ae=i.forwardRef(((e,t)=>i.createElement(ce,te({},e,{shape:"roundCuboid",ref:t}))));ae.displayName="RoundCuboidCollider";const ue=i.forwardRef(((e,t)=>i.createElement(ce,te({},e,{shape:"ball",ref:t}))));ue.displayName="BallCollider";const de=i.forwardRef(((e,t)=>i.createElement(ce,te({},e,{shape:"capsule",ref:t}))));de.displayName="CapsuleCollider";const fe=i.forwardRef(((e,t)=>i.createElement(ce,te({},e,{shape:"heightfield",ref:t}))));fe.displayName="HeightfieldCollider";const pe=i.forwardRef(((e,t)=>i.createElement(ce,te({},e,{shape:"trimesh",ref:t}))));pe.displayName="TrimeshCollider";const me=i.forwardRef(((e,t)=>i.createElement(ce,te({},e,{shape:"cone",ref:t}))));me.displayName="ConeCollider";const ve=i.forwardRef(((e,t)=>i.createElement(ce,te({},e,{shape:"roundCone",ref:t}))));ve.displayName="RoundConeCollider";const ye=i.forwardRef(((e,t)=>i.createElement(ce,te({},e,{shape:"cylinder",ref:t}))));ye.displayName="CylinderCollider";const ge=i.forwardRef(((e,t)=>i.createElement(ce,te({},e,{shape:"roundCylinder",ref:t}))));ye.displayName="RoundCylinderCollider";const be=i.forwardRef(((e,t)=>i.createElement(ce,te({},e,{shape:"convexHull",ref:t}))));be.displayName="ConvexHullCollider";const he=["args","colliders","canSleep"],Ee={gravityScale:(e,t)=>{e.setGravityScale(t,!0)},linearDamping:(e,t)=>{e.setLinearDamping(t)},angularDamping:(e,t)=>{e.setAngularDamping(t)},dominanceGroup:(e,t)=>{e.setDominanceGroup(t)},enabledRotations:(e,[t,o,n])=>{e.setEnabledRotations(t,o,n,!0)},enabledTranslations:(e,[t,o,n])=>{e.setEnabledTranslations(t,o,n,!0)},lockRotations:(e,t)=>{e.lockRotations(t,!0)},lockTranslations:(e,t)=>{e.lockTranslations(t,!0)},angularVelocity:(e,[t,o,n])=>{e.setAngvel({x:t,y:o,z:n},!0)},linearVelocity:(e,[t,o,n])=>{e.setLinvel({x:t,y:o,z:n},!0)},ccd:(e,t)=>{e.enableCcd(t)},userData:(e,t)=>{e.userData=t},type(e,t){e.setBodyType(R(t),!0)},position:()=>{},rotation:()=>{},quaternion:()=>{},scale:()=>{}},xe=Object.keys(Ee),Ce=(e,t,o,n=!0)=>{const r=(0,i.useMemo)((()=>xe.flatMap((e=>M(t[e])))),[t]);(0,i.useEffect)((()=>{((e,t,o,n=!0)=>{if(!e)return;const r=o.get(e.handle);r&&(n&&(r.object.updateWorldMatrix(!0,!1),b.copy(r.object.matrixWorld).decompose(h,E,x),e.setTranslation(h,!1),e.setRotation(E,!1)),xe.forEach((o=>{o in t&&Ee[o](e,t[o])})))})(e(),t,o,n)}),r)},we=["children","type","position","rotation","scale","quaternion","transformState"],Se=(0,i.createContext)(void 0),je=()=>(0,i.useContext)(Se),Re=(0,i.memo)((0,i.forwardRef)(((e,t)=>{const{children:o,type:r,position:l,rotation:c,scale:s,quaternion:a,transformState:u}=e,d=A(e,we),f=(0,i.useRef)(null),p=le(t),{world:m,rigidBodyStates:y,physicsOptions:g,rigidBodyEvents:b}=H(),h=(0,i.useMemo)((()=>v(v(v({},g),e),{},{children:void 0})),[g,e]),E=he.flatMap((e=>Array.isArray(h[e])?[...h[e]]:h[e])),C=X(f,h),w=oe((()=>{const e=(e=>{var t;const o=R((null===e||void 0===e?void 0:e.type)||"dynamic"),r=new n.RigidBodyDesc(o);return r.canSleep=null===(t=null===e||void 0===e?void 0:e.canSleep)||void 0===t||t,r})(h),o=m.createRigidBody(e);return"function"===typeof t&&t(o),p.current=o,o}),(e=>{m.getRigidBody(e.handle)&&m.removeRigidBody(e)}),E);(0,i.useEffect)((()=>{const t=w(),o=(({rigidBody:e,object:t,setMatrix:o,getMatrix:n,worldScale:r,meshType:i="mesh"})=>{t.updateWorldMatrix(!0,!1);const l=t.parent.matrixWorld.clone().invert();return{object:t,rigidBody:e,invertedWorldMatrix:l,setMatrix:o||(e=>{t.matrix.copy(e)}),getMatrix:n||(e=>e.copy(t.matrix)),scale:r||t.getWorldScale(x).clone(),isSleeping:!1,meshType:i}})({rigidBody:t,object:f.current});return y.set(t.handle,e.transformState?e.transformState(o):o),()=>{y.delete(t.handle)}}),[w]),Ce(w,h,y),((e,t,o)=>{const{onWake:n,onSleep:r,onCollisionEnter:l,onCollisionExit:c,onIntersectionEnter:s,onIntersectionExit:a,onContactForce:u}=t,d={onWake:n,onSleep:r,onCollisionEnter:l,onCollisionExit:c,onIntersectionEnter:s,onIntersectionExit:a,onContactForce:u};(0,i.useEffect)((()=>{const t=e();return o.set(t.handle,d),()=>{o.delete(t.handle)}}),[n,r,l,c,s,a,u])})(w,h,b);const S=(0,i.useMemo)((()=>({ref:f,getRigidBody:w,options:h})),[w]);return i.createElement(Se.Provider,{value:S},i.createElement("object3D",te({ref:f},d,{position:l,rotation:c,quaternion:a,scale:s}),o,C.map(((e,t)=>i.createElement(ce,te({key:t},e))))))})));Re.displayName="RigidBody";const Me=(0,i.memo)((e=>{const{children:t,type:o}=e,{physicsOptions:n}=H(),r=(0,i.useRef)(null),{options:l}=je(),c=(0,i.useMemo)((()=>v(v(v({},n),l),{},{children:void 0,colliders:o})),[n,l]),s=X(r,c,!1);return i.createElement("object3D",{ref:r,userData:{r3RapierType:"MeshCollider"}},t,s.map(((e,t)=>i.createElement(ce,te({key:t},e)))))}));Me.displayName="MeshCollider";const Oe=["children","instances","colliderNodes","position","rotation","quaternion","scale"],Fe=(0,i.memo)((0,i.forwardRef)(((e,t)=>{const o=le(t,[]),n=(0,i.useRef)(null),r=(0,i.useRef)(null),{children:c,instances:s,colliderNodes:a=[],position:u,rotation:d,quaternion:f,scale:p}=e,m=A(e,Oe),y=X(n,v(v({},e),{},{children:void 0})),g=()=>{const e=r.current.children[0];if(e&&"isInstancedMesh"in e)return e};(0,i.useEffect)((()=>{const e=g();e?e.instanceMatrix.setUsage(l.DynamicDrawUsage):console.warn("InstancedRigidBodies expects exactly one child, which must be an InstancedMesh")}),[]);return i.createElement("object3D",te({ref:n},m,{position:u,rotation:d,quaternion:f,scale:p}),i.createElement("object3D",{ref:r},c),null===s||void 0===s?void 0:s.map(((e,t)=>i.createElement(Re,te({},m,e,{ref:e=>o.current[t]=e,transformState:e=>((e,t)=>{const o=g();return o?v(v({},e),{},{getMatrix:e=>(o.getMatrixAt(t,e),e),setMatrix:e=>{o.setMatrixAt(t,e),o.instanceMatrix.needsUpdate=!0},meshType:"instancedMesh"}):e})(e,t)}),i.createElement(i.Fragment,null,a.map(((e,t)=>i.createElement(i.Fragment,{key:t},e))),y.map(((e,t)=>i.createElement(ce,te({key:t},e)))))))))})));Fe.displayName="InstancedRigidBodies";const Be=(e,t,o)=>{const{world:n}=H(),r=(0,i.useRef)();return oe((()=>{if(e.current&&t.current){const i=n.createImpulseJoint(o,e.current,t.current,!0);return r.current=i,i}}),(e=>{e&&(r.current=void 0,n.getImpulseJoint(e.handle)&&n.removeImpulseJoint(e,!0))}),[]),r},Pe=(e,t,[o,n,r,i])=>{const{rapier:l}=H();return Be(e,t,l.JointData.fixed(C(o),w(n,["x","y","z","w"]),C(r),w(i,["x","y","z","w"])))},Ie=(e,t,[o,n])=>{const{rapier:r}=H();return Be(e,t,r.JointData.spherical(C(o),C(n)))},Ae=(e,t,[o,n,r,i])=>{const{rapier:l}=H(),c=l.JointData.revolute(C(o),C(n),C(r));return i&&(c.limitsEnabled=!0,c.limits=i),Be(e,t,c)},De=(e,t,[o,n,r,i])=>{const{rapier:l}=H(),c=l.JointData.prismatic(C(o),C(n),C(r));return i&&(c.limitsEnabled=!0,c.limits=i),Be(e,t,c)},ze=(e,t)=>(ke(e)<<16)+(void 0!==t?ke(t):65535),ke=e=>[e].flat().reduce(((e,t)=>e|1<<t),0)},87047:function(e){e.exports=function e(t,o){if(t===o)return!0;if(t&&o&&"object"==typeof t&&"object"==typeof o){if(t.constructor!==o.constructor)return!1;var n,r,i;if(Array.isArray(t)){if((n=t.length)!=o.length)return!1;for(r=n;0!==r--;)if(!e(t[r],o[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===o.source&&t.flags===o.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===o.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===o.toString();if((n=(i=Object.keys(t)).length)!==Object.keys(o).length)return!1;for(r=n;0!==r--;)if(!Object.prototype.hasOwnProperty.call(o,i[r]))return!1;for(r=n;0!==r--;){var l=i[r];if(!e(t[l],o[l]))return!1}return!0}return t!==t&&o!==o}}}]);