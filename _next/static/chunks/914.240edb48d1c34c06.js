(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[914],{70571:function(e,t,n){"use strict";n.r(t),n.d(t,{AccumulativeShadows:function(){return sx},AdaptiveDpr:function(){return nw},AdaptiveEvents:function(){return rw},ArcballControls:function(){return jl},AsciiRenderer:function(){return $c},BBAnchor:function(){return bg},Backdrop:function(){return Ax},BakeShadows:function(){return ZE},Billboard:function(){return Ls},Bounds:function(){return mv},Box:function(){return Oy},Bvh:function(){return pg},CameraControls:function(){return lh},CameraShake:function(){return vv},Capsule:function(){return nv},CatmullRomLine:function(){return wa},Caustics:function(){return xx},Center:function(){return Tg},Circle:function(){return Uy},Clone:function(){return kc.o},Cloud:function(){return iE},CloudInstance:function(){return rE},Clouds:function(){return nE},ComputedAttribute:function(){return Fc},Cone:function(){return Ny},ContactShadows:function(){return rx},CubeCamera:function(){return ul},CubeTexture:function(){return Wh},CubicBezierLine:function(){return Ea},CurveModifier:function(){return hy},CycleRaycast:function(){return v},Cylinder:function(){return Vy},Decal:function(){return Yc},Detailed:function(){return YE},DetectGPU:function(){return Em},DeviceOrientationControls:function(){return ml},Dodecahedron:function(){return $y},DragControls:function(){return Ye},Edges:function(){return yc},Effects:function(){return oc},Environment:function(){return ex},EnvironmentCube:function(){return Kv},EnvironmentMap:function(){return Zv},EnvironmentPortal:function(){return Jv},Example:function(){return Qg},Extrude:function(){return ev},FaceControls:function(){return WC},FaceLandmarker:function(){return VC},FaceLandmarkerDefaults:function(){return NC},Facemesh:function(){return FC},FacemeshDatas:function(){return OC},FacemeshEye:function(){return LC},FacemeshEyeDefaults:function(){return kC},Fbo:function(){return sl},Fbx:function(){return $d},FirstPersonControls:function(){return hu},Fisheye:function(){return Aw},Float:function(){return xv},FlyControls:function(){return vl},GizmoHelper:function(){return bh},GizmoViewcube:function(){return Uh},GizmoViewport:function(){return Gh},Gltf:function(){return Kc.o},GradientTexture:function(){return ac},GradientType:function(){return sc},Grid:function(){return Hh},Helper:function(){return JA},Html:function(){return y},Hud:function(){return ph},Icosahedron:function(){return Ky},Image:function(){return gc},Instance:function(){return Jg},InstancedAttribute:function(){return ny},Instances:function(){return $g},IsObject:function(){return lc},KeyboardControls:function(){return gs},Ktx2:function(){return UA},Lathe:function(){return tv},Lightformer:function(){return Tx},Line:function(){return ya},Loader:function(){return M},MapControls:function(){return Ml},MarchingCube:function(){return Gc},MarchingCubes:function(){return Vc},MarchingPlane:function(){return jc},Mask:function(){return hw},MatcapTexture:function(){return mE},Merged:function(){return ey},MeshDiscardMaterial:function(){return Ty},MeshDistortMaterial:function(){return Ay},MeshPortalMaterial:function(){return fw},MeshReflectorMaterial:function(){return vy},MeshRefractionMaterial:function(){return By},MeshTransmissionMaterial:function(){return Dy},MeshWobbleMaterial:function(){return py},MotionPathControls:function(){return Ah},NormalTexture:function(){return yE},Octahedron:function(){return Jy},OrbitControls:function(){return Sl},OrthographicCamera:function(){return al},Outlines:function(){return xc},PerformanceMonitor:function(){return ow},PerspectiveCamera:function(){return cl},PivotControls:function(){return PC},Plane:function(){return jy},Point:function(){return UE},PointMaterial:function(){return zy},PointMaterialImpl:function(){return Py},PointerLockControls:function(){return su},Points:function(){return VE},PointsBuffer:function(){return NE},Polyhedron:function(){return Zy},PositionMesh:function(){return jg},PositionPoint:function(){return PE},PositionalAudio:function(){return Ca},Preload:function(){return XE},PresentationControls:function(){return ms},Progress:function(){return b},QuadraticBezierLine:function(){return xa},RandomizedLight:function(){return ax},Reflector:function(){return Ex},RenderCubeTexture:function(){return lw},RenderTexture:function(){return aw},Resize:function(){return cv},Ring:function(){return Xy},RoundedBox:function(){return ov},Sampler:function(){return Rc},ScreenQuad:function(){return av},ScreenSizer:function(){return qs},ScreenSpace:function(){return Os},Scroll:function(){return kn},ScrollControls:function(){return zn},Segment:function(){return WE},SegmentObject:function(){return HE},Segments:function(){return jE},Select:function(){return Fs},Shadow:function(){return mx},ShadowAlpha:function(){return ME},Shape:function(){return rv},Sky:function(){return Lx},SoftShadows:function(){return ky},Sparkles:function(){return uE},Sphere:function(){return Gy},Splat:function(){return il},SpotLight:function(){return Dx},SpotLightShadow:function(){return Sx},SpriteAnimator:function(){return oy},Stage:function(){return hx},Stars:function(){return Nx},Stats:function(){return nm},StatsGl:function(){return om},Svg:function(){return Zc},Tetrahedron:function(){return Yy},Text:function(){return ba},Text3D:function(){return La},Texture:function(){return hc},Torus:function(){return qy},TorusKnot:function(){return Wy},TrackballControls:function(){return Pl},Trail:function(){return Dc},TrailTexture:function(){return Dg},TransformControls:function(){return Zl},Tube:function(){return Hy},VideoTexture:function(){return qA},View:function(){return Vw},Wireframe:function(){return BE},accumulativeContext:function(){return ix},calcPosFromAngles:function(){return kx},calculateAspectRatio:function(){return XA},calculateScaleFactor:function(){return js},checkIfFrameIsEmpty:function(){return YA},createInstances:function(){return ty},getFirstItem:function(){return WA},isWebGL2Available:function(){return ic},meshBounds:function(){return tw},shaderMaterial:function(){return cc},useAnimations:function(){return gg},useAspect:function(){return am},useBVH:function(){return mg},useBounds:function(){return pv},useBoxProjectedEnv:function(){return Cg},useCamera:function(){return cm},useContextBridge:function(){return fg},useCubeCamera:function(){return ll},useCubeTexture:function(){return qh},useCursor:function(){return x},useDepthBuffer:function(){return sm},useDetectGPU:function(){return xm},useEnvironment:function(){return Vv},useFBO:function(){return ol},useFBX:function(){return Jd},useFaceControls:function(){return YC},useFaceLandmarker:function(){return GC},useFont:function(){return Fa},useGLTF:function(){return Kc.L},useGizmoContext:function(){return gh},useHelper:function(){return KA},useIntersect:function(){return yg},useKTX2:function(){return OA},useKeyboardControls:function(){return ys},useMask:function(){return dw},useMatcapTexture:function(){return AE},useMotion:function(){return hh},useNormalTexture:function(){return gE},usePerformanceMonitor:function(){return sw},useProgress:function(){return _},useScroll:function(){return Pn},useSelect:function(){return ks},useSpriteAnimator:function(){return iy},useSpriteLoader:function(){return ZA},useSurfaceSampler:function(){return zc},useTexture:function(){return uc},useTrail:function(){return Sc},useTrailTexture:function(){return Sg},useVideoTexture:function(){return HA}});var r=n(50593),i=n(2265),o=n(34040),s=n(21247),a=n(70162);const c=new s.Vector3,l=new s.Vector3,u=new s.Vector3,h=new s.Vector2;function d(e,t,n){const r=c.setFromMatrixPosition(e.matrixWorld);r.project(t);const i=n.width/2,o=n.height/2;return[r.x*i+i,-r.y*o+o]}const A=e=>Math.abs(e)<1e-10?0:e;function m(e,t,n=""){let r="matrix3d(";for(let i=0;16!==i;i++)r+=A(t[i]*e.elements[i])+(15!==i?",":")");return n+r}const p=(f=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],e=>m(e,f));var f;const g=(e,t)=>m(e,(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1])(t),"translate(-50%,-50%)");const y=i.forwardRef((({children:e,eps:t=.001,style:n,className:m,prepend:f,center:y,fullscreen:v,portal:x,distanceFactor:E,sprite:w=!1,transform:C=!1,occlude:I,onOcclude:_,castShadow:b,receiveShadow:B,material:M,geometry:S,zIndexRange:D=[16777271,0],calculatePosition:T=d,as:Q="div",wrapperClass:P,pointerEvents:z="auto",...R},F)=>{const{gl:k,camera:L,scene:O,size:U,raycaster:N,events:V,viewport:G}=(0,a.D)(),[j]=i.useState((()=>document.createElement(Q))),H=i.useRef(),q=i.useRef(null),W=i.useRef(0),Y=i.useRef([0,0]),X=i.useRef(null),Z=i.useRef(null),K=(null==x?void 0:x.current)||V.connected||k.domElement.parentNode,J=i.useRef(null),$=i.useRef(!1),ee=i.useMemo((()=>I&&"blending"!==I||Array.isArray(I)&&I.length&&function(e){return e&&"object"===typeof e&&"current"in e}(I[0])),[I]);i.useLayoutEffect((()=>{const e=k.domElement;I&&"blending"===I?(e.style.zIndex=`${Math.floor(D[0]/2)}`,e.style.position="absolute",e.style.pointerEvents="none"):(e.style.zIndex=null,e.style.position=null,e.style.pointerEvents=null)}),[I]),i.useLayoutEffect((()=>{if(q.current){const e=H.current=o.createRoot(j);if(O.updateMatrixWorld(),C)j.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const e=T(q.current,L,U);j.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${e[0]}px,${e[1]}px,0);transform-origin:0 0;`}return K&&(f?K.prepend(j):K.appendChild(j)),()=>{K&&K.removeChild(j),e.unmount()}}}),[K,C]),i.useLayoutEffect((()=>{P&&(j.className=P)}),[P]);const te=i.useMemo((()=>C?{position:"absolute",top:0,left:0,width:U.width,height:U.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:y?"translate3d(-50%,-50%,0)":"none",...v&&{top:-U.height/2,left:-U.width/2,width:U.width,height:U.height},...n}),[n,y,v,U,C]),ne=i.useMemo((()=>({position:"absolute",pointerEvents:z})),[z]);i.useLayoutEffect((()=>{var t,r;($.current=!1,C)?null==(t=H.current)||t.render(i.createElement("div",{ref:X,style:te},i.createElement("div",{ref:Z,style:ne},i.createElement("div",{ref:F,className:m,style:n,children:e})))):null==(r=H.current)||r.render(i.createElement("div",{ref:F,style:te,className:m,children:e}))}));const re=i.useRef(!0);(0,a.F)((e=>{if(q.current){L.updateMatrixWorld(),q.current.updateWorldMatrix(!0,!1);const e=C?Y.current:T(q.current,L,U);if(C||Math.abs(W.current-L.zoom)>t||Math.abs(Y.current[0]-e[0])>t||Math.abs(Y.current[1]-e[1])>t){const t=function(e,t){const n=c.setFromMatrixPosition(e.matrixWorld),r=l.setFromMatrixPosition(t.matrixWorld),i=n.sub(r),o=t.getWorldDirection(u);return i.angleTo(o)>Math.PI/2}(q.current,L);let n=!1;ee&&(Array.isArray(I)?n=I.map((e=>e.current)):"blending"!==I&&(n=[O]));const r=re.current;if(n){const e=function(e,t,n,r){const i=c.setFromMatrixPosition(e.matrixWorld),o=i.clone();o.project(t),h.set(o.x,o.y),n.setFromCamera(h,t);const s=n.intersectObjects(r,!0);if(s.length){const e=s[0].distance;return i.distanceTo(n.ray.origin)<e}return!0}(q.current,L,N,n);re.current=e&&!t}else re.current=!t;r!==re.current&&(_?_(!re.current):j.style.display=re.current?"block":"none");const i=Math.floor(D[0]/2),o=I?ee?[D[0],i]:[i-1,0]:D;if(j.style.zIndex=`${function(e,t,n){if(t instanceof s.PerspectiveCamera||t instanceof s.OrthographicCamera){const r=c.setFromMatrixPosition(e.matrixWorld),i=l.setFromMatrixPosition(t.matrixWorld),o=r.distanceTo(i),s=(n[1]-n[0])/(t.far-t.near),a=n[1]-s*t.far;return Math.round(s*o+a)}}(q.current,L,o)}`,C){const[e,t]=[U.width/2,U.height/2],n=L.projectionMatrix.elements[5]*t,{isOrthographicCamera:r,top:i,left:o,bottom:s,right:a}=L,c=p(L.matrixWorldInverse),l=r?`scale(${n})translate(${A(-(a+o)/2)}px,${A((i+s)/2)}px)`:`translateZ(${n}px)`;let u=q.current.matrixWorld;w&&(u=L.matrixWorldInverse.clone().transpose().copyPosition(u).scale(q.current.scale),u.elements[3]=u.elements[7]=u.elements[11]=0,u.elements[15]=1),j.style.width=U.width+"px",j.style.height=U.height+"px",j.style.perspective=r?"":`${n}px`,X.current&&Z.current&&(X.current.style.transform=`${l}${c}translate(${e}px,${t}px)`,Z.current.style.transform=g(u,1/((E||10)/400)))}else{const t=void 0===E?1:function(e,t){if(t instanceof s.OrthographicCamera)return t.zoom;if(t instanceof s.PerspectiveCamera){const n=c.setFromMatrixPosition(e.matrixWorld),r=l.setFromMatrixPosition(t.matrixWorld),i=t.fov*Math.PI/180,o=n.distanceTo(r);return 1/(2*Math.tan(i/2)*o)}return 1}(q.current,L)*E;j.style.transform=`translate3d(${e[0]}px,${e[1]}px,0) scale(${t})`}Y.current=e,W.current=L.zoom}}if(!ee&&J.current&&!$.current)if(C){if(X.current){const e=X.current.children[0];if(null!=e&&e.clientWidth&&null!=e&&e.clientHeight){const{isOrthographicCamera:t}=L;if(t||S)R.scale&&(Array.isArray(R.scale)?R.scale instanceof s.Vector3?J.current.scale.copy(R.scale.clone().divideScalar(1)):J.current.scale.set(1/R.scale[0],1/R.scale[1],1/R.scale[2]):J.current.scale.setScalar(1/R.scale));else{const t=(E||10)/400,n=e.clientWidth*t,r=e.clientHeight*t;J.current.scale.set(n,r,1)}$.current=!0}}}else{const t=j.children[0];if(null!=t&&t.clientWidth&&null!=t&&t.clientHeight){const e=1/G.factor,n=t.clientWidth*e,r=t.clientHeight*e;J.current.scale.set(n,r,1),$.current=!0}J.current.lookAt(e.camera.position)}}));const ie=i.useMemo((()=>({vertexShader:C?void 0:'\n          /*\n            This shader is from the THREE\'s SpriteMaterial.\n            We need to turn the backing plane into a Sprite\n            (make it always face the camera) if "transfrom"\n            is false.\n          */\n          #include <common>\n\n          void main() {\n            vec2 center = vec2(0., 1.);\n            float rotation = 0.0;\n\n            // This is somewhat arbitrary, but it seems to work well\n            // Need to figure out how to derive this dynamically if it even matters\n            float size = 0.03;\n\n            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n            vec2 scale;\n            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n            bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n            if ( isPerspective ) scale *= - mvPosition.z;\n\n            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;\n            vec2 rotatedPosition;\n            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n            mvPosition.xy += rotatedPosition;\n\n            gl_Position = projectionMatrix * mvPosition;\n          }\n      ',fragmentShader:"\n        void main() {\n          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n        }\n      "})),[C]);return i.createElement("group",(0,r.Z)({},R,{ref:q}),I&&!ee&&i.createElement("mesh",{castShadow:b,receiveShadow:B,ref:J},S||i.createElement("planeGeometry",null),M||i.createElement("shaderMaterial",{side:s.DoubleSide,vertexShader:ie.vertexShader,fragmentShader:ie.fragmentShader})))}));function v({onChanged:e,portal:t,preventDefault:n=!0,scroll:r=!0,keyCode:o=9}){const s=i.useRef(0),c=(0,a.D)((e=>e.setEvents)),l=(0,a.D)((e=>e.get)),u=(0,a.D)((e=>e.gl));return i.useEffect((()=>{var i;let a,h=[];const d=l().events.filter,A=null!==(i=null==t?void 0:t.current)&&void 0!==i?i:u.domElement.parentNode,m=()=>A&&e&&e(h,Math.round(s.current)%h.length);c({filter:(e,t)=>{let n=[...e];n.length===h.length&&h.every((e=>n.map((e=>e.object.uuid)).includes(e.object.uuid)))||(s.current=0,h=n,m()),d&&(n=d(n,t));for(let r=0;r<Math.round(s.current)%n.length;r++){const e=n.shift();n=[...n,e]}return n}});const p=e=>{var t,n;s.current=e(s.current),null==(t=l().events.handlers)||t.onPointerCancel(void 0),null==(n=l().events.handlers)||n.onPointerMove(a),m()},f=e=>{(e.keyCode||e.which)===o&&(n&&e.preventDefault(),h.length>1&&p((e=>e+1)))},g=e=>{n&&e.preventDefault();let t=0;e||(e=window.event),e.wheelDelta?t=e.wheelDelta/120:e.detail&&(t=-e.detail/3),h.length>1&&p((e=>Math.abs(e-t)))},y=e=>a=e;return document.addEventListener("pointermove",y,{passive:!0}),r&&document.addEventListener("wheel",g),void 0!==o&&document.addEventListener("keydown",f),()=>{c({filter:d}),void 0!==o&&document.removeEventListener("keydown",f),r&&document.removeEventListener("wheel",g),document.removeEventListener("pointermove",y)}}),[u,l,c,n,r,o]),null}function x(e,t="pointer",n="auto",r=document.body){i.useEffect((()=>{if(e)return r.style.cursor=t,()=>{r.style.cursor=n}}),[e])}function E(e){let t;const n=new Set,r=(e,r)=>{const i="function"===typeof e?e(t):e;if(i!==t){const e=t;t=r?i:Object.assign({},t,i),n.forEach((n=>n(t,e)))}},i=()=>t,o={setState:r,getState:i,subscribe:(e,r,o)=>r||o?((e,r=i,o=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let s=r(t);function a(){const n=r(t);if(!o(s,n)){const t=s;e(s=n,t)}}return n.add(a),()=>n.delete(a)})(e,r,o):(n.add(e),()=>n.delete(e)),destroy:()=>n.clear()};return t=e(r,i,o),o}const w="undefined"===typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?i.useEffect:i.useLayoutEffect;function C(e){const t="function"===typeof e?E(e):e,n=(e=t.getState,n=Object.is)=>{const[,r]=(0,i.useReducer)((e=>e+1),0),o=t.getState(),s=(0,i.useRef)(o),a=(0,i.useRef)(e),c=(0,i.useRef)(n),l=(0,i.useRef)(!1),u=(0,i.useRef)();let h;void 0===u.current&&(u.current=e(o));let d=!1;(s.current!==o||a.current!==e||c.current!==n||l.current)&&(h=e(o),d=!n(u.current,h)),w((()=>{d&&(u.current=h),s.current=o,a.current=e,c.current=n,l.current=!1}));const A=(0,i.useRef)(o);w((()=>{const e=()=>{try{const e=t.getState(),n=a.current(e);c.current(u.current,n)||(s.current=e,u.current=n,r())}catch(e){l.current=!0,r()}},n=t.subscribe(e);return t.getState()!==A.current&&e(),n}),[]);const m=d?h:u.current;return(0,i.useDebugValue)(m),m};return Object.assign(n,t),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const e=[n,t];return{next(){const t=e.length<=0;return{value:e.shift(),done:t}}}},n}let I=0;const _=C((e=>(s.DefaultLoadingManager.onStart=(t,n,r)=>{e({active:!0,item:t,loaded:n,total:r,progress:(n-I)/(r-I)*100})},s.DefaultLoadingManager.onLoad=()=>{e({active:!1})},s.DefaultLoadingManager.onError=t=>e((e=>({errors:[...e.errors,t]}))),s.DefaultLoadingManager.onProgress=(t,n,r)=>{n===r&&(I=r),e({active:!0,item:t,loaded:n,total:r,progress:(n-I)/(r-I)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})));function b({children:e}){const t=_();return i.createElement(i.Fragment,null,null==e?void 0:e(t))}const B=e=>`Loading ${e.toFixed(2)}%`;function M({containerStyles:e,innerStyles:t,barStyles:n,dataStyles:r,dataInterpolation:o=B,initialState:s=(e=>e)}){const{active:a,progress:c}=_(),l=i.useRef(0),u=i.useRef(0),h=i.useRef(null),[d,A]=i.useState(s(a));i.useEffect((()=>{let e;return a!==d&&(e=setTimeout((()=>A(a)),300)),()=>clearTimeout(e)}),[d,a]);const m=i.useCallback((()=>{h.current&&(l.current+=(c-l.current)/2,(l.current>.95*c||100===c)&&(l.current=c),h.current.innerText=o(l.current),l.current<c&&(u.current=requestAnimationFrame(m)))}),[o,c]);return i.useEffect((()=>(m(),()=>cancelAnimationFrame(u.current))),[m]),d?i.createElement("div",{style:{...S.container,opacity:a?1:0,...e}},i.createElement("div",null,i.createElement("div",{style:{...S.inner,...t}},i.createElement("div",{style:{...S.bar,transform:`scaleX(${c/100})`,...n}}),i.createElement("span",{ref:h,style:{...S.data,...r}})))):null}const S={container:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#171717",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 300ms ease",zIndex:1e3},inner:{width:100,height:3,background:"#272727",textAlign:"center"},bar:{height:3,width:"100%",background:"white",transition:"transform 200ms",transformOrigin:"left center"},data:{display:"inline-block",position:"relative",fontVariantNumeric:"tabular-nums",marginTop:"0.8em",color:"#f0f0f0",fontSize:"0.6em",fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", "Helvetica Neue", Helvetica, Arial, Roboto, Ubuntu, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',whiteSpace:"nowrap"}};const D={toVector:(e,t)=>(void 0===e&&(e=t),Array.isArray(e)?e:[e,e]),add:(e,t)=>[e[0]+t[0],e[1]+t[1]],sub:(e,t)=>[e[0]-t[0],e[1]-t[1]],addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function T(e,t,n){return 0===t||Math.abs(t)===1/0?Math.pow(e,5*n):e*t*n/(t+n*e)}function Q(e,t,n,r=.15){return 0===r?function(e,t,n){return Math.max(t,Math.min(e,n))}(e,t,n):e<t?-T(t-e,n-t,r)+t:e>n?+T(e-n,n-t,r)+n:e}function P(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}function z(e,t,n){return(t=P(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){z(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const k={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function L(e){return e?e[0].toUpperCase()+e.slice(1):""}const O=["enter","leave"];function U(e,t="",n=!1){const r=k[e],i=r&&r[t]||t;return"on"+L(e)+L(i)+(function(e=!1,t){return e&&!O.includes(t)}(n,i)?"Capture":"")}const N=["gotpointercapture","lostpointercapture"];function V(e){let t=e.substring(2).toLowerCase();const n=!!~t.indexOf("passive");n&&(t=t.replace("passive",""));const r=N.includes(t)?"capturecapture":"capture",i=!!~t.indexOf(r);return i&&(t=t.replace("capture","")),{device:t,capture:i,passive:n}}function G(e){return"touches"in e}function j(e){return G(e)?"touch":"pointerType"in e?e.pointerType:"mouse"}function H(e){return G(e)?function(e){return"touchend"===e.type||"touchcancel"===e.type?e.changedTouches:e.targetTouches}(e)[0]:e}function q(e,t){try{const n=t.clientX-e.clientX,r=t.clientY-e.clientY,i=(t.clientX+e.clientX)/2,o=(t.clientY+e.clientY)/2,s=Math.hypot(n,r),a=-180*Math.atan2(n,r)/Math.PI;return{angle:a,distance:s,origin:[i,o]}}catch(n){}return null}function W(e){return function(e){return Array.from(e.touches).filter((t=>{var n,r;return t.target===e.currentTarget||(null===(n=e.currentTarget)||void 0===n||null===(r=n.contains)||void 0===r?void 0:r.call(n,t.target))}))}(e).map((e=>e.identifier))}function Y(e,t){const[n,r]=Array.from(e.touches).filter((e=>t.includes(e.identifier)));return q(n,r)}function X(e){const t=H(e);return G(e)?t.identifier:t.pointerId}function Z(e){const t=H(e);return[t.clientX,t.clientY]}function K(e){let{deltaX:t,deltaY:n,deltaMode:r}=e;return 1===r?(t*=40,n*=40):2===r&&(t*=800,n*=800),[t,n]}function J(e,...t){return"function"===typeof e?e(...t):e}function $(){}function ee(...e){return 0===e.length?$:1===e.length?e[0]:function(){let t;for(const n of e)t=n.apply(this,arguments)||t;return t}}function te(e,t){return Object.assign({},t,e||{})}class ne{constructor(e,t,n){this.ctrl=e,this.args=t,this.key=n,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:n,args:r}=this;t[n]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=r,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,n=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=n.from?J(n.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:n,shared:r}=this;t.args=this.args;let i=0;if(e&&(t.event=e,n.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,r.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,r.locked=!!document.pointerLockElement,Object.assign(r,function(e){const t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){const{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o}=e;Object.assign(t,{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o})}return t}(e)),r.down=r.pressed=r.buttons%2===1||r.touches>0,i=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const e=t._delta.map(Math.abs);D.addTo(t._distance,e)}this.axisIntent&&this.axisIntent(e);const[o,s]=t._movement,[a,c]=n.threshold,{_step:l,values:u}=t;if(n.hasCustomTransform?(!1===l[0]&&(l[0]=Math.abs(o)>=a&&u[0]),!1===l[1]&&(l[1]=Math.abs(s)>=c&&u[1])):(!1===l[0]&&(l[0]=Math.abs(o)>=a&&Math.sign(o)*a),!1===l[1]&&(l[1]=Math.abs(s)>=c&&Math.sign(s)*c)),t.intentional=!1!==l[0]||!1!==l[1],!t.intentional)return;const h=[0,0];if(n.hasCustomTransform){const[e,t]=u;h[0]=!1!==l[0]?e-l[0]:0,h[1]=!1!==l[1]?t-l[1]:0}else h[0]=!1!==l[0]?o-l[0]:0,h[1]=!1!==l[1]?s-l[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(h);const d=t.offset,A=t._active&&!t._blocked||t.active;A&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=r[this.ingKey]=t._active,e&&(t.first&&("bounds"in n&&(t._bounds=J(n.bounds,t)),this.setup&&this.setup()),t.movement=h,this.computeOffset()));const[m,p]=t.offset,[[f,g],[y,v]]=t._bounds;t.overflow=[m<f?-1:m>g?1:0,p<y?-1:p>v?1:0],t._movementBound[0]=!!t.overflow[0]&&(!1===t._movementBound[0]?t._movement[0]:t._movementBound[0]),t._movementBound[1]=!!t.overflow[1]&&(!1===t._movementBound[1]?t._movement[1]:t._movementBound[1]);const x=t._active&&n.rubberband||[0,0];if(t.offset=function(e,[t,n],[r,i]){const[[o,s],[a,c]]=e;return[Q(t,o,s,r),Q(n,a,c,i)]}(t._bounds,t.offset,x),t.delta=D.sub(t.offset,d),this.computeMovement(),A&&(!t.last||i>32)){t.delta=D.sub(t.offset,d);const e=t.delta.map(Math.abs);D.addTo(t.distance,e),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&i>0&&(t.velocity=[e[0]/i,e[1]/i],t.timeDelta=i)}}emit(){const e=this.state,t=this.shared,n=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!n.triggerAllEvents)return;const r=this.handler(F(F(F({},t),e),{},{[this.aliasKey]:e.values}));void 0!==r&&(e.memo=r)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}class re extends ne{constructor(...e){super(...e),z(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=D.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=D.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,n=this.config;if(!t.axis&&e){const r="object"===typeof n.axisThreshold?n.axisThreshold[j(e)]:n.axisThreshold;t.axis=function([e,t],n){const r=Math.abs(e),i=Math.abs(t);return r>i&&r>n?"x":i>r&&i>n?"y":void 0}(t._movement,r)}t._blocked=(n.lockDirection||!!n.axis)&&!t.axis||!!n.axis&&n.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0}}}const ie=e=>e,oe={enabled:(e=!0)=>e,eventOptions:(e,t,n)=>F(F({},n.shared.eventOptions),e),preventDefault:(e=!1)=>e,triggerAllEvents:(e=!1)=>e,rubberband(e=0){switch(e){case!0:return[.15,.15];case!1:return[0,0];default:return D.toVector(e)}},from:e=>"function"===typeof e?e:null!=e?D.toVector(e):void 0,transform(e,t,n){const r=e||n.shared.transform;return this.hasCustomTransform=!!r,r||ie},threshold:e=>D.toVector(e,0)};const se=F(F({},oe),{},{axis(e,t,{axis:n}){if(this.lockDirection="lock"===n,!this.lockDirection)return n},axisThreshold:(e=0)=>e,bounds(e={}){if("function"===typeof e)return t=>se.bounds(e(t));if("current"in e)return()=>e.current;if("function"===typeof HTMLElement&&e instanceof HTMLElement)return e;const{left:t=-1/0,right:n=1/0,top:r=-1/0,bottom:i=1/0}=e;return[[t,n],[r,i]]}}),ae={ArrowRight:(e,t=1)=>[e*t,0],ArrowLeft:(e,t=1)=>[-1*e*t,0],ArrowUp:(e,t=1)=>[0,-1*e*t],ArrowDown:(e,t=1)=>[0,e*t]};const ce="undefined"!==typeof window&&window.document&&window.document.createElement;function le(){return ce&&"ontouchstart"in window}const ue={isBrowser:ce,gesture:function(){try{return"constructor"in GestureEvent}catch(lm){return!1}}(),touch:le(),touchscreen:le()||ce&&window.navigator.maxTouchPoints>1,pointer:ce&&"onpointerdown"in window,pointerLock:ce&&"exitPointerLock"in window.document},he={mouse:0,touch:0,pen:8},de=F(F({},se),{},{device(e,t,{pointer:{touch:n=!1,lock:r=!1,mouse:i=!1}={}}){return this.pointerLock=r&&ue.pointerLock,ue.touch&&n?"touch":this.pointerLock?"mouse":ue.pointer&&!i?"pointer":ue.touch?"touch":"mouse"},preventScrollAxis(e,t,{preventScroll:n}){if(this.preventScrollDelay="number"===typeof n?n:n||void 0===n&&e?250:void 0,ue.touchscreen&&!1!==n)return e||(void 0!==n?"y":void 0)},pointerCapture(e,t,{pointer:{capture:n=!0,buttons:r=1,keys:i=!0}={}}){return this.pointerButtons=r,this.keys=i,!this.pointerLock&&"pointer"===this.device&&n},threshold(e,t,{filterTaps:n=!1,tapsThreshold:r=3,axis:i}){const o=D.toVector(e,n?r:i?1:0);return this.filterTaps=n,this.tapsThreshold=r,o},swipe({velocity:e=.5,distance:t=50,duration:n=250}={}){return{velocity:this.transform(D.toVector(e)),distance:this.transform(D.toVector(t)),duration:n}},delay(e=0){switch(e){case!0:return 180;case!1:return 0;default:return e}},axisThreshold:e=>e?F(F({},he),e):he,keyboardDisplacement:(e=10)=>e});function Ae(e){const[t,n]=e.overflow,[r,i]=e._delta,[o,s]=e._direction;(t<0&&r>0&&o<0||t>0&&r<0&&o>0)&&(e._movement[0]=e._movementBound[0]),(n<0&&i>0&&s<0||n>0&&i<0&&s>0)&&(e._movement[1]=e._movementBound[1])}const me=F(F({},oe),{},{device(e,t,{shared:n,pointer:{touch:r=!1}={}}){if(n.target&&!ue.touch&&ue.gesture)return"gesture";if(ue.touch&&r)return"touch";if(ue.touchscreen){if(ue.pointer)return"pointer";if(ue.touch)return"touch"}},bounds(e,t,{scaleBounds:n={},angleBounds:r={}}){const i=e=>{const t=te(J(n,e),{min:-1/0,max:1/0});return[t.min,t.max]},o=e=>{const t=te(J(r,e),{min:-1/0,max:1/0});return[t.min,t.max]};return"function"!==typeof n&&"function"!==typeof r?[i(),o()]:e=>[i(e),o(e)]},threshold(e,t,n){this.lockDirection="lock"===n.axis;return D.toVector(e,this.lockDirection?[.1,3]:0)},modifierKey:e=>void 0===e?"ctrlKey":e,pinchOnWheel:(e=!0)=>e});const pe=F(F({},se),{},{mouseOnly:(e=!0)=>e});const fe=se;const ge=se;const ye=F(F({},se),{},{mouseOnly:(e=!0)=>e}),ve=new Map,xe=new Map;function Ee(e){ve.set(e.key,e.engine),xe.set(e.key,e.resolver)}const we={key:"drag",engine:class extends re{constructor(...e){super(...e),z(this,"ingKey","dragging")}reset(){super.reset();const e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){const e=this.state;if(e._bounds instanceof HTMLElement){const t=e._bounds.getBoundingClientRect(),n=e.currentTarget.getBoundingClientRect(),r={left:t.left-n.left+e.offset[0],right:t.right-n.right+e.offset[0],top:t.top-n.top+e.offset[1],bottom:t.bottom-n.bottom+e.offset[1]};e._bounds=se.bounds(r)}}cancel(){const e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout((()=>{this.compute(),this.emit()}),0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){const t=this.config,n=this.state;if(null!=e.buttons&&(Array.isArray(t.pointerButtons)?!t.pointerButtons.includes(e.buttons):-1!==t.pointerButtons&&t.pointerButtons!==e.buttons))return;const r=this.ctrl.setEventIds(e);t.pointerCapture&&e.target.setPointerCapture(e.pointerId),r&&r.size>1&&n._pointerActive||(this.start(e),this.setupPointer(e),n._pointerId=X(e),n._pointerActive=!0,this.computeValues(Z(e)),this.computeInitial(),t.preventScrollAxis&&"mouse"!==j(e)?(n._active=!1,this.setupScrollPrevention(e)):t.delay>0?(this.setupDelayTrigger(e),t.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){const t=this.state;t._active=!0,t._preventScroll=!0,t._delayed=!1,this.compute(e),this.emit()}pointerMove(e){const t=this.state,n=this.config;if(!t._pointerActive)return;const r=X(e);if(void 0!==t._pointerId&&r!==t._pointerId)return;const i=Z(e);return document.pointerLockElement===e.target?t._delta=[e.movementX,e.movementY]:(t._delta=D.sub(i,t._values),this.computeValues(i)),D.addTo(t._movement,t._delta),this.compute(e),t._delayed&&t.intentional?(this.timeoutStore.remove("dragDelay"),t.active=!1,void this.startPointerDrag(e)):n.preventScrollAxis&&!t._preventScroll?t.axis?t.axis===n.preventScrollAxis||"xy"===n.preventScrollAxis?(t._active=!1,void this.clean()):(this.timeoutStore.remove("startPointerDrag"),void this.startPointerDrag(e)):void 0:void this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch(s){0}const t=this.state,n=this.config;if(!t._active||!t._pointerActive)return;const r=X(e);if(void 0!==t._pointerId&&r!==t._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);const[i,o]=t._distance;if(t.tap=i<=n.tapsThreshold&&o<=n.tapsThreshold,t.tap&&n.filterTaps)t._force=!0;else{const[e,r]=t._delta,[i,o]=t._movement,[s,a]=n.swipe.velocity,[c,l]=n.swipe.distance,u=n.swipe.duration;if(t.elapsedTime<u){const n=Math.abs(e/t.timeDelta),u=Math.abs(r/t.timeDelta);n>s&&Math.abs(i)>c&&(t.swipe[0]=Math.sign(e)),u>a&&Math.abs(o)>l&&(t.swipe[1]=Math.sign(r))}}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){const t=this.config,n=t.device;t.pointerLock&&e.currentTarget.requestPointerLock(),t.pointerCapture||(this.eventStore.add(this.sharedConfig.window,n,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){this.state._preventScroll=!1,function(e){"persist"in e&&"function"===typeof e.persist&&e.persist()}(e);const t=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",t),this.eventStore.add(this.sharedConfig.window,"touch","cancel",t),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",(()=>{this.state._step=[0,0],this.startPointerDrag(e)}),this.config.delay)}keyDown(e){const t=ae[e.key];if(t){const n=this.state,r=e.shiftKey?10:e.altKey?.1:1;this.start(e),n._delta=t(this.config.keyboardDisplacement,r),n._keyboardActive=!0,D.addTo(n._movement,n._delta),this.compute(e),this.emit()}}keyUp(e){e.key in ae&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){const t=this.config.device;e(t,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(t,"change",this.pointerMove.bind(this)),e(t,"end",this.pointerUp.bind(this)),e(t,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}},resolver:de},Ce={key:"hover",engine:class extends re{constructor(...e){super(...e),z(this,"ingKey","hovering")}enter(e){this.config.mouseOnly&&"mouse"!==e.pointerType||(this.start(e),this.computeValues(Z(e)),this.compute(e),this.emit())}leave(e){if(this.config.mouseOnly&&"mouse"!==e.pointerType)return;const t=this.state;if(!t._active)return;t._active=!1;const n=Z(e);t._movement=t._delta=D.sub(n,t._values),this.computeValues(n),this.compute(e),t.delta=t.movement,this.emit()}bind(e){e("pointer","enter",this.enter.bind(this)),e("pointer","leave",this.leave.bind(this))}},resolver:ye},Ie={key:"move",engine:class extends re{constructor(...e){super(...e),z(this,"ingKey","moving")}move(e){this.config.mouseOnly&&"mouse"!==e.pointerType||(this.state._active?this.moveChange(e):this.moveStart(e),this.timeoutStore.add("moveEnd",this.moveEnd.bind(this)))}moveStart(e){this.start(e),this.computeValues(Z(e)),this.compute(e),this.computeInitial(),this.emit()}moveChange(e){if(!this.state._active)return;const t=Z(e),n=this.state;n._delta=D.sub(t,n._values),D.addTo(n._movement,n._delta),this.computeValues(t),this.compute(e),this.emit()}moveEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}bind(e){e("pointer","change",this.move.bind(this)),e("pointer","leave",this.moveEnd.bind(this))}},resolver:pe},_e={key:"pinch",engine:class extends ne{constructor(...e){super(...e),z(this,"ingKey","pinching"),z(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:t,lastOffset:n}=this.state;this.state.offset="wheel"===e?D.add(t,n):[(1+t[0])*n[0],t[1]+n[1]]}computeMovement(){const{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){const e=this.state,[t,n]=e._movement;if(!e.axis){const r=30*Math.abs(t)-Math.abs(n);r<0?e.axis="angle":r>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&("scale"===this.state.axis?e[1]=0:"angle"===this.state.axis&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout((()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()}),0)}touchStart(e){this.ctrl.setEventIds(e);const t=this.state,n=this.ctrl.touchIds;if(t._active&&t._touchIds.every((e=>n.has(e))))return;if(n.size<2)return;this.start(e),t._touchIds=Array.from(n).slice(0,2);const r=Y(e,t._touchIds);r&&this.pinchStart(e,r)}pointerStart(e){if(null!=e.buttons&&e.buttons%2!==1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const t=this.state,n=t._pointerEvents,r=this.ctrl.pointerIds;if(t._active&&Array.from(n.keys()).every((e=>r.has(e))))return;if(n.size<2&&n.set(e.pointerId,e),t._pointerEvents.size<2)return;this.start(e);const i=q(...Array.from(n.values()));i&&this.pinchStart(e,i)}pinchStart(e,t){this.state.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const t=Y(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){const t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;const n=q(...Array.from(t.values()));n&&this.pinchMove(e,n)}pinchMove(e,t){const n=this.state,r=n._values[1],i=t.angle-r;let o=0;Math.abs(i)>270&&(o+=Math.sign(i)),this.computeValues([t.distance,t.angle-360*o]),n.origin=t.origin,n.turns=o,n._movement=[n._values[0]/n._initial[0]-1,n._values[1]-n._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some((e=>!this.ctrl.touchIds.has(e)))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch(n){}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];const n=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=D.sub(t._movement,n),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const t=this.config.modifierKey;t&&!(Array.isArray(t)?t.find((t=>e[t])):e[t])||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const t=this.state;t._delta=[-K(e)[1]/100*t.offset[0],0],D.addTo(t._movement,t._delta),Ae(t),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}},resolver:me},be={key:"scroll",engine:class extends re{constructor(...e){super(...e),z(this,"ingKey","scrolling")}scroll(e){this.state._active||this.start(e),this.scrollChange(e),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(e){e.cancelable&&e.preventDefault();const t=this.state,n=function(e){var t,n;const{scrollX:r,scrollY:i,scrollLeft:o,scrollTop:s}=e.currentTarget;return[null!==(t=null!==r&&void 0!==r?r:o)&&void 0!==t?t:0,null!==(n=null!==i&&void 0!==i?i:s)&&void 0!==n?n:0]}(e);t._delta=D.sub(n,t._values),D.addTo(t._movement,t._delta),this.computeValues(n),this.compute(e),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("scroll","",this.scroll.bind(this))}},resolver:fe},Be={key:"wheel",engine:class extends re{constructor(...e){super(...e),z(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const t=this.state;t._delta=K(e),D.addTo(t._movement,t._delta),Ae(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}},resolver:ge};function Me(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}const Se={target(e){if(e)return()=>"current"in e?e.current:e},enabled:(e=!0)=>e,window:(e=(ue.isBrowser?window:void 0))=>e,eventOptions:({passive:e=!0,capture:t=!1}={})=>({passive:e,capture:t}),transform:e=>e},De=["target","eventOptions","window","enabled","transform"];function Te(e={},t){const n={};for(const[r,i]of Object.entries(t))switch(typeof i){case"function":n[r]=i.call(n,e[r],r,e);break;case"object":n[r]=Te(e[r],i);break;case"boolean":i&&(n[r]=e[r])}return n}class Qe{constructor(e,t){z(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,n,r,i){const o=this._listeners,s=function(e,t=""){const n=k[e];return e+(n&&n[t]||t)}(t,n),a=F(F({},this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{}),i);e.addEventListener(s,r,a);const c=()=>{e.removeEventListener(s,r,a),o.delete(c)};return o.add(c),c}clean(){this._listeners.forEach((e=>e())),this._listeners.clear()}}class Pe{constructor(){z(this,"_timeouts",new Map)}add(e,t,n=140,...r){this.remove(e),this._timeouts.set(e,window.setTimeout(t,n,...r))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach((e=>{window.clearTimeout(e)})),this._timeouts.clear()}}class ze{constructor(e){z(this,"gestures",new Set),z(this,"_targetEventStore",new Qe(this)),z(this,"gestureEventStores",{}),z(this,"gestureTimeoutStores",{}),z(this,"handlers",{}),z(this,"config",{}),z(this,"pointerIds",new Set),z(this,"touchIds",new Set),z(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),function(e,t){t.drag&&Re(e,"drag");t.wheel&&Re(e,"wheel");t.scroll&&Re(e,"scroll");t.move&&Re(e,"move");t.pinch&&Re(e,"pinch");t.hover&&Re(e,"hover")}(this,e)}setEventIds(e){return G(e)?(this.touchIds=new Set(W(e)),this.touchIds):"pointerId"in e?("pointerup"===e.type||"pointercancel"===e.type?this.pointerIds.delete(e.pointerId):"pointerdown"===e.type&&this.pointerIds.add(e.pointerId),this.pointerIds):void 0}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=function(e,t,n={}){const r=e,{target:i,eventOptions:o,window:s,enabled:a,transform:c}=r,l=Me(r,De);if(n.shared=Te({target:i,eventOptions:o,window:s,enabled:a,transform:c},Se),t){const e=xe.get(t);n[t]=Te(F({shared:n.shared},l),e)}else for(const u in l){const e=xe.get(u);e&&(n[u]=Te(F({shared:n.shared},l[u]),e))}return n}(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,n={};let r;if(!t.target||(r=t.target(),r)){if(t.enabled){for(const t of this.gestures){const i=this.config[t],o=Fe(n,i.eventOptions,!!r);if(i.enabled){new(ve.get(t))(this,e,t).bind(o)}}const i=Fe(n,t.eventOptions,!!r);for(const t in this.nativeHandlers)i(t,"",(n=>this.nativeHandlers[t](F(F({},this.state.shared),{},{event:n,args:e}))),void 0,!0)}for(const e in n)n[e]=ee(...n[e]);if(!r)return n;for(const e in n){const{device:t,capture:i,passive:o}=V(e);this._targetEventStore.add(r,t,"",n[e],{capture:i,passive:o})}}}}function Re(e,t){e.gestures.add(t),e.gestureEventStores[t]=new Qe(e,t),e.gestureTimeoutStores[t]=new Pe}const Fe=(e,t,n)=>(r,i,o,s={},a=!1)=>{var c,l;const u=null!==(c=s.capture)&&void 0!==c?c:t.capture,h=null!==(l=s.passive)&&void 0!==l?l:t.passive;let d=a?r:U(r,i,u);n&&h&&(d+="Passive"),e[d]=e[d]||[],e[d].push(o)},ke=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function Le(e,t,n,r,i,o){if(!e.has(n))return;if(!ve.has(r))return void 0;const s=n+"Start",a=n+"End";i[r]=e=>{let r;return e.first&&s in t&&t[s](e),n in t&&(r=t[n](e)),e.last&&a in t&&t[a](e),r},o[r]=o[r]||{}}function Oe(e,t){const[n,r,i]=function(e){const t={},n={},r=new Set;for(let i in e)ke.test(i)?(r.add(RegExp.lastMatch),n[i]=e[i]):t[i]=e[i];return[n,t,r]}(e),o={};return Le(i,n,"onDrag","drag",o,t),Le(i,n,"onWheel","wheel",o,t),Le(i,n,"onScroll","scroll",o,t),Le(i,n,"onPinch","pinch",o,t),Le(i,n,"onMove","move",o,t),Le(i,n,"onHover","hover",o,t),{handlers:o,config:t,nativeHandlers:r}}function Ue(e,t={},n,r){const o=i.useMemo((()=>new ze(e)),[]);if(o.applyHandlers(e,r),o.applyConfig(t,n),i.useEffect(o.effect.bind(o)),i.useEffect((()=>o.clean.bind(o)),[]),void 0===t.target)return o.bind.bind(o)}function Ne(e,t){const n=([we,_e,be,Be,Ie,Ce].forEach(Ee),function(e,t){const{handlers:n,nativeHandlers:r,config:i}=Oe(e,t||{});return Ue(n,i,void 0,r)});return n(e,t||{})}const Ve=new s.Vector3,Ge=new s.Vector2,je=new s.Vector3,He=new s.Vector3,qe=new s.Vector3,We=new s.Plane,Ye=i.forwardRef((({autoTransform:e=!0,matrix:t,axisLock:n,dragLimits:o,onHover:c,onDragStart:l,onDrag:u,onDragEnd:h,children:d,dragConfig:A,...m},p)=>{const f=(0,a.D)((e=>e.controls)),{camera:g,size:y,raycaster:v,invalidate:x}=(0,a.D)(),E=i.useRef(null),w=Ne({onHover:({hovering:e})=>c&&c(null!==e&&void 0!==e&&e),onDragStart:({event:e})=>{f&&(f.enabled=!1);const{point:t}=e;E.current.matrix.decompose(Ve,new s.Quaternion,new s.Vector3),je.copy(t),He.copy(je).sub(Ve),l&&l(Ve),x()},onDrag:({xy:[t,r],intentional:i})=>{if(!i)return;const a=(t-y.left)/y.width*2-1,c=-(r-y.top)/y.height*2+1;if(Ge.set(a,c),v.setFromCamera(Ge,g),n)switch(n){case"x":qe.set(1,0,0);break;case"y":qe.set(0,1,0);break;case"z":qe.set(0,0,1)}else g.getWorldDirection(qe).negate();We.setFromNormalAndCoplanarPoint(qe,je),v.ray.intersectPlane(We,je);const l=E.current.matrix.clone(),h=E.current.matrixWorld.clone(),d=new s.Vector3(je.x-He.x,je.y-He.y,je.z-He.z);if(o&&(d.x=o[0]?Math.max(Math.min(d.x,o[0][1]),o[0][0]):d.x,d.y=o[1]?Math.max(Math.min(d.y,o[1][1]),o[1][0]):d.y,d.z=o[2]?Math.max(Math.min(d.z,o[2][1]),o[2][0]):d.z),e){E.current.matrix.setPosition(d);const e=E.current.matrix.clone().multiply(l.invert()),t=E.current.matrix.clone().multiply(h.invert());u&&u(E.current.matrix,e,E.current.matrixWorld,t)}else{const e=(new s.Matrix4).copy(E.current.matrix);e.setPosition(d);const t=e.clone().multiply(l.invert()),n=e.clone().multiply(h.invert());u&&u(e,t,E.current.matrixWorld,n)}x()},onDragEnd:()=>{f&&(f.enabled=!0),h&&h(),x()}},{drag:{filterTaps:!0,threshold:1,..."object"===typeof A?A:{}}});return i.useImperativeHandle(p,(()=>E.current),[]),i.useLayoutEffect((()=>{t&&(E.current.matrix=t)}),[t]),i.createElement("group",(0,r.Z)({ref:E},w(),{matrix:t,matrixAutoUpdate:!1},m),d)}));function Xe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ze(e,t){return Ze=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ze(e,t)}function Ke(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(lm){return!1}}function Je(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],c=t[5],l=t[6],u=t[7],h=t[8];return r*a*h+i*c*l+o*s*u-o*a*l-i*s*h-r*c*u}function $e(e,t){for(var n=[],r=e.toArray(),i=t.toArray(),o=0;o<r.length;o++)n[o]=r[o]+i[o];return(new s.Matrix3).fromArray(n)}function et(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function tt(e,t){if(e){if("string"===typeof e)return et(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?et(e,t):void 0}}function nt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],s=!0,a=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);s=!0);}catch(c){a=!0,i=c}finally{try{s||null==n.return||n.return()}finally{if(a)throw i}}return o}}(e,t)||tt(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rt(e){return function(e){if(Array.isArray(e))return et(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||tt(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function it(e,t,n){return it=Ke()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&Ze(i,n.prototype),i},it.apply(null,arguments)}function ot(e){var t=nt(e[0],2),n=t[0],r=t[1],i=nt(e[1],2),o=i[0],s=i[1],a=nt(e[2],2);return Je(n,r,1,o,s,1,a[0],a[1],1)}function st(e){return 0===ot(e)}var at=new s.Vector2,ct=new s.Vector2;function lt(e){var t=e.map((function(e){return Array.isArray(e)?it(s.Vector2,rt(e)):e})),n=nt(t,3),r=n[0],i=n[1],o=n[2];if(st(e))return!1;var a=at.subVectors(i,r);return ct.subVectors(o,r).cross(a)>0}function ut(e,t,n){return Math.max(t,Math.min(n,e))}function ht(e,t){return ut(e-Math.floor(e/t)*t,0,t)}function dt(e,t){var n=ht(t-e,2*Math.PI);return n>Math.PI&&(n-=2*Math.PI),n}function At(e,t){return e.x===t.x?"undefined"!==typeof e.z&&e.y===t.y?e.z-t.z:e.y-t.y:e.x-t.x}function mt(e){return e*e*e*(e*(6*e-15)+10)}function pt(e,t,n){return e*(1-n)+t*n}function ft(e,t,n){return(n-e)/(t-e)}function gt(e,t){var n=(new s.Vector3).crossVectors(e,t),r=e.dot(t),i=(new s.Matrix3).identity(),o=(new s.Matrix3).set(0,-n.z,n.y,n.z,0,-n.x,-n.y,n.x,0),a=(new s.Matrix3).multiplyMatrices(o,o).multiplyScalar(1/(1+r));return $e($e(i,o),a)}var yt=Object.freeze({__proto__:null,clamp:ut,repeat:ht,deltaAngle:dt,degToRad:function(e){return e/180*Math.PI},radToDeg:function(e){return 180*e/Math.PI},fibonacciOnSphere:function(e,t){for(var n=t.radius,r=void 0===n?1:n,i=e.length/3,o=2/i,s=Math.PI*(3-2.2360679775),a=0;a<e.length;a+=3){var c=a*o-1+o/2,l=Math.sqrt(1-Math.pow(c,2)),u=a%i*s,h=Math.cos(u)*l,d=Math.sin(u)*l;e[a]=h*r,e[a+1]=c*r,e[a+2]=d*r}},vectorEquals:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.EPSILON;return Math.abs(e.x-t.x)<n&&Math.abs(e.y-t.y)<n&&Math.abs(e.z-t.z)<n},lexicographic:At,convexHull:function(e){for(var t=e.sort(At),n=[t[0],t[1]],r=2;r<t.length;r++)for(n.push(t[r]);n.length>2&&lt(rt(n.slice(-3)));)n.splice(n.length-2,1);for(var i=[t[t.length-1],t[t.length-2]],o=t.length-3;o>=0;o--)for(i.push(t[o]);i.length>2&&lt(rt(i.slice(-3)));)i.splice(i.length-2,1);return i.splice(0,1),i.splice(i.length-1,1),[].concat(n,i)},remap:function(e,t,n){var r=nt(t,2),i=r[0],o=r[1],s=nt(n,2),a=s[0];return a+(e-i)*(s[1]-a)/(o-i)},fade:mt,lerp:pt,inverseLerp:ft,normalize:function(e,t,n){var r=Math.sqrt(e*e+t*t+n*n);return[e/r,t/r,n/r]},pointOnCubeToPointOnSphere:function(e,t,n){var r=e*e,i=t*t,o=n*n;return[e*Math.sqrt(1-(i+o)/2+i*o/3),t*Math.sqrt(1-(o+r)/2+o*r/3),n*Math.sqrt(1-(r+i)/2+r*i/3)]},rotateVectorOnVector:gt,pointToCoordinate:function(e,t,n){return[Math.asin(t),Math.atan2(e,-n)]},coordinateToPoint:function(e,t){var n=Math.sin(e),r=Math.cos(e);return[Math.sin(t)*r,n,-Math.cos(t)*r]},planeSegmentIntersection:function(e,t){var n=nt(t,2),r=n[0],i=n[1],o=gt(e.normal,new s.Vector3(0,1,0)),a=ft(r.clone().applyMatrix3(o).y,i.clone().applyMatrix3(o).y,0);return(new s.Vector3).lerpVectors(r,i,a)},pointToPlaneDistance:function(e,t){return t.normal.dot(e)},getIndexFrom3D:function(e,t){var n=nt(e,3),r=n[0],i=n[1],o=n[2],s=nt(t,2),a=s[0];return o*a*s[1]+i*a+r},get3DFromIndex:function(e,t){var n=nt(t,2),r=n[0],i=r*n[1],o=e/i,s=e-i*o;return[s%r,s/r,o]},getIndexFrom2D:function(e,t){return e[0]+t[0]*e[1]},get2DFromIndex:function(e,t){return[e%t,Math.floor(e/t)]}});function vt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var xt=function e(t,n,r){var i=this;vt(this,e),Xe(this,"dot2",(function(e,t){return i.x*e+i.y*t})),Xe(this,"dot3",(function(e,t,n){return i.x*e+i.y*t+i.z*n})),this.x=t,this.y=n,this.z=r},Et=[new xt(1,1,0),new xt(-1,1,0),new xt(1,-1,0),new xt(-1,-1,0),new xt(1,0,1),new xt(-1,0,1),new xt(1,0,-1),new xt(-1,0,-1),new xt(0,1,1),new xt(0,-1,1),new xt(0,1,-1),new xt(0,-1,-1)],wt=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],Ct=new Array(512),It=new Array(512),_t=function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var n;n=1&t?wt[t]^255&e:wt[t]^e>>8&255,Ct[t]=Ct[t+256]=n,It[t]=It[t+256]=Et[n%12]}};_t(0);Math.sqrt(3),Math.sqrt(3),Math.PI;function bt(e){var t=function(e){if("number"===typeof e)e=Math.abs(e);else if("string"===typeof e){var t=e;e=0;for(var n=0;n<t.length;n++)e=(e+(n+1)*(t.charCodeAt(n)%96))%2147483647}return 0===e&&(e=311),e}(e);return function(){var e=48271*t%2147483647;return t=e,e/2147483647}}var Bt=function e(t){var n=this;vt(this,e),Xe(this,"seed",0),Xe(this,"init",(function(e){n.seed=e,n.value=bt(e)})),Xe(this,"value",bt(this.seed)),this.init(t)};new Bt(Math.random());var Mt=function(e){return 1/(1+e+.48*e*e+.235*e*e*e)},St={in:function(e){return 1-Math.cos(e*Math.PI/2)},out:function(e){return Math.sin(e*Math.PI/2)},inOut:function(e){return-(Math.cos(Math.PI*e)-1)/2}},Dt={in:function(e){return e*e*e},out:function(e){return 1-Math.pow(1-e,3)},inOut:function(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}},Tt={in:function(e){return e*e*e*e*e},out:function(e){return 1-Math.pow(1-e,5)},inOut:function(e){return e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2}},Qt={in:function(e){return 1-Math.sqrt(1-Math.pow(e,2))},out:function(e){return Math.sqrt(1-Math.pow(e-1,2))},inOut:function(e){return e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2}},Pt={in:function(e){return 0===e?0:Math.pow(2,10*e-10)},out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},inOut:function(e){return 0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2}};function zt(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.25,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.01,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Mt,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:.001,c="velocity_"+t;if(void 0===e.__damp&&(e.__damp={}),void 0===e.__damp[c]&&(e.__damp[c]=0),Math.abs(e[t]-n)<=a)return e[t]=n,!1;var l=2/(r=Math.max(1e-4,r)),u=s(l*i),h=e[t]-n,d=n,A=o*r;h=Math.min(Math.max(h,-A),A),n=e[t]-h;var m=(e.__damp[c]+l*h)*i;e.__damp[c]=(e.__damp[c]-l*m)*u;var p=n+(h+m)*u;return d-e[t]>0===p>d&&(p=d,e.__damp[c]=(p-d)/i),e[t]=p,!0}var Rt=new s.Vector3,Ft=new s.Quaternion,kt=new s.Quaternion,Lt=new s.Matrix4,Ot=new s.Vector3;function Ut(e,t,n,r,i,o,s,a){return zt(e,t,e[t]+dt(e[t],n),r,i,o,s,a)}var Nt,Vt,Gt=new s.Vector2;var jt,Ht,qt,Wt=new s.Vector3;function Yt(e,t,n,r,i,o,s){return"number"===typeof t?Wt.setScalar(t):Array.isArray(t)?Wt.set(t[0],t[1],t[2]):Wt.copy(t),jt=zt(e,"x",Wt.x,n,r,i,o,s),Ht=zt(e,"y",Wt.y,n,r,i,o,s),qt=zt(e,"z",Wt.z,n,r,i,o,s),jt||Ht||qt}var Xt,Zt,Kt,Jt,$t=new s.Vector4;var en,tn,nn,rn=new s.Euler;var on,sn,an,cn=new s.Color;var ln,un,hn,dn,An=new s.Quaternion,mn=new s.Vector4,pn=new s.Vector4,fn=new s.Vector4;function gn(e,t,n,r,i,o,s){var a=e;Array.isArray(t)?An.set(t[0],t[1],t[2],t[3]):An.copy(t);var c=e.dot(An)>0?1:-1;return An.x*=c,An.y*=c,An.z*=c,An.w*=c,ln=zt(e,"x",An.x,n,r,i,o,s),un=zt(e,"y",An.y,n,r,i,o,s),hn=zt(e,"z",An.z,n,r,i,o,s),dn=zt(e,"w",An.w,n,r,i,o,s),mn.set(e.x,e.y,e.z,e.w).normalize(),pn.set(a.__damp.velocity_x,a.__damp.velocity_y,a.__damp.velocity_z,a.__damp.velocity_w),fn.copy(mn).multiplyScalar(pn.dot(mn)/mn.dot(mn)),a.__damp.velocity_x-=fn.x,a.__damp.velocity_y-=fn.y,a.__damp.velocity_z-=fn.z,a.__damp.velocity_w-=fn.w,e.set(mn.x,mn.y,mn.z,mn.w),ln||un||hn||dn}var yn,vn,xn,En=new s.Spherical;var wn,Cn,In,_n=new s.Matrix4,bn=new s.Vector3,Bn=new s.Quaternion,Mn=new s.Vector3;var Sn=Object.freeze({__proto__:null,rsqw:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/(2*Math.PI);return n/Math.atan(1/t)*Math.atan(Math.sin(2*Math.PI*e*r)/t)},exp:Mt,linear:function(e){return e},sine:St,cubic:Dt,quint:Tt,circ:Qt,quart:{in:function(e){return e*e*e*e},out:function(e){return 1- --e*e*e*e},inOut:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e}},expo:Pt,damp:zt,dampLookAt:function(e,t,n,r,i,o,s){"number"===typeof t?Rt.setScalar(t):Array.isArray(t)?Rt.set(t[0],t[1],t[2]):Rt.copy(t);var a=e.parent;e.updateWorldMatrix(!0,!1),Ot.setFromMatrixPosition(e.matrixWorld),function(e){return e&&e.isCamera}(e)||function(e){return e&&e.isLight}(e)?Lt.lookAt(Ot,Rt,e.up):Lt.lookAt(Rt,Ot,e.up),gn(e.quaternion,kt.setFromRotationMatrix(Lt),n,r,i,o,s),a&&(Lt.extractRotation(a.matrixWorld),Ft.setFromRotationMatrix(Lt),gn(e.quaternion,kt.copy(e.quaternion).premultiply(Ft.invert()),n,r,i,o,s))},dampAngle:Ut,damp2:function(e,t,n,r,i,o,s){return"number"===typeof t?Gt.setScalar(t):Array.isArray(t)?Gt.set(t[0],t[1]):Gt.copy(t),Nt=zt(e,"x",Gt.x,n,r,i,o,s),Vt=zt(e,"y",Gt.y,n,r,i,o,s),Nt||Vt},damp3:Yt,damp4:function(e,t,n,r,i,o,s){return"number"===typeof t?$t.setScalar(t):Array.isArray(t)?$t.set(t[0],t[1],t[2],t[3]):$t.copy(t),Xt=zt(e,"x",$t.x,n,r,i,o,s),Zt=zt(e,"y",$t.y,n,r,i,o,s),Kt=zt(e,"z",$t.z,n,r,i,o,s),Jt=zt(e,"w",$t.w,n,r,i,o,s),Xt||Zt||Kt||Jt},dampE:function(e,t,n,r,i,o,s){return Array.isArray(t)?rn.set(t[0],t[1],t[2],t[3]):rn.copy(t),en=Ut(e,"x",rn.x,n,r,i,o,s),tn=Ut(e,"y",rn.y,n,r,i,o,s),nn=Ut(e,"z",rn.z,n,r,i,o,s),en||tn||nn},dampC:function(e,t,n,r,i,o,a){return t instanceof s.Color?cn.copy(t):Array.isArray(t)?cn.setRGB(t[0],t[1],t[2]):cn.set(t),on=zt(e,"r",cn.r,n,r,i,o,a),sn=zt(e,"g",cn.g,n,r,i,o,a),an=zt(e,"b",cn.b,n,r,i,o,a),on||sn||an},dampQ:gn,dampS:function(e,t,n,r,i,o,s){return Array.isArray(t)?En.set(t[0],t[1],t[2]):En.copy(t),yn=zt(e,"radius",En.radius,n,r,i,o,s),vn=Ut(e,"phi",En.phi,n,r,i,o,s),xn=Ut(e,"theta",En.theta,n,r,i,o,s),yn||vn||xn},dampM:function(e,t,n,r,i,o,a){var c=e;return void 0===c.__damp&&(c.__damp={position:new s.Vector3,rotation:new s.Quaternion,scale:new s.Vector3},e.decompose(c.__damp.position,c.__damp.rotation,c.__damp.scale)),Array.isArray(t)?_n.set.apply(_n,rt(t)):_n.copy(t),_n.decompose(bn,Bn,Mn),wn=Yt(c.__damp.position,bn,n,r,i,o,a),Cn=gn(c.__damp.rotation,Bn,n,r,i,o,a),In=Yt(c.__damp.scale,Mn,n,r,i,o,a),e.compose(c.__damp.position,c.__damp.rotation,c.__damp.scale),wn||Cn||In}});function Dn(e){return Dn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Dn(e)}function Tn(e,t){if(t&&("object"===typeof t||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}s.BufferGeometry;const Qn=i.createContext(null);function Pn(){return i.useContext(Qn)}function zn({eps:e=1e-5,enabled:t=!0,infinite:n,horizontal:r,pages:o=1,distance:s=1,damping:c=.25,maxSpeed:l=1/0,prepend:u=!1,style:h={},children:d}){const{get:A,setEvents:m,gl:p,size:f,invalidate:g,events:y}=(0,a.D)(),[v]=i.useState((()=>document.createElement("div"))),[x]=i.useState((()=>document.createElement("div"))),[E]=i.useState((()=>document.createElement("div"))),w=p.domElement.parentNode,C=i.useRef(0),I=i.useMemo((()=>{const t={el:v,eps:e,fill:x,fixed:E,horizontal:r,damping:c,offset:0,delta:0,scroll:C,pages:o,range(e,t,n=0){const r=e-n,i=r+t+2*n;return this.offset<r?0:this.offset>i?1:(this.offset-r)/(i-r)},curve(e,t,n=0){return Math.sin(this.range(e,t,n)*Math.PI)},visible(e,t,n=0){const r=e-n,i=r+t+2*n;return this.offset>=r&&this.offset<=i}};return t}),[e,c,r,o]);i.useEffect((()=>{v.style.position="absolute",v.style.width="100%",v.style.height="100%",v.style[r?"overflowX":"overflowY"]="auto",v.style[r?"overflowY":"overflowX"]="hidden",v.style.top="0px",v.style.left="0px";for(const n in h)v.style[n]=h[n];E.style.position="sticky",E.style.top="0px",E.style.left="0px",E.style.width="100%",E.style.height="100%",E.style.overflow="hidden",v.appendChild(E),x.style.height=r?"100%":o*s*100+"%",x.style.width=r?o*s*100+"%":"100%",x.style.pointerEvents="none",v.appendChild(x),u?w.prepend(v):w.appendChild(v),v[r?"scrollLeft":"scrollTop"]=1;const e=y.connected||p.domElement;requestAnimationFrame((()=>null==y.connect?void 0:y.connect(v)));const t=A().events.compute;return m({compute(e,t){const{left:n,top:r}=w.getBoundingClientRect(),i=e.clientX-n,o=e.clientY-r;t.pointer.set(i/t.size.width*2-1,-o/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),()=>{w.removeChild(v),m({compute:t}),null==y.connect||y.connect(e)}}),[o,s,r,v,x,E,w]),i.useEffect((()=>{if(y.connected===v){const e=f[r?"width":"height"],i=v[r?"scrollWidth":"scrollHeight"],o=i-e;let s=0,a=!0,c=!0;const l=()=>{if(t&&!c&&(g(),s=v[r?"scrollLeft":"scrollTop"],C.current=s/o,n)){if(!a)if(s>=o){const e=1-I.offset;v[r?"scrollLeft":"scrollTop"]=1,C.current=I.offset=-e,a=!0}else if(s<=0){const e=1+I.offset;v[r?"scrollLeft":"scrollTop"]=i,C.current=I.offset=e,a=!0}a&&setTimeout((()=>a=!1),40)}};v.addEventListener("scroll",l,{passive:!0}),requestAnimationFrame((()=>c=!1));const u=e=>v.scrollLeft+=e.deltaY/2;return r&&v.addEventListener("wheel",u,{passive:!0}),()=>{v.removeEventListener("scroll",l),r&&v.removeEventListener("wheel",u)}}}),[v,y,f,n,I,g,r,t]);let _=0;return(0,a.F)(((t,n)=>{_=I.offset,Sn.damp(I,"offset",C.current,c,n,l,void 0,e),Sn.damp(I,"delta",Math.abs(_-I.offset),c,n,l,void 0,e),I.delta>e&&g()})),i.createElement(Qn.Provider,{value:I},d)}const Rn=i.forwardRef((({children:e},t)=>{const n=i.useRef(null);i.useImperativeHandle(t,(()=>n.current),[]);const r=Pn(),{width:o,height:s}=(0,a.D)((e=>e.viewport));return(0,a.F)((()=>{n.current.position.x=r.horizontal?-o*(r.pages-1)*r.offset:0,n.current.position.y=r.horizontal?0:s*(r.pages-1)*r.offset})),i.createElement("group",{ref:n},e)})),Fn=i.forwardRef((({children:e,style:t,...n},s)=>{const c=Pn(),l=i.useRef(null);i.useImperativeHandle(s,(()=>l.current),[]);const{width:u,height:h}=(0,a.D)((e=>e.size)),d=i.useContext(a.g),A=i.useMemo((()=>o.createRoot(c.fixed)),[c.fixed]);return(0,a.F)((()=>{c.delta>c.eps&&(l.current.style.transform=`translate3d(${c.horizontal?-u*(c.pages-1)*c.offset:0}px,${c.horizontal?0:h*(c.pages-1)*-c.offset}px,0)`)})),A.render(i.createElement("div",(0,r.Z)({ref:l,style:{...t,position:"absolute",top:0,left:0,willChange:"transform"}},n),i.createElement(Qn.Provider,{value:c},i.createElement(a.g.Provider,{value:d},e)))),null})),kn=i.forwardRef((({html:e,...t},n)=>{const o=e?Fn:Rn;return i.createElement(o,(0,r.Z)({ref:n},t))}));let Ln=er();const On=e=>Zn(e,Ln);let Un=er();On.write=e=>Zn(e,Un);let Nn=er();On.onStart=e=>Zn(e,Nn);let Vn=er();On.onFrame=e=>Zn(e,Vn);let Gn=er();On.onFinish=e=>Zn(e,Gn);let jn=[];On.setTimeout=(e,t)=>{let n=On.now()+t,r=()=>{let e=jn.findIndex((e=>e.cancel==r));~e&&jn.splice(e,1),Yn-=~e?1:0},i={time:n,handler:e,cancel:r};return jn.splice(Hn(n),0,i),Yn+=1,Kn(),i};let Hn=e=>~(~jn.findIndex((t=>t.time>e))||~jn.length);On.cancel=e=>{Nn.delete(e),Vn.delete(e),Gn.delete(e),Ln.delete(e),Un.delete(e)},On.sync=e=>{Xn=!0,On.batchedUpdates(e),Xn=!1},On.throttle=e=>{let t;function n(){try{e(...t)}finally{t=null}}function r(...e){t=e,On.onStart(n)}return r.handler=e,r.cancel=()=>{Nn.delete(n),t=null},r};let qn="undefined"!=typeof window?window.requestAnimationFrame:()=>{};On.use=e=>qn=e,On.now="undefined"!=typeof performance?()=>performance.now():Date.now,On.batchedUpdates=e=>e(),On.catch=console.error,On.frameLoop="always",On.advance=()=>{"demand"!==On.frameLoop?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):$n()};let Wn=-1,Yn=0,Xn=!1;function Zn(e,t){Xn?(t.delete(e),e(0)):(t.add(e),Kn())}function Kn(){Wn<0&&(Wn=0,"demand"!==On.frameLoop&&qn(Jn))}function Jn(){~Wn&&(qn(Jn),On.batchedUpdates($n))}function $n(){let e=Wn;Wn=On.now();let t=Hn(Wn);t&&(tr(jn.splice(0,t),(e=>e.handler())),Yn-=t),Yn?(Nn.flush(),Ln.flush(e?Math.min(64,Wn-e):16.667),Vn.flush(),Un.flush(),Gn.flush()):Wn=-1}function er(){let e=new Set,t=e;return{add(n){Yn+=t!=e||e.has(n)?0:1,e.add(n)},delete:n=>(Yn-=t==e&&e.has(n)?1:0,e.delete(n)),flush(n){t.size&&(e=new Set,Yn-=t.size,tr(t,(t=>t(n)&&e.add(t))),Yn+=e.size,t=e)}}}function tr(e,t){e.forEach((e=>{try{t(e)}catch(lm){On.catch(lm)}}))}function nr(){}const rr={arr:Array.isArray,obj:e=>!!e&&"Object"===e.constructor.name,fun:e=>"function"===typeof e,str:e=>"string"===typeof e,num:e=>"number"===typeof e,und:e=>void 0===e};function ir(e,t){if(rr.arr(e)){if(!rr.arr(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}return e===t}const or=(e,t)=>e.forEach(t);function sr(e,t,n){if(rr.arr(e))for(let r=0;r<e.length;r++)t.call(n,e[r],`${r}`);else for(const r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r)}const ar=e=>rr.und(e)?[]:rr.arr(e)?e:[e];function cr(e,t){if(e.size){const n=Array.from(e);e.clear(),or(n,t)}}const lr=(e,...t)=>cr(e,(e=>e(...t))),ur=()=>"undefined"===typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent);let hr,dr,Ar=null,mr=!1,pr=nr;const fr=e=>{e.to&&(dr=e.to),e.now&&(On.now=e.now),void 0!==e.colors&&(Ar=e.colors),null!=e.skipAnimation&&(mr=e.skipAnimation),e.createStringInterpolator&&(hr=e.createStringInterpolator),e.requestAnimationFrame&&On.use(e.requestAnimationFrame),e.batchedUpdates&&(On.batchedUpdates=e.batchedUpdates),e.willAdvance&&(pr=e.willAdvance),e.frameLoop&&(On.frameLoop=e.frameLoop)};var gr=Object.freeze({__proto__:null,get createStringInterpolator(){return hr},get to(){return dr},get colors(){return Ar},get skipAnimation(){return mr},get willAdvance(){return pr},assign:fr});const yr=new Set;let vr=[],xr=[],Er=0;const wr={get idle(){return!yr.size&&!vr.length},start(e){Er>e.priority?(yr.add(e),On.onStart(Cr)):(Ir(e),On(br))},advance:br,sort(e){if(Er)On.onFrame((()=>wr.sort(e)));else{const t=vr.indexOf(e);~t&&(vr.splice(t,1),_r(e))}},clear(){vr=[],yr.clear()}};function Cr(){yr.forEach(Ir),yr.clear(),On(br)}function Ir(e){vr.includes(e)||_r(e)}function _r(e){vr.splice(function(e,t){const n=e.findIndex(t);return n<0?e.length:n}(vr,(t=>t.priority>e.priority)),0,e)}function br(e){const t=xr;for(let n=0;n<vr.length;n++){const r=vr[n];Er=r.priority,r.idle||(pr(r),r.advance(e),r.idle||t.push(r))}return Er=0,xr=vr,xr.length=0,vr=t,vr.length>0}const Br="[-+]?\\d*\\.?\\d+",Mr=Br+"%";function Sr(...e){return"\\(\\s*("+e.join(")\\s*,\\s*(")+")\\s*\\)"}const Dr=new RegExp("rgb"+Sr(Br,Br,Br)),Tr=new RegExp("rgba"+Sr(Br,Br,Br,Br)),Qr=new RegExp("hsl"+Sr(Br,Mr,Mr)),Pr=new RegExp("hsla"+Sr(Br,Mr,Mr,Br)),zr=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,Rr=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,Fr=/^#([0-9a-fA-F]{6})$/,kr=/^#([0-9a-fA-F]{8})$/;function Lr(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function Or(e,t,n){const r=n<.5?n*(1+t):n+t-n*t,i=2*n-r,o=Lr(i,r,e+1/3),s=Lr(i,r,e),a=Lr(i,r,e-1/3);return Math.round(255*o)<<24|Math.round(255*s)<<16|Math.round(255*a)<<8}function Ur(e){const t=parseInt(e,10);return t<0?0:t>255?255:t}function Nr(e){return(parseFloat(e)%360+360)%360/360}function Vr(e){const t=parseFloat(e);return t<0?0:t>1?255:Math.round(255*t)}function Gr(e){const t=parseFloat(e);return t<0?0:t>100?1:t/100}function jr(e){let t=function(e){let t;return"number"===typeof e?e>>>0===e&&e>=0&&e<=4294967295?e:null:(t=Fr.exec(e))?parseInt(t[1]+"ff",16)>>>0:Ar&&void 0!==Ar[e]?Ar[e]:(t=Dr.exec(e))?(Ur(t[1])<<24|Ur(t[2])<<16|Ur(t[3])<<8|255)>>>0:(t=Tr.exec(e))?(Ur(t[1])<<24|Ur(t[2])<<16|Ur(t[3])<<8|Vr(t[4]))>>>0:(t=zr.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+"ff",16)>>>0:(t=kr.exec(e))?parseInt(t[1],16)>>>0:(t=Rr.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+t[4]+t[4],16)>>>0:(t=Qr.exec(e))?(255|Or(Nr(t[1]),Gr(t[2]),Gr(t[3])))>>>0:(t=Pr.exec(e))?(Or(Nr(t[1]),Gr(t[2]),Gr(t[3]))|Vr(t[4]))>>>0:null}(e);return null===t?e:(t=t||0,`rgba(${(4278190080&t)>>>24}, ${(16711680&t)>>>16}, ${(65280&t)>>>8}, ${(255&t)/255})`)}const Hr=(e,t,n)=>{if(rr.fun(e))return e;if(rr.arr(e))return Hr({range:e,output:t,extrapolate:n});if(rr.str(e.output[0]))return hr(e);const r=e,i=r.output,o=r.range||[0,1],s=r.extrapolateLeft||r.extrapolate||"extend",a=r.extrapolateRight||r.extrapolate||"extend",c=r.easing||(e=>e);return e=>{const t=function(e,t){for(var n=1;n<t.length-1&&!(t[n]>=e);++n);return n-1}(e,o);return function(e,t,n,r,i,o,s,a,c){let l=c?c(e):e;if(l<t){if("identity"===s)return l;"clamp"===s&&(l=t)}if(l>n){if("identity"===a)return l;"clamp"===a&&(l=n)}if(r===i)return r;if(t===n)return e<=t?r:i;t===-1/0?l=-l:n===1/0?l-=t:l=(l-t)/(n-t);l=o(l),r===-1/0?l=-l:i===1/0?l+=r:l=l*(i-r)+r;return l}(e,o[t],o[t+1],i[t],i[t+1],c,s,a,r.map)}};const qr=1.70158,Wr=1.525*qr,Yr=qr+1,Xr=2*Math.PI/3,Zr=2*Math.PI/4.5,Kr=e=>{const t=7.5625,n=2.75;return e<1/n?t*e*e:e<2/n?t*(e-=1.5/n)*e+.75:e<2.5/n?t*(e-=2.25/n)*e+.9375:t*(e-=2.625/n)*e+.984375},Jr={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>1-(1-e)*(1-e),easeInOutQuad:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,easeInCubic:e=>e*e*e,easeOutCubic:e=>1-Math.pow(1-e,3),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1-Math.pow(1-e,4),easeInOutQuart:e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1-Math.pow(1-e,5),easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInExpo:e=>0===e?0:Math.pow(2,10*e-10),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,easeInCirc:e=>1-Math.sqrt(1-Math.pow(e,2)),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeInBack:e=>Yr*e*e*e-qr*e*e,easeOutBack:e=>1+Yr*Math.pow(e-1,3)+qr*Math.pow(e-1,2),easeInOutBack:e=>e<.5?Math.pow(2*e,2)*(7.189819*e-Wr)/2:(Math.pow(2*e-2,2)*((Wr+1)*(2*e-2)+Wr)+2)/2,easeInElastic:e=>0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*Xr),easeOutElastic:e=>0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*Xr)+1,easeInOutElastic:e=>0===e?0:1===e?1:e<.5?-Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*Zr)/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*Zr)/2+1,easeInBounce:e=>1-Kr(1-e),easeOutBounce:Kr,easeInOutBounce:e=>e<.5?(1-Kr(1-2*e))/2:(1+Kr(2*e-1))/2,steps:(e,t="end")=>n=>{const r=(n="end"===t?Math.min(n,.999):Math.max(n,.001))*e;return((e,t,n)=>Math.min(Math.max(n,e),t))(0,1,("end"===t?Math.floor(r):Math.ceil(r))/e)}};function $r(){return $r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},$r.apply(this,arguments)}const ei=Symbol.for("FluidValue.get"),ti=Symbol.for("FluidValue.observers"),ni=e=>Boolean(e&&e[ei]),ri=e=>e&&e[ei]?e[ei]():e,ii=e=>e[ti]||null;function oi(e,t){let n=e[ti];n&&n.forEach((e=>{!function(e,t){e.eventObserved?e.eventObserved(t):e(t)}(e,t)}))}class si{constructor(e){if(this[ei]=void 0,this[ti]=void 0,!e&&!(e=this.get))throw Error("Unknown getter");ai(this,e)}}const ai=(e,t)=>ui(e,ei,t);function ci(e,t){if(e[ei]){let n=e[ti];n||ui(e,ti,n=new Set),n.has(t)||(n.add(t),e.observerAdded&&e.observerAdded(n.size,t))}return t}function li(e,t){let n=e[ti];if(n&&n.has(t)){const r=n.size-1;r?n.delete(t):e[ti]=null,e.observerRemoved&&e.observerRemoved(r,t)}}const ui=(e,t,n)=>Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0}),hi=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,di=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,Ai=new RegExp(`(${hi.source})(%|[a-z]+)`,"i"),mi=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,pi=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,fi=e=>{const[t,n]=gi(e);if(!t||ur())return e;const r=window.getComputedStyle(document.documentElement).getPropertyValue(t);if(r)return r.trim();if(n&&n.startsWith("--")){const t=window.getComputedStyle(document.documentElement).getPropertyValue(n);return t||e}return n&&pi.test(n)?fi(n):n||e},gi=e=>{const t=pi.exec(e);if(!t)return[,];const[,n,r]=t;return[n,r]};let yi;const vi=(e,t,n,r,i)=>`rgba(${Math.round(t)}, ${Math.round(n)}, ${Math.round(r)}, ${i})`,xi=e=>{yi||(yi=Ar?new RegExp(`(${Object.keys(Ar).join("|")})(?!\\w)`,"g"):/^\b$/);const t=e.output.map((e=>ri(e).replace(pi,fi).replace(di,jr).replace(yi,jr))),n=t.map((e=>e.match(hi).map(Number))),r=n[0].map(((e,t)=>n.map((e=>{if(!(t in e))throw Error('The arity of each "output" value must be equal');return e[t]})))),i=r.map((t=>Hr($r({},e,{output:t}))));return e=>{var n;const r=!Ai.test(t[0])&&(null==(n=t.find((e=>Ai.test(e))))?void 0:n.replace(hi,""));let o=0;return t[0].replace(hi,(()=>`${i[o++](e)}${r||""}`)).replace(mi,vi)}},Ei="react-spring: ",wi=e=>{const t=e;let n=!1;if("function"!=typeof t)throw new TypeError(`${Ei}once requires a function parameter`);return(...e)=>{n||(t(...e),n=!0)}},Ci=wi(console.warn);const Ii=wi(console.warn);function _i(e){return rr.str(e)&&("#"==e[0]||/\d/.test(e)||!ur()&&pi.test(e)||e in(Ar||{}))}new WeakMap;new Set;new WeakMap,new WeakMap,new WeakMap;const bi=ur()?i.useEffect:i.useLayoutEffect,Bi=()=>{const e=(0,i.useRef)(!1);return bi((()=>(e.current=!0,()=>{e.current=!1})),[]),e};function Mi(){const e=(0,i.useState)()[1],t=Bi();return()=>{t.current&&e(Math.random())}}const Si=e=>(0,i.useEffect)(e,Di),Di=[];function Ti(e){const t=(0,i.useRef)();return(0,i.useEffect)((()=>{t.current=e})),t.current}const Qi=Symbol.for("Animated:node"),Pi=e=>e&&e[Qi],zi=(e,t)=>{return n=e,r=Qi,i=t,Object.defineProperty(n,r,{value:i,writable:!0,configurable:!0});var n,r,i},Ri=e=>e&&e[Qi]&&e[Qi].getPayload();class Fi{constructor(){this.payload=void 0,zi(this,this)}getPayload(){return this.payload||[]}}class ki extends Fi{constructor(e){super(),this.done=!0,this.elapsedTime=void 0,this.lastPosition=void 0,this.lastVelocity=void 0,this.v0=void 0,this.durationProgress=0,this._value=e,rr.num(this._value)&&(this.lastPosition=this._value)}static create(e){return new ki(e)}getPayload(){return[this]}getValue(){return this._value}setValue(e,t){return rr.num(e)&&(this.lastPosition=e,t&&(e=Math.round(e/t)*t,this.done&&(this.lastPosition=e))),this._value!==e&&(this._value=e,!0)}reset(){const{done:e}=this;this.done=!1,rr.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}}class Li extends ki{constructor(e){super(0),this._string=null,this._toString=void 0,this._toString=Hr({output:[e,e]})}static create(e){return new Li(e)}getValue(){let e=this._string;return null==e?this._string=this._toString(this._value):e}setValue(e){if(rr.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else{if(!super.setValue(e))return!1;this._string=null}return!0}reset(e){e&&(this._toString=Hr({output:[this.getValue(),e]})),this._value=0,super.reset()}}const Oi={dependencies:null};class Ui extends Fi{constructor(e){super(),this.source=e,this.setValue(e)}getValue(e){const t={};return sr(this.source,((n,r)=>{var i;(i=n)&&i[Qi]===i?t[r]=n.getValue(e):ni(n)?t[r]=ri(n):e||(t[r]=n)})),t}setValue(e){this.source=e,this.payload=this._makePayload(e)}reset(){this.payload&&or(this.payload,(e=>e.reset()))}_makePayload(e){if(e){const t=new Set;return sr(e,this._addToPayload,t),Array.from(t)}}_addToPayload(e){Oi.dependencies&&ni(e)&&Oi.dependencies.add(e);const t=Ri(e);t&&or(t,(e=>this.add(e)))}}class Ni extends Ui{constructor(e){super(e)}static create(e){return new Ni(e)}getValue(){return this.source.map((e=>e.getValue()))}setValue(e){const t=this.getPayload();return e.length==t.length?t.map(((t,n)=>t.setValue(e[n]))).some(Boolean):(super.setValue(e.map(Vi)),!0)}}function Vi(e){return(_i(e)?Li:ki).create(e)}function Gi(e){const t=Pi(e);return t?t.constructor:rr.arr(e)?Ni:_i(e)?Li:ki}function ji(){return ji=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ji.apply(this,arguments)}const Hi=(e,t)=>{const n=!rr.fun(e)||e.prototype&&e.prototype.isReactComponent;return(0,i.forwardRef)(((r,o)=>{const s=(0,i.useRef)(null),a=n&&(0,i.useCallback)((e=>{s.current=function(e,t){e&&(rr.fun(e)?e(t):e.current=t);return t}(o,e)}),[o]),[c,l]=function(e,t){const n=new Set;Oi.dependencies=n,e.style&&(e=ji({},e,{style:t.createAnimatedStyle(e.style)}));return e=new Ui(e),Oi.dependencies=null,[e,n]}(r,t),u=Mi(),h=()=>{const e=s.current;if(n&&!e)return;!1===(!!e&&t.applyAnimatedValues(e,c.getValue(!0)))&&u()},d=new qi(h,l),A=(0,i.useRef)();bi((()=>(A.current=d,or(l,(e=>ci(e,d))),()=>{A.current&&(or(A.current.deps,(e=>li(e,A.current))),On.cancel(A.current.update))}))),(0,i.useEffect)(h,[]),Si((()=>()=>{const e=A.current;or(e.deps,(t=>li(t,e)))}));const m=t.getComponentProps(c.getValue());return i.createElement(e,ji({},m,{ref:a}))}))};class qi{constructor(e,t){this.update=e,this.deps=t}eventObserved(e){"change"==e.type&&On.write(this.update)}}const Wi=Symbol.for("AnimatedComponent"),Yi=e=>rr.str(e)?e:e&&rr.str(e.displayName)?e.displayName:rr.fun(e)&&e.name||null;function Xi(){return Xi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Xi.apply(this,arguments)}function Zi(e,...t){return rr.fun(e)?e(...t):e}const Ki=(e,t)=>!0===e||!!(t&&e&&(rr.fun(e)?e(t):ar(e).includes(t))),Ji=(e,t)=>rr.obj(e)?t&&e[t]:e,$i=(e,t)=>!0===e.default?e[t]:e.default?e.default[t]:void 0,eo=e=>e,to=(e,t=eo)=>{let n=no;e.default&&!0!==e.default&&(e=e.default,n=Object.keys(e));const r={};for(const i of n){const n=t(e[i],i);rr.und(n)||(r[i]=n)}return r},no=["config","onProps","onStart","onChange","onPause","onResume","onRest"],ro={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function io(e){const t=function(e){const t={};let n=0;if(sr(e,((e,r)=>{ro[r]||(t[r]=e,n++)})),n)return t}(e);if(t){const n={to:t};return sr(e,((e,r)=>r in t||(n[r]=e))),n}return Xi({},e)}function oo(e){return e=ri(e),rr.arr(e)?e.map(oo):_i(e)?gr.createStringInterpolator({range:[0,1],output:[e,e]})(1):e}function so(e){for(const t in e)return!0;return!1}function ao(e){return rr.fun(e)||rr.arr(e)&&rr.obj(e[0])}function co(e,t){var n;null==(n=e.ref)||n.delete(e),null==t||t.delete(e)}function lo(e,t){var n;t&&e.ref!==t&&(null==(n=e.ref)||n.delete(e),t.add(e),e.ref=t)}const uo=Xi({},{tension:170,friction:26},{mass:1,damping:1,easing:Jr.linear,clamp:!1});class ho{constructor(){this.tension=void 0,this.friction=void 0,this.frequency=void 0,this.damping=void 0,this.mass=void 0,this.velocity=0,this.restVelocity=void 0,this.precision=void 0,this.progress=void 0,this.duration=void 0,this.easing=void 0,this.clamp=void 0,this.bounce=void 0,this.decay=void 0,this.round=void 0,Object.assign(this,uo)}}function Ao(e,t){if(rr.und(t.decay)){const n=!rr.und(t.tension)||!rr.und(t.friction);!n&&rr.und(t.frequency)&&rr.und(t.damping)&&rr.und(t.mass)||(e.duration=void 0,e.decay=void 0),n&&(e.frequency=void 0)}else e.duration=void 0}const mo=[];class po{constructor(){this.changed=!1,this.values=mo,this.toValues=null,this.fromValues=mo,this.to=void 0,this.from=void 0,this.config=new ho,this.immediate=!1}}function fo(e,{key:t,props:n,defaultProps:r,state:i,actions:o}){return new Promise(((s,a)=>{var c;let l,u,h=Ki(null!=(c=n.cancel)?c:null==r?void 0:r.cancel,t);if(h)m();else{rr.und(n.pause)||(i.paused=Ki(n.pause,t));let e=null==r?void 0:r.pause;!0!==e&&(e=i.paused||Ki(e,t)),l=Zi(n.delay||0,t),e?(i.resumeQueue.add(A),o.pause()):(o.resume(),A())}function d(){i.resumeQueue.add(A),i.timeouts.delete(u),u.cancel(),l=u.time-On.now()}function A(){l>0&&!gr.skipAnimation?(i.delayed=!0,u=On.setTimeout(m,l),i.pauseQueue.add(d),i.timeouts.add(u)):m()}function m(){i.delayed&&(i.delayed=!1),i.pauseQueue.delete(d),i.timeouts.delete(u),e<=(i.cancelId||0)&&(h=!0);try{o.start(Xi({},n,{callId:e,cancel:h}),s)}catch(t){a(t)}}}))}const go=(e,t)=>1==t.length?t[0]:t.some((e=>e.cancelled))?xo(e.get()):t.every((e=>e.noop))?yo(e.get()):vo(e.get(),t.every((e=>e.finished))),yo=e=>({value:e,noop:!0,finished:!0,cancelled:!1}),vo=(e,t,n=!1)=>({value:e,finished:t,cancelled:n}),xo=e=>({value:e,cancelled:!0,finished:!1});function Eo(e,t,n,r){const{callId:i,parentId:o,onRest:s}=t,{asyncTo:a,promise:c}=n;return o||e!==a||t.reset?n.promise=(async()=>{n.asyncId=i,n.asyncTo=e;const l=to(t,((e,t)=>"onRest"===t?void 0:e));let u,h;const d=new Promise(((e,t)=>(u=e,h=t))),A=e=>{const t=i<=(n.cancelId||0)&&xo(r)||i!==n.asyncId&&vo(r,!1);if(t)throw e.result=t,h(e),e},m=(e,t)=>{const o=new Co,s=new Io;return(async()=>{if(gr.skipAnimation)throw wo(n),s.result=vo(r,!1),h(s),s;A(o);const a=rr.obj(e)?Xi({},e):Xi({},t,{to:e});a.parentId=i,sr(l,((e,t)=>{rr.und(a[t])&&(a[t]=e)}));const c=await r.start(a);return A(o),n.paused&&await new Promise((e=>{n.resumeQueue.add(e)})),c})()};let p;if(gr.skipAnimation)return wo(n),vo(r,!1);try{let t;t=rr.arr(e)?(async e=>{for(const t of e)await m(t)})(e):Promise.resolve(e(m,r.stop.bind(r))),await Promise.all([t.then(u),d]),p=vo(r.get(),!0,!1)}catch(f){if(f instanceof Co)p=f.result;else{if(!(f instanceof Io))throw f;p=f.result}}finally{i==n.asyncId&&(n.asyncId=o,n.asyncTo=o?a:void 0,n.promise=o?c:void 0)}return rr.fun(s)&&On.batchedUpdates((()=>{s(p,r,r.item)})),p})():c}function wo(e,t){cr(e.timeouts,(e=>e.cancel())),e.pauseQueue.clear(),e.resumeQueue.clear(),e.asyncId=e.asyncTo=e.promise=void 0,t&&(e.cancelId=t)}class Co extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise."),this.result=void 0}}class Io extends Error{constructor(){super("SkipAnimationSignal"),this.result=void 0}}const _o=e=>e instanceof Bo;let bo=1;class Bo extends si{constructor(...e){super(...e),this.id=bo++,this.key=void 0,this._priority=0}get priority(){return this._priority}set priority(e){this._priority!=e&&(this._priority=e,this._onPriorityChange(e))}get(){const e=Pi(this);return e&&e.getValue()}to(...e){return gr.to(this,e)}interpolate(...e){return Ci(`${Ei}The "interpolate" function is deprecated in v9 (use "to" instead)`),gr.to(this,e)}toJSON(){return this.get()}observerAdded(e){1==e&&this._attach()}observerRemoved(e){0==e&&this._detach()}_attach(){}_detach(){}_onChange(e,t=!1){oi(this,{type:"change",parent:this,value:e,idle:t})}_onPriorityChange(e){this.idle||wr.sort(this),oi(this,{type:"priority",parent:this,priority:e})}}const Mo=Symbol.for("SpringPhase"),So=e=>(1&e[Mo])>0,Do=e=>(2&e[Mo])>0,To=e=>(4&e[Mo])>0,Qo=(e,t)=>t?e[Mo]|=3:e[Mo]&=-3,Po=(e,t)=>t?e[Mo]|=4:e[Mo]&=-5;class zo extends Bo{constructor(e,t){if(super(),this.key=void 0,this.animation=new po,this.queue=void 0,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!rr.und(e)||!rr.und(t)){const n=rr.obj(e)?Xi({},e):Xi({},t,{from:e});rr.und(n.default)&&(n.default=!0),this.start(n)}}get idle(){return!(Do(this)||this._state.asyncTo)||To(this)}get goal(){return ri(this.animation.to)}get velocity(){const e=Pi(this);return e instanceof ki?e.lastVelocity||0:e.getPayload().map((e=>e.lastVelocity||0))}get hasAnimated(){return So(this)}get isAnimating(){return Do(this)}get isPaused(){return To(this)}get isDelayed(){return this._state.delayed}advance(e){let t=!0,n=!1;const r=this.animation;let{config:i,toValues:o}=r;const s=Ri(r.to);!s&&ni(r.to)&&(o=ar(ri(r.to))),r.values.forEach(((a,c)=>{if(a.done)return;const l=a.constructor==Li?1:s?s[c].lastPosition:o[c];let u=r.immediate,h=l;if(!u){if(h=a.lastPosition,i.tension<=0)return void(a.done=!0);let t=a.elapsedTime+=e;const n=r.fromValues[c],o=null!=a.v0?a.v0:a.v0=rr.arr(i.velocity)?i.velocity[c]:i.velocity;let s;const d=i.precision||(n==l?.005:Math.min(1,.001*Math.abs(l-n)));if(rr.und(i.duration))if(i.decay){const e=!0===i.decay?.998:i.decay,r=Math.exp(-(1-e)*t);h=n+o/(1-e)*(1-r),u=Math.abs(a.lastPosition-h)<=d,s=o*r}else{s=null==a.lastVelocity?o:a.lastVelocity;const t=i.restVelocity||d/10,r=i.clamp?0:i.bounce,c=!rr.und(r),A=n==l?a.v0>0:n<l;let m,p=!1;const f=1,g=Math.ceil(e/f);for(let e=0;e<g&&(m=Math.abs(s)>t,m||(u=Math.abs(l-h)<=d,!u));++e){c&&(p=h==l||h>l==A,p&&(s=-s*r,h=l));s+=(1e-6*-i.tension*(h-l)+.001*-i.friction*s)/i.mass*f,h+=s*f}}else{let r=1;i.duration>0&&(this._memoizedDuration!==i.duration&&(this._memoizedDuration=i.duration,a.durationProgress>0&&(a.elapsedTime=i.duration*a.durationProgress,t=a.elapsedTime+=e)),r=(i.progress||0)+t/this._memoizedDuration,r=r>1?1:r<0?0:r,a.durationProgress=r),h=n+i.easing(r)*(l-n),s=(h-a.lastPosition)/e,u=1==r}a.lastVelocity=s,Number.isNaN(h)&&(console.warn("Got NaN while animating:",this),u=!0)}s&&!s[c].done&&(u=!1),u?a.done=!0:t=!1,a.setValue(h,i.round)&&(n=!0)}));const a=Pi(this),c=a.getValue();if(t){const e=ri(r.to);c===e&&!n||i.decay?n&&i.decay&&this._onChange(c):(a.setValue(e),this._onChange(e)),this._stop()}else n&&this._onChange(c)}set(e){return On.batchedUpdates((()=>{this._stop(),this._focus(e),this._set(e)})),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(Do(this)){const{to:e,config:t}=this.animation;On.batchedUpdates((()=>{this._onStart(),t.decay||this._set(e,!1),this._stop()}))}return this}update(e){return(this.queue||(this.queue=[])).push(e),this}start(e,t){let n;return rr.und(e)?(n=this.queue||[],this.queue=[]):n=[rr.obj(e)?e:Xi({},t,{to:e})],Promise.all(n.map((e=>this._update(e)))).then((e=>go(this,e)))}stop(e){const{to:t}=this.animation;return this._focus(this.get()),wo(this._state,e&&this._lastCallId),On.batchedUpdates((()=>this._stop(t,e))),this}reset(){this._update({reset:!0})}eventObserved(e){"change"==e.type?this._start():"priority"==e.type&&(this.priority=e.priority+1)}_prepareNode(e){const t=this.key||"";let{to:n,from:r}=e;n=rr.obj(n)?n[t]:n,(null==n||ao(n))&&(n=void 0),r=rr.obj(r)?r[t]:r,null==r&&(r=void 0);const i={to:n,from:r};return So(this)||(e.reverse&&([n,r]=[r,n]),r=ri(r),rr.und(r)?Pi(this)||this._set(n):this._set(r)),i}_update(e,t){let n=Xi({},e);const{key:r,defaultProps:i}=this;n.default&&Object.assign(i,to(n,((e,t)=>/^on/.test(t)?Ji(e,r):e))),No(this,n,"onProps"),Vo(this,"onProps",n,this);const o=this._prepareNode(n);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const s=this._state;return fo(++this._lastCallId,{key:r,props:n,defaultProps:i,state:s,actions:{pause:()=>{To(this)||(Po(this,!0),lr(s.pauseQueue),Vo(this,"onPause",vo(this,Ro(this,this.animation.to)),this))},resume:()=>{To(this)&&(Po(this,!1),Do(this)&&this._resume(),lr(s.resumeQueue),Vo(this,"onResume",vo(this,Ro(this,this.animation.to)),this))},start:this._merge.bind(this,o)}}).then((e=>{if(n.loop&&e.finished&&(!t||!e.noop)){const e=Fo(n);if(e)return this._update(e,!0)}return e}))}_merge(e,t,n){if(t.cancel)return this.stop(!0),n(xo(this));const r=!rr.und(e.to),i=!rr.und(e.from);if(r||i){if(!(t.callId>this._lastToId))return n(xo(this));this._lastToId=t.callId}const{key:o,defaultProps:s,animation:a}=this,{to:c,from:l}=a;let{to:u=c,from:h=l}=e;!i||r||t.default&&!rr.und(u)||(u=h),t.reverse&&([u,h]=[h,u]);const d=!ir(h,l);d&&(a.from=h),h=ri(h);const A=!ir(u,c);A&&this._focus(u);const m=ao(t.to),{config:p}=a,{decay:f,velocity:g}=p;(r||i)&&(p.velocity=0),t.config&&!m&&function(e,t,n){n&&(Ao(n=Xi({},n),t),t=Xi({},n,t)),Ao(e,t),Object.assign(e,t);for(const s in uo)null==e[s]&&(e[s]=uo[s]);let{mass:r,frequency:i,damping:o}=e;rr.und(i)||(i<.01&&(i=.01),o<0&&(o=0),e.tension=Math.pow(2*Math.PI/i,2)*r,e.friction=4*Math.PI*o*r/i)}(p,Zi(t.config,o),t.config!==s.config?Zi(s.config,o):void 0);let y=Pi(this);if(!y||rr.und(u))return n(vo(this,!0));const v=rr.und(t.reset)?i&&!t.default:!rr.und(h)&&Ki(t.reset,o),x=v?h:this.get(),E=oo(u),w=rr.num(E)||rr.arr(E)||_i(E),C=!m&&(!w||Ki(s.immediate||t.immediate,o));if(A){const e=Gi(u);if(e!==y.constructor){if(!C)throw Error(`Cannot animate between ${y.constructor.name} and ${e.name}, as the "to" prop suggests`);y=this._set(E)}}const I=y.constructor;let _=ni(u),b=!1;if(!_){const e=v||!So(this)&&d;(A||e)&&(b=ir(oo(x),E),_=!b),(ir(a.immediate,C)||C)&&ir(p.decay,f)&&ir(p.velocity,g)||(_=!0)}if(b&&Do(this)&&(a.changed&&!v?_=!0:_||this._stop(c)),!m&&((_||ni(c))&&(a.values=y.getPayload(),a.toValues=ni(u)?null:I==Li?[1]:ar(E)),a.immediate!=C&&(a.immediate=C,C||v||this._set(c)),_)){const{onRest:e}=a;or(Uo,(e=>No(this,t,e)));const r=vo(this,Ro(this,c));lr(this._pendingCalls,r),this._pendingCalls.add(n),a.changed&&On.batchedUpdates((()=>{a.changed=!v,null==e||e(r,this),v?Zi(s.onRest,r):null==a.onStart||a.onStart(r,this)}))}v&&this._set(x),m?n(Eo(t.to,t,this._state,this)):_?this._start():Do(this)&&!A?this._pendingCalls.add(n):n(yo(x))}_focus(e){const t=this.animation;e!==t.to&&(ii(this)&&this._detach(),t.to=e,ii(this)&&this._attach())}_attach(){let e=0;const{to:t}=this.animation;ni(t)&&(ci(t,this),_o(t)&&(e=t.priority+1)),this.priority=e}_detach(){const{to:e}=this.animation;ni(e)&&li(e,this)}_set(e,t=!0){const n=ri(e);if(!rr.und(n)){const e=Pi(this);if(!e||!ir(n,e.getValue())){const r=Gi(n);e&&e.constructor==r?e.setValue(n):zi(this,r.create(n)),e&&On.batchedUpdates((()=>{this._onChange(n,t)}))}}return Pi(this)}_onStart(){const e=this.animation;e.changed||(e.changed=!0,Vo(this,"onStart",vo(this,Ro(this,e.to)),this))}_onChange(e,t){t||(this._onStart(),Zi(this.animation.onChange,e,this)),Zi(this.defaultProps.onChange,e,this),super._onChange(e,t)}_start(){const e=this.animation;Pi(this).reset(ri(e.to)),e.immediate||(e.fromValues=e.values.map((e=>e.lastPosition))),Do(this)||(Qo(this,!0),To(this)||this._resume())}_resume(){gr.skipAnimation?this.finish():wr.start(this)}_stop(e,t){if(Do(this)){Qo(this,!1);const n=this.animation;or(n.values,(e=>{e.done=!0})),n.toValues&&(n.onChange=n.onPause=n.onResume=void 0),oi(this,{type:"idle",parent:this});const r=t?xo(this.get()):vo(this.get(),Ro(this,null!=e?e:n.to));lr(this._pendingCalls,r),n.changed&&(n.changed=!1,Vo(this,"onRest",r,this))}}}function Ro(e,t){const n=oo(t);return ir(oo(e.get()),n)}function Fo(e,t=e.loop,n=e.to){let r=Zi(t);if(r){const i=!0!==r&&io(r),o=(i||e).reverse,s=!i||i.reset;return ko(Xi({},e,{loop:t,default:!1,pause:void 0,to:!o||ao(n)?n:void 0,from:s?e.from:void 0,reset:s},i))}}function ko(e){const{to:t,from:n}=e=io(e),r=new Set;return rr.obj(t)&&Oo(t,r),rr.obj(n)&&Oo(n,r),e.keys=r.size?Array.from(r):null,e}function Lo(e){const t=ko(e);return rr.und(t.default)&&(t.default=to(t)),t}function Oo(e,t){sr(e,((e,n)=>null!=e&&t.add(n)))}const Uo=["onStart","onRest","onChange","onPause","onResume"];function No(e,t,n){e.animation[n]=t[n]!==$i(t,n)?Ji(t[n],e.key):void 0}function Vo(e,t,...n){var r,i,o,s;null==(r=(i=e.animation)[t])||r.call(i,...n),null==(o=(s=e.defaultProps)[t])||o.call(s,...n)}const Go=["onStart","onChange","onRest"];let jo=1;class Ho{constructor(e,t){this.id=jo++,this.springs={},this.queue=[],this.ref=void 0,this._flush=void 0,this._initialProps=void 0,this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._item=void 0,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),t&&(this._flush=t),e&&this.start(Xi({default:!0},e))}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every((e=>e.idle&&!e.isDelayed&&!e.isPaused))}get item(){return this._item}set item(e){this._item=e}get(){const e={};return this.each(((t,n)=>e[n]=t.get())),e}set(e){for(const t in e){const n=e[t];rr.und(n)||this.springs[t].set(n)}}update(e){return e&&this.queue.push(ko(e)),this}start(e){let{queue:t}=this;return e?t=ar(e).map(ko):this.queue=[],this._flush?this._flush(this,t):(Jo(this,t),qo(this,t))}stop(e,t){if(e!==!!e&&(t=e),t){const n=this.springs;or(ar(t),(t=>n[t].stop(!!e)))}else wo(this._state,this._lastAsyncId),this.each((t=>t.stop(!!e)));return this}pause(e){if(rr.und(e))this.start({pause:!0});else{const t=this.springs;or(ar(e),(e=>t[e].pause()))}return this}resume(e){if(rr.und(e))this.start({pause:!1});else{const t=this.springs;or(ar(e),(e=>t[e].resume()))}return this}each(e){sr(this.springs,e)}_onFrame(){const{onStart:e,onChange:t,onRest:n}=this._events,r=this._active.size>0,i=this._changed.size>0;(r&&!this._started||i&&!this._started)&&(this._started=!0,cr(e,(([e,t])=>{t.value=this.get(),e(t,this,this._item)})));const o=!r&&this._started,s=i||o&&n.size?this.get():null;i&&t.size&&cr(t,(([e,t])=>{t.value=s,e(t,this,this._item)})),o&&(this._started=!1,cr(n,(([e,t])=>{t.value=s,e(t,this,this._item)})))}eventObserved(e){if("change"==e.type)this._changed.add(e.parent),e.idle||this._active.add(e.parent);else{if("idle"!=e.type)return;this._active.delete(e.parent)}On.onFrame(this._onFrame)}}function qo(e,t){return Promise.all(t.map((t=>Wo(e,t)))).then((t=>go(e,t)))}async function Wo(e,t,n){const{keys:r,to:i,from:o,loop:s,onRest:a,onResolve:c}=t,l=rr.obj(t.default)&&t.default;s&&(t.loop=!1),!1===i&&(t.to=null),!1===o&&(t.from=null);const u=rr.arr(i)||rr.fun(i)?i:void 0;u?(t.to=void 0,t.onRest=void 0,l&&(l.onRest=void 0)):or(Go,(n=>{const r=t[n];if(rr.fun(r)){const i=e._events[n];t[n]=({finished:e,cancelled:t})=>{const n=i.get(r);n?(e||(n.finished=!1),t&&(n.cancelled=!0)):i.set(r,{value:null,finished:e||!1,cancelled:t||!1})},l&&(l[n]=t[n])}}));const h=e._state;t.pause===!h.paused?(h.paused=t.pause,lr(t.pause?h.pauseQueue:h.resumeQueue)):h.paused&&(t.pause=!0);const d=(r||Object.keys(e.springs)).map((n=>e.springs[n].start(t))),A=!0===t.cancel||!0===$i(t,"cancel");(u||A&&h.asyncId)&&d.push(fo(++e._lastAsyncId,{props:t,state:h,actions:{pause:nr,resume:nr,start(t,n){A?(wo(h,e._lastAsyncId),n(xo(e))):(t.onRest=a,n(Eo(u,t,h,e)))}}})),h.paused&&await new Promise((e=>{h.resumeQueue.add(e)}));const m=go(e,await Promise.all(d));if(s&&m.finished&&(!n||!m.noop)){const n=Fo(t,s,i);if(n)return Jo(e,[n]),Wo(e,n,!0)}return c&&On.batchedUpdates((()=>c(m,e,e.item))),m}function Yo(e,t){const n=Xi({},e.springs);return t&&or(ar(t),(e=>{rr.und(e.keys)&&(e=ko(e)),rr.obj(e.to)||(e=Xi({},e,{to:void 0})),Ko(n,e,(e=>Zo(e)))})),Xo(e,n),n}function Xo(e,t){sr(t,((t,n)=>{e.springs[n]||(e.springs[n]=t,ci(t,e))}))}function Zo(e,t){const n=new zo;return n.key=e,t&&ci(n,t),n}function Ko(e,t,n){t.keys&&or(t.keys,(r=>{(e[r]||(e[r]=n(r)))._prepareNode(t)}))}function Jo(e,t){or(t,(t=>{Ko(e.springs,t,(t=>Zo(t,e)))}))}function $o(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}const es=["children"],ts=e=>{let{children:t}=e,n=$o(e,es);const r=(0,i.useContext)(ns),o=n.pause||!!r.pause,s=n.immediate||!!r.immediate;n=function(e,t){const[n]=(0,i.useState)((()=>({inputs:t,result:e()}))),r=(0,i.useRef)(),o=r.current;let s=o;if(s){const n=Boolean(t&&s.inputs&&function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(t,s.inputs));n||(s={inputs:t,result:e()})}else s=n;return(0,i.useEffect)((()=>{r.current=s,o==n&&(n.inputs=n.result=void 0)}),[s]),s.result}((()=>({pause:o,immediate:s})),[o,s]);const{Provider:a}=ns;return i.createElement(a,{value:n},t)},ns=function(e,t){return Object.assign(e,i.createContext(t)),e.Provider._context=e,e.Consumer._context=e,e}(ts,{});ts.Provider=ns.Provider,ts.Consumer=ns.Consumer;const rs=()=>{const e=[],t=function(t){Ii(`${Ei}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`);const r=[];return or(e,((e,i)=>{if(rr.und(t))r.push(e.start());else{const o=n(t,e,i);o&&r.push(e.start(o))}})),r};t.current=e,t.add=function(t){e.includes(t)||e.push(t)},t.delete=function(t){const n=e.indexOf(t);~n&&e.splice(n,1)},t.pause=function(){return or(e,(e=>e.pause(...arguments))),this},t.resume=function(){return or(e,(e=>e.resume(...arguments))),this},t.set=function(t){or(e,(e=>e.set(t)))},t.start=function(t){const n=[];return or(e,((e,r)=>{if(rr.und(t))n.push(e.start());else{const i=this._getProps(t,e,r);i&&n.push(e.start(i))}})),n},t.stop=function(){return or(e,(e=>e.stop(...arguments))),this},t.update=function(t){return or(e,((e,n)=>e.update(this._getProps(t,e,n)))),this};const n=function(e,t,n){return rr.fun(e)?e(n,t):e};return t._getProps=n,t};function is(e,t,n){const r=rr.fun(t)&&t;r&&!n&&(n=[]);const o=(0,i.useMemo)((()=>r||3==arguments.length?rs():void 0),[]),s=(0,i.useRef)(0),a=Mi(),c=(0,i.useMemo)((()=>({ctrls:[],queue:[],flush(e,t){const n=Yo(e,t);return s.current>0&&!c.queue.length&&!Object.keys(n).some((t=>!e.springs[t]))?qo(e,t):new Promise((r=>{Xo(e,n),c.queue.push((()=>{r(qo(e,t))})),a()}))}})),[]),l=(0,i.useRef)([...c.ctrls]),u=[],h=Ti(e)||0;function d(e,n){for(let i=e;i<n;i++){const e=l.current[i]||(l.current[i]=new Ho(null,c.flush)),n=r?r(i,e):t[i];n&&(u[i]=Lo(n))}}(0,i.useMemo)((()=>{or(l.current.slice(e,h),(e=>{co(e,o),e.stop(!0)})),l.current.length=e,d(h,e)}),[e]),(0,i.useMemo)((()=>{d(0,Math.min(h,e))}),n);const A=l.current.map(((e,t)=>Yo(e,u[t]))),m=(0,i.useContext)(ts),p=Ti(m),f=m!==p&&so(m);bi((()=>{s.current++,c.ctrls=l.current;const{queue:e}=c;e.length&&(c.queue=[],or(e,(e=>e()))),or(l.current,((e,t)=>{null==o||o.add(e),f&&e.start({default:m});const n=u[t];n&&(lo(e,n.ref),e.ref?e.queue.push(n):e.start(n))}))})),Si((()=>()=>{or(c.ctrls,(e=>e.stop(!0)))}));const g=A.map((e=>Xi({},e)));return o?[g,o]:g}function os(e,t){const n=rr.fun(e),[[r],i]=is(1,n?e:[e],n?t||[]:t);return n||2==arguments.length?[r,i]:r}let ss;!function(e){e.MOUNT="mount",e.ENTER="enter",e.UPDATE="update",e.LEAVE="leave"}(ss||(ss={}));class as extends Bo{constructor(e,t){super(),this.key=void 0,this.idle=!0,this.calc=void 0,this._active=new Set,this.source=e,this.calc=Hr(...t);const n=this._get(),r=Gi(n);zi(this,r.create(n))}advance(e){const t=this._get();ir(t,this.get())||(Pi(this).setValue(t),this._onChange(t,this.idle)),!this.idle&&ls(this._active)&&us(this)}_get(){const e=rr.arr(this.source)?this.source.map(ri):ar(ri(this.source));return this.calc(...e)}_start(){this.idle&&!ls(this._active)&&(this.idle=!1,or(Ri(this),(e=>{e.done=!1})),gr.skipAnimation?(On.batchedUpdates((()=>this.advance())),us(this)):wr.start(this))}_attach(){let e=1;or(ar(this.source),(t=>{ni(t)&&ci(t,this),_o(t)&&(t.idle||this._active.add(t),e=Math.max(e,t.priority+1))})),this.priority=e,this._start()}_detach(){or(ar(this.source),(e=>{ni(e)&&li(e,this)})),this._active.clear(),us(this)}eventObserved(e){"change"==e.type?e.idle?this.advance():(this._active.add(e.parent),this._start()):"idle"==e.type?this._active.delete(e.parent):"priority"==e.type&&(this.priority=ar(this.source).reduce(((e,t)=>Math.max(e,(_o(t)?t.priority:0)+1)),0))}}function cs(e){return!1!==e.idle}function ls(e){return!e.size||Array.from(e).every(cs)}function us(e){e.idle||(e.idle=!0,or(Ri(e),(e=>{e.done=!0})),oi(e,{type:"idle",parent:e}))}gr.assign({createStringInterpolator:xi,to:(e,t)=>new as(e,t)});wr.advance;const hs=["primitive"].concat(Object.keys(s).filter((e=>/^[A-Z]/.test(e))).map((e=>e[0].toLowerCase()+e.slice(1))));gr.assign({createStringInterpolator:xi,colors:{transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},frameLoop:"demand"}),(0,a.o)((()=>{On.advance()}));const ds=((e,{applyAnimatedValues:t=(()=>!1),createAnimatedStyle:n=(e=>new Ui(e)),getComponentProps:r=(e=>e)}={})=>{const i={applyAnimatedValues:t,createAnimatedStyle:n,getComponentProps:r},o=e=>{const t=Yi(e)||"Anonymous";return(e=rr.str(e)?o[e]||(o[e]=Hi(e,i)):e[Wi]||(e[Wi]=Hi(e,i))).displayName=`Animated(${t})`,e};return sr(e,((t,n)=>{rr.arr(e)&&(n=Yi(t)),o[n]=o(t)})),{animated:o}})(hs,{applyAnimatedValues:a.k}),As=ds.animated;function ms({enabled:e=!0,snap:t,global:n,domElement:o,cursor:c=!0,children:l,speed:u=1,rotation:h=[0,0,0],zoom:d=1,polar:A=[0,Math.PI/2],azimuth:m=[-1/0,1/0],config:p={mass:1,tension:170,friction:26}}){const f=(0,a.D)((e=>e.events)),g=(0,a.D)((e=>e.gl)),y=o||f.connected||g.domElement,{size:v}=(0,a.D)(),x=i.useMemo((()=>[h[0]+A[0],h[0]+A[1]]),[h[0],A[0],A[1]]),E=i.useMemo((()=>[h[1]+m[0],h[1]+m[1]]),[h[1],m[0],m[1]]),w=i.useMemo((()=>[s.MathUtils.clamp(h[0],...x),s.MathUtils.clamp(h[1],...E),h[2]]),[h[0],h[1],h[2],x,E]),[C,I]=os((()=>({scale:1,rotation:w,config:p})));i.useEffect((()=>{I.start({scale:1,rotation:w,config:p})}),[w]),i.useEffect((()=>{if(n&&c&&e)return y.style.cursor="grab",g.domElement.style.cursor="",()=>{y.style.cursor="default",g.domElement.style.cursor="default"}}),[n,c,y,e]);const _=Ne({onHover:({last:t})=>{c&&!n&&e&&(y.style.cursor=t?"auto":"grab")},onDrag:({down:n,delta:[r,i],memo:[o,a]=C.rotation.animation.to||w})=>{if(!e)return[i,r];c&&(y.style.cursor=n?"grabbing":"grab"),r=s.MathUtils.clamp(a+r/v.width*Math.PI*u,...E),i=s.MathUtils.clamp(o+i/v.height*Math.PI*u,...x);const l=t&&!n&&"boolean"!==typeof t?t:p;return I.start({scale:n&&i>x[1]/2?d:1,rotation:t&&!n?w:[i,r,0],config:e=>"scale"===e?{...l,friction:3*l.friction}:l}),[i,r]}},{target:n?y:void 0});return i.createElement(As.group,(0,r.Z)({},null==_?void 0:_(),C),l)}Object.defineProperty,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;const ps=e=>(t,n,r)=>{const i=r.subscribe;r.subscribe=(e,t,n)=>{let o=e;if(t){const i=(null==n?void 0:n.equalityFn)||Object.is;let s=e(r.getState());o=n=>{const r=e(n);if(!i(s,r)){const e=s;t(s=r,e)}},(null==n?void 0:n.fireImmediately)&&t(s,s)}return i(o)};return e(t,n,r)};Object.defineProperty,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;const fs=i.createContext(null);function gs({map:e,children:t,onChange:n,domElement:r}){const o=e.map((e=>e.name+e.keys)).join("-"),s=i.useMemo((()=>C(ps((()=>e.reduce(((e,t)=>({...e,[t.name]:!1})),{}))))),[o]),a=i.useMemo((()=>[s.subscribe,s.getState,s]),[o]),c=s.setState;return i.useEffect((()=>{const t=e.map((({name:e,keys:t,up:r})=>({keys:t,up:r,fn:t=>{c({[e]:t}),n&&n(e,t,a[1]())}}))).reduce(((e,{keys:t,fn:n,up:r=!0})=>(t.forEach((t=>e[t]={fn:n,pressed:!1,up:r})),e)),{}),i=({key:e,code:n})=>{const r=t[e]||t[n];if(!r)return;const{fn:i,pressed:o,up:s}=r;r.pressed=!0,!s&&o||i(!0)},o=({key:e,code:n})=>{const r=t[e]||t[n];if(!r)return;const{fn:i,up:o}=r;r.pressed=!1,o&&i(!1)},s=r||window;return s.addEventListener("keydown",i,{passive:!0}),s.addEventListener("keyup",o,{passive:!0}),()=>{s.removeEventListener("keydown",i),s.removeEventListener("keyup",o)}}),[r,o]),i.createElement(fs.Provider,{value:a,children:t})}function ys(e){const[t,n,r]=i.useContext(fs);return e?r(e):[t,n]}const vs=new s.Frustum,xs=new s.Vector3,Es=new s.Vector3,ws=new s.Vector3,Cs=new s.Vector3,Is=new s.Vector3,_s=new s.Vector3,bs=new s.Vector3,Bs=new s.Vector3,Ms=new s.Vector3,Ss=new s.Vector3,Ds=new s.Vector3,Ts=new s.Vector3,Qs=new s.Vector3,Ps=new s.Vector3;class zs{constructor(e,t,n){this.camera=e,this.scene=t,this.startPoint=new s.Vector3,this.endPoint=new s.Vector3,this.collection=[],this.deep=n||Number.MAX_VALUE}select(e,t){return this.startPoint=e||this.startPoint,this.endPoint=t||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(vs,this.scene),this.collection}updateFrustum(e,t){if(e=e||this.startPoint,t=t||this.endPoint,e.x===t.x&&(t.x+=Number.EPSILON),e.y===t.y&&(t.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera)Es.copy(e),Es.x=Math.min(e.x,t.x),Es.y=Math.max(e.y,t.y),t.x=Math.max(e.x,t.x),t.y=Math.min(e.y,t.y),ws.setFromMatrixPosition(this.camera.matrixWorld),Cs.copy(Es),Is.set(t.x,Es.y,0),_s.copy(t),bs.set(Es.x,t.y,0),Cs.unproject(this.camera),Is.unproject(this.camera),_s.unproject(this.camera),bs.unproject(this.camera),Ts.copy(Cs).sub(ws),Qs.copy(Is).sub(ws),Ps.copy(_s).sub(ws),Ts.normalize(),Qs.normalize(),Ps.normalize(),Ts.multiplyScalar(this.deep),Qs.multiplyScalar(this.deep),Ps.multiplyScalar(this.deep),Ts.add(ws),Qs.add(ws),Ps.add(ws),(n=vs.planes)[0].setFromCoplanarPoints(ws,Cs,Is),n[1].setFromCoplanarPoints(ws,Is,_s),n[2].setFromCoplanarPoints(_s,bs,ws),n[3].setFromCoplanarPoints(bs,Cs,ws),n[4].setFromCoplanarPoints(Is,_s,bs),n[5].setFromCoplanarPoints(Ps,Qs,Ts),n[5].normal.multiplyScalar(-1);else if(this.camera.isOrthographicCamera){const r=Math.min(e.x,t.x),i=Math.max(e.y,t.y),o=Math.max(e.x,t.x),s=Math.min(e.y,t.y);var n;Cs.set(r,i,-1),Is.set(o,i,-1),_s.set(o,s,-1),bs.set(r,s,-1),Bs.set(r,i,1),Ms.set(o,i,1),Ss.set(o,s,1),Ds.set(r,s,1),Cs.unproject(this.camera),Is.unproject(this.camera),_s.unproject(this.camera),bs.unproject(this.camera),Bs.unproject(this.camera),Ms.unproject(this.camera),Ss.unproject(this.camera),Ds.unproject(this.camera),(n=vs.planes)[0].setFromCoplanarPoints(Cs,Bs,Ms),n[1].setFromCoplanarPoints(Is,Ms,Ss),n[2].setFromCoplanarPoints(Ss,Ds,bs),n[3].setFromCoplanarPoints(Ds,Bs,Cs),n[4].setFromCoplanarPoints(Is,_s,bs),n[5].setFromCoplanarPoints(Ss,Ms,Bs),n[5].normal.multiplyScalar(-1)}else console.error("THREE.SelectionBox: Unsupported camera type.")}searchChildInFrustum(e,t){if((t.isMesh||t.isLine||t.isPoints)&&void 0!==t.material&&(null===t.geometry.boundingSphere&&t.geometry.computeBoundingSphere(),xs.copy(t.geometry.boundingSphere.center),xs.applyMatrix4(t.matrixWorld),e.containsPoint(xs)&&this.collection.push(t)),t.children.length>0)for(let n=0;n<t.children.length;n++)this.searchChildInFrustum(e,t.children[n])}}const Rs=i.createContext([]);function Fs({box:e,multiple:t,children:n,onChange:o,onChangePointerUp:c,border:l="1px solid #55aaff",backgroundColor:u="rgba(75, 160, 255, 0.1)",filter:h=(e=>e),...d}){const[A,m]=i.useState(!1),{setEvents:p,camera:f,raycaster:g,gl:y,controls:v,size:x,get:E}=(0,a.D)(),[w,C]=i.useState(!1),[I,_]=i.useReducer(((e,{object:t,shift:n})=>void 0===t?[]:Array.isArray(t)?t:n?e.includes(t)?e.filter((e=>e!==t)):[t,...e]:e[0]===t?[]:[t]),[]);i.useEffect((()=>{A?null==o||o(I):null==c||c(I)}),[I,A]);const b=i.useCallback((e=>{e.stopPropagation(),_({object:h([e.object])[0],shift:t&&e.shiftKey})}),[]),B=i.useCallback((e=>!w&&_({})),[w]),M=i.useRef(null);return i.useEffect((()=>{if(!e||!t)return;const n=new zs(f,M.current),r=document.createElement("div");r.style.pointerEvents="none",r.style.border=l,r.style.backgroundColor=u,r.style.position="fixed";const i=new s.Vector2,o=new s.Vector2,a=new s.Vector2,c=E().events.enabled,d=null==v?void 0:v.enabled;let A=!1;function g(e,t){const{offsetX:n,offsetY:r}=e,{width:i,height:o}=x;t.set(n/i*2-1,-r/o*2+1)}function w(e){e.shiftKey&&(!function(e){var t;v&&(v.enabled=!1),p({enabled:!1}),m(A=!0),null==(t=y.domElement.parentElement)||t.appendChild(r),r.style.left=`${e.clientX}px`,r.style.top=`${e.clientY}px`,r.style.width="0px",r.style.height="0px",i.x=e.clientX,i.y=e.clientY}(e),g(e,n.startPoint))}let C=[];function I(e){if(A){!function(e){a.x=Math.max(i.x,e.clientX),a.y=Math.max(i.y,e.clientY),o.x=Math.min(i.x,e.clientX),o.y=Math.min(i.y,e.clientY),r.style.left=`${o.x}px`,r.style.top=`${o.y}px`,r.style.width=a.x-o.x+"px",r.style.height=a.y-o.y+"px"}(e),g(e,n.endPoint);const t=n.select().sort((e=>e.uuid)).filter((e=>e.isMesh));(function(e,t){if(Object.is(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(let r=0;r<n.length;r++)if(!Object.prototype.hasOwnProperty.call(t,n[r])||!Object.is(e[n[r]],t[n[r]]))return!1;return!0})(t,C)||(C=t,_({object:h(t)}))}}function b(e){A&&function(){var e;A&&(v&&(v.enabled=d),p({enabled:c}),m(A=!1),null==(e=r.parentElement)||e.removeChild(r))}()}return document.addEventListener("pointerdown",w,{passive:!0}),document.addEventListener("pointermove",I,{passive:!0,capture:!0}),document.addEventListener("pointerup",b,{passive:!0}),()=>{document.removeEventListener("pointerdown",w),document.removeEventListener("pointermove",I,!0),document.removeEventListener("pointerup",b)}}),[x.width,x.height,g,f,v,y]),i.createElement("group",(0,r.Z)({ref:M,onClick:b,onPointerOver:()=>C(!0),onPointerOut:()=>C(!1),onPointerMissed:B},d),i.createElement(Rs.Provider,{value:I},n))}function ks(){return i.useContext(Rs)}const Ls=i.forwardRef((function({children:e,follow:t=!0,lockX:n=!1,lockY:o=!1,lockZ:c=!1,...l},u){const h=i.useRef(null),d=i.useRef(null),A=new s.Quaternion;return(0,a.F)((({camera:e})=>{if(!t||!d.current)return;const r=d.current.rotation.clone();d.current.updateMatrix(),d.current.updateWorldMatrix(!1,!1),d.current.getWorldQuaternion(A),e.getWorldQuaternion(h.current.quaternion).premultiply(A.invert()),n&&(d.current.rotation.x=r.x),o&&(d.current.rotation.y=r.y),c&&(d.current.rotation.z=r.z)})),i.useImperativeHandle(u,(()=>d.current),[]),i.createElement("group",(0,r.Z)({ref:d},l),i.createElement("group",{ref:h},e))})),Os=i.forwardRef((({children:e,depth:t=-1,...n},o)=>{const s=i.useRef(null);return i.useImperativeHandle(o,(()=>s.current),[]),(0,a.F)((({camera:e})=>{s.current.quaternion.copy(e.quaternion),s.current.position.copy(e.position)})),i.createElement("group",(0,r.Z)({ref:s},n),i.createElement("group",{"position-z":-t},e))})),Us=new s.Vector3,Ns=new s.Vector3,Vs=new s.Vector3,Gs=(e,t,n,r=1)=>{const i=Us.set(e.x/n.width*2-1,-e.y/n.height*2+1,r);return i.unproject(t),i},js=(e,t,n,r)=>{const i=((e,t,n)=>{const r=n.width/2,i=n.height/2;t.updateMatrixWorld(!1);const o=e.project(t);return o.x=o.x*r+r,o.y=-o.y*i+i,o})(Vs.copy(e),n,r);let o=0;for(let s=0;s<2;++s){const a=Ns.copy(i).setComponent(s,i.getComponent(s)+t),c=Gs(a,n,r,a.z);o=Math.max(o,e.distanceTo(c))}return o},Hs=new s.Vector3,qs=(0,i.forwardRef)((({scale:e=1,...t},n)=>{const o=(0,i.useRef)(null);return i.useImperativeHandle(n,(()=>o.current),[]),(0,a.F)((t=>{const n=o.current;if(!n)return;const r=js(n.getWorldPosition(Hs),e,t.camera,t.size);n.scale.setScalar(r*e)})),i.createElement("object3D",(0,r.Z)({ref:o},t))})),Ws=new s.Box3,Ys=new s.Vector3;class Xs extends s.InstancedBufferGeometry{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new s.Float32BufferAttribute([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new s.Float32BufferAttribute([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),n.applyMatrix4(e),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new s.InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceStart",new s.InterleavedBufferAttribute(n,3,0)),this.setAttribute("instanceEnd",new s.InterleavedBufferAttribute(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e,t=3){let n;e instanceof Float32Array?n=e:Array.isArray(e)&&(n=new Float32Array(e));const r=new s.InstancedInterleavedBuffer(n,2*t,1);return this.setAttribute("instanceColorStart",new s.InterleavedBufferAttribute(r,t,0)),this.setAttribute("instanceColorEnd",new s.InterleavedBufferAttribute(r,t,t)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new s.WireframeGeometry(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new s.Box3);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),Ws.setFromBufferAttribute(t),this.boundingBox.union(Ws))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new s.Sphere),null===this.boundingBox&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){const n=this.boundingSphere.center;this.boundingBox.getCenter(n);let r=0;for(let i=0,o=e.count;i<o;i++)Ys.fromBufferAttribute(e,i),r=Math.max(r,n.distanceToSquared(Ys)),Ys.fromBufferAttribute(t,i),r=Math.max(r,n.distanceToSquared(Ys));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class Zs extends s.ShaderMaterial{constructor(e){super({type:"LineMaterial",uniforms:s.UniformsUtils.clone(s.UniformsUtils.merge([s.UniformsLib.common,s.UniformsLib.fog,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new s.Vector2(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}}])),vertexShader:"\n\t\t\t\t#include <common>\n\t\t\t\t#include <fog_pars_vertex>\n\t\t\t\t#include <logdepthbuf_pars_vertex>\n\t\t\t\t#include <clipping_planes_pars_vertex>\n\n\t\t\t\tuniform float linewidth;\n\t\t\t\tuniform vec2 resolution;\n\n\t\t\t\tattribute vec3 instanceStart;\n\t\t\t\tattribute vec3 instanceEnd;\n\n\t\t\t\t#ifdef USE_COLOR\n\t\t\t\t\t#ifdef USE_LINE_COLOR_ALPHA\n\t\t\t\t\t\tvarying vec4 vLineColor;\n\t\t\t\t\t\tattribute vec4 instanceColorStart;\n\t\t\t\t\t\tattribute vec4 instanceColorEnd;\n\t\t\t\t\t#else\n\t\t\t\t\t\tvarying vec3 vLineColor;\n\t\t\t\t\t\tattribute vec3 instanceColorStart;\n\t\t\t\t\t\tattribute vec3 instanceColorEnd;\n\t\t\t\t\t#endif\n\t\t\t\t#endif\n\n\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\tvarying vec4 worldPos;\n\t\t\t\t\tvarying vec3 worldStart;\n\t\t\t\t\tvarying vec3 worldEnd;\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#else\n\n\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t#endif\n\n\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\tuniform float dashScale;\n\t\t\t\t\tattribute float instanceDistanceStart;\n\t\t\t\t\tattribute float instanceDistanceEnd;\n\t\t\t\t\tvarying float vLineDistance;\n\n\t\t\t\t#endif\n\n\t\t\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t\t\t// conservative estimate of the near plane\n\t\t\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#ifdef USE_COLOR\n\n\t\t\t\t\t\tvLineColor = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\t\t\t\t\t\tvUv = uv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\t\t\t// camera space\n\t\t\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t\tworldStart = start.xyz;\n\t\t\t\t\t\tworldEnd = end.xyz;\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tvUv = uv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\t\t\tif ( perspective ) {\n\n\t\t\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// clip space\n\t\t\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t\t\t// ndc space\n\t\t\t\t\tvec3 ndcStart = clipStart.xyz / clipStart.w;\n\t\t\t\t\tvec3 ndcEnd = clipEnd.xyz / clipEnd.w;\n\n\t\t\t\t\t// direction\n\t\t\t\t\tvec2 dir = ndcEnd.xy - ndcStart.xy;\n\n\t\t\t\t\t// account for clip-space aspect ratio\n\t\t\t\t\tdir.x *= aspect;\n\t\t\t\t\tdir = normalize( dir );\n\n\t\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t\t// get the offset direction as perpendicular to the view vector\n\t\t\t\t\t\tvec3 worldDir = normalize( end.xyz - start.xyz );\n\t\t\t\t\t\tvec3 offset;\n\t\t\t\t\t\tif ( position.y < 0.5 ) {\n\n\t\t\t\t\t\t\toffset = normalize( cross( start.xyz, worldDir ) );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\toffset = normalize( cross( end.xyz, worldDir ) );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// sign flip\n\t\t\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t\t\tfloat forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );\n\n\t\t\t\t\t\t// don't extend the line if we're rendering dashes because we\n\t\t\t\t\t\t// won't be rendering the endcaps\n\t\t\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t\t\t// extend the line bounds to encompass  endcaps\n\t\t\t\t\t\t\tstart.xyz += - worldDir * linewidth * 0.5;\n\t\t\t\t\t\t\tend.xyz += worldDir * linewidth * 0.5;\n\n\t\t\t\t\t\t\t// shift the position of the quad so it hugs the forward edge of the line\n\t\t\t\t\t\t\toffset.xy -= dir * forwardOffset;\n\t\t\t\t\t\t\toffset.z += 0.5;\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t// endcaps\n\t\t\t\t\t\tif ( position.y > 1.0 || position.y < 0.0 ) {\n\n\t\t\t\t\t\t\toffset.xy += dir * 2.0 * forwardOffset;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// adjust for linewidth\n\t\t\t\t\t\toffset *= linewidth * 0.5;\n\n\t\t\t\t\t\t// set the world position\n\t\t\t\t\t\tworldPos = ( position.y < 0.5 ) ? start : end;\n\t\t\t\t\t\tworldPos.xyz += offset;\n\n\t\t\t\t\t\t// project the worldpos\n\t\t\t\t\t\tvec4 clip = projectionMatrix * worldPos;\n\n\t\t\t\t\t\t// shift the depth of the projected points so the line\n\t\t\t\t\t\t// segments overlap neatly\n\t\t\t\t\t\tvec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;\n\t\t\t\t\t\tclip.z = clipPose.z * clip.w;\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\t\t\t\t\t\t// undo aspect ratio adjustment\n\t\t\t\t\t\tdir.x /= aspect;\n\t\t\t\t\t\toffset.x /= aspect;\n\n\t\t\t\t\t\t// sign flip\n\t\t\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t\t\t// endcaps\n\t\t\t\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\t\t\t\toffset += - dir;\n\n\t\t\t\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\t\t\t\toffset += dir;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// adjust for linewidth\n\t\t\t\t\t\toffset *= linewidth;\n\n\t\t\t\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\t\t\t\toffset /= resolution.y;\n\n\t\t\t\t\t\t// select end\n\t\t\t\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t\t\t\t// back to clip space\n\t\t\t\t\t\toffset *= clip.w;\n\n\t\t\t\t\t\tclip.xy += offset;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tgl_Position = clip;\n\n\t\t\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t\t\t#include <logdepthbuf_vertex>\n\t\t\t\t\t#include <clipping_planes_vertex>\n\t\t\t\t\t#include <fog_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:`\n\t\t\t\tuniform vec3 diffuse;\n\t\t\t\tuniform float opacity;\n\t\t\t\tuniform float linewidth;\n\n\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\tuniform float dashOffset;\n\t\t\t\t\tuniform float dashSize;\n\t\t\t\t\tuniform float gapSize;\n\n\t\t\t\t#endif\n\n\t\t\t\tvarying float vLineDistance;\n\n\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\tvarying vec4 worldPos;\n\t\t\t\t\tvarying vec3 worldStart;\n\t\t\t\t\tvarying vec3 worldEnd;\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#else\n\n\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t#endif\n\n\t\t\t\t#include <common>\n\t\t\t\t#include <fog_pars_fragment>\n\t\t\t\t#include <logdepthbuf_pars_fragment>\n\t\t\t\t#include <clipping_planes_pars_fragment>\n\n\t\t\t\t#ifdef USE_COLOR\n\t\t\t\t\t#ifdef USE_LINE_COLOR_ALPHA\n\t\t\t\t\t\tvarying vec4 vLineColor;\n\t\t\t\t\t#else\n\t\t\t\t\t\tvarying vec3 vLineColor;\n\t\t\t\t\t#endif\n\t\t\t\t#endif\n\n\t\t\t\tvec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {\n\n\t\t\t\t\tfloat mua;\n\t\t\t\t\tfloat mub;\n\n\t\t\t\t\tvec3 p13 = p1 - p3;\n\t\t\t\t\tvec3 p43 = p4 - p3;\n\n\t\t\t\t\tvec3 p21 = p2 - p1;\n\n\t\t\t\t\tfloat d1343 = dot( p13, p43 );\n\t\t\t\t\tfloat d4321 = dot( p43, p21 );\n\t\t\t\t\tfloat d1321 = dot( p13, p21 );\n\t\t\t\t\tfloat d4343 = dot( p43, p43 );\n\t\t\t\t\tfloat d2121 = dot( p21, p21 );\n\n\t\t\t\t\tfloat denom = d2121 * d4343 - d4321 * d4321;\n\n\t\t\t\t\tfloat numer = d1343 * d4321 - d1321 * d4343;\n\n\t\t\t\t\tmua = numer / denom;\n\t\t\t\t\tmua = clamp( mua, 0.0, 1.0 );\n\t\t\t\t\tmub = ( d1343 + d4321 * ( mua ) ) / d4343;\n\t\t\t\t\tmub = clamp( mub, 0.0, 1.0 );\n\n\t\t\t\t\treturn vec2( mua, mub );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tfloat alpha = opacity;\n\n\t\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t\t// Find the closest points on the view ray and the line segment\n\t\t\t\t\t\tvec3 rayEnd = normalize( worldPos.xyz ) * 1e5;\n\t\t\t\t\t\tvec3 lineDir = worldEnd - worldStart;\n\t\t\t\t\t\tvec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );\n\n\t\t\t\t\t\tvec3 p1 = worldStart + lineDir * params.x;\n\t\t\t\t\t\tvec3 p2 = rayEnd * params.y;\n\t\t\t\t\t\tvec3 delta = p1 - p2;\n\t\t\t\t\t\tfloat len = length( delta );\n\t\t\t\t\t\tfloat norm = len / linewidth;\n\n\t\t\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\t\t\tfloat dnorm = fwidth( norm );\n\t\t\t\t\t\t\t\talpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );\n\n\t\t\t\t\t\t\t#else\n\n\t\t\t\t\t\t\t\tif ( norm > 0.5 ) {\n\n\t\t\t\t\t\t\t\t\tdiscard;\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\t\t// artifacts appear on some hardware if a derivative is taken within a conditional\n\t\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\t\t\t\t\t\t\tfloat dlen = fwidth( len2 );\n\n\t\t\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\t\t\talpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t#else\n\n\t\t\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\t\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tvec4 diffuseColor = vec4( diffuse, alpha );\n\t\t\t\t\t#ifdef USE_COLOR\n\t\t\t\t\t\t#ifdef USE_LINE_COLOR_ALPHA\n\t\t\t\t\t\t\tdiffuseColor *= vLineColor;\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tdiffuseColor.rgb *= vLineColor;\n\t\t\t\t\t\t#endif\n\t\t\t\t\t#endif\n\n\t\t\t\t\t#include <logdepthbuf_fragment>\n\n\t\t\t\t\tgl_FragColor = diffuseColor;\n\n\t\t\t\t\t#include <tonemapping_fragment>\n\t\t\t\t\t#include <${parseInt(s.REVISION.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>\n\t\t\t\t\t#include <fog_fragment>\n\t\t\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t\t\t}\n\t\t\t`,clipping:!0}),this.isLineMaterial=!0,this.onBeforeCompile=function(){this.transparent?this.defines.USE_LINE_COLOR_ALPHA="1":delete this.defines.USE_LINE_COLOR_ALPHA},Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(e){!0===e?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(e){Boolean(e)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),!0===e?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(e){Boolean(e)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),!0===e?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}var Ks=n(14542);const Js=Ks.i>=125?"uv1":"uv2",$s=new s.Vector4,ea=new s.Vector3,ta=new s.Vector3,na=new s.Vector4,ra=new s.Vector4,ia=new s.Vector4,oa=new s.Vector3,sa=new s.Matrix4,aa=new s.Line3,ca=new s.Vector3,la=new s.Box3,ua=new s.Sphere,ha=new s.Vector4;let da,Aa;function ma(e,t,n){return ha.set(0,0,-t,1).applyMatrix4(e.projectionMatrix),ha.multiplyScalar(1/ha.w),ha.x=Aa/n.width,ha.y=Aa/n.height,ha.applyMatrix4(e.projectionMatrixInverse),ha.multiplyScalar(1/ha.w),Math.abs(Math.max(ha.x,ha.y))}class pa extends s.Mesh{constructor(e=new Xs,t=new Zs({color:16777215*Math.random()})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,n=e.attributes.instanceEnd,r=new Float32Array(2*t.count);for(let o=0,s=0,a=t.count;o<a;o++,s+=2)ea.fromBufferAttribute(t,o),ta.fromBufferAttribute(n,o),r[s]=0===s?0:r[s-1],r[s+1]=r[s]+ea.distanceTo(ta);const i=new s.InstancedInterleavedBuffer(r,2,1);return e.setAttribute("instanceDistanceStart",new s.InterleavedBufferAttribute(i,1,0)),e.setAttribute("instanceDistanceEnd",new s.InterleavedBufferAttribute(i,1,1)),this}raycast(e,t){const n=this.material.worldUnits,r=e.camera;null!==r||n||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const i=void 0!==e.params.Line2&&e.params.Line2.threshold||0;da=e.ray;const o=this.matrixWorld,a=this.geometry,c=this.material;let l,u;if(Aa=c.linewidth+i,null===a.boundingSphere&&a.computeBoundingSphere(),ua.copy(a.boundingSphere).applyMatrix4(o),n)l=.5*Aa;else{l=ma(r,Math.max(r.near,ua.distanceToPoint(da.origin)),c.resolution)}if(ua.radius+=l,!1!==da.intersectsSphere(ua)){if(null===a.boundingBox&&a.computeBoundingBox(),la.copy(a.boundingBox).applyMatrix4(o),n)u=.5*Aa;else{u=ma(r,Math.max(r.near,la.distanceToPoint(da.origin)),c.resolution)}la.expandByScalar(u),!1!==da.intersectsBox(la)&&(n?function(e,t){const n=e.matrixWorld,r=e.geometry,i=r.attributes.instanceStart,o=r.attributes.instanceEnd;for(let a=0,c=Math.min(r.instanceCount,i.count);a<c;a++){aa.start.fromBufferAttribute(i,a),aa.end.fromBufferAttribute(o,a),aa.applyMatrix4(n);const r=new s.Vector3,c=new s.Vector3;da.distanceSqToSegment(aa.start,aa.end,c,r),c.distanceTo(r)<.5*Aa&&t.push({point:c,pointOnLine:r,distance:da.origin.distanceTo(c),object:e,face:null,faceIndex:a,uv:null,[Js]:null})}}(this,t):function(e,t,n){const r=t.projectionMatrix,i=e.material.resolution,o=e.matrixWorld,a=e.geometry,c=a.attributes.instanceStart,l=a.attributes.instanceEnd,u=Math.min(a.instanceCount,c.count),h=-t.near;da.at(1,ia),ia.w=1,ia.applyMatrix4(t.matrixWorldInverse),ia.applyMatrix4(r),ia.multiplyScalar(1/ia.w),ia.x*=i.x/2,ia.y*=i.y/2,ia.z=0,oa.copy(ia),sa.multiplyMatrices(t.matrixWorldInverse,o);for(let d=0,A=u;d<A;d++){if(na.fromBufferAttribute(c,d),ra.fromBufferAttribute(l,d),na.w=1,ra.w=1,na.applyMatrix4(sa),ra.applyMatrix4(sa),na.z>h&&ra.z>h)continue;if(na.z>h){const e=na.z-ra.z,t=(na.z-h)/e;na.lerp(ra,t)}else if(ra.z>h){const e=ra.z-na.z,t=(ra.z-h)/e;ra.lerp(na,t)}na.applyMatrix4(r),ra.applyMatrix4(r),na.multiplyScalar(1/na.w),ra.multiplyScalar(1/ra.w),na.x*=i.x/2,na.y*=i.y/2,ra.x*=i.x/2,ra.y*=i.y/2,aa.start.copy(na),aa.start.z=0,aa.end.copy(ra),aa.end.z=0;const t=aa.closestPointToPointParameter(oa,!0);aa.at(t,ca);const a=s.MathUtils.lerp(na.z,ra.z,t),u=a>=-1&&a<=1,A=oa.distanceTo(ca)<.5*Aa;if(u&&A){aa.start.fromBufferAttribute(c,d),aa.end.fromBufferAttribute(l,d),aa.start.applyMatrix4(o),aa.end.applyMatrix4(o);const t=new s.Vector3,r=new s.Vector3;da.distanceSqToSegment(aa.start,aa.end,r,t),n.push({point:r,pointOnLine:t,distance:da.origin.distanceTo(r),object:e,face:null,faceIndex:d,uv:null,[Js]:null})}}}(this,r,t))}}onBeforeRender(e){const t=this.material.uniforms;t&&t.resolution&&(e.getViewport($s),this.material.uniforms.resolution.value.set($s.z,$s.w))}}class fa extends Xs{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,n=new Float32Array(2*t);for(let r=0;r<t;r+=3)n[2*r]=e[r],n[2*r+1]=e[r+1],n[2*r+2]=e[r+2],n[2*r+3]=e[r+3],n[2*r+4]=e[r+4],n[2*r+5]=e[r+5];return super.setPositions(n),this}setColors(e,t=3){const n=e.length-t,r=new Float32Array(2*n);if(3===t)for(let i=0;i<n;i+=t)r[2*i]=e[i],r[2*i+1]=e[i+1],r[2*i+2]=e[i+2],r[2*i+3]=e[i+3],r[2*i+4]=e[i+4],r[2*i+5]=e[i+5];else for(let i=0;i<n;i+=t)r[2*i]=e[i],r[2*i+1]=e[i+1],r[2*i+2]=e[i+2],r[2*i+3]=e[i+3],r[2*i+4]=e[i+4],r[2*i+5]=e[i+5],r[2*i+6]=e[i+6],r[2*i+7]=e[i+7];return super.setColors(r,t),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class ga extends pa{constructor(e=new fa,t=new Zs({color:16777215*Math.random()})){super(e,t),this.isLine2=!0,this.type="Line2"}}const ya=i.forwardRef((function({points:e,color:t=16777215,vertexColors:n,linewidth:o,lineWidth:c,segments:l,dashed:u,...h},d){var A,m;const p=(0,a.D)((e=>e.size)),f=i.useMemo((()=>l?new pa:new ga),[l]),[g]=i.useState((()=>new Zs)),y=4===(null==n||null==(A=n[0])?void 0:A.length)?4:3,v=i.useMemo((()=>{const r=l?new Xs:new fa,i=e.map((e=>{const t=Array.isArray(e);return e instanceof s.Vector3||e instanceof s.Vector4?[e.x,e.y,e.z]:e instanceof s.Vector2?[e.x,e.y,0]:t&&3===e.length?[e[0],e[1],e[2]]:t&&2===e.length?[e[0],e[1],0]:e}));if(r.setPositions(i.flat()),n){t=16777215;const e=n.map((e=>e instanceof s.Color?e.toArray():e));r.setColors(e.flat(),y)}return r}),[e,l,n,y]);return i.useLayoutEffect((()=>{f.computeLineDistances()}),[e,f]),i.useLayoutEffect((()=>{u?g.defines.USE_DASH="":delete g.defines.USE_DASH,g.needsUpdate=!0}),[u,g]),i.useEffect((()=>()=>{v.dispose(),g.dispose()}),[v]),i.createElement("primitive",(0,r.Z)({object:f,ref:d},h),i.createElement("primitive",{object:v,attach:"geometry"}),i.createElement("primitive",(0,r.Z)({object:g,attach:"material",color:t,vertexColors:Boolean(n),resolution:[p.width,p.height],linewidth:null!==(m=null!==o&&void 0!==o?o:c)&&void 0!==m?m:1,dashed:u,transparent:4===y},h)))})),va=new s.Vector3,xa=i.forwardRef((function({start:e=[0,0,0],end:t=[0,0,0],mid:n,segments:o=20,...a},c){const l=i.useRef(null);i.useImperativeHandle(c,(()=>l.current));const[u]=i.useState((()=>new s.QuadraticBezierCurve3(void 0,void 0,void 0))),h=i.useCallback(((e,t,n,r=20)=>(e instanceof s.Vector3?u.v0.copy(e):u.v0.set(...e),t instanceof s.Vector3?u.v2.copy(t):u.v2.set(...t),n instanceof s.Vector3?u.v1.copy(n):Array.isArray(n)?u.v1.set(...n):u.v1.copy(u.v0.clone().add(u.v2.clone().sub(u.v0)).add(va.set(0,u.v0.y-u.v2.y,0))),u.getPoints(r))),[]);i.useLayoutEffect((()=>{l.current.setPoints=(e,t,n)=>{const r=h(e,t,n);l.current.geometry&&l.current.geometry.setPositions(r.map((e=>e.toArray())).flat())}}),[]);const d=i.useMemo((()=>h(e,t,n,o)),[e,t,n,o]);return i.createElement(ya,(0,r.Z)({ref:l,points:d},a))})),Ea=i.forwardRef((function({start:e,end:t,midA:n,midB:o,segments:a=20,...c},l){const u=i.useMemo((()=>{const r=e instanceof s.Vector3?e:new s.Vector3(...e),i=t instanceof s.Vector3?t:new s.Vector3(...t),c=n instanceof s.Vector3?n:new s.Vector3(...n),l=o instanceof s.Vector3?o:new s.Vector3(...o);return new s.CubicBezierCurve3(r,c,l,i).getPoints(a)}),[e,t,n,o,a]);return i.createElement(ya,(0,r.Z)({ref:l,points:u},c))})),wa=i.forwardRef((function({points:e,closed:t=!1,curveType:n="centripetal",tension:o=.5,segments:a=20,vertexColors:c,...l},u){const h=i.useMemo((()=>{const r=e.map((e=>e instanceof s.Vector3?e:new s.Vector3(...e)));return new s.CatmullRomCurve3(r,t,n,o)}),[e,t,n,o]),d=i.useMemo((()=>h.getPoints(a)),[h,a]),A=i.useMemo((()=>{if(!c||c.length<2)return;if(c.length===a+1)return c;const e=c.map((e=>e instanceof s.Color?e:new s.Color(...e)));t&&e.push(e[0].clone());const n=[e[0]],r=a/(e.length-1);for(let t=1;t<a;t++){const i=t%r/r,o=Math.floor(t/r);n.push(e[o].clone().lerp(e[o+1],i))}return n.push(e[e.length-1]),n}),[c,a]);return i.createElement(ya,(0,r.Z)({ref:u,points:d,vertexColors:A},l))})),Ca=i.forwardRef((({url:e,distance:t=1,loop:n=!0,autoplay:o,...c},l)=>{const u=i.useRef(null);i.useImperativeHandle(l,(()=>u.current),[]);const h=(0,a.D)((({camera:e})=>e)),[d]=i.useState((()=>new s.AudioListener)),A=(0,a.H)(s.AudioLoader,e);return i.useEffect((()=>{const e=u.current;e&&(e.setBuffer(A),e.setRefDistance(t),e.setLoop(n),o&&!e.isPlaying&&e.play())}),[A,h,t,n]),i.useEffect((()=>{const e=u.current;return h.add(d),()=>{h.remove(d),e&&(e.isPlaying&&e.stop(),e.source&&e.source._connected&&e.disconnect())}}),[]),i.createElement("positionalAudio",(0,r.Z)({ref:u,args:[d]},c))}));var Ia=n(65418),_a=n(11257);const ba=i.forwardRef((({sdfGlyphSize:e=64,anchorX:t="center",anchorY:n="middle",font:o,fontSize:s=1,children:c,characters:l,onSync:u,...h},d)=>{const A=(0,a.D)((({invalidate:e})=>e)),[m]=i.useState((()=>new Ia.xv)),[p,f]=i.useMemo((()=>{const e=[];let t="";return i.Children.forEach(c,(n=>{"string"===typeof n||"number"===typeof n?t+=n:e.push(n)})),[e,t]}),[c]);return(0,_a.Rq)((()=>new Promise((e=>(0,Ia.C5)({font:o,characters:l},e)))),["troika-text",o,l]),i.useLayoutEffect((()=>{m.sync((()=>{A(),u&&u(m)}))})),i.useEffect((()=>()=>m.dispose()),[m]),i.createElement("primitive",(0,r.Z)({object:m,ref:d,font:o,text:f,anchorX:t,anchorY:n,fontSize:s,sdfGlyphSize:e},h),p)}));class Ba extends s.ExtrudeGeometry{constructor(e,t={}){const{bevelEnabled:n=!1,bevelSize:r=8,bevelThickness:i=10,font:o,height:s=50,size:a=100,lineHeight:c=1,letterSpacing:l=0,...u}=t;if(void 0===o)super();else{super(o.generateShapes(e,a,{lineHeight:c,letterSpacing:l}),{...u,bevelEnabled:n,bevelSize:r,bevelThickness:i,depth:s})}this.type="TextGeometry"}}var Ma=n(57666),Sa=Object.defineProperty,Da=(e,t,n)=>(((e,t,n)=>{t in e?Sa(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);class Ta extends s.Loader{constructor(e){super(e)}load(e,t,n,r){const i=new s.FileLoader(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,(e=>{if("string"!==typeof e)throw new Error("unsupported data type");const n=JSON.parse(e),r=this.parse(n);t&&t(r)}),n,r)}loadAsync(e,t){return super.loadAsync(e,t)}parse(e){return new Qa(e)}}class Qa{constructor(e){Da(this,"data"),this.data=e}generateShapes(e,t=100,n){const r=[],i={letterSpacing:0,lineHeight:1,...n},o=function(e,t,n,r){const i=Array.from(e),o=t/n.resolution,s=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*o,a=[];let c=0,l=0;for(let u=0;u<i.length;u++){const e=i[u];if("\n"===e)c=0,l-=s*r.lineHeight;else{const t=Pa(e,o,c,l,n);t&&(c+=t.offsetX+r.letterSpacing,a.push(t.path))}}return a}(e,t,this.data,i);for(let s=0,a=o.length;s<a;s++)Array.prototype.push.apply(r,o[s].toShapes(!1));return r}}function Pa(e,t,n,r,i){const o=i.glyphs[e]||i.glyphs["?"];if(!o)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+i.familyName+".");const a=new s.ShapePath;let c,l,u,h,d,A,m,p;if(o.o){const e=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let i=0,o=e.length;i<o;){switch(e[i++]){case"m":c=parseInt(e[i++])*t+n,l=parseInt(e[i++])*t+r,a.moveTo(c,l);break;case"l":c=parseInt(e[i++])*t+n,l=parseInt(e[i++])*t+r,a.lineTo(c,l);break;case"q":u=parseInt(e[i++])*t+n,h=parseInt(e[i++])*t+r,d=parseInt(e[i++])*t+n,A=parseInt(e[i++])*t+r,a.quadraticCurveTo(d,A,u,h);break;case"b":u=parseInt(e[i++])*t+n,h=parseInt(e[i++])*t+r,d=parseInt(e[i++])*t+n,A=parseInt(e[i++])*t+r,m=parseInt(e[i++])*t+n,p=parseInt(e[i++])*t+r,a.bezierCurveTo(d,A,m,p,u,h)}}}return{offsetX:o.ha*t,path:a}}Da(Qa,"isFont"),Da(Qa,"type");let za=null;async function Ra(e){const t=await async function(e){return"string"===typeof e?await(await fetch(e)).json():e}(e);return n=t,za||(za=new Ta),za.parse(n);var n}function Fa(e){return(0,_a.Rq)(Ra,[e])}Fa.preload=e=>(0,_a.MA)(Ra,[e]),Fa.clear=e=>(0,_a.ZH)([e]);const ka=["string","number"],La=i.forwardRef((({font:e,letterSpacing:t=0,lineHeight:n=1,size:o=1,height:s=.2,bevelThickness:c=.1,bevelSize:l=.01,bevelEnabled:u=!1,bevelOffset:h=0,bevelSegments:d=4,curveSegments:A=8,smooth:m,children:p,...f},g)=>{i.useMemo((()=>(0,a.e)({RenamedTextGeometry:Ba})),[]);const y=i.useRef(null),v=Fa(e),x=(0,i.useMemo)((()=>({font:v,size:o,height:s,bevelThickness:c,bevelSize:l,bevelEnabled:u,bevelSegments:d,bevelOffset:h,curveSegments:A,letterSpacing:t,lineHeight:n})),[v,o,s,c,l,u,d,h,A,t,n]),[E,...w]=(0,i.useMemo)((()=>(e=>{let t="";const n=[];return i.Children.forEach(e,(e=>{ka.includes(typeof e)?t+=e+"":n.push(e)})),[t,...n]})(p)),[p]),C=i.useMemo((()=>[E,x]),[E,x]);return i.useLayoutEffect((()=>{m&&(y.current.geometry=(0,Ma.$1)(y.current.geometry,m),y.current.geometry.computeVertexNormals())}),[C,m]),i.useImperativeHandle(g,(()=>y.current),[]),i.createElement("mesh",(0,r.Z)({},f,{ref:y}),i.createElement("renamedTextGeometry",{args:C}),w)})),Oa={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")};var Ua=Object.defineProperty,Na=(e,t,n)=>(((e,t,n)=>{t in e?Ua(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);class Va{constructor(){Na(this,"enabled",!0),Na(this,"needsSwap",!0),Na(this,"clear",!1),Na(this,"renderToScreen",!1)}setSize(e,t){}render(e,t,n,r,i){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}class Ga{constructor(e){Na(this,"camera",new s.OrthographicCamera(-1,1,1,-1,0,1)),Na(this,"geometry",new s.PlaneGeometry(2,2)),Na(this,"mesh"),this.mesh=new s.Mesh(this.geometry,e)}get material(){return this.mesh.material}set material(e){this.mesh.material=e}dispose(){this.mesh.geometry.dispose()}render(e){e.render(this.mesh,this.camera)}}var ja=Object.defineProperty,Ha=(e,t,n)=>(((e,t,n)=>{t in e?ja(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);class qa extends Va{constructor(e,t="tDiffuse"){super(),Ha(this,"textureID"),Ha(this,"uniforms"),Ha(this,"material"),Ha(this,"fsQuad"),this.textureID=t,e instanceof s.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):(this.uniforms=s.UniformsUtils.clone(e.uniforms),this.material=new s.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Ga(this.material)}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.fsQuad.dispose(),this.material.dispose()}}var Wa=Object.defineProperty,Ya=(e,t,n)=>(((e,t,n)=>{t in e?Wa(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);class Xa extends Va{constructor(e,t){super(),Ya(this,"scene"),Ya(this,"camera"),Ya(this,"inverse"),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const r=e.getContext(),i=e.state;let o,s;i.buffers.color.setMask(!1),i.buffers.depth.setMask(!1),i.buffers.color.setLocked(!0),i.buffers.depth.setLocked(!0),this.inverse?(o=0,s=1):(o=1,s=0),i.buffers.stencil.setTest(!0),i.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),i.buffers.stencil.setFunc(r.ALWAYS,o,4294967295),i.buffers.stencil.setClear(s),i.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),i.buffers.color.setLocked(!1),i.buffers.depth.setLocked(!1),i.buffers.stencil.setLocked(!1),i.buffers.stencil.setFunc(r.EQUAL,1,4294967295),i.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),i.buffers.stencil.setLocked(!0)}}class Za extends Va{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}var Ka=Object.defineProperty,Ja=(e,t,n)=>(((e,t,n)=>{t in e?Ka(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);class $a{constructor(e,t){if(Ja(this,"renderer"),Ja(this,"_pixelRatio"),Ja(this,"_width"),Ja(this,"_height"),Ja(this,"renderTarget1"),Ja(this,"renderTarget2"),Ja(this,"writeBuffer"),Ja(this,"readBuffer"),Ja(this,"renderToScreen"),Ja(this,"passes",[]),Ja(this,"copyPass"),Ja(this,"clock"),this.renderer=e,void 0===t){const n={minFilter:s.LinearFilter,magFilter:s.LinearFilter,format:s.RGBAFormat},r=e.getSize(new s.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=r.width,this._height=r.height,(t=new s.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,n)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,void 0===Oa&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===qa&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new qa(Oa),this.copyPass.material.blending=s.NoBlending,this.clock=new s.Clock}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;const r=this.passes.length;for(let i=0;i<r;i++){const t=this.passes[i];if(!1!==t.enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),t.needsSwap){if(n){const t=this.renderer.getContext(),n=this.renderer.state.buffers.stencil;n.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),n.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==Xa&&(t instanceof Xa?n=!0:t instanceof Za&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const t=this.renderer.getSize(new s.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(let i=0;i<this.passes.length;i++)this.passes[i].setSize(n,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}var ec=Object.defineProperty,tc=(e,t,n)=>(((e,t,n)=>{t in e?ec(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);class nc extends Va{constructor(e,t,n,r,i=0){super(),tc(this,"scene"),tc(this,"camera"),tc(this,"overrideMaterial"),tc(this,"clearColor"),tc(this,"clearAlpha"),tc(this,"clearDepth",!1),tc(this,"_oldClearColor",new s.Color),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=i,this.clear=!0,this.needsSwap=!1}render(e,t,n){let r,i=e.autoClear;e.autoClear=!1;let o=null;void 0!==this.overrideMaterial&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),r=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,r),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=o),e.autoClear=i}}const rc={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 tex = texture2D( tDiffuse, vUv );","\tgl_FragColor = LinearTosRGB( tex );","}"].join("\n")},ic=()=>{try{var e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(lm){return!1}},oc=i.forwardRef((({children:e,multisamping:t=8,renderIndex:n=1,disableRender:o,disableGamma:c,disableRenderPass:l,depthBuffer:u=!0,stencilBuffer:h=!1,anisotropy:d=1,encoding:A,type:m,...p},f)=>{i.useMemo((()=>(0,a.e)({EffectComposer:$a,RenderPass:nc,ShaderPass:qa})),[]);const g=i.useRef(null);i.useImperativeHandle(f,(()=>g.current),[]);const{scene:y,camera:v,gl:x,size:E,viewport:w}=(0,a.D)(),[C]=i.useState((()=>{const e=new s.WebGLRenderTarget(E.width,E.height,{type:m||s.HalfFloatType,format:s.RGBAFormat,depthBuffer:u,stencilBuffer:h,anisotropy:d});return m===s.UnsignedByteType&&null!=A&&("colorSpace"in e?e.texture.colorSpace=A:e.texture.encoding=A),e.samples=t,e}));i.useEffect((()=>{var e,t;null==(e=g.current)||e.setSize(E.width,E.height),null==(t=g.current)||t.setPixelRatio(w.dpr)}),[x,E,w.dpr]),(0,a.F)((()=>{var e;o||null==(e=g.current)||e.render()}),n);const I=[];return l||I.push(i.createElement("renderPass",{key:"renderpass",attach:`passes-${I.length}`,args:[y,v]})),c||I.push(i.createElement("shaderPass",{attach:`passes-${I.length}`,key:"gammapass",args:[rc]})),i.Children.forEach(e,(e=>{e&&I.push(i.cloneElement(e,{key:I.length,attach:`passes-${I.length}`}))})),i.createElement("effectComposer",(0,r.Z)({ref:g,args:[x,C]},p),I)}));let sc=function(e){return e.Linear="linear",e.Radial="radial",e}({});function ac({stops:e,colors:t,size:n=1024,width:o=16,type:c=sc.Linear,innerCircleRadius:l=0,outerCircleRadius:u="auto",...h}){const d=(0,a.D)((e=>e.gl)),A=i.useMemo((()=>{const r=document.createElement("canvas"),i=r.getContext("2d");let a;if(r.width=o,r.height=n,c===sc.Linear)a=i.createLinearGradient(0,0,0,n);else{const e=r.width/2,t=r.height/2,n="auto"!==u?Math.abs(Number(u)):Math.sqrt(e**2+t**2);a=i.createRadialGradient(e,t,Math.abs(l),e,t,n)}const h=new s.Color;let d=e.length;for(;d--;)a.addColorStop(e[d],h.set(t[d]).getStyle());return i.save(),i.fillStyle=a,i.fillRect(0,0,o,n),i.restore(),r}),[e]);return i.createElement("canvasTexture",(0,r.Z)({colorSpace:d.outputColorSpace,args:[A],attach:"map"},h))}function cc(e,t,n,r){const i=class extends s.ShaderMaterial{constructor(i={}){const o=Object.entries(e);super({uniforms:o.reduce(((e,[t,n])=>({...e,...s.UniformsUtils.clone({[t]:{value:n}})})),{}),vertexShader:t,fragmentShader:n}),this.key="",o.forEach((([e])=>Object.defineProperty(this,e,{get:()=>this.uniforms[e].value,set:t=>this.uniforms[e].value=t}))),Object.assign(this,i),r&&r(this)}};return i.key=s.MathUtils.generateUUID(),i}const lc=e=>e===Object(e)&&!Array.isArray(e)&&"function"!==typeof e;function uc(e,t){const n=(0,a.D)((e=>e.gl)),r=(0,a.H)(s.TextureLoader,lc(e)?Object.values(e):e);(0,i.useLayoutEffect)((()=>{null==t||t(r)}),[t]),(0,i.useEffect)((()=>{if("initTexture"in n){let e=[];Array.isArray(r)?e=r:r instanceof s.Texture?e=[r]:lc(r)&&(e=Object.values(r)),e.forEach((e=>{e instanceof s.Texture&&n.initTexture(e)}))}}),[n,r]);const o=(0,i.useMemo)((()=>{if(lc(e)){const t={};let n=0;for(const i in e)t[i]=r[n++];return t}return r}),[e,r]);return o}uc.preload=e=>a.H.preload(s.TextureLoader,e),uc.clear=e=>a.H.clear(s.TextureLoader,e);const hc=({children:e,input:t,onLoad:n})=>{const r=uc(t,n);return i.createElement(i.Fragment,null,null==e?void 0:e(r))},dc=(()=>parseInt(s.REVISION.replace(/\D+/g,"")))(),Ac=cc({color:new s.Color("white"),scale:new s.Vector2(1,1),imageBounds:new s.Vector2(1,1),resolution:1024,map:null,zoom:1,radius:0,grayscale:0,opacity:1},"\n  varying vec2 vUv;\n  varying vec2 vPos;\n  void main() {\n    gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);\n    vUv = uv;\n    vPos = position.xy;\n  }\n",`\n  // mostly from https://gist.github.com/statico/df64c5d167362ecf7b34fca0b1459a44\n  varying vec2 vUv;\n  varying vec2 vPos;\n  uniform vec2 scale;\n  uniform vec2 imageBounds;\n  uniform float resolution;\n  uniform vec3 color;\n  uniform sampler2D map;\n  uniform float radius;\n  uniform float zoom;\n  uniform float grayscale;\n  uniform float opacity;\n  const vec3 luma = vec3(.299, 0.587, 0.114);\n  vec4 toGrayscale(vec4 color, float intensity) {\n    return vec4(mix(color.rgb, vec3(dot(color.rgb, luma)), intensity), color.a);\n  }\n  vec2 aspect(vec2 size) {\n    return size / min(size.x, size.y);\n  }\n  \n  const float PI = 3.14159265;\n    \n  // from https://iquilezles.org/articles/distfunctions\n  float udRoundBox( vec2 p, vec2 b, float r ) {\n    return length(max(abs(p)-b+r,0.0))-r;\n  }\n\n  void main() {\n    vec2 s = aspect(scale);\n    vec2 i = aspect(imageBounds);\n    float rs = s.x / s.y;\n    float ri = i.x / i.y;\n    vec2 new = rs < ri ? vec2(i.x * s.y / i.y, s.y) : vec2(s.x, i.y * s.x / i.x);\n    vec2 offset = (rs < ri ? vec2((new.x - s.x) / 2.0, 0.0) : vec2(0.0, (new.y - s.y) / 2.0)) / new;\n    vec2 uv = vUv * s / new + offset;\n    vec2 zUv = (uv - vec2(0.5, 0.5)) / zoom + vec2(0.5, 0.5);\n\n    vec2 res = vec2(scale * resolution);\n    vec2 halfRes = 0.5 * res;\n    float b = udRoundBox(vUv.xy * res - halfRes, halfRes, resolution * radius);    \n\t  vec3 a = mix(vec3(1.0,0.0,0.0), vec3(0.0,0.0,0.0), smoothstep(0.0, 1.0, b));\n    gl_FragColor = toGrayscale(texture2D(map, zUv) * vec4(color, opacity * a), grayscale);\n    \n    #include <tonemapping_fragment>\n    #include <${dc>=154?"colorspace_fragment":"encodings_fragment"}>\n  }\n`),mc=i.forwardRef((({children:e,color:t,segments:n=1,scale:o=1,zoom:s=1,grayscale:c=0,opacity:l=1,radius:u=0,texture:h,toneMapped:d,transparent:A,side:m,...p},f)=>{(0,a.e)({ImageMaterial:Ac});const g=i.useRef(null),y=(0,a.D)((e=>e.size)),v=Array.isArray(o)?[o[0],o[1]]:[o,o],x=[h.image.width,h.image.height],E=Math.max(y.width,y.height);return i.useImperativeHandle(f,(()=>g.current),[]),i.useLayoutEffect((()=>{g.current.geometry.parameters&&g.current.material.scale.set(v[0]*g.current.geometry.parameters.width,v[1]*g.current.geometry.parameters.height)}),[]),i.createElement("mesh",(0,r.Z)({ref:g,scale:Array.isArray(o)?[...o,1]:o},p),i.createElement("planeGeometry",{args:[1,1,n,n]}),i.createElement("imageMaterial",{color:t,map:h,zoom:s,grayscale:c,opacity:l,scale:v,imageBounds:x,resolution:E,radius:u,toneMapped:d,transparent:A,side:m,key:Ac.key}),e)})),pc=i.forwardRef((({url:e,...t},n)=>{const o=uc(e);return i.createElement(mc,(0,r.Z)({},t,{texture:o,ref:n}))})),fc=i.forwardRef((({url:e,...t},n)=>i.createElement(mc,(0,r.Z)({},t,{ref:n})))),gc=i.forwardRef(((e,t)=>{if(e.url)return i.createElement(pc,(0,r.Z)({},e,{ref:t}));if(e.texture)return i.createElement(fc,(0,r.Z)({},e,{ref:t}));throw new Error("<Image /> requires a url or texture")})),yc=i.forwardRef((({threshold:e=15,geometry:t,...n},o)=>{const a=i.useRef(null);i.useImperativeHandle(o,(()=>a.current),[]);const c=i.useMemo((()=>[0,0,0,1,0,0]),[]),l=i.useRef(),u=i.useRef();return i.useLayoutEffect((()=>{const n=a.current.parent,r=null!==t&&void 0!==t?t:null==n?void 0:n.geometry;if(!r)return;if(l.current===r&&u.current===e)return;l.current=r,u.current=e;const i=new s.EdgesGeometry(r,e).attributes.position.array;a.current.geometry.setPositions(i),a.current.geometry.attributes.instanceStart.needsUpdate=!0,a.current.geometry.attributes.instanceEnd.needsUpdate=!0,a.current.computeLineDistances()})),i.createElement(ya,(0,r.Z)({segments:!0,points:c,ref:a,raycast:()=>null},n))})),vc=cc({screenspace:!1,color:new s.Color("black"),opacity:1,thickness:.05,size:new s.Vector2},"#include <common>\n   #include <morphtarget_pars_vertex>\n   #include <skinning_pars_vertex>\n   uniform float thickness;\n   uniform bool screenspace;\n   uniform vec2 size;\n   void main() {\n     #if defined (USE_SKINNING)\n\t     #include <beginnormal_vertex>\n       #include <morphnormal_vertex>\n       #include <skinbase_vertex>\n       #include <skinnormal_vertex>\n       #include <defaultnormal_vertex>\n     #endif\n     #include <begin_vertex>\n\t   #include <morphtarget_vertex>\n\t   #include <skinning_vertex>\n     #include <project_vertex>\n     vec4 tNormal = vec4(normal, 0.0);\n     vec4 tPosition = vec4(transformed, 1.0);\n     #ifdef USE_INSTANCING\n       tNormal = instanceMatrix * tNormal;\n       tPosition = instanceMatrix * tPosition;\n     #endif\n     if (screenspace) {\n       vec3 newPosition = tPosition.xyz + tNormal.xyz * thickness;\n       gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0); \n     } else {\n       vec4 clipPosition = projectionMatrix * modelViewMatrix * tPosition;\n       vec4 clipNormal = projectionMatrix * modelViewMatrix * tNormal;\n       vec2 offset = normalize(clipNormal.xy) * thickness / size * clipPosition.w * 2.0;\n       clipPosition.xy += offset;\n       gl_Position = clipPosition;\n     }\n   }",`uniform vec3 color;\n   uniform float opacity;\n   void main(){\n     gl_FragColor = vec4(color, opacity);\n     #include <tonemapping_fragment>\n     #include <${dc>=154?"colorspace_fragment":"encodings_fragment"}>\n   }`);function xc({color:e="black",opacity:t=1,transparent:n=!1,screenspace:o=!1,toneMapped:c=!0,polygonOffset:l=!1,polygonOffsetFactor:u=0,renderOrder:h=0,thickness:d=.05,angle:A=Math.PI,...m}){const p=i.useRef(),[f]=i.useState((()=>new vc({side:s.BackSide}))),{gl:g}=(0,a.D)(),y=g.getDrawingBufferSize(new s.Vector2);i.useMemo((()=>(0,a.e)({OutlinesMaterial:vc})),[]);const v=i.useRef(0),x=i.useRef();return i.useLayoutEffect((()=>{const e=p.current;if(!e)return;const t=e.parent;if(t&&t.geometry&&(v.current!==A||x.current!==t.geometry)){var n;v.current=A,x.current=t.geometry;let r=null==(n=e.children)?void 0:n[0];r&&(A&&r.geometry.dispose(),e.remove(r)),t.skeleton?(r=new s.SkinnedMesh,r.material=f,r.bind(t.skeleton,t.bindMatrix),e.add(r)):t.isInstancedMesh?(r=new s.InstancedMesh(t.geometry,f,t.count),r.instanceMatrix=t.instanceMatrix,e.add(r)):(r=new s.Mesh,r.material=f,e.add(r)),r.geometry=A?(0,Ma.LZ)(t.geometry,A):t.geometry}})),i.useLayoutEffect((()=>{const r=p.current;if(!r)return;const i=r.children[0];i&&(i.renderOrder=h,(0,a.k)(i.material,{transparent:n,thickness:d,color:e,opacity:t,size:y,screenspace:o,toneMapped:c,polygonOffset:l,polygonOffsetFactor:u}))})),i.useEffect((()=>()=>{const e=p.current;if(!e)return;const t=e.children[0];t&&(A&&t.geometry.dispose(),e.remove(t))}),[]),i.createElement("group",(0,r.Z)({ref:p},m))}var Ec=Object.defineProperty,wc=(e,t,n)=>(((e,t,n)=>{t in e?Ec(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);function Cc(e,t,n,r,i){let o;if(e=e.subarray||e.slice?e:e.buffer,n=n.subarray||n.slice?n:n.buffer,e=t?e.subarray?e.subarray(t,i&&t+i):e.slice(t,i&&t+i):e,n.set)n.set(e,r);else for(o=0;o<e.length;o++)n[o+r]=e[o];return n}class Ic extends s.BufferGeometry{constructor(){super(),wc(this,"type","MeshLine"),wc(this,"isMeshLine",!0),wc(this,"positions",[]),wc(this,"previous",[]),wc(this,"next",[]),wc(this,"side",[]),wc(this,"width",[]),wc(this,"indices_array",[]),wc(this,"uvs",[]),wc(this,"counters",[]),wc(this,"widthCallback",null),wc(this,"_attributes"),wc(this,"_points",[]),wc(this,"points"),wc(this,"matrixWorld",new s.Matrix4),Object.defineProperties(this,{points:{enumerable:!0,get(){return this._points},set(e){this.setPoints(e,this.widthCallback)}}})}setMatrixWorld(e){this.matrixWorld=e}setPoints(e,t){if(e=function(e){return e instanceof Float32Array?e:e instanceof s.BufferGeometry?e.getAttribute("position").array:e.map((e=>{const t=Array.isArray(e);return e instanceof s.Vector3?[e.x,e.y,e.z]:e instanceof s.Vector2?[e.x,e.y,0]:t&&3===e.length?[e[0],e[1],e[2]]:t&&2===e.length?[e[0],e[1],0]:e})).flat()}(e),this._points=e,this.widthCallback=null!=t?t:null,this.positions=[],this.counters=[],e.length&&e[0]instanceof s.Vector3)for(let n=0;n<e.length;n++){const t=e[n],r=n/(e.length-1);this.positions.push(t.x,t.y,t.z),this.positions.push(t.x,t.y,t.z),this.counters.push(r),this.counters.push(r)}else for(let n=0;n<e.length;n+=3){const t=n/(e.length-1);this.positions.push(e[n],e[n+1],e[n+2]),this.positions.push(e[n],e[n+1],e[n+2]),this.counters.push(t),this.counters.push(t)}this.process()}compareV3(e,t){const n=6*e,r=6*t;return this.positions[n]===this.positions[r]&&this.positions[n+1]===this.positions[r+1]&&this.positions[n+2]===this.positions[r+2]}copyV3(e){const t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]}process(){const e=this.positions.length/6;let t,n;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],n=this.compareV3(0,e-1)?this.copyV3(e-2):this.copyV3(0),this.previous.push(n[0],n[1],n[2]),this.previous.push(n[0],n[1],n[2]);for(let r=0;r<e;r++){if(this.side.push(1),this.side.push(-1),t=this.widthCallback?this.widthCallback(r/(e-1)):1,this.width.push(t),this.width.push(t),this.uvs.push(r/(e-1),0),this.uvs.push(r/(e-1),1),r<e-1){n=this.copyV3(r),this.previous.push(n[0],n[1],n[2]),this.previous.push(n[0],n[1],n[2]);const e=2*r;this.indices_array.push(e,e+1,e+2),this.indices_array.push(e+2,e+1,e+3)}r>0&&(n=this.copyV3(r),this.next.push(n[0],n[1],n[2]),this.next.push(n[0],n[1],n[2]))}n=this.compareV3(e-1,0)?this.copyV3(1):this.copyV3(e-1),this.next.push(n[0],n[1],n[2]),this.next.push(n[0],n[1],n[2]),this._attributes&&this._attributes.position.count===this.counters.length?(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0):this._attributes={position:new s.BufferAttribute(new Float32Array(this.positions),3),previous:new s.BufferAttribute(new Float32Array(this.previous),3),next:new s.BufferAttribute(new Float32Array(this.next),3),side:new s.BufferAttribute(new Float32Array(this.side),1),width:new s.BufferAttribute(new Float32Array(this.width),1),uv:new s.BufferAttribute(new Float32Array(this.uvs),2),index:new s.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new s.BufferAttribute(new Float32Array(this.counters),1)},this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()}advance({x:e,y:t,z:n}){const r=this._attributes.position.array,i=this._attributes.previous.array,o=this._attributes.next.array,s=r.length;Cc(r,0,i,0,s),Cc(r,6,r,0,s-6),r[s-6]=e,r[s-5]=t,r[s-4]=n,r[s-3]=e,r[s-2]=t,r[s-1]=n,Cc(r,6,o,0,s-6),o[s-6]=e,o[s-5]=t,o[s-4]=n,o[s-3]=e,o[s-2]=t,o[s-1]=n,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0}}const _c=`\n  #include <fog_pars_fragment>\n  #include <logdepthbuf_pars_fragment>\n  #include <clipping_planes_pars_fragment>\n  \n  uniform sampler2D map;\n  uniform sampler2D alphaMap;\n  uniform float useGradient;\n  uniform float useMap;\n  uniform float useAlphaMap;\n  uniform float useDash;\n  uniform float dashArray;\n  uniform float dashOffset;\n  uniform float dashRatio;\n  uniform float visibility;\n  uniform float alphaTest;\n  uniform vec2 repeat;\n  uniform vec3 gradient[2];\n  \n  varying vec2 vUV;\n  varying vec4 vColor;\n  varying float vCounters;\n  \n  void main() {\n    #include <logdepthbuf_fragment>\n    vec4 diffuseColor = vColor;\n    if (useGradient == 1.) diffuseColor = vec4(mix(gradient[0], gradient[1], vCounters), 1.0);\n    if (useMap == 1.) diffuseColor *= texture2D(map, vUV * repeat);\n    if (useAlphaMap == 1.) diffuseColor.a *= texture2D(alphaMap, vUV * repeat).a;\n    if (diffuseColor.a < alphaTest) discard;\n    if (useDash == 1.) diffuseColor.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));\n    diffuseColor.a *= step(vCounters, visibility);\n    #include <clipping_planes_fragment>\n    gl_FragColor = diffuseColor;     \n    #include <fog_fragment>\n    #include <tonemapping_fragment>\n    #include <${(()=>parseInt(s.REVISION.replace(/\D+/g,"")))()>=154?"colorspace_fragment":"encodings_fragment"}>\n  }\n`;class bc extends s.ShaderMaterial{constructor(e){super({uniforms:{...s.UniformsLib.fog,lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new s.Color(16777215)},gradient:{value:[new s.Color(16711680),new s.Color(65280)]},opacity:{value:1},resolution:{value:new s.Vector2(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},useGradient:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new s.Vector2(1,1)}},vertexShader:"\n  #include <common>\n  #include <logdepthbuf_pars_vertex>\n  #include <fog_pars_vertex>\n  #include <clipping_planes_pars_vertex>\n\n  attribute vec3 previous;\n  attribute vec3 next;\n  attribute float side;\n  attribute float width;\n  attribute float counters;\n  \n  uniform vec2 resolution;\n  uniform float lineWidth;\n  uniform vec3 color;\n  uniform float opacity;\n  uniform float sizeAttenuation;\n  \n  varying vec2 vUV;\n  varying vec4 vColor;\n  varying float vCounters;\n  \n  vec2 fix(vec4 i, float aspect) {\n    vec2 res = i.xy / i.w;\n    res.x *= aspect;\n    return res;\n  }\n  \n  void main() {\n    float aspect = resolution.x / resolution.y;\n    vColor = vec4(color, opacity);\n    vUV = uv;\n    vCounters = counters;\n  \n    mat4 m = projectionMatrix * modelViewMatrix;\n    vec4 finalPosition = m * vec4(position, 1.0) * aspect;\n    vec4 prevPos = m * vec4(previous, 1.0);\n    vec4 nextPos = m * vec4(next, 1.0);\n  \n    vec2 currentP = fix(finalPosition, aspect);\n    vec2 prevP = fix(prevPos, aspect);\n    vec2 nextP = fix(nextPos, aspect);\n  \n    float w = lineWidth * width;\n  \n    vec2 dir;\n    if (nextP == currentP) dir = normalize(currentP - prevP);\n    else if (prevP == currentP) dir = normalize(nextP - currentP);\n    else {\n      vec2 dir1 = normalize(currentP - prevP);\n      vec2 dir2 = normalize(nextP - currentP);\n      dir = normalize(dir1 + dir2);\n  \n      vec2 perp = vec2(-dir1.y, dir1.x);\n      vec2 miter = vec2(-dir.y, dir.x);\n      //w = clamp(w / dot(miter, perp), 0., 4. * lineWidth * width);\n    }\n  \n    //vec2 normal = (cross(vec3(dir, 0.), vec3(0., 0., 1.))).xy;\n    vec4 normal = vec4(-dir.y, dir.x, 0., 1.);\n    normal.xy *= .5 * w;\n    //normal *= projectionMatrix;\n    if (sizeAttenuation == 0.) {\n      normal.xy *= finalPosition.w;\n      normal.xy /= (vec4(resolution, 0., 1.) * projectionMatrix).xy * aspect;\n    }\n  \n    finalPosition.xy += normal.xy * side;\n    gl_Position = finalPosition;\n    #include <logdepthbuf_vertex>\n    #include <fog_vertex>\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n    #include <clipping_planes_vertex>\n    #include <fog_vertex>\n  }\n",fragmentShader:_c}),wc(this,"lineWidth"),wc(this,"map"),wc(this,"useMap"),wc(this,"alphaMap"),wc(this,"useAlphaMap"),wc(this,"color"),wc(this,"gradient"),wc(this,"resolution"),wc(this,"sizeAttenuation"),wc(this,"dashArray"),wc(this,"dashOffset"),wc(this,"dashRatio"),wc(this,"useDash"),wc(this,"useGradient"),wc(this,"visibility"),wc(this,"repeat"),this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get(){return this.uniforms.lineWidth.value},set(e){this.uniforms.lineWidth.value=e}},map:{enumerable:!0,get(){return this.uniforms.map.value},set(e){this.uniforms.map.value=e}},useMap:{enumerable:!0,get(){return this.uniforms.useMap.value},set(e){this.uniforms.useMap.value=e}},alphaMap:{enumerable:!0,get(){return this.uniforms.alphaMap.value},set(e){this.uniforms.alphaMap.value=e}},useAlphaMap:{enumerable:!0,get(){return this.uniforms.useAlphaMap.value},set(e){this.uniforms.useAlphaMap.value=e}},color:{enumerable:!0,get(){return this.uniforms.color.value},set(e){this.uniforms.color.value=e}},gradient:{enumerable:!0,get(){return this.uniforms.gradient.value},set(e){this.uniforms.gradient.value=e}},opacity:{enumerable:!0,get(){return this.uniforms.opacity.value},set(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get(){return this.uniforms.resolution.value},set(e){this.uniforms.resolution.value.copy(e)}},sizeAttenuation:{enumerable:!0,get(){return this.uniforms.sizeAttenuation.value},set(e){this.uniforms.sizeAttenuation.value=e}},dashArray:{enumerable:!0,get(){return this.uniforms.dashArray.value},set(e){this.uniforms.dashArray.value=e,this.useDash=0!==e?1:0}},dashOffset:{enumerable:!0,get(){return this.uniforms.dashOffset.value},set(e){this.uniforms.dashOffset.value=e}},dashRatio:{enumerable:!0,get(){return this.uniforms.dashRatio.value},set(e){this.uniforms.dashRatio.value=e}},useDash:{enumerable:!0,get(){return this.uniforms.useDash.value},set(e){this.uniforms.useDash.value=e}},useGradient:{enumerable:!0,get(){return this.uniforms.useGradient.value},set(e){this.uniforms.useGradient.value=e}},visibility:{enumerable:!0,get(){return this.uniforms.visibility.value},set(e){this.uniforms.visibility.value=e}},alphaTest:{enumerable:!0,get(){return this.uniforms.alphaTest.value},set(e){this.uniforms.alphaTest.value=e}},repeat:{enumerable:!0,get(){return this.uniforms.repeat.value},set(e){this.uniforms.repeat.value.copy(e)}}}),this.setValues(e)}copy(e){return super.copy(e),this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.gradient=e.gradient,this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.dashArray=e.dashArray,this.dashOffset=e.dashOffset,this.dashRatio=e.dashRatio,this.useDash=e.useDash,this.useGradient=e.useGradient,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this}}const Bc={width:.2,length:1,decay:1,local:!1,stride:0,interval:1},Mc=(e,t=1)=>(e.set(e.subarray(t)),e.fill(-1/0,-t),e);function Sc(e,t){const{length:n,local:r,decay:o,interval:c,stride:l}={...Bc,...t},u=i.useRef(),[h]=i.useState((()=>new s.Vector3));i.useLayoutEffect((()=>{e&&(u.current=Float32Array.from({length:10*n*3},((t,n)=>e.position.getComponent(n%3))))}),[n,e]);const d=i.useRef(new s.Vector3),A=i.useRef(0);return(0,a.F)((()=>{if(e&&u.current){if(0===A.current){let t;r?t=e.position:(e.getWorldPosition(h),t=h);const n=1*o;for(let e=0;e<n;e++)t.distanceTo(d.current)<l||(Mc(u.current,3),u.current.set(t.toArray(),u.current.length-3));d.current.copy(t)}A.current++,A.current=A.current%c}})),u}const Dc=i.forwardRef(((e,t)=>{const{children:n}=e,{width:r,length:o,decay:c,local:l,stride:u,interval:h}={...Bc,...e},{color:d="hotpink",attenuation:A,target:m}=e,p=(0,a.D)((e=>e.size)),f=(0,a.D)((e=>e.scene)),g=i.useRef(null),[y,v]=i.useState(null),x=Sc(y,{length:o,decay:c,local:l,stride:u,interval:h});i.useEffect((()=>{const e=(null==m?void 0:m.current)||g.current.children.find((e=>e instanceof s.Object3D));e&&v(e)}),[x,m]);const E=i.useMemo((()=>new Ic),[]),w=i.useMemo((()=>{var e;const t=new bc({lineWidth:.1*r,color:d,sizeAttenuation:1,resolution:new s.Vector2(p.width,p.height)});let i;if(n)if(Array.isArray(n))i=n.find((e=>{const t=e;return"string"===typeof t.type&&"meshLineMaterial"===t.type}));else{const e=n;"string"===typeof e.type&&"meshLineMaterial"===e.type&&(i=e)}return"object"===typeof(null==(e=i)?void 0:e.props)&&t.setValues(i.props),t}),[r,d,p,n]);return i.useEffect((()=>{w.uniforms.resolution.value.set(p.width,p.height)}),[p]),(0,a.F)((()=>{x.current&&E.setPoints(x.current,A)})),i.createElement("group",null,(0,a.h)(i.createElement("mesh",{ref:t,geometry:E,material:w}),f),i.createElement("group",{ref:g},n))})),Tc=new s.Triangle,Qc=new s.Vector3;class Pc{constructor(e){let t=e.geometry;t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){const e=this.positionAttribute,t=this.weightAttribute,n=new Float32Array(e.count/3);for(let i=0;i<e.count;i+=3){let r=1;t&&(r=t.getX(i)+t.getX(i+1)+t.getX(i+2)),Tc.a.fromBufferAttribute(e,i),Tc.b.fromBufferAttribute(e,i+1),Tc.c.fromBufferAttribute(e,i+2),r*=Tc.getArea(),n[i/3]=r}this.distribution=new Float32Array(e.count/3);let r=0;for(let i=0;i<n.length;i++)r+=n[i],this.distribution[i]=r;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,n){const r=this.sampleFaceIndex();return this.sampleFace(r,e,t,n)}sampleFaceIndex(){const e=this.distribution[this.distribution.length-1];return this.binarySearch(this.randomFunction()*e)}binarySearch(e){const t=this.distribution;let n=0,r=t.length-1,i=-1;for(;n<=r;){const o=Math.ceil((n+r)/2);if(0===o||t[o-1]<=e&&t[o]>e){i=o;break}e<t[o]?r=o-1:n=o+1}return i}sampleFace(e,t,n,r){let i=this.randomFunction(),o=this.randomFunction();return i+o>1&&(i=1-i,o=1-o),Tc.a.fromBufferAttribute(this.positionAttribute,3*e),Tc.b.fromBufferAttribute(this.positionAttribute,3*e+1),Tc.c.fromBufferAttribute(this.positionAttribute,3*e+2),t.set(0,0,0).addScaledVector(Tc.a,i).addScaledVector(Tc.b,o).addScaledVector(Tc.c,1-(i+o)),void 0!==n&&Tc.getNormal(n),void 0!==r&&void 0!==this.colorAttribute&&(Tc.a.fromBufferAttribute(this.colorAttribute,3*e),Tc.b.fromBufferAttribute(this.colorAttribute,3*e+1),Tc.c.fromBufferAttribute(this.colorAttribute,3*e+2),Qc.set(0,0,0).addScaledVector(Tc.a,i).addScaledVector(Tc.b,o).addScaledVector(Tc.c,1-(i+o)),r.r=Qc.x,r.g=Qc.y,r.b=Qc.z),this}}function zc(e,t=16,n,r,o){const[a,c]=i.useState((()=>{const e=Array.from({length:t},(()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])).flat();return new s.InstancedBufferAttribute(Float32Array.from(e),16)}));return i.useLayoutEffect((()=>{if("undefined"===typeof e.current)return;const i=new Pc(e.current);r&&i.setWeightAttribute(r),i.build();const l=new s.Vector3,u=new s.Vector3,h=new s.Color,d=new s.Object3D;e.current.updateMatrixWorld(!0);for(let r=0;r<t;r++)i.sample(l,u,h),"function"===typeof n?n({dummy:d,sampledMesh:e.current,position:l,normal:u,color:h},r):d.position.copy(l),d.updateMatrix(),null!=o&&o.current&&o.current.setMatrixAt(r,d.matrix),d.matrix.toArray(a.array,16*r);null!=o&&o.current&&(o.current.instanceMatrix.needsUpdate=!0),a.needsUpdate=!0,c(new s.InstancedBufferAttribute(a.array,a.itemSize).copy(a))}),[e,o,r,t,n]),a}function Rc({children:e,weight:t,transform:n,instances:o,mesh:s,count:a=16,...c}){const l=i.useRef(null),u=i.useRef(null),h=i.useRef(null);return i.useLayoutEffect((()=>{var e,t;u.current=null!==(e=null==o?void 0:o.current)&&void 0!==e?e:l.current.children.find((e=>e.hasOwnProperty("instanceMatrix"))),h.current=null!==(t=null==s?void 0:s.current)&&void 0!==t?t:l.current.children.find((e=>"Mesh"===e.type))}),[e,null==s?void 0:s.current,null==o?void 0:o.current]),zc(h,a,n,t,u),i.createElement("group",(0,r.Z)({ref:l},c),e)}const Fc=({compute:e,name:t,...n})=>{const[o]=i.useState((()=>new s.BufferAttribute(new Float32Array(0),1))),a=i.useRef(null);return i.useLayoutEffect((()=>{if(a.current){var t;const n=null!==(t=a.current.parent)&&void 0!==t?t:a.current.__r3f.parent,r=e(n);a.current.copy(r)}}),[e]),i.createElement("primitive",(0,r.Z)({ref:a,object:o,attach:`attributes-${t}`},n))};var kc=n(38550);class Lc extends s.Mesh{constructor(e,t,n=!1,r=!1,i=1e4){const o=new s.BufferGeometry;super(o,t),this.isMarchingCubes=!0;const a=this,c=new Float32Array(36),l=new Float32Array(36),u=new Float32Array(36);function h(e,t,n){return e+(t-e)*n}function d(e,t,n,r,i,o,s,d,A,m){const p=(n-s)/(d-s),f=a.normal_cache;c[t+0]=r+p*a.delta,c[t+1]=i,c[t+2]=o,l[t+0]=h(f[e+0],f[e+3],p),l[t+1]=h(f[e+1],f[e+4],p),l[t+2]=h(f[e+2],f[e+5],p),u[t+0]=h(a.palette[3*A+0],a.palette[3*m+0],p),u[t+1]=h(a.palette[3*A+1],a.palette[3*m+1],p),u[t+2]=h(a.palette[3*A+2],a.palette[3*m+2],p)}function A(e,t,n,r,i,o,s,d,A,m){const p=(n-s)/(d-s),f=a.normal_cache;c[t+0]=r,c[t+1]=i+p*a.delta,c[t+2]=o;const g=e+3*a.yd;l[t+0]=h(f[e+0],f[g+0],p),l[t+1]=h(f[e+1],f[g+1],p),l[t+2]=h(f[e+2],f[g+2],p),u[t+0]=h(a.palette[3*A+0],a.palette[3*m+0],p),u[t+1]=h(a.palette[3*A+1],a.palette[3*m+1],p),u[t+2]=h(a.palette[3*A+2],a.palette[3*m+2],p)}function m(e,t,n,r,i,o,s,d,A,m){const p=(n-s)/(d-s),f=a.normal_cache;c[t+0]=r,c[t+1]=i,c[t+2]=o+p*a.delta;const g=e+3*a.zd;l[t+0]=h(f[e+0],f[g+0],p),l[t+1]=h(f[e+1],f[g+1],p),l[t+2]=h(f[e+2],f[g+2],p),u[t+0]=h(a.palette[3*A+0],a.palette[3*m+0],p),u[t+1]=h(a.palette[3*A+1],a.palette[3*m+1],p),u[t+2]=h(a.palette[3*A+2],a.palette[3*m+2],p)}function p(e){const t=3*e;0===a.normal_cache[t]&&(a.normal_cache[t+0]=a.field[e-1]-a.field[e+1],a.normal_cache[t+1]=a.field[e-a.yd]-a.field[e+a.yd],a.normal_cache[t+2]=a.field[e-a.zd]-a.field[e+a.zd])}function f(e,t,n,r,i){const o=r+1,s=r+a.yd,h=r+a.zd,f=o+a.yd,y=o+a.zd,v=r+a.yd+a.zd,x=o+a.yd+a.zd;let E=0;const w=a.field[r],C=a.field[o],I=a.field[s],_=a.field[f],b=a.field[h],B=a.field[y],M=a.field[v],S=a.field[x];w<i&&(E|=1),C<i&&(E|=2),I<i&&(E|=8),_<i&&(E|=4),b<i&&(E|=16),B<i&&(E|=32),M<i&&(E|=128),S<i&&(E|=64);const D=Oc[E];if(0===D)return 0;const T=a.delta,Q=e+T,P=t+T,z=n+T;1&D&&(p(r),p(o),d(3*r,0,i,e,t,n,w,C,r,o)),2&D&&(p(o),p(f),A(3*o,3,i,Q,t,n,C,_,o,f)),4&D&&(p(s),p(f),d(3*s,6,i,e,P,n,I,_,s,f)),8&D&&(p(r),p(s),A(3*r,9,i,e,t,n,w,I,r,s)),16&D&&(p(h),p(y),d(3*h,12,i,e,t,z,b,B,h,y)),32&D&&(p(y),p(x),A(3*y,15,i,Q,t,z,B,S,y,x)),64&D&&(p(v),p(x),d(3*v,18,i,e,P,z,M,S,v,x)),128&D&&(p(h),p(v),A(3*h,21,i,e,t,z,b,M,h,v)),256&D&&(p(r),p(h),m(3*r,24,i,e,t,n,w,b,r,h)),512&D&&(p(o),p(y),m(3*o,27,i,Q,t,n,C,B,o,y)),1024&D&&(p(f),p(x),m(3*f,30,i,Q,P,n,_,S,f,x)),2048&D&&(p(s),p(v),m(3*s,33,i,e,P,n,I,M,s,v)),E<<=4;let R,F,k,L=0,O=0;for(;-1!=Uc[E+O];)R=E+O,F=R+1,k=R+2,g(c,l,u,3*Uc[R],3*Uc[F],3*Uc[k]),O+=3,L++;return L}function g(e,t,n,r,i,o){const s=3*a.count;if(a.positionArray[s+0]=e[r],a.positionArray[s+1]=e[r+1],a.positionArray[s+2]=e[r+2],a.positionArray[s+3]=e[i],a.positionArray[s+4]=e[i+1],a.positionArray[s+5]=e[i+2],a.positionArray[s+6]=e[o],a.positionArray[s+7]=e[o+1],a.positionArray[s+8]=e[o+2],!0===a.material.flatShading){const e=(t[r+0]+t[i+0]+t[o+0])/3,n=(t[r+1]+t[i+1]+t[o+1])/3,c=(t[r+2]+t[i+2]+t[o+2])/3;a.normalArray[s+0]=e,a.normalArray[s+1]=n,a.normalArray[s+2]=c,a.normalArray[s+3]=e,a.normalArray[s+4]=n,a.normalArray[s+5]=c,a.normalArray[s+6]=e,a.normalArray[s+7]=n,a.normalArray[s+8]=c}else a.normalArray[s+0]=t[r+0],a.normalArray[s+1]=t[r+1],a.normalArray[s+2]=t[r+2],a.normalArray[s+3]=t[i+0],a.normalArray[s+4]=t[i+1],a.normalArray[s+5]=t[i+2],a.normalArray[s+6]=t[o+0],a.normalArray[s+7]=t[o+1],a.normalArray[s+8]=t[o+2];if(a.enableUvs){const t=2*a.count;a.uvArray[t+0]=e[r+0],a.uvArray[t+1]=e[r+2],a.uvArray[t+2]=e[i+0],a.uvArray[t+3]=e[i+2],a.uvArray[t+4]=e[o+0],a.uvArray[t+5]=e[o+2]}a.enableColors&&(a.colorArray[s+0]=n[r+0],a.colorArray[s+1]=n[r+1],a.colorArray[s+2]=n[r+2],a.colorArray[s+3]=n[i+0],a.colorArray[s+4]=n[i+1],a.colorArray[s+5]=n[i+2],a.colorArray[s+6]=n[o+0],a.colorArray[s+7]=n[o+1],a.colorArray[s+8]=n[o+2]),a.count+=3}this.enableUvs=n,this.enableColors=r,this.init=function(e){this.resolution=e,this.isolation=80,this.size=e,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(3*this.size3),this.palette=new Float32Array(3*this.size3),this.count=0;const t=3*i;this.positionArray=new Float32Array(3*t);const n=new s.BufferAttribute(this.positionArray,3);n.setUsage(s.DynamicDrawUsage),o.setAttribute("position",n),this.normalArray=new Float32Array(3*t);const r=new s.BufferAttribute(this.normalArray,3);if(r.setUsage(s.DynamicDrawUsage),o.setAttribute("normal",r),this.enableUvs){this.uvArray=new Float32Array(2*t);const e=new s.BufferAttribute(this.uvArray,2);e.setUsage(s.DynamicDrawUsage),o.setAttribute("uv",e)}if(this.enableColors){this.colorArray=new Float32Array(3*t);const e=new s.BufferAttribute(this.colorArray,3);e.setUsage(s.DynamicDrawUsage),o.setAttribute("color",e)}o.boundingSphere=new s.Sphere(new s.Vector3,1)},this.addBall=function(e,t,n,r,i,o){const a=Math.sign(r);r=Math.abs(r);const c=!(void 0===o||null===o);let l=new s.Color(e,t,n);if(c)try{l=o instanceof s.Color?o:Array.isArray(o)?new s.Color(Math.min(Math.abs(o[0]),1),Math.min(Math.abs(o[1]),1),Math.min(Math.abs(o[2]),1)):new s.Color(o)}catch(T){l=new s.Color(e,t,n)}const u=this.size*Math.sqrt(r/i),h=n*this.size,d=t*this.size,A=e*this.size;let m=Math.floor(h-u);m<1&&(m=1);let p=Math.floor(h+u);p>this.size-1&&(p=this.size-1);let f=Math.floor(d-u);f<1&&(f=1);let g=Math.floor(d+u);g>this.size-1&&(g=this.size-1);let y=Math.floor(A-u);y<1&&(y=1);let v,x,E,w,C,I,_,b,B,M,S,D=Math.floor(A+u);for(D>this.size-1&&(D=this.size-1),E=m;E<p;E++)for(C=this.size2*E,b=E/this.size-n,B=b*b,x=f;x<g;x++)for(w=C+this.size*x,_=x/this.size-t,M=_*_,v=y;v<D;v++)if(I=v/this.size-e,S=r/(1e-6+I*I+M+B)-i,S>0){this.field[w+v]+=S*a;const e=Math.sqrt((v-A)*(v-A)+(x-d)*(x-d)+(E-h)*(E-h))/u,t=1-e*e*e*(e*(6*e-15)+10);this.palette[3*(w+v)+0]+=l.r*t,this.palette[3*(w+v)+1]+=l.g*t,this.palette[3*(w+v)+2]+=l.b*t}},this.addPlaneX=function(e,t){const n=this.size,r=this.yd,i=this.zd,o=this.field;let s,a,c,l,u,h,d,A=n*Math.sqrt(e/t);for(A>n&&(A=n),s=0;s<A;s++)if(h=s/n,l=h*h,u=e/(1e-4+l)-t,u>0)for(a=0;a<n;a++)for(d=s+a*r,c=0;c<n;c++)o[i*c+d]+=u},this.addPlaneY=function(e,t){const n=this.size,r=this.yd,i=this.zd,o=this.field;let s,a,c,l,u,h,d,A,m=n*Math.sqrt(e/t);for(m>n&&(m=n),a=0;a<m;a++)if(h=a/n,l=h*h,u=e/(1e-4+l)-t,u>0)for(d=a*r,s=0;s<n;s++)for(A=d+s,c=0;c<n;c++)o[i*c+A]+=u},this.addPlaneZ=function(e,t){const n=this.size,r=this.yd,i=this.zd,o=this.field;let s,a,c,l,u,h,d,A,m=n*Math.sqrt(e/t);for(m>n&&(m=n),c=0;c<m;c++)if(h=c/n,l=h*h,u=e/(1e-4+l)-t,u>0)for(d=i*c,a=0;a<n;a++)for(A=d+a*r,s=0;s<n;s++)o[A+s]+=u},this.setCell=function(e,t,n,r){const i=this.size2*n+this.size*t+e;this.field[i]=r},this.getCell=function(e,t,n){const r=this.size2*n+this.size*t+e;return this.field[r]},this.blur=function(e=1){const t=this.field,n=t.slice(),r=this.size,i=this.size2;for(let o=0;o<r;o++)for(let s=0;s<r;s++)for(let a=0;a<r;a++){const c=i*a+r*s+o;let l=n[c],u=1;for(let t=-1;t<=1;t+=2){const c=t+o;if(!(c<0||c>=r))for(let t=-1;t<=1;t+=2){const o=t+s;if(!(o<0||o>=r))for(let t=-1;t<=1;t+=2){const s=t+a;if(s<0||s>=r)continue;u++,l+=e*(n[i*s+r*o+c]-l)/u}}}t[c]=l}},this.reset=function(){for(let e=0;e<this.size3;e++)this.normal_cache[3*e]=0,this.field[e]=0,this.palette[3*e]=this.palette[3*e+1]=this.palette[3*e+2]=0},this.update=function(){this.count=0;const e=this.size-2;for(let t=1;t<e;t++){const n=this.size2*t,r=(t-this.halfsize)/this.halfsize;for(let t=1;t<e;t++){const i=n+this.size*t,o=(t-this.halfsize)/this.halfsize;for(let t=1;t<e;t++){f((t-this.halfsize)/this.halfsize,o,r,i+t,this.isolation)}}}this.geometry.setDrawRange(0,this.count),o.getAttribute("position").needsUpdate=!0,o.getAttribute("normal").needsUpdate=!0,this.enableUvs&&(o.getAttribute("uv").needsUpdate=!0),this.enableColors&&(o.getAttribute("color").needsUpdate=!0),this.count/3>i&&console.warn("THREE.MarchingCubes: Geometry buffers too small for rendering. Please create an instance with a higher poly count.")},this.init(e)}}const Oc=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),Uc=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),Nc=i.createContext(null),Vc=i.forwardRef((({resolution:e=28,maxPolyCount:t=1e4,enableUvs:n=!1,enableColors:o=!1,children:s,...c},l)=>{const u=i.useRef(null);i.useImperativeHandle(l,(()=>u.current),[]);const h=i.useMemo((()=>new Lc(e,null,n,o,t)),[e,t,n,o]),d=i.useMemo((()=>({getParent:()=>u})),[]);return(0,a.F)((()=>{h.update(),h.reset()}),-1),i.createElement(i.Fragment,null,i.createElement("primitive",(0,r.Z)({object:h,ref:u},c),i.createElement(Nc.Provider,{value:d},s)))})),Gc=i.forwardRef((({strength:e=.5,subtract:t=12,color:n,...o},c)=>{const{getParent:l}=i.useContext(Nc),u=i.useMemo((()=>l()),[l]),h=i.useRef(null);i.useImperativeHandle(c,(()=>h.current),[]);const d=new s.Vector3;return(0,a.F)((r=>{u.current&&h.current&&(h.current.getWorldPosition(d),u.current.addBall(.5+.5*d.x,.5+.5*d.y,.5+.5*d.z,e,t,n))})),i.createElement("group",(0,r.Z)({ref:h},o))})),jc=i.forwardRef((({planeType:e="x",strength:t=.5,subtract:n=12,...o},s)=>{const{getParent:c}=i.useContext(Nc),l=i.useMemo((()=>c()),[c]),u=i.useRef(null);i.useImperativeHandle(s,(()=>u.current),[]);const h=i.useMemo((()=>"x"===e?"addPlaneX":"y"===e?"addPlaneY":"addPlaneZ"),[e]);return(0,a.F)((()=>{l.current&&u.current&&l.current[h](t,n)})),i.createElement("group",(0,r.Z)({ref:u},o))}));class Hc extends s.BufferGeometry{constructor(e,t,n,r){super();const i=[],o=[],a=[],c=new s.Vector3,l=new s.Matrix4;l.makeRotationFromEuler(n),l.setPosition(t);const u=new s.Matrix4;function h(t,n,r){n.applyMatrix4(e.matrixWorld),n.applyMatrix4(u),r.transformDirection(e.matrixWorld),t.push(new qc(n.clone(),r.clone()))}function d(e,t){const n=[],i=.5*Math.abs(r.dot(t));for(let r=0;r<e.length;r+=3){let o,s,a,c,l,u,h,d=0;switch(o=e[r+0].position.dot(t)-i>0,s=e[r+1].position.dot(t)-i>0,a=e[r+2].position.dot(t)-i>0,d=(o?1:0)+(s?1:0)+(a?1:0),d){case 0:n.push(e[r]),n.push(e[r+1]),n.push(e[r+2]);break;case 1:if(o&&(c=e[r+1],l=e[r+2],u=A(e[r],c,t,i),h=A(e[r],l,t,i)),s){c=e[r],l=e[r+2],u=A(e[r+1],c,t,i),h=A(e[r+1],l,t,i),n.push(u),n.push(l.clone()),n.push(c.clone()),n.push(l.clone()),n.push(u.clone()),n.push(h);break}a&&(c=e[r],l=e[r+1],u=A(e[r+2],c,t,i),h=A(e[r+2],l,t,i)),n.push(c.clone()),n.push(l.clone()),n.push(u),n.push(h),n.push(u.clone()),n.push(l.clone());break;case 2:o||(c=e[r].clone(),l=A(c,e[r+1],t,i),u=A(c,e[r+2],t,i),n.push(c),n.push(l),n.push(u)),s||(c=e[r+1].clone(),l=A(c,e[r+2],t,i),u=A(c,e[r],t,i),n.push(c),n.push(l),n.push(u)),a||(c=e[r+2].clone(),l=A(c,e[r],t,i),u=A(c,e[r+1],t,i),n.push(c),n.push(l),n.push(u))}}return n}function A(e,t,n,r){const i=e.position.dot(n)-r,o=i/(i-(t.position.dot(n)-r));return new qc(new s.Vector3(e.position.x+o*(t.position.x-e.position.x),e.position.y+o*(t.position.y-e.position.y),e.position.z+o*(t.position.z-e.position.z)),new s.Vector3(e.normal.x+o*(t.normal.x-e.normal.x),e.normal.y+o*(t.normal.y-e.normal.y),e.normal.z+o*(t.normal.z-e.normal.z)))}u.copy(l).invert(),function(){let t,n=[];const u=new s.Vector3,A=new s.Vector3;if(!0===e.geometry.isGeometry)return void console.error("THREE.DecalGeometry no longer supports THREE.Geometry. Use BufferGeometry instead.");const m=e.geometry,p=m.attributes.position,f=m.attributes.normal;if(null!==m.index){const e=m.index;for(t=0;t<e.count;t++)u.fromBufferAttribute(p,e.getX(t)),A.fromBufferAttribute(f,e.getX(t)),h(n,u,A)}else for(t=0;t<p.count;t++)u.fromBufferAttribute(p,t),A.fromBufferAttribute(f,t),h(n,u,A);for(n=d(n,c.set(1,0,0)),n=d(n,c.set(-1,0,0)),n=d(n,c.set(0,1,0)),n=d(n,c.set(0,-1,0)),n=d(n,c.set(0,0,1)),n=d(n,c.set(0,0,-1)),t=0;t<n.length;t++){const e=n[t];a.push(.5+e.position.x/r.x,.5+e.position.y/r.y),e.position.applyMatrix4(l),i.push(e.position.x,e.position.y,e.position.z),o.push(e.normal.x,e.normal.y,e.normal.z)}}(),this.setAttribute("position",new s.Float32BufferAttribute(i,3)),this.setAttribute("normal",new s.Float32BufferAttribute(o,3)),this.setAttribute("uv",new s.Float32BufferAttribute(a,2))}}class qc{constructor(e,t){this.position=e,this.normal=t}clone(){return new this.constructor(this.position.clone(),this.normal.clone())}}function Wc(e=[0,0,0]){return function(e){return Array.isArray(e)}(e)?e:e instanceof s.Vector3||e instanceof s.Euler?[e.x,e.y,e.z]:[e,e,e]}const Yc=i.forwardRef((function({debug:e,depthTest:t=!1,polygonOffsetFactor:n=-10,map:o,mesh:c,children:l,position:u,rotation:h,scale:d,...A},m){const p=i.useRef(null);i.useImperativeHandle(m,(()=>p.current));const f=i.useRef(null);return i.useLayoutEffect((()=>{const e=(null==c?void 0:c.current)||p.current.parent,t=p.current;if(!(e instanceof s.Mesh))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const n={position:new s.Vector3,rotation:new s.Euler,scale:new s.Vector3(1,1,1)};if(e){(0,a.k)(n,{position:u,scale:d});const r=e.matrixWorld.clone();if(e.matrixWorld.identity(),h&&"number"!==typeof h)(0,a.k)(n,{rotation:h});else{const t=new s.Object3D;t.position.copy(n.position),t.lookAt(e.position),"number"===typeof h&&t.rotateZ(h),(0,a.k)(n,{rotation:t.rotation})}return t.geometry=new Hc(e,n.position,n.rotation,n.scale),f.current&&((0,a.k)(f.current,n),f.current.traverse((e=>e.raycast=()=>null))),e.matrixWorld=r,()=>{t.geometry.dispose()}}}),[c,...Wc(u),...Wc(d),...Wc(h)]),i.createElement("mesh",(0,r.Z)({ref:p,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":n,"material-depthTest":t,"material-map":o},A),l,e&&i.createElement("mesh",{ref:f},i.createElement("boxGeometry",null),i.createElement("meshNormalMaterial",{wireframe:!0}),i.createElement("axesHelper",null)))}));var Xc=n(7124);const Zc=(0,i.forwardRef)((function({src:e,skipFill:t,skipStrokes:n,fillMaterial:o,strokeMaterial:c,fillMeshProps:l,strokeMeshProps:u,...h},d){const A=(0,a.H)(Xc.u,e.startsWith("<svg")?`data:image/svg+xml;utf8,${e}`:e),m=(0,i.useMemo)((()=>n?[]:A.paths.map((e=>{var t;return void 0===(null==(t=e.userData)?void 0:t.style.stroke)||"none"===e.userData.style.stroke?null:e.subPaths.map((t=>Xc.u.pointsToStroke(t.getPoints(),e.userData.style)))}))),[A,n]);(0,i.useEffect)((()=>()=>m.forEach((e=>e&&e.map((e=>e.dispose()))))),[m]);let p=0;return i.createElement("object3D",(0,r.Z)({ref:d},h),i.createElement("object3D",{scale:[1,-1,1]},A.paths.map(((e,a)=>{var h,d;return i.createElement(i.Fragment,{key:a},!t&&void 0!==(null==(h=e.userData)?void 0:h.style.fill)&&"none"!==e.userData.style.fill&&Xc.u.createShapes(e).map(((t,n)=>i.createElement("mesh",(0,r.Z)({key:n},l,{renderOrder:p++}),i.createElement("shapeGeometry",{args:[t]}),i.createElement("meshBasicMaterial",(0,r.Z)({color:e.userData.style.fill,opacity:e.userData.style.fillOpacity,transparent:!0,side:s.DoubleSide,depthWrite:!1},o))))),!n&&void 0!==(null==(d=e.userData)?void 0:d.style.stroke)&&"none"!==e.userData.style.stroke&&e.subPaths.map(((t,n)=>i.createElement("mesh",(0,r.Z)({key:n,geometry:m[a][n]},u,{renderOrder:p++}),i.createElement("meshBasicMaterial",(0,r.Z)({color:e.userData.style.stroke,opacity:e.userData.style.strokeOpacity,transparent:!0,side:s.DoubleSide,depthWrite:!1},c))))))}))))}));var Kc=n(93579);class Jc{constructor(e,t=" .:-=+*#%@",n={}){const r=n.resolution||.15,i=n.scale||1,o=n.color||!1,s=n.alpha||!1,a=n.block||!1,c=n.invert||!1,l=n.strResolution||"low";let u,h;const d=document.createElement("div");d.style.cursor="default";const A=document.createElement("table");let m,p,f;d.appendChild(A),this.setSize=function(t,n){u=t,h=n,e.setSize(t,n),function(){m=Math.floor(u*r),p=Math.floor(h*r),E.width=m,E.height=p,f=e.domElement,f.style.backgroundColor&&(A.rows[0].cells[0].style.backgroundColor=f.style.backgroundColor,A.rows[0].cells[0].style.color=f.style.color);A.cellSpacing=0,A.cellPadding=0;const t=A.style;t.whiteSpace="pre",t.margin="0px",t.padding="0px",t.letterSpacing=b+"px",t.fontFamily=v,t.fontSize=I+"px",t.lineHeight=_+"px",t.textAlign="left",t.textDecoration="none"}()},this.render=function(t,n){e.render(t,n),function(e){w.clearRect(0,0,m,p),w.drawImage(x,0,0,m,p);const t=w.getImageData(0,0,m,p).data;let n="";for(let r=0;r<p;r+=2){for(let e=0;e<m;e++){const i=4*(r*m+e),l=t[i],u=t[i+1],h=t[i+2],d=t[i+3];let A,p;p=(.3*l+.59*u+.11*h)/255,0==d&&(p=1),A=Math.floor((1-p)*(C.length-1)),c&&(A=C.length-A-1);let f=C[A];void 0!==f&&" "!=f||(f="&nbsp;"),n+=o?"<span style='color:rgb("+l+","+u+","+h+");"+(a?"background-color:rgb("+l+","+u+","+h+");":"")+(s?"opacity:"+d/255+";":"")+"'>"+f+"</span>":f}n+="<br/>"}e.innerHTML=`<tr><td style="display:block;width:${u}px;height:${h}px;overflow:hidden">${n}</td></tr>`}(A)},this.domElement=d;const g=" .,:;i1tfLCG08@".split(""),y=" CGO08@".split(""),v="courier new, monospace",x=e.domElement,E=document.createElement("canvas");if(!E.getContext)return;const w=E.getContext("2d");if(!w.getImageData)return;let C=o?y:g;t&&(C=t);const I=2/r*i,_=2/r*i;let b=0;if("low"==l)switch(i){case 1:b=-1;break;case 2:case 3:b=-2.1;break;case 4:b=-3.1;break;case 5:b=-4.15}if("medium"==l)switch(i){case 1:b=0;break;case 2:b=-1;break;case 3:b=-1.04;break;case 4:case 5:b=-2.1}if("high"==l)switch(i){case 1:case 2:b=0;break;case 3:case 4:case 5:b=-1}}}function $c({renderIndex:e=1,bgColor:t="black",fgColor:n="white",characters:r=" .:-+*=%@#",invert:o=!0,color:s=!1,resolution:c=.15}){const{size:l,gl:u,scene:h,camera:d}=(0,a.D)(),A=i.useMemo((()=>{const e=new Jc(u,r,{invert:o,color:s,resolution:c});return e.domElement.style.position="absolute",e.domElement.style.top="0px",e.domElement.style.left="0px",e.domElement.style.pointerEvents="none",e}),[r,o,s,c]);return i.useLayoutEffect((()=>{A.domElement.style.color=n,A.domElement.style.backgroundColor=t}),[n,t]),i.useEffect((()=>(u.domElement.style.opacity="0",u.domElement.parentNode.appendChild(A.domElement),()=>{u.domElement.style.opacity="1",u.domElement.parentNode.removeChild(A.domElement)})),[A]),i.useEffect((()=>{A.setSize(l.width,l.height)}),[A,l]),(0,a.F)((e=>{A.render(h,d)}),e),i.createElement(i.Fragment,null)}const el=cc({alphaTest:0,viewport:new s.Vector2(1980,1080),focal:1e3,centerAndScaleTexture:null,covAndColorTexture:null},"\n    precision highp sampler2D;\n    precision highp usampler2D;\n    out vec4 vColor;\n    out vec3 vPosition;\n    uniform vec2 resolution;\n    uniform vec2 viewport;\n    uniform float focal;\n    attribute uint splatIndex;\n    uniform sampler2D centerAndScaleTexture;\n    uniform usampler2D covAndColorTexture;    \n\n    vec2 unpackInt16(in uint value) {\n      int v = int(value);\n      int v0 = v >> 16;\n      int v1 = (v & 0xFFFF);\n      if((v & 0x8000) != 0)\n        v1 |= 0xFFFF0000;\n      return vec2(float(v1), float(v0));\n    }\n\n    void main () {\n      ivec2 texSize = textureSize(centerAndScaleTexture, 0);\n      ivec2 texPos = ivec2(splatIndex%uint(texSize.x), splatIndex/uint(texSize.x));\n      vec4 centerAndScaleData = texelFetch(centerAndScaleTexture, texPos, 0);\n      vec4 center = vec4(centerAndScaleData.xyz, 1);\n      vec4 camspace = modelViewMatrix * center;\n      vec4 pos2d = projectionMatrix * camspace;\n\n      float bounds = 1.2 * pos2d.w;\n      if (pos2d.z < -pos2d.w || pos2d.x < -bounds || pos2d.x > bounds\n        || pos2d.y < -bounds || pos2d.y > bounds) {\n        gl_Position = vec4(0.0, 0.0, 2.0, 1.0);\n        return;\n      }\n\n      uvec4 covAndColorData = texelFetch(covAndColorTexture, texPos, 0);\n      vec2 cov3D_M11_M12 = unpackInt16(covAndColorData.x) * centerAndScaleData.w;\n      vec2 cov3D_M13_M22 = unpackInt16(covAndColorData.y) * centerAndScaleData.w;\n      vec2 cov3D_M23_M33 = unpackInt16(covAndColorData.z) * centerAndScaleData.w;\n      mat3 Vrk = mat3(\n        cov3D_M11_M12.x, cov3D_M11_M12.y, cov3D_M13_M22.x,\n        cov3D_M11_M12.y, cov3D_M13_M22.y, cov3D_M23_M33.x,\n        cov3D_M13_M22.x, cov3D_M23_M33.x, cov3D_M23_M33.y\n      );\n\n      mat3 J = mat3(\n        focal / camspace.z, 0., -(focal * camspace.x) / (camspace.z * camspace.z),\n        0., focal / camspace.z, -(focal * camspace.y) / (camspace.z * camspace.z),\n        0., 0., 0.\n      );\n\n      mat3 W = transpose(mat3(modelViewMatrix));\n      mat3 T = W * J;\n      mat3 cov = transpose(T) * Vrk * T;\n      vec2 vCenter = vec2(pos2d) / pos2d.w;\n      float diagonal1 = cov[0][0] + 0.3;\n      float offDiagonal = cov[0][1];\n      float diagonal2 = cov[1][1] + 0.3;\n      float mid = 0.5 * (diagonal1 + diagonal2);\n      float radius = length(vec2((diagonal1 - diagonal2) / 2.0, offDiagonal));\n      float lambda1 = mid + radius;\n      float lambda2 = max(mid - radius, 0.1);\n      vec2 diagonalVector = normalize(vec2(offDiagonal, lambda1 - diagonal1));\n      vec2 v1 = min(sqrt(2.0 * lambda1), 1024.0) * diagonalVector;\n      vec2 v2 = min(sqrt(2.0 * lambda2), 1024.0) * vec2(diagonalVector.y, -diagonalVector.x);\n      uint colorUint = covAndColorData.w;\n      vColor = vec4(\n        float(colorUint & uint(0xFF)) / 255.0,\n        float((colorUint >> uint(8)) & uint(0xFF)) / 255.0,\n        float((colorUint >> uint(16)) & uint(0xFF)) / 255.0,\n        float(colorUint >> uint(24)) / 255.0\n      );\n      vPosition = position;\n\n      gl_Position = vec4(\n        vCenter \n          + position.x * v2 / viewport * 2.0 \n          + position.y * v1 / viewport * 2.0, pos2d.z / pos2d.w, 1.0);\n    }\n    ",`\n    #include <alphatest_pars_fragment>\n    #include <alphahash_pars_fragment>\n    in vec4 vColor;\n    in vec3 vPosition;\n    void main () {\n      float A = -dot(vPosition.xy, vPosition.xy);\n      if (A < -4.0) discard;\n      float B = exp(A) * vColor.a;\n      vec4 diffuseColor = vec4(vColor.rgb, B);\n      #include <alphatest_fragment>\n      #include <alphahash_fragment>\n      gl_FragColor = diffuseColor;\n      #include <tonemapping_fragment>\n      #include <${parseInt(s.REVISION.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>\n    }\n  `);function tl(e){let t=null,n=0;e.onmessage=r=>{if("push"==r.data.method){0===n&&(t=new Float32Array(r.data.length));const e=new Float32Array(r.data.matrices);t.set(e,n),n+=e.length}else if("sort"==r.data.method&&null!==t){const n=function(e,n=!1){const r=t.length/16;let i=-1/0,o=1/0;const s=new Float32Array(r),a=new Int32Array(s.buffer),c=new Int32Array(r);let l=0;for(let m=0;m<r;m++){const r=e[0]*t[16*m+12]+e[1]*t[16*m+13]+e[2]*t[16*m+14]+e[3];(n||r<0&&t[16*m+15]>-1e-4*r)&&(s[l]=r,c[l]=m,l++,r>i&&(i=r),r<o&&(o=r))}const u=65535/(i-o),h=new Uint32Array(65536);for(let t=0;t<l;t++)a[t]=(s[t]-o)*u|0,h[a[t]]++;const d=new Uint32Array(65536);for(let t=1;t<65536;t++)d[t]=d[t-1]+h[t-1];const A=new Uint32Array(l);for(let t=0;t<l;t++)A[d[a[t]]++]=c[t];return A}(new Float32Array(r.data.view),r.data.hashed);e.postMessage({indices:n,key:r.data.key},[n.buffer])}}}class nl extends s.Loader{constructor(...e){super(...e),this.gl=null,this.chunkSize=25e3}load(e,t,n,r){const i={gl:this.gl,url:this.manager.resolveURL(e),worker:new Worker(URL.createObjectURL(new Blob(["(",tl.toString(),")(self)"],{type:"application/javascript"}))),manager:this.manager,update:(e,t,n)=>function(e,t,n,r){if(e.updateMatrixWorld(),t.gl.getCurrentViewport(n.viewport),n.material.viewport.x=n.viewport.z,n.material.viewport.y=n.viewport.w,n.material.focal=n.viewport.w/2*Math.abs(e.projectionMatrix.elements[5]),n.ready){if(r&&n.sorted)return;n.ready=!1;const e=new Float32Array([n.modelViewMatrix.elements[2],-n.modelViewMatrix.elements[6],n.modelViewMatrix.elements[10],n.modelViewMatrix.elements[14]]);t.worker.postMessage({method:"sort",src:t.url,key:n.uuid,view:e.buffer,hashed:r},[e.buffer]),r&&t.loaded&&(n.sorted=!0)}}(t,i,e,n),connect:e=>function(e,t){e.loading||async function(e){e.loading=!0;let t=0,n=0;const r=[];let i=0;const o=0!==e.totalDownloadBytes;for(;;)try{const{value:s,done:a}=await e.stream.read();if(a)break;if(t+=s.length,void 0!=e.totalDownloadBytes){const n=t/e.totalDownloadBytes*100;if(e.onProgress&&n-i>1){const r=new ProgressEvent("progress",{lengthComputable:o,loaded:t,total:e.totalDownloadBytes});e.onProgress(r),i=n}}r.push(s);const c=t-n;if(void 0!=e.totalDownloadBytes&&c>e.rowLength*e.chunkSize){let t=Math.floor(c/e.rowLength);const i=new Uint8Array(c);let s=0;for(const e of r)i.set(e,s),s+=e.length;if(r.length=0,c>t*e.rowLength){const n=new Uint8Array(c-t*e.rowLength);n.set(i.subarray(c-n.length,c),0),r.push(n)}const a=new Uint8Array(t*e.rowLength);a.set(i.subarray(0,a.byteLength),0);const l=rl(e,a.buffer,t);if(e.worker.postMessage({method:"push",src:e.url,length:16*e.numVertices,matrices:l.buffer},[l.buffer]),n+=t*e.rowLength,e.onProgress){const t=new ProgressEvent("progress",{lengthComputable:o,loaded:e.totalDownloadBytes,total:e.totalDownloadBytes});e.onProgress(t)}}}catch(s){console.error(s);break}if(t-n>0){let t=new Uint8Array(r.reduce(((e,t)=>e+t.length),0)),n=0;for(const e of r)t.set(e,n),n+=e.length;let i=Math.floor(t.byteLength/e.rowLength);const o=rl(e,t.buffer,i);e.worker.postMessage({method:"push",src:e.url,length:16*i,matrices:o.buffer},[o.buffer])}e.loaded=!0,e.manager.itemEnd(e.url)}(e);t.ready=!1,t.pm=new s.Matrix4,t.vm1=new s.Matrix4,t.vm2=new s.Matrix4,t.viewport=new s.Vector4;let n=new Uint32Array(e.bufferTextureWidth*e.bufferTextureHeight);const r=new s.InstancedBufferAttribute(n,1,!1);r.setUsage(s.DynamicDrawUsage);const i=t.geometry=new s.InstancedBufferGeometry,o=new Float32Array(18),a=new s.BufferAttribute(o,3);function c(e){if(t&&e.data.key===t.uuid){let n=new Uint32Array(e.data.indices);i.attributes.splatIndex.set(n),i.attributes.splatIndex.needsUpdate=!0,i.instanceCount=n.length,t.ready=!0}}async function l(){for(;;){const t=e.gl.properties.get(e.centerAndScaleTexture),n=e.gl.properties.get(e.covAndColorTexture);if(null!=t&&t.__webglTexture&&null!=n&&n.__webglTexture&&e.loadedVertexCount>0)break;await new Promise((e=>setTimeout(e,10)))}t.ready=!0}return i.setAttribute("position",a),a.setXYZ(2,-2,2,0),a.setXYZ(1,2,2,0),a.setXYZ(0,-2,-2,0),a.setXYZ(5,-2,-2,0),a.setXYZ(4,2,2,0),a.setXYZ(3,2,-2,0),a.needsUpdate=!0,i.setAttribute("splatIndex",r),i.instanceCount=1,e.worker.addEventListener("message",c),l(),()=>e.worker.removeEventListener("message",c)}(i,e),loading:!1,loaded:!1,loadedVertexCount:0,chunkSize:this.chunkSize,totalDownloadBytes:0,numVertices:0,rowLength:32,maxVertexes:0,bufferTextureWidth:0,bufferTextureHeight:0,stream:null,centerAndScaleData:null,covAndColorData:null,covAndColorTexture:null,centerAndScaleTexture:null,onProgress:n};(async function(e){e.manager.itemStart(e.url);const t=await fetch(e.url);if(null===t.body)throw"Failed to fetch file";let n=t.headers.get("Content-Length");const r=n?parseInt(n):void 0;if(void 0==r)throw"Failed to get content length";e.stream=t.body.getReader(),e.totalDownloadBytes=r,e.numVertices=Math.floor(e.totalDownloadBytes/e.rowLength);const i=e.gl.getContext();let o=i.getParameter(i.MAX_TEXTURE_SIZE);e.maxVertexes=o*o,e.numVertices>e.maxVertexes&&(e.numVertices=e.maxVertexes);return e.bufferTextureWidth=o,e.bufferTextureHeight=Math.floor((e.numVertices-1)/o)+1,e.centerAndScaleData=new Float32Array(e.bufferTextureWidth*e.bufferTextureHeight*4),e.covAndColorData=new Uint32Array(e.bufferTextureWidth*e.bufferTextureHeight*4),e.centerAndScaleTexture=new s.DataTexture(e.centerAndScaleData,e.bufferTextureWidth,e.bufferTextureHeight,s.RGBAFormat,s.FloatType),e.centerAndScaleTexture.needsUpdate=!0,e.covAndColorTexture=new s.DataTexture(e.covAndColorData,e.bufferTextureWidth,e.bufferTextureHeight,s.RGBAIntegerFormat,s.UnsignedIntType),e.covAndColorTexture.internalFormat="RGBA32UI",e.covAndColorTexture.needsUpdate=!0,e})(i).then(t).catch((e=>{null==r||r(e),i.manager.itemError(i.url)}))}}function rl(e,t,n){const r=e.gl.getContext();if(e.loadedVertexCount+n>e.maxVertexes&&(n=e.maxVertexes-e.loadedVertexCount),n<=0)throw"Failed to parse file";const i=new Uint8Array(t),o=new Float32Array(t),a=new Float32Array(16*n),c=new Uint8Array(e.covAndColorData.buffer),l=new Int16Array(e.covAndColorData.buffer);for(let u=0;u<n;u++){const t=new s.Quaternion(-(i[32*u+28+1]-128)/128,(i[32*u+28+2]-128)/128,(i[32*u+28+3]-128)/128,-(i[32*u+28+0]-128)/128);t.invert();const n=new s.Vector3(o[8*u+0],o[8*u+1],-o[8*u+2]),r=new s.Vector3(o[8*u+3+0],o[8*u+3+1],o[8*u+3+2]),h=new s.Matrix4;h.makeRotationFromQuaternion(t),h.transpose(),h.scale(r);const d=h.clone();h.transpose(),h.premultiply(d),h.setPosition(n);const A=[0,1,2,5,6,10];let m=0;for(let e=0;e<A.length;e++)Math.abs(h.elements[A[e]])>m&&(m=Math.abs(h.elements[A[e]]));let p=4*e.loadedVertexCount+4*u;e.centerAndScaleData[p+0]=n.x,e.centerAndScaleData[p+1]=-n.y,e.centerAndScaleData[p+2]=n.z,e.centerAndScaleData[p+3]=m/32767,p=8*e.loadedVertexCount+4*u*2;for(let e=0;e<A.length;e++)l[p+e]=32767*h.elements[A[e]]/m;p=16*e.loadedVertexCount+4*(4*u+3);const f=new s.Color(i[32*u+24+0]/255,i[32*u+24+1]/255,i[32*u+24+2]/255);f.convertSRGBToLinear(),c[p+0]=255*f.r,c[p+1]=255*f.g,c[p+2]=255*f.b,c[p+3]=i[32*u+24+3],h.elements[15]=Math.max(r.x,r.y,r.z)*i[32*u+24+3]/255;for(let e=0;e<16;e++)a[16*u+e]=h.elements[e]}for(;n>0;){let t=0,i=0;const o=e.loadedVertexCount%e.bufferTextureWidth,s=Math.floor(e.loadedVertexCount/e.bufferTextureWidth);e.loadedVertexCount%e.bufferTextureWidth!=0?(t=Math.min(e.bufferTextureWidth,o+n)-o,i=1):Math.floor(n/e.bufferTextureWidth)>0?(t=e.bufferTextureWidth,i=Math.floor(n/e.bufferTextureWidth)):(t=n%e.bufferTextureWidth,i=1);const a=e.gl.properties.get(e.centerAndScaleTexture);r.bindTexture(r.TEXTURE_2D,a.__webglTexture),r.texSubImage2D(r.TEXTURE_2D,0,o,s,t,i,r.RGBA,r.FLOAT,e.centerAndScaleData,4*e.loadedVertexCount);const c=e.gl.properties.get(e.covAndColorTexture);r.bindTexture(r.TEXTURE_2D,c.__webglTexture),r.texSubImage2D(r.TEXTURE_2D,0,o,s,t,i,r.RGBA_INTEGER,r.UNSIGNED_INT,e.covAndColorData,4*e.loadedVertexCount),e.gl.resetState(),e.loadedVertexCount+=t*i,n-=t*i}return a}function il({src:e,toneMapped:t=!1,alphaTest:n=0,alphaHash:o=!1,chunkSize:c=25e3,...l}){(0,a.e)({SplatMaterial:el});const u=i.useRef(null),h=(0,a.D)((e=>e.gl)),d=(0,a.D)((e=>e.camera)),A=(0,a.H)(nl,e,(e=>{e.gl=h,e.chunkSize=c}));return i.useLayoutEffect((()=>A.connect(u.current)),[e]),(0,a.F)((()=>A.update(u.current,d,o))),i.createElement("mesh",(0,r.Z)({ref:u,frustumCulled:!1},l),i.createElement("splatMaterial",{key:`${e}/${n}/${o}${el.key}`,transparent:!o,depthTest:!0,alphaTest:o?0:n,centerAndScaleTexture:A.centerAndScaleTexture,covAndColorTexture:A.covAndColorTexture,depthWrite:!!o||n>0,blending:o?s.NormalBlending:s.CustomBlending,blendSrcAlpha:s.OneFactor,alphaHash:!!o,toneMapped:t}))}function ol(e,t,n){const r=(0,a.D)((e=>e.size)),o=(0,a.D)((e=>e.viewport)),c="number"===typeof e?e:r.width*o.dpr,l="number"===typeof t?t:r.height*o.dpr,u=("number"===typeof e?n:e)||{},{samples:h=0,depth:d,...A}=u,m=i.useMemo((()=>{const e=new s.WebGLRenderTarget(c,l,{minFilter:s.LinearFilter,magFilter:s.LinearFilter,type:s.HalfFloatType,...A});return d&&(e.depthTexture=new s.DepthTexture(c,l,s.FloatType)),e.samples=h,e}),[]);return i.useLayoutEffect((()=>{m.setSize(c,l),h&&(m.samples=h)}),[h,m,c,l]),i.useEffect((()=>()=>m.dispose()),[]),m}const sl=({children:e,width:t,height:n,...r})=>{const o=ol(t,n,r);return i.createElement(i.Fragment,null,null==e?void 0:e(o))},al=i.forwardRef((({envMap:e,resolution:t=256,frames:n=1/0,children:o,makeDefault:s,...c},l)=>{const u=(0,a.D)((({set:e})=>e)),h=(0,a.D)((({camera:e})=>e)),d=(0,a.D)((({size:e})=>e)),A=i.useRef(null);i.useImperativeHandle(l,(()=>A.current),[]);const m=i.useRef(null),p=ol(t);i.useLayoutEffect((()=>{c.manual||A.current.updateProjectionMatrix()}),[d,c]),i.useLayoutEffect((()=>{A.current.updateProjectionMatrix()})),i.useLayoutEffect((()=>{if(s){const e=h;return u((()=>({camera:A.current}))),()=>u((()=>({camera:e})))}}),[A,s,u]);let f=0,g=null;const y="function"===typeof o;return(0,a.F)((t=>{y&&(n===1/0||f<n)&&(m.current.visible=!1,t.gl.setRenderTarget(p),g=t.scene.background,e&&(t.scene.background=e),t.gl.render(t.scene,A.current),t.scene.background=g,t.gl.setRenderTarget(null),m.current.visible=!0,f++)})),i.createElement(i.Fragment,null,i.createElement("orthographicCamera",(0,r.Z)({left:d.width/-2,right:d.width/2,top:d.height/2,bottom:d.height/-2,ref:A},c),!y&&o),i.createElement("group",{ref:m},y&&o(p.texture)))})),cl=i.forwardRef((({envMap:e,resolution:t=256,frames:n=1/0,makeDefault:o,children:s,...c},l)=>{const u=(0,a.D)((({set:e})=>e)),h=(0,a.D)((({camera:e})=>e)),d=(0,a.D)((({size:e})=>e)),A=i.useRef(null);i.useImperativeHandle(l,(()=>A.current),[]);const m=i.useRef(null),p=ol(t);i.useLayoutEffect((()=>{c.manual||(A.current.aspect=d.width/d.height)}),[d,c]),i.useLayoutEffect((()=>{A.current.updateProjectionMatrix()}));let f=0,g=null;const y="function"===typeof s;return(0,a.F)((t=>{y&&(n===1/0||f<n)&&(m.current.visible=!1,t.gl.setRenderTarget(p),g=t.scene.background,e&&(t.scene.background=e),t.gl.render(t.scene,A.current),t.scene.background=g,t.gl.setRenderTarget(null),m.current.visible=!0,f++)})),i.useLayoutEffect((()=>{if(o){const e=h;return u((()=>({camera:A.current}))),()=>u((()=>({camera:e})))}}),[A,o,u]),i.createElement(i.Fragment,null,i.createElement("perspectiveCamera",(0,r.Z)({ref:A},c),!y&&s),i.createElement("group",{ref:m},y&&s(p.texture)))}));function ll({resolution:e=256,near:t=.1,far:n=1e3,envMap:r,fog:o}={}){const c=(0,a.D)((({gl:e})=>e)),l=(0,a.D)((({scene:e})=>e)),u=(0,i.useMemo)((()=>{const t=new s.WebGLCubeRenderTarget(e);return t.texture.type=s.HalfFloatType,t}),[e]);(0,i.useEffect)((()=>()=>{u.dispose()}),[u]);const h=(0,i.useMemo)((()=>new s.CubeCamera(t,n,u)),[t,n,u]);let d,A;const m=i.useCallback((()=>{d=l.fog,A=l.background,l.background=r||A,l.fog=o||d,h.update(c,l),l.fog=d,l.background=A}),[c,l,h]);return{fbo:u,camera:h,update:m}}function ul({children:e,frames:t=1/0,resolution:n,near:r,far:o,envMap:s,fog:c,...l}){const u=i.useRef(null),{fbo:h,camera:d,update:A}=ll({resolution:n,near:r,far:o,envMap:s,fog:c});let m=0;return(0,a.F)((()=>{u.current&&(t===1/0||m<t)&&(u.current.visible=!1,A(),u.current.visible=!0,m++)})),i.createElement("group",l,i.createElement("primitive",{object:d}),i.createElement("group",{ref:u},null==e?void 0:e(h.texture)))}var hl=Object.defineProperty,dl=(e,t,n)=>(((e,t,n)=>{t in e?hl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);class Al extends s.EventDispatcher{constructor(e){super(),dl(this,"object"),dl(this,"changeEvent",{type:"change"}),dl(this,"EPS",1e-6),dl(this,"enabled",!0),dl(this,"deviceOrientation",{alpha:0,beta:0,gamma:0}),dl(this,"screenOrientation",0),dl(this,"alphaOffset",0),dl(this,"onDeviceOrientationChangeEvent",(e=>{this.deviceOrientation=e})),dl(this,"onScreenOrientationChangeEvent",(()=>{this.screenOrientation=window.orientation||0})),dl(this,"zee",new s.Vector3(0,0,1)),dl(this,"euler",new s.Euler),dl(this,"q0",new s.Quaternion),dl(this,"q1",new s.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5))),dl(this,"setObjectQuaternion",((e,t,n,r,i)=>{this.euler.set(n,t,-r,"YXZ"),e.setFromEuler(this.euler),e.multiply(this.q1),e.multiply(this.q0.setFromAxisAngle(this.zee,-i))})),dl(this,"connect",(()=>{this.onScreenOrientationChangeEvent(),void 0!==window.DeviceOrientationEvent&&"function"===typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then((e=>{"granted"==e&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))})).catch((e=>{console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",e)})):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0})),dl(this,"disconnect",(()=>{window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.enabled=!1})),dl(this,"lastQuaternion",new s.Quaternion),dl(this,"update",(()=>{if(!1===this.enabled)return;const e=this.deviceOrientation;if(e){const t=e.alpha?s.MathUtils.degToRad(e.alpha)+this.alphaOffset:0,n=e.beta?s.MathUtils.degToRad(e.beta):0,r=e.gamma?s.MathUtils.degToRad(e.gamma):0,i=this.screenOrientation?s.MathUtils.degToRad(this.screenOrientation):0;this.setObjectQuaternion(this.object.quaternion,t,n,r,i),8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(this.changeEvent))}})),dl(this,"dispose",(()=>this.disconnect())),this.object=e,this.object.rotation.reorder("YXZ"),this.connect()}}const ml=i.forwardRef(((e,t)=>{const{camera:n,onChange:o,makeDefault:s,...c}=e,l=(0,a.D)((e=>e.camera)),u=(0,a.D)((e=>e.invalidate)),h=(0,a.D)((e=>e.get)),d=(0,a.D)((e=>e.set)),A=n||l,m=i.useMemo((()=>new Al(A)),[A]);return i.useEffect((()=>{const e=e=>{u(),o&&o(e)};return null==m||null==m.addEventListener||m.addEventListener("change",e),()=>null==m||null==m.removeEventListener?void 0:m.removeEventListener("change",e)}),[o,m,u]),(0,a.F)((()=>null==m?void 0:m.update()),-1),i.useEffect((()=>{const e=m;return null==e||e.connect(),()=>null==e?void 0:e.dispose()}),[m]),i.useEffect((()=>{if(s){const e=h().controls;return d({controls:m}),()=>d({controls:e})}}),[s,m]),m?i.createElement("primitive",(0,r.Z)({ref:t,object:m},c)):null}));var pl=Object.defineProperty,fl=(e,t,n)=>(((e,t,n)=>{t in e?pl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);function gl(e){e.preventDefault()}class yl extends s.EventDispatcher{constructor(e,t){super(),fl(this,"object"),fl(this,"domElement",null),fl(this,"movementSpeed",1),fl(this,"rollSpeed",.005),fl(this,"dragToLook",!1),fl(this,"autoForward",!1),fl(this,"changeEvent",{type:"change"}),fl(this,"EPS",1e-6),fl(this,"tmpQuaternion",new s.Quaternion),fl(this,"mouseStatus",0),fl(this,"movementSpeedMultiplier",1),fl(this,"moveState",{up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0}),fl(this,"moveVector",new s.Vector3(0,0,0)),fl(this,"rotationVector",new s.Vector3(0,0,0)),fl(this,"keydown",(e=>{if(!e.altKey){switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}})),fl(this,"keyup",(e=>{switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()})),fl(this,"pointerdown",(e=>{if(this.dragToLook)this.mouseStatus++;else{switch(e.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1}this.updateMovementVector()}})),fl(this,"pointermove",(e=>{if(!this.dragToLook||this.mouseStatus>0){const t=this.getContainerDimensions(),n=t.size[0]/2,r=t.size[1]/2;this.moveState.yawLeft=-(e.pageX-t.offset[0]-n)/n,this.moveState.pitchDown=(e.pageY-t.offset[1]-r)/r,this.updateRotationVector()}})),fl(this,"pointerup",(e=>{if(this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(e.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0}this.updateMovementVector()}this.updateRotationVector()})),fl(this,"lastQuaternion",new s.Quaternion),fl(this,"lastPosition",new s.Vector3),fl(this,"update",(e=>{const t=e*this.movementSpeed,n=e*this.rollSpeed;this.object.translateX(this.moveVector.x*t),this.object.translateY(this.moveVector.y*t),this.object.translateZ(this.moveVector.z*t),this.tmpQuaternion.set(this.rotationVector.x*n,this.rotationVector.y*n,this.rotationVector.z*n,1).normalize(),this.object.quaternion.multiply(this.tmpQuaternion),(this.lastPosition.distanceToSquared(this.object.position)>this.EPS||8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS)&&(this.dispatchEvent(this.changeEvent),this.lastQuaternion.copy(this.object.quaternion),this.lastPosition.copy(this.object.position))})),fl(this,"updateMovementVector",(()=>{const e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back})),fl(this,"updateRotationVector",(()=>{this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft})),fl(this,"getContainerDimensions",(()=>this.domElement==document||this.domElement instanceof Document?{size:[window.innerWidth,window.innerHeight],offset:[0,0]}:{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]})),fl(this,"connect",(e=>{this.domElement=e,e instanceof Document||e.setAttribute("tabindex",-1),this.domElement.addEventListener("contextmenu",gl),this.domElement.addEventListener("pointermove",this.pointermove),this.domElement.addEventListener("pointerdown",this.pointerdown),this.domElement.addEventListener("pointerup",this.pointerup),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup)})),fl(this,"dispose",(()=>{this.domElement.removeEventListener("contextmenu",gl),this.domElement.removeEventListener("pointermove",this.pointermove),this.domElement.removeEventListener("pointerdown",this.pointerdown),this.domElement.removeEventListener("pointerup",this.pointerup),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup)})),this.object=e,void 0!==t&&this.connect(t),this.updateMovementVector(),this.updateRotationVector()}}const vl=i.forwardRef((({domElement:e,...t},n)=>{const{onChange:o,makeDefault:s,...c}=t,l=(0,a.D)((e=>e.invalidate)),u=(0,a.D)((e=>e.camera)),h=(0,a.D)((e=>e.gl)),d=(0,a.D)((e=>e.events)),A=(0,a.D)((e=>e.get)),m=(0,a.D)((e=>e.set)),p=e||d.connected||h.domElement,f=i.useMemo((()=>new yl(u)),[u]);return i.useEffect((()=>(f.connect(p),()=>{f.dispose()})),[p,f,l]),i.useEffect((()=>{const e=e=>{l(),o&&o(e)};return null==f.addEventListener||f.addEventListener("change",e),()=>null==f.removeEventListener?void 0:f.removeEventListener("change",e)}),[o,l]),i.useEffect((()=>{if(s){const e=A().controls;return m({controls:f}),()=>m({controls:e})}}),[s,f]),(0,a.F)(((e,t)=>f.update(t))),i.createElement("primitive",(0,r.Z)({ref:n,object:f,args:[u,p]},c))}));var xl=Object.defineProperty,El=(e,t,n)=>(((e,t,n)=>{t in e?xl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);const wl=new s.Ray,Cl=new s.Plane,Il=Math.cos(Math.PI/180*70),_l=(e,t)=>(e%t+t)%t;class bl extends s.EventDispatcher{constructor(e,t){super(),El(this,"object"),El(this,"domElement"),El(this,"enabled",!0),El(this,"target",new s.Vector3),El(this,"minDistance",0),El(this,"maxDistance",1/0),El(this,"minZoom",0),El(this,"maxZoom",1/0),El(this,"minPolarAngle",0),El(this,"maxPolarAngle",Math.PI),El(this,"minAzimuthAngle",-1/0),El(this,"maxAzimuthAngle",1/0),El(this,"enableDamping",!1),El(this,"dampingFactor",.05),El(this,"enableZoom",!0),El(this,"zoomSpeed",1),El(this,"enableRotate",!0),El(this,"rotateSpeed",1),El(this,"enablePan",!0),El(this,"panSpeed",1),El(this,"screenSpacePanning",!0),El(this,"keyPanSpeed",7),El(this,"zoomToCursor",!1),El(this,"autoRotate",!1),El(this,"autoRotateSpeed",2),El(this,"reverseOrbit",!1),El(this,"reverseHorizontalOrbit",!1),El(this,"reverseVerticalOrbit",!1),El(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),El(this,"mouseButtons",{LEFT:s.MOUSE.ROTATE,MIDDLE:s.MOUSE.DOLLY,RIGHT:s.MOUSE.PAN}),El(this,"touches",{ONE:s.TOUCH.ROTATE,TWO:s.TOUCH.DOLLY_PAN}),El(this,"target0"),El(this,"position0"),El(this,"zoom0"),El(this,"_domElementKeyEvents",null),El(this,"getPolarAngle"),El(this,"getAzimuthalAngle"),El(this,"setPolarAngle"),El(this,"setAzimuthalAngle"),El(this,"getDistance"),El(this,"listenToKeyEvents"),El(this,"stopListenToKeyEvents"),El(this,"saveState"),El(this,"reset"),El(this,"update"),El(this,"connect"),El(this,"dispose"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>u.phi,this.getAzimuthalAngle=()=>u.theta,this.setPolarAngle=e=>{let t=_l(e,2*Math.PI),r=u.phi;r<0&&(r+=2*Math.PI),t<0&&(t+=2*Math.PI);let i=Math.abs(t-r);2*Math.PI-i<i&&(t<r?t+=2*Math.PI:r+=2*Math.PI),h.phi=t-r,n.update()},this.setAzimuthalAngle=e=>{let t=_l(e,2*Math.PI),r=u.theta;r<0&&(r+=2*Math.PI),t<0&&(t+=2*Math.PI);let i=Math.abs(t-r);2*Math.PI-i<i&&(t<r?t+=2*Math.PI:r+=2*Math.PI),h.theta=t-r,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=e=>{e.addEventListener("keydown",Z),this._domElementKeyEvents=e},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Z),this._domElementKeyEvents=null},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(r),n.update(),c=a.NONE},this.update=(()=>{const t=new s.Vector3,i=new s.Vector3(0,1,0),o=(new s.Quaternion).setFromUnitVectors(e.up,i),m=o.clone().invert(),p=new s.Vector3,f=new s.Quaternion,g=2*Math.PI;return function(){const y=n.object.position;o.setFromUnitVectors(e.up,i),m.copy(o).invert(),t.copy(y).sub(n.target),t.applyQuaternion(o),u.setFromVector3(t),n.autoRotate&&c===a.NONE&&S(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(u.theta+=h.theta*n.dampingFactor,u.phi+=h.phi*n.dampingFactor):(u.theta+=h.theta,u.phi+=h.phi);let v=n.minAzimuthAngle,x=n.maxAzimuthAngle;isFinite(v)&&isFinite(x)&&(v<-Math.PI?v+=g:v>Math.PI&&(v-=g),x<-Math.PI?x+=g:x>Math.PI&&(x-=g),u.theta=v<=x?Math.max(v,Math.min(x,u.theta)):u.theta>(v+x)/2?Math.max(v,u.theta):Math.min(x,u.theta)),u.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,u.phi)),u.makeSafe(),!0===n.enableDamping?n.target.addScaledVector(A,n.dampingFactor):n.target.add(A),n.zoomToCursor&&_||n.object.isOrthographicCamera?u.radius=k(u.radius):u.radius=k(u.radius*d),t.setFromSpherical(u),t.applyQuaternion(m),y.copy(n.target).add(t),n.object.matrixAutoUpdate||n.object.updateMatrix(),n.object.lookAt(n.target),!0===n.enableDamping?(h.theta*=1-n.dampingFactor,h.phi*=1-n.dampingFactor,A.multiplyScalar(1-n.dampingFactor)):(h.set(0,0,0),A.set(0,0,0));let E=!1;if(n.zoomToCursor&&_){let r=null;if(n.object instanceof s.PerspectiveCamera&&n.object.isPerspectiveCamera){const e=t.length();r=k(e*d);const i=e-r;n.object.position.addScaledVector(C,i),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const e=new s.Vector3(I.x,I.y,0);e.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/d)),n.object.updateProjectionMatrix(),E=!0;const i=new s.Vector3(I.x,I.y,0);i.unproject(n.object),n.object.position.sub(i).add(e),n.object.updateMatrixWorld(),r=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;null!==r&&(n.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(r).add(n.object.position):(wl.origin.copy(n.object.position),wl.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(wl.direction))<Il?e.lookAt(n.target):(Cl.setFromNormalAndCoplanarPoint(n.object.up,n.target),wl.intersectPlane(Cl,n.target))))}else n.object instanceof s.OrthographicCamera&&n.object.isOrthographicCamera&&(E=1!==d,E&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/d)),n.object.updateProjectionMatrix()));return d=1,_=!1,!!(E||p.distanceToSquared(n.object.position)>l||8*(1-f.dot(n.object.quaternion))>l)&&(n.dispatchEvent(r),p.copy(n.object.position),f.copy(n.object.quaternion),E=!1,!0)}})(),this.connect=e=>{n.domElement=e,n.domElement.style.touchAction="none",n.domElement.addEventListener("contextmenu",K),n.domElement.addEventListener("pointerdown",q),n.domElement.addEventListener("pointercancel",Y),n.domElement.addEventListener("wheel",X)},this.dispose=()=>{var e,t,r,i,o,s;n.domElement&&(n.domElement.style.touchAction="auto"),null==(e=n.domElement)||e.removeEventListener("contextmenu",K),null==(t=n.domElement)||t.removeEventListener("pointerdown",q),null==(r=n.domElement)||r.removeEventListener("pointercancel",Y),null==(i=n.domElement)||i.removeEventListener("wheel",X),null==(o=n.domElement)||o.ownerDocument.removeEventListener("pointermove",W),null==(s=n.domElement)||s.ownerDocument.removeEventListener("pointerup",Y),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",Z)};const n=this,r={type:"change"},i={type:"start"},o={type:"end"},a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let c=a.NONE;const l=1e-6,u=new s.Spherical,h=new s.Spherical;let d=1;const A=new s.Vector3,m=new s.Vector2,p=new s.Vector2,f=new s.Vector2,g=new s.Vector2,y=new s.Vector2,v=new s.Vector2,x=new s.Vector2,E=new s.Vector2,w=new s.Vector2,C=new s.Vector3,I=new s.Vector2;let _=!1;const b=[],B={};function M(){return Math.pow(.95,n.zoomSpeed)}function S(e){n.reverseOrbit||n.reverseHorizontalOrbit?h.theta+=e:h.theta-=e}function D(e){n.reverseOrbit||n.reverseVerticalOrbit?h.phi+=e:h.phi-=e}const T=(()=>{const e=new s.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),A.add(e)}})(),Q=(()=>{const e=new s.Vector3;return function(t,r){!0===n.screenSpacePanning?e.setFromMatrixColumn(r,1):(e.setFromMatrixColumn(r,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),A.add(e)}})(),P=(()=>{const e=new s.Vector3;return function(t,r){const i=n.domElement;if(i&&n.object instanceof s.PerspectiveCamera&&n.object.isPerspectiveCamera){const o=n.object.position;e.copy(o).sub(n.target);let s=e.length();s*=Math.tan(n.object.fov/2*Math.PI/180),T(2*t*s/i.clientHeight,n.object.matrix),Q(2*r*s/i.clientHeight,n.object.matrix)}else i&&n.object instanceof s.OrthographicCamera&&n.object.isOrthographicCamera?(T(t*(n.object.right-n.object.left)/n.object.zoom/i.clientWidth,n.object.matrix),Q(r*(n.object.top-n.object.bottom)/n.object.zoom/i.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}})();function z(e){n.object instanceof s.PerspectiveCamera&&n.object.isPerspectiveCamera||n.object instanceof s.OrthographicCamera&&n.object.isOrthographicCamera?d/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function R(e){n.object instanceof s.PerspectiveCamera&&n.object.isPerspectiveCamera||n.object instanceof s.OrthographicCamera&&n.object.isOrthographicCamera?d*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function F(e){if(!n.zoomToCursor||!n.domElement)return;_=!0;const t=n.domElement.getBoundingClientRect(),r=e.clientX-t.left,i=e.clientY-t.top,o=t.width,s=t.height;I.x=r/o*2-1,I.y=-i/s*2+1,C.set(I.x,I.y,1).unproject(n.object).sub(n.object.position).normalize()}function k(e){return Math.max(n.minDistance,Math.min(n.maxDistance,e))}function L(e){m.set(e.clientX,e.clientY)}function O(e){g.set(e.clientX,e.clientY)}function U(){if(1==b.length)m.set(b[0].pageX,b[0].pageY);else{const e=.5*(b[0].pageX+b[1].pageX),t=.5*(b[0].pageY+b[1].pageY);m.set(e,t)}}function N(){if(1==b.length)g.set(b[0].pageX,b[0].pageY);else{const e=.5*(b[0].pageX+b[1].pageX),t=.5*(b[0].pageY+b[1].pageY);g.set(e,t)}}function V(){const e=b[0].pageX-b[1].pageX,t=b[0].pageY-b[1].pageY,n=Math.sqrt(e*e+t*t);x.set(0,n)}function G(e){if(1==b.length)p.set(e.pageX,e.pageY);else{const t=$(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);p.set(n,r)}f.subVectors(p,m).multiplyScalar(n.rotateSpeed);const t=n.domElement;t&&(S(2*Math.PI*f.x/t.clientHeight),D(2*Math.PI*f.y/t.clientHeight)),m.copy(p)}function j(e){if(1==b.length)y.set(e.pageX,e.pageY);else{const t=$(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);y.set(n,r)}v.subVectors(y,g).multiplyScalar(n.panSpeed),P(v.x,v.y),g.copy(y)}function H(e){const t=$(e),r=e.pageX-t.x,i=e.pageY-t.y,o=Math.sqrt(r*r+i*i);E.set(0,o),w.set(0,Math.pow(E.y/x.y,n.zoomSpeed)),z(w.y),x.copy(E)}function q(e){var t,r;!1!==n.enabled&&(0===b.length&&(null==(t=n.domElement)||t.ownerDocument.addEventListener("pointermove",W),null==(r=n.domElement)||r.ownerDocument.addEventListener("pointerup",Y)),function(e){b.push(e)}(e),"touch"===e.pointerType?function(e){switch(J(e),b.length){case 1:switch(n.touches.ONE){case s.TOUCH.ROTATE:if(!1===n.enableRotate)return;U(),c=a.TOUCH_ROTATE;break;case s.TOUCH.PAN:if(!1===n.enablePan)return;N(),c=a.TOUCH_PAN;break;default:c=a.NONE}break;case 2:switch(n.touches.TWO){case s.TOUCH.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;n.enableZoom&&V(),n.enablePan&&N(),c=a.TOUCH_DOLLY_PAN;break;case s.TOUCH.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;n.enableZoom&&V(),n.enableRotate&&U(),c=a.TOUCH_DOLLY_ROTATE;break;default:c=a.NONE}break;default:c=a.NONE}c!==a.NONE&&n.dispatchEvent(i)}(e):function(e){let t;switch(e.button){case 0:t=n.mouseButtons.LEFT;break;case 1:t=n.mouseButtons.MIDDLE;break;case 2:t=n.mouseButtons.RIGHT;break;default:t=-1}switch(t){case s.MOUSE.DOLLY:if(!1===n.enableZoom)return;!function(e){F(e),x.set(e.clientX,e.clientY)}(e),c=a.DOLLY;break;case s.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;O(e),c=a.PAN}else{if(!1===n.enableRotate)return;L(e),c=a.ROTATE}break;case s.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;L(e),c=a.ROTATE}else{if(!1===n.enablePan)return;O(e),c=a.PAN}break;default:c=a.NONE}c!==a.NONE&&n.dispatchEvent(i)}(e))}function W(e){!1!==n.enabled&&("touch"===e.pointerType?function(e){switch(J(e),c){case a.TOUCH_ROTATE:if(!1===n.enableRotate)return;G(e),n.update();break;case a.TOUCH_PAN:if(!1===n.enablePan)return;j(e),n.update();break;case a.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&H(e),n.enablePan&&j(e)}(e),n.update();break;case a.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&H(e),n.enableRotate&&G(e)}(e),n.update();break;default:c=a.NONE}}(e):function(e){if(!1===n.enabled)return;switch(c){case a.ROTATE:if(!1===n.enableRotate)return;!function(e){p.set(e.clientX,e.clientY),f.subVectors(p,m).multiplyScalar(n.rotateSpeed);const t=n.domElement;t&&(S(2*Math.PI*f.x/t.clientHeight),D(2*Math.PI*f.y/t.clientHeight)),m.copy(p),n.update()}(e);break;case a.DOLLY:if(!1===n.enableZoom)return;!function(e){E.set(e.clientX,e.clientY),w.subVectors(E,x),w.y>0?z(M()):w.y<0&&R(M()),x.copy(E),n.update()}(e);break;case a.PAN:if(!1===n.enablePan)return;!function(e){y.set(e.clientX,e.clientY),v.subVectors(y,g).multiplyScalar(n.panSpeed),P(v.x,v.y),g.copy(y),n.update()}(e)}}(e))}function Y(e){var t,r,i;!function(e){delete B[e.pointerId];for(let t=0;t<b.length;t++)if(b[t].pointerId==e.pointerId)return void b.splice(t,1)}(e),0===b.length&&(null==(t=n.domElement)||t.releasePointerCapture(e.pointerId),null==(r=n.domElement)||r.ownerDocument.removeEventListener("pointermove",W),null==(i=n.domElement)||i.ownerDocument.removeEventListener("pointerup",Y)),n.dispatchEvent(o),c=a.NONE}function X(e){!1===n.enabled||!1===n.enableZoom||c!==a.NONE&&c!==a.ROTATE||(e.preventDefault(),n.dispatchEvent(i),function(e){F(e),e.deltaY<0?R(M()):e.deltaY>0&&z(M()),n.update()}(e),n.dispatchEvent(o))}function Z(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){let t=!1;switch(e.code){case n.keys.UP:P(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:P(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:P(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:P(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function K(e){!1!==n.enabled&&e.preventDefault()}function J(e){let t=B[e.pointerId];void 0===t&&(t=new s.Vector2,B[e.pointerId]=t),t.set(e.pageX,e.pageY)}function $(e){const t=e.pointerId===b[0].pointerId?b[1]:b[0];return B[t.pointerId]}void 0!==t&&this.connect(t),this.update()}}class Bl extends bl{constructor(e,t){super(e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=s.MOUSE.PAN,this.mouseButtons.RIGHT=s.MOUSE.ROTATE,this.touches.ONE=s.TOUCH.PAN,this.touches.TWO=s.TOUCH.DOLLY_ROTATE}}const Ml=i.forwardRef(((e={enableDamping:!0},t)=>{const{domElement:n,camera:o,makeDefault:s,onChange:c,onStart:l,onEnd:u,...h}=e,d=(0,a.D)((e=>e.invalidate)),A=(0,a.D)((e=>e.camera)),m=(0,a.D)((e=>e.gl)),p=(0,a.D)((e=>e.events)),f=(0,a.D)((e=>e.set)),g=(0,a.D)((e=>e.get)),y=n||p.connected||m.domElement,v=o||A,x=i.useMemo((()=>new Bl(v)),[v]);return i.useEffect((()=>{x.connect(y);const e=e=>{d(),c&&c(e)};return x.addEventListener("change",e),l&&x.addEventListener("start",l),u&&x.addEventListener("end",u),()=>{x.dispose(),x.removeEventListener("change",e),l&&x.removeEventListener("start",l),u&&x.removeEventListener("end",u)}}),[c,l,u,x,d,y]),i.useEffect((()=>{if(s){const e=g().controls;return f({controls:x}),()=>f({controls:e})}}),[s,x]),(0,a.F)((()=>x.update()),-1),i.createElement("primitive",(0,r.Z)({ref:t,object:x,enableDamping:!0},h))})),Sl=i.forwardRef((({makeDefault:e,camera:t,regress:n,domElement:o,enableDamping:s=!0,keyEvents:c=!1,onChange:l,onStart:u,onEnd:h,...d},A)=>{const m=(0,a.D)((e=>e.invalidate)),p=(0,a.D)((e=>e.camera)),f=(0,a.D)((e=>e.gl)),g=(0,a.D)((e=>e.events)),y=(0,a.D)((e=>e.setEvents)),v=(0,a.D)((e=>e.set)),x=(0,a.D)((e=>e.get)),E=(0,a.D)((e=>e.performance)),w=t||p,C=o||g.connected||f.domElement,I=i.useMemo((()=>new bl(w)),[w]);return(0,a.F)((()=>{I.enabled&&I.update()}),-1),i.useEffect((()=>(c&&I.connect(!0===c?C:c),I.connect(C),()=>{I.dispose()})),[c,C,n,I,m]),i.useEffect((()=>{const e=e=>{m(),n&&E.regress(),l&&l(e)},t=e=>{u&&u(e)},r=e=>{h&&h(e)};return I.addEventListener("change",e),I.addEventListener("start",t),I.addEventListener("end",r),()=>{I.removeEventListener("start",t),I.removeEventListener("end",r),I.removeEventListener("change",e)}}),[l,u,h,I,m,y]),i.useEffect((()=>{if(e){const e=x().controls;return v({controls:I}),()=>v({controls:e})}}),[e,I]),i.createElement("primitive",(0,r.Z)({ref:A,object:I,enableDamping:s},d))}));var Dl=Object.defineProperty,Tl=(e,t,n)=>(((e,t,n)=>{t in e?Dl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);class Ql extends s.EventDispatcher{constructor(e,t){super(),Tl(this,"enabled",!0),Tl(this,"screen",{left:0,top:0,width:0,height:0}),Tl(this,"rotateSpeed",1),Tl(this,"zoomSpeed",1.2),Tl(this,"panSpeed",.3),Tl(this,"noRotate",!1),Tl(this,"noZoom",!1),Tl(this,"noPan",!1),Tl(this,"staticMoving",!1),Tl(this,"dynamicDampingFactor",.2),Tl(this,"minDistance",0),Tl(this,"maxDistance",1/0),Tl(this,"keys",["KeyA","KeyS","KeyD"]),Tl(this,"mouseButtons",{LEFT:s.MOUSE.ROTATE,MIDDLE:s.MOUSE.DOLLY,RIGHT:s.MOUSE.PAN}),Tl(this,"object"),Tl(this,"domElement"),Tl(this,"cursorZoom",!1),Tl(this,"target",new s.Vector3),Tl(this,"mousePosition",new s.Vector2),Tl(this,"STATE",{NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4}),Tl(this,"EPS",1e-6),Tl(this,"lastZoom",1),Tl(this,"lastPosition",new s.Vector3),Tl(this,"cursorVector",new s.Vector3),Tl(this,"targetVector",new s.Vector3),Tl(this,"_state",this.STATE.NONE),Tl(this,"_keyState",this.STATE.NONE),Tl(this,"_eye",new s.Vector3),Tl(this,"_movePrev",new s.Vector2),Tl(this,"_moveCurr",new s.Vector2),Tl(this,"_lastAxis",new s.Vector3),Tl(this,"_lastAngle",0),Tl(this,"_zoomStart",new s.Vector2),Tl(this,"_zoomEnd",new s.Vector2),Tl(this,"_touchZoomDistanceStart",0),Tl(this,"_touchZoomDistanceEnd",0),Tl(this,"_panStart",new s.Vector2),Tl(this,"_panEnd",new s.Vector2),Tl(this,"target0"),Tl(this,"position0"),Tl(this,"up0"),Tl(this,"zoom0"),Tl(this,"changeEvent",{type:"change"}),Tl(this,"startEvent",{type:"start"}),Tl(this,"endEvent",{type:"end"}),Tl(this,"onScreenVector",new s.Vector2),Tl(this,"getMouseOnScreen",((e,t)=>(this.onScreenVector.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),this.onScreenVector))),Tl(this,"onCircleVector",new s.Vector2),Tl(this,"getMouseOnCircle",((e,t)=>(this.onCircleVector.set((e-.5*this.screen.width-this.screen.left)/(.5*this.screen.width),(this.screen.height+2*(this.screen.top-t))/this.screen.width),this.onCircleVector))),Tl(this,"axis",new s.Vector3),Tl(this,"quaternion",new s.Quaternion),Tl(this,"eyeDirection",new s.Vector3),Tl(this,"objectUpDirection",new s.Vector3),Tl(this,"objectSidewaysDirection",new s.Vector3),Tl(this,"moveDirection",new s.Vector3),Tl(this,"angle",0),Tl(this,"rotateCamera",(()=>{this.moveDirection.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0),this.angle=this.moveDirection.length(),this.angle?(this._eye.copy(this.object.position).sub(this.target),this.eyeDirection.copy(this._eye).normalize(),this.objectUpDirection.copy(this.object.up).normalize(),this.objectSidewaysDirection.crossVectors(this.objectUpDirection,this.eyeDirection).normalize(),this.objectUpDirection.setLength(this._moveCurr.y-this._movePrev.y),this.objectSidewaysDirection.setLength(this._moveCurr.x-this._movePrev.x),this.moveDirection.copy(this.objectUpDirection.add(this.objectSidewaysDirection)),this.axis.crossVectors(this.moveDirection,this._eye).normalize(),this.angle*=this.rotateSpeed,this.quaternion.setFromAxisAngle(this.axis,this.angle),this._eye.applyQuaternion(this.quaternion),this.object.up.applyQuaternion(this.quaternion),this._lastAxis.copy(this.axis),this._lastAngle=this.angle):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),this.quaternion.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(this.quaternion),this.object.up.applyQuaternion(this.quaternion)),this._movePrev.copy(this._moveCurr)})),Tl(this,"zoomCamera",(()=>{let e;if(this._state===this.STATE.TOUCH_ZOOM_PAN)e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom/=e,this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type");else{if(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,Math.abs(e-1)>this.EPS&&e>0&&(this.object.isPerspectiveCamera?(e>1&&this._eye.length()>=this.maxDistance-this.EPS&&(e=1),this._eye.multiplyScalar(e)):this.object.isOrthographicCamera?(e>1&&this.object.zoom<this.maxDistance*this.maxDistance&&(e=1),this.object.zoom/=e):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor,this.cursorZoom){this.targetVector.copy(this.target).project(this.object);let t=this.cursorVector.set(this.mousePosition.x,this.mousePosition.y,this.targetVector.z).unproject(this.object);this.target.lerpVectors(t,this.target,e)}this.object.isOrthographicCamera&&this.object.updateProjectionMatrix()}})),Tl(this,"mouseChange",new s.Vector2),Tl(this,"objectUp",new s.Vector3),Tl(this,"pan",new s.Vector3),Tl(this,"panCamera",(()=>{if(this.domElement&&(this.mouseChange.copy(this._panEnd).sub(this._panStart),this.mouseChange.lengthSq()>this.EPS)){if(this.object.isOrthographicCamera){const e=this.object,t=(e.right-e.left)/this.object.zoom,n=(e.top-e.bottom)/this.object.zoom;this.mouseChange.x*=t,this.mouseChange.y*=n}else this.mouseChange.multiplyScalar(this._eye.length()*this.panSpeed);this.pan.copy(this._eye).cross(this.object.up).setLength(this.mouseChange.x),this.pan.add(this.objectUp.copy(this.object.up).setLength(this.mouseChange.y)),this.object.position.add(this.pan),this.target.add(this.pan),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(this.mouseChange.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}})),Tl(this,"checkDistances",(()=>{this.noZoom&&this.noPan||(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))})),Tl(this,"handleResize",(()=>{if(!this.domElement)return;const e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height})),Tl(this,"update",(()=>{this._eye.subVectors(this.object.position,this.target),this.noRotate||this.rotateCamera(),this.noZoom||this.zoomCamera(),this.noPan||this.panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this.checkDistances(),this.object.lookAt(this.target),this.lastPosition.distanceToSquared(this.object.position)>this.EPS&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this.lastPosition.distanceToSquared(this.object.position)>this.EPS||this.lastZoom!==this.object.zoom)&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")})),Tl(this,"reset",(()=>{this._state=this.STATE.NONE,this._keyState=this.STATE.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.up.copy(this.up0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastZoom=this.object.zoom})),Tl(this,"keydown",(e=>{!1!==this.enabled&&(window.removeEventListener("keydown",this.keydown),this._keyState===this.STATE.NONE&&(e.code!==this.keys[this.STATE.ROTATE]||this.noRotate?e.code!==this.keys[this.STATE.ZOOM]||this.noZoom?e.code!==this.keys[this.STATE.PAN]||this.noPan||(this._keyState=this.STATE.PAN):this._keyState=this.STATE.ZOOM:this._keyState=this.STATE.ROTATE))})),Tl(this,"onPointerDown",(e=>{if(!1!==this.enabled)switch(e.pointerType){case"mouse":case"pen":this.onMouseDown(e)}})),Tl(this,"onPointerMove",(e=>{if(!1!==this.enabled)switch(e.pointerType){case"mouse":case"pen":this.onMouseMove(e)}})),Tl(this,"onPointerUp",(e=>{if(!1!==this.enabled)switch(e.pointerType){case"mouse":case"pen":this.onMouseUp()}})),Tl(this,"keyup",(()=>{!1!==this.enabled&&(this._keyState=this.STATE.NONE,window.addEventListener("keydown",this.keydown))})),Tl(this,"onMouseDown",(e=>{if(!this.domElement)return;if(this._state===this.STATE.NONE)switch(e.button){case this.mouseButtons.LEFT:this._state=this.STATE.ROTATE;break;case this.mouseButtons.MIDDLE:this._state=this.STATE.ZOOM;break;case this.mouseButtons.RIGHT:this._state=this.STATE.PAN}const t=this._keyState!==this.STATE.NONE?this._keyState:this._state;t!==this.STATE.ROTATE||this.noRotate?t!==this.STATE.ZOOM||this.noZoom?t!==this.STATE.PAN||this.noPan||(this._panStart.copy(this.getMouseOnScreen(e.pageX,e.pageY)),this._panEnd.copy(this._panStart)):(this._zoomStart.copy(this.getMouseOnScreen(e.pageX,e.pageY)),this._zoomEnd.copy(this._zoomStart)):(this._moveCurr.copy(this.getMouseOnCircle(e.pageX,e.pageY)),this._movePrev.copy(this._moveCurr)),this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.dispatchEvent(this.startEvent)})),Tl(this,"onMouseMove",(e=>{if(!1===this.enabled)return;const t=this._keyState!==this.STATE.NONE?this._keyState:this._state;t!==this.STATE.ROTATE||this.noRotate?t!==this.STATE.ZOOM||this.noZoom?t!==this.STATE.PAN||this.noPan||this._panEnd.copy(this.getMouseOnScreen(e.pageX,e.pageY)):this._zoomEnd.copy(this.getMouseOnScreen(e.pageX,e.pageY)):(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(e.pageX,e.pageY)))})),Tl(this,"onMouseUp",(()=>{this.domElement&&!1!==this.enabled&&(this._state=this.STATE.NONE,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),this.dispatchEvent(this.endEvent))})),Tl(this,"mousewheel",(e=>{if(!1!==this.enabled&&!0!==this.noZoom){switch(e.preventDefault(),e.deltaMode){case 2:this._zoomStart.y-=.025*e.deltaY;break;case 1:this._zoomStart.y-=.01*e.deltaY;break;default:this._zoomStart.y-=25e-5*e.deltaY}this.mousePosition.x=e.offsetX/this.screen.width*2-1,this.mousePosition.y=-e.offsetY/this.screen.height*2+1,this.dispatchEvent(this.startEvent),this.dispatchEvent(this.endEvent)}})),Tl(this,"touchstart",(e=>{if(!1!==this.enabled){if(e.preventDefault(),1===e.touches.length)this._state=this.STATE.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY)),this._movePrev.copy(this._moveCurr);else{this._state=this.STATE.TOUCH_ZOOM_PAN;const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(t*t+n*n);const r=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;this._panStart.copy(this.getMouseOnScreen(r,i)),this._panEnd.copy(this._panStart)}this.dispatchEvent(this.startEvent)}})),Tl(this,"touchmove",(e=>{if(!1!==this.enabled)if(e.preventDefault(),1===e.touches.length)this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY));else{const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;this._touchZoomDistanceEnd=Math.sqrt(t*t+n*n);const r=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;this._panEnd.copy(this.getMouseOnScreen(r,i))}})),Tl(this,"touchend",(e=>{if(!1!==this.enabled){switch(e.touches.length){case 0:this._state=this.STATE.NONE;break;case 1:this._state=this.STATE.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY)),this._movePrev.copy(this._moveCurr)}this.dispatchEvent(this.endEvent)}})),Tl(this,"contextmenu",(e=>{!1!==this.enabled&&e.preventDefault()})),Tl(this,"connect",(e=>{e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=e,this.domElement.addEventListener("contextmenu",this.contextmenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.mousewheel),this.domElement.addEventListener("touchstart",this.touchstart),this.domElement.addEventListener("touchend",this.touchend),this.domElement.addEventListener("touchmove",this.touchmove),this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup),this.handleResize()})),Tl(this,"dispose",(()=>{this.domElement&&(this.domElement.removeEventListener("contextmenu",this.contextmenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.mousewheel),this.domElement.removeEventListener("touchstart",this.touchstart),this.domElement.removeEventListener("touchend",this.touchend),this.domElement.removeEventListener("touchmove",this.touchmove),this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup))})),this.object=e,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,void 0!==t&&this.connect(t),this.update()}}const Pl=i.forwardRef((({makeDefault:e,camera:t,domElement:n,regress:o,onChange:s,onStart:c,onEnd:l,...u},h)=>{const{invalidate:d,camera:A,gl:m,events:p,set:f,get:g,performance:y,viewport:v}=(0,a.D)(),x=t||A,E=n||p.connected||m.domElement,w=i.useMemo((()=>new Ql(x)),[x]);return(0,a.F)((()=>{w.enabled&&w.update()}),-1),i.useEffect((()=>(w.connect(E),()=>{w.dispose()})),[E,o,w,d]),i.useEffect((()=>{const e=e=>{d(),o&&y.regress(),s&&s(e)};return w.addEventListener("change",e),c&&w.addEventListener("start",c),l&&w.addEventListener("end",l),()=>{c&&w.removeEventListener("start",c),l&&w.removeEventListener("end",l),w.removeEventListener("change",e)}}),[s,c,l,w,d]),i.useEffect((()=>{w.handleResize()}),[v]),i.useEffect((()=>{if(e){const e=g().controls;return f({controls:w}),()=>f({controls:e})}}),[e,w]),i.createElement("primitive",(0,r.Z)({ref:h,object:w},u))}));var zl=Object.defineProperty,Rl=(e,t,n)=>(((e,t,n)=>{t in e?zl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);const Fl={IDLE:Symbol(),ROTATE:Symbol(),PAN:Symbol(),SCALE:Symbol(),FOV:Symbol(),FOCUS:Symbol(),ZROTATE:Symbol(),TOUCH_MULTI:Symbol(),ANIMATION_FOCUS:Symbol(),ANIMATION_ROTATE:Symbol()},kl={NONE:Symbol(),ONE_FINGER:Symbol(),ONE_FINGER_SWITCHED:Symbol(),TWO_FINGER:Symbol(),MULT_FINGER:Symbol(),CURSOR:Symbol()},Ll={x:0,y:0},Ol={camera:new s.Matrix4,gizmos:new s.Matrix4},Ul={type:"change"},Nl={type:"start"},Vl={type:"end"};class Gl extends s.EventDispatcher{constructor(e,t=null,n=null){super(),Rl(this,"camera"),Rl(this,"domElement"),Rl(this,"scene"),Rl(this,"mouseActions"),Rl(this,"_mouseOp"),Rl(this,"_v2_1"),Rl(this,"_v3_1"),Rl(this,"_v3_2"),Rl(this,"_m4_1"),Rl(this,"_m4_2"),Rl(this,"_quat"),Rl(this,"_translationMatrix"),Rl(this,"_rotationMatrix"),Rl(this,"_scaleMatrix"),Rl(this,"_rotationAxis"),Rl(this,"_cameraMatrixState"),Rl(this,"_cameraProjectionState"),Rl(this,"_fovState"),Rl(this,"_upState"),Rl(this,"_zoomState"),Rl(this,"_nearPos"),Rl(this,"_farPos"),Rl(this,"_gizmoMatrixState"),Rl(this,"_up0"),Rl(this,"_zoom0"),Rl(this,"_fov0"),Rl(this,"_initialNear"),Rl(this,"_nearPos0"),Rl(this,"_initialFar"),Rl(this,"_farPos0"),Rl(this,"_cameraMatrixState0"),Rl(this,"_gizmoMatrixState0"),Rl(this,"_button"),Rl(this,"_touchStart"),Rl(this,"_touchCurrent"),Rl(this,"_input"),Rl(this,"_switchSensibility"),Rl(this,"_startFingerDistance"),Rl(this,"_currentFingerDistance"),Rl(this,"_startFingerRotation"),Rl(this,"_currentFingerRotation"),Rl(this,"_devPxRatio"),Rl(this,"_downValid"),Rl(this,"_nclicks"),Rl(this,"_downEvents"),Rl(this,"_clickStart"),Rl(this,"_maxDownTime"),Rl(this,"_maxInterval"),Rl(this,"_posThreshold"),Rl(this,"_movementThreshold"),Rl(this,"_currentCursorPosition"),Rl(this,"_startCursorPosition"),Rl(this,"_grid"),Rl(this,"_gridPosition"),Rl(this,"_gizmos"),Rl(this,"_curvePts"),Rl(this,"_timeStart"),Rl(this,"_animationId"),Rl(this,"focusAnimationTime"),Rl(this,"_timePrev"),Rl(this,"_timeCurrent"),Rl(this,"_anglePrev"),Rl(this,"_angleCurrent"),Rl(this,"_cursorPosPrev"),Rl(this,"_cursorPosCurr"),Rl(this,"_wPrev"),Rl(this,"_wCurr"),Rl(this,"adjustNearFar"),Rl(this,"scaleFactor"),Rl(this,"dampingFactor"),Rl(this,"wMax"),Rl(this,"enableAnimations"),Rl(this,"enableGrid"),Rl(this,"cursorZoom"),Rl(this,"minFov"),Rl(this,"maxFov"),Rl(this,"enabled"),Rl(this,"enablePan"),Rl(this,"enableRotate"),Rl(this,"enableZoom"),Rl(this,"minDistance"),Rl(this,"maxDistance"),Rl(this,"minZoom"),Rl(this,"maxZoom"),Rl(this,"target"),Rl(this,"_currentTarget"),Rl(this,"_tbRadius"),Rl(this,"_state"),Rl(this,"onWindowResize",(()=>{const e=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3;if(this.camera){const e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e)}const t=this._tbRadius/e,n=new s.EllipseCurve(0,0,t,t).getPoints(this._curvePts),r=(new s.BufferGeometry).setFromPoints(n);for(const i in this._gizmos.children){this._gizmos.children[i].geometry=r}this.dispatchEvent(Ul)})),Rl(this,"onContextMenu",(e=>{if(this.enabled)for(let t=0;t<this.mouseActions.length;t++)if(2==this.mouseActions[t].mouse){e.preventDefault();break}})),Rl(this,"onPointerCancel",(()=>{this._touchStart.splice(0,this._touchStart.length),this._touchCurrent.splice(0,this._touchCurrent.length),this._input=kl.NONE})),Rl(this,"onPointerDown",(e=>{if(0==e.button&&e.isPrimary?(this._downValid=!0,this._downEvents.push(e)):this._downValid=!1,"touch"==e.pointerType&&this._input!=kl.CURSOR)switch(this._touchStart.push(e),this._touchCurrent.push(e),this._input){case kl.NONE:this._input=kl.ONE_FINGER,this.onSinglePanStart(e,"ROTATE"),window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp);break;case kl.ONE_FINGER:case kl.ONE_FINGER_SWITCHED:this._input=kl.TWO_FINGER,this.onRotateStart(),this.onPinchStart(),this.onDoublePanStart();break;case kl.TWO_FINGER:this._input=kl.MULT_FINGER,this.onTriplePanStart()}else if("touch"!=e.pointerType&&this._input==kl.NONE){let t=null;e.ctrlKey||e.metaKey?t="CTRL":e.shiftKey&&(t="SHIFT"),this._mouseOp=this.getOpFromAction(e.button,t),this._mouseOp&&(window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp),this._input=kl.CURSOR,this._button=e.button,this.onSinglePanStart(e,this._mouseOp))}})),Rl(this,"onPointerMove",(e=>{if("touch"==e.pointerType&&this._input!=kl.CURSOR)switch(this._input){case kl.ONE_FINGER:this.updateTouchEvent(e),this.onSinglePanMove(e,Fl.ROTATE);break;case kl.ONE_FINGER_SWITCHED:if(this.calculatePointersDistance(this._touchCurrent[0],e)*this._devPxRatio>=this._switchSensibility){this._input=kl.ONE_FINGER,this.updateTouchEvent(e),this.onSinglePanStart(e,"ROTATE");break}break;case kl.TWO_FINGER:this.updateTouchEvent(e),this.onRotateMove(),this.onPinchMove(),this.onDoublePanMove();break;case kl.MULT_FINGER:this.updateTouchEvent(e),this.onTriplePanMove()}else if("touch"!=e.pointerType&&this._input==kl.CURSOR){let t=null;e.ctrlKey||e.metaKey?t="CTRL":e.shiftKey&&(t="SHIFT");const n=this.getOpStateFromAction(this._button,t);n&&this.onSinglePanMove(e,n)}if(this._downValid){this.calculatePointersDistance(this._downEvents[this._downEvents.length-1],e)*this._devPxRatio>this._movementThreshold&&(this._downValid=!1)}})),Rl(this,"onPointerUp",(e=>{if("touch"==e.pointerType&&this._input!=kl.CURSOR){const t=this._touchCurrent.length;for(let n=0;n<t;n++)if(this._touchCurrent[n].pointerId==e.pointerId){this._touchCurrent.splice(n,1),this._touchStart.splice(n,1);break}switch(this._input){case kl.ONE_FINGER:case kl.ONE_FINGER_SWITCHED:window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=kl.NONE,this.onSinglePanEnd();break;case kl.TWO_FINGER:this.onDoublePanEnd(),this.onPinchEnd(),this.onRotateEnd(),this._input=kl.ONE_FINGER_SWITCHED;break;case kl.MULT_FINGER:0==this._touchCurrent.length&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=kl.NONE,this.onTriplePanEnd())}}else"touch"!=e.pointerType&&this._input==kl.CURSOR&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=kl.NONE,this.onSinglePanEnd(),this._button=-1);if(e.isPrimary)if(this._downValid){if(e.timeStamp-this._downEvents[this._downEvents.length-1].timeStamp<=this._maxDownTime)if(0==this._nclicks)this._nclicks=1,this._clickStart=performance.now();else{const t=e.timeStamp-this._clickStart,n=this.calculatePointersDistance(this._downEvents[1],this._downEvents[0])*this._devPxRatio;t<=this._maxInterval&&n<=this._posThreshold?(this._nclicks=0,this._downEvents.splice(0,this._downEvents.length),this.onDoubleTap(e)):(this._nclicks=1,this._downEvents.shift(),this._clickStart=performance.now())}else this._downValid=!1,this._nclicks=0,this._downEvents.splice(0,this._downEvents.length)}else this._nclicks=0,this._downEvents.splice(0,this._downEvents.length)})),Rl(this,"onWheel",(e=>{var t,n;if(this.enabled&&this.enableZoom&&this.domElement){let r=null;e.ctrlKey||e.metaKey?r="CTRL":e.shiftKey&&(r="SHIFT");const i=this.getOpFromAction("WHEEL",r);if(i){e.preventDefault(),this.dispatchEvent(Nl);const r=125;let o=e.deltaY/r,a=1;switch(o>0?a=1/this.scaleFactor:o<0&&(a=this.scaleFactor),i){case"ZOOM":if(this.updateTbState(Fl.SCALE,!0),o>0?a=1/Math.pow(this.scaleFactor,o):o<0&&(a=Math.pow(this.scaleFactor,-o)),this.cursorZoom&&this.enablePan){let r;this.camera instanceof s.OrthographicCamera&&(r=null==(t=this.unprojectOnTbPlane(this.camera,e.clientX,e.clientY,this.domElement))?void 0:t.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position)),this.camera instanceof s.PerspectiveCamera&&(r=null==(n=this.unprojectOnTbPlane(this.camera,e.clientX,e.clientY,this.domElement))?void 0:n.applyQuaternion(this.camera.quaternion).add(this._gizmos.position)),void 0!==r&&this.applyTransformMatrix(this.applyScale(a,r))}else this.applyTransformMatrix(this.applyScale(a,this._gizmos.position));this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(Fl.IDLE,!1),this.dispatchEvent(Ul),this.dispatchEvent(Vl);break;case"FOV":if(this.camera instanceof s.PerspectiveCamera){this.updateTbState(Fl.FOV,!0),0!=e.deltaX&&(o=e.deltaX/r,a=1,o>0?a=1/Math.pow(this.scaleFactor,o):o<0&&(a=Math.pow(this.scaleFactor,-o))),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const t=this._v3_1.distanceTo(this._gizmos.position);let n=t/a;n=s.MathUtils.clamp(n,this.minDistance,this.maxDistance);const i=t*Math.tan(s.MathUtils.DEG2RAD*this.camera.fov*.5);let c=s.MathUtils.RAD2DEG*(2*Math.atan(i/n));c>this.maxFov?c=this.maxFov:c<this.minFov&&(c=this.minFov);a=t/(i/Math.tan(s.MathUtils.DEG2RAD*(c/2))),this.setFov(c),this.applyTransformMatrix(this.applyScale(a,this._gizmos.position,!1))}this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(Fl.IDLE,!1),this.dispatchEvent(Ul),this.dispatchEvent(Vl)}}}})),Rl(this,"onSinglePanStart",((e,t)=>{if(this.enabled&&this.domElement)switch(this.dispatchEvent(Nl),this.setCenter(e.clientX,e.clientY),t){case"PAN":if(!this.enablePan)return;if(-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(Ul)),this.camera){this.updateTbState(Fl.PAN,!0);const e=this.unprojectOnTbPlane(this.camera,Ll.x,Ll.y,this.domElement);void 0!==e&&this._startCursorPosition.copy(e),this.enableGrid&&(this.drawGrid(),this.dispatchEvent(Ul))}break;case"ROTATE":if(!this.enableRotate)return;if(-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1),this.camera){this.updateTbState(Fl.ROTATE,!0);const e=this.unprojectOnTbSurface(this.camera,Ll.x,Ll.y,this.domElement,this._tbRadius);void 0!==e&&this._startCursorPosition.copy(e),this.activateGizmos(!0),this.enableAnimations&&(this._timePrev=this._timeCurrent=performance.now(),this._angleCurrent=this._anglePrev=0,this._cursorPosPrev.copy(this._startCursorPosition),this._cursorPosCurr.copy(this._cursorPosPrev),this._wCurr=0,this._wPrev=this._wCurr)}this.dispatchEvent(Ul);break;case"FOV":if(!this.enableZoom)return;this.camera instanceof s.PerspectiveCamera&&(-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(Ul)),this.updateTbState(Fl.FOV,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(Ll.x,Ll.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition));break;case"ZOOM":if(!this.enableZoom)return;-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(Ul)),this.updateTbState(Fl.SCALE,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(Ll.x,Ll.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition)}})),Rl(this,"onSinglePanMove",((e,t)=>{if(this.enabled&&this.domElement){const n=t!=this._state;switch(this.setCenter(e.clientX,e.clientY),t){case Fl.PAN:if(this.enablePan&&this.camera)if(n){this.dispatchEvent(Vl),this.dispatchEvent(Nl),this.updateTbState(t,!0);const e=this.unprojectOnTbPlane(this.camera,Ll.x,Ll.y,this.domElement);void 0!==e&&this._startCursorPosition.copy(e),this.enableGrid&&this.drawGrid(),this.activateGizmos(!1)}else{const e=this.unprojectOnTbPlane(this.camera,Ll.x,Ll.y,this.domElement);void 0!==e&&this._currentCursorPosition.copy(e),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition))}break;case Fl.ROTATE:if(this.enableRotate&&this.camera)if(n){this.dispatchEvent(Vl),this.dispatchEvent(Nl),this.updateTbState(t,!0);const e=this.unprojectOnTbSurface(this.camera,Ll.x,Ll.y,this.domElement,this._tbRadius);void 0!==e&&this._startCursorPosition.copy(e),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!0)}else{const e=this.unprojectOnTbSurface(this.camera,Ll.x,Ll.y,this.domElement,this._tbRadius);void 0!==e&&this._currentCursorPosition.copy(e);const t=this._startCursorPosition.distanceTo(this._currentCursorPosition),n=this._startCursorPosition.angleTo(this._currentCursorPosition),r=Math.max(t/this._tbRadius,n);this.applyTransformMatrix(this.rotate(this.calculateRotationAxis(this._startCursorPosition,this._currentCursorPosition),r)),this.enableAnimations&&(this._timePrev=this._timeCurrent,this._timeCurrent=performance.now(),this._anglePrev=this._angleCurrent,this._angleCurrent=r,this._cursorPosPrev.copy(this._cursorPosCurr),this._cursorPosCurr.copy(this._currentCursorPosition),this._wPrev=this._wCurr,this._wCurr=this.calculateAngularSpeed(this._anglePrev,this._angleCurrent,this._timePrev,this._timeCurrent))}break;case Fl.SCALE:if(this.enableZoom)if(n)this.dispatchEvent(Vl),this.dispatchEvent(Nl),this.updateTbState(t,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(Ll.x,Ll.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{const e=8;this._currentCursorPosition.setY(.5*this.getCursorNDC(Ll.x,Ll.y,this.domElement).y);const t=this._currentCursorPosition.y-this._startCursorPosition.y;let n=1;t<0?n=1/Math.pow(this.scaleFactor,-t*e):t>0&&(n=Math.pow(this.scaleFactor,t*e)),this.applyTransformMatrix(this.applyScale(n,this._gizmos.position))}break;case Fl.FOV:if(this.enableZoom&&this.camera instanceof s.PerspectiveCamera)if(n)this.dispatchEvent(Vl),this.dispatchEvent(Nl),this.updateTbState(t,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(Ll.x,Ll.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{const e=8;this._currentCursorPosition.setY(.5*this.getCursorNDC(Ll.x,Ll.y,this.domElement).y);const t=this._currentCursorPosition.y-this._startCursorPosition.y;let n=1;t<0?n=1/Math.pow(this.scaleFactor,-t*e):t>0&&(n=Math.pow(this.scaleFactor,t*e)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const r=this._v3_1.distanceTo(this._gizmos.position);let i=r/n;i=s.MathUtils.clamp(i,this.minDistance,this.maxDistance);const o=r*Math.tan(s.MathUtils.DEG2RAD*this._fovState*.5);let a=s.MathUtils.RAD2DEG*(2*Math.atan(o/i));a=s.MathUtils.clamp(a,this.minFov,this.maxFov);const c=o/Math.tan(s.MathUtils.DEG2RAD*(a/2));n=r/c,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(a),this.applyTransformMatrix(this.applyScale(n,this._v3_2,!1));const l=this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(c/r);this._m4_1.makeTranslation(l.x,l.y,l.z)}}this.dispatchEvent(Ul)}})),Rl(this,"onSinglePanEnd",(()=>{if(this._state==Fl.ROTATE){if(!this.enableRotate)return;if(this.enableAnimations){if(performance.now()-this._timeCurrent<120){const e=Math.abs((this._wPrev+this._wCurr)/2),t=this;this._animationId=window.requestAnimationFrame((function(n){t.updateTbState(Fl.ANIMATION_ROTATE,!0);const r=t.calculateRotationAxis(t._cursorPosPrev,t._cursorPosCurr);t.onRotationAnim(n,r,Math.min(e,t.wMax))}))}else this.updateTbState(Fl.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Ul)}else this.updateTbState(Fl.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Ul)}else this._state!=Fl.PAN&&this._state!=Fl.IDLE||(this.updateTbState(Fl.IDLE,!1),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1),this.dispatchEvent(Ul));this.dispatchEvent(Vl)})),Rl(this,"onDoubleTap",(e=>{if(this.enabled&&this.enablePan&&this.scene&&this.camera&&this.domElement){this.dispatchEvent(Nl),this.setCenter(e.clientX,e.clientY);const t=this.unprojectOnObj(this.getCursorNDC(Ll.x,Ll.y,this.domElement),this.camera);if(t&&this.enableAnimations){const e=this;-1!=this._animationId&&window.cancelAnimationFrame(this._animationId),this._timeStart=-1,this._animationId=window.requestAnimationFrame((function(n){e.updateTbState(Fl.ANIMATION_FOCUS,!0),e.onFocusAnim(n,t,e._cameraMatrixState,e._gizmoMatrixState)}))}else t&&!this.enableAnimations&&(this.updateTbState(Fl.FOCUS,!0),this.focus(t,this.scaleFactor),this.updateTbState(Fl.IDLE,!1),this.dispatchEvent(Ul))}this.dispatchEvent(Vl)})),Rl(this,"onDoublePanStart",(()=>{if(this.enabled&&this.enablePan&&this.camera&&this.domElement){this.dispatchEvent(Nl),this.updateTbState(Fl.PAN,!0),this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);const e=this.unprojectOnTbPlane(this.camera,Ll.x,Ll.y,this.domElement,!0);void 0!==e&&this._startCursorPosition.copy(e),this._currentCursorPosition.copy(this._startCursorPosition),this.activateGizmos(!1)}})),Rl(this,"onDoublePanMove",(()=>{if(this.enabled&&this.enablePan&&this.camera&&this.domElement){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=Fl.PAN&&(this.updateTbState(Fl.PAN,!0),this._startCursorPosition.copy(this._currentCursorPosition));const e=this.unprojectOnTbPlane(this.camera,Ll.x,Ll.y,this.domElement,!0);void 0!==e&&this._currentCursorPosition.copy(e),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition,!0)),this.dispatchEvent(Ul)}})),Rl(this,"onDoublePanEnd",(()=>{this.updateTbState(Fl.IDLE,!1),this.dispatchEvent(Vl)})),Rl(this,"onRotateStart",(()=>{var e;this.enabled&&this.enableRotate&&(this.dispatchEvent(Nl),this.updateTbState(Fl.ZROTATE,!0),this._startFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this._currentFingerRotation=this._startFingerRotation,null==(e=this.camera)||e.getWorldDirection(this._rotationAxis),this.enablePan||this.enableZoom||this.activateGizmos(!0))})),Rl(this,"onRotateMove",(()=>{var e;if(this.enabled&&this.enableRotate&&this.camera&&this.domElement){let t;this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=Fl.ZROTATE&&(this.updateTbState(Fl.ZROTATE,!0),this._startFingerRotation=this._currentFingerRotation),this._currentFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this.enablePan?this.camera&&(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),t=null==(e=this.unprojectOnTbPlane(this.camera,Ll.x,Ll.y,this.domElement))?void 0:e.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._v3_2)):t=(new s.Vector3).setFromMatrixPosition(this._gizmoMatrixState);const n=s.MathUtils.DEG2RAD*(this._startFingerRotation-this._currentFingerRotation);void 0!==t&&this.applyTransformMatrix(this.zRotate(t,n)),this.dispatchEvent(Ul)}})),Rl(this,"onRotateEnd",(()=>{this.updateTbState(Fl.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Vl)})),Rl(this,"onPinchStart",(()=>{this.enabled&&this.enableZoom&&(this.dispatchEvent(Nl),this.updateTbState(Fl.SCALE,!0),this._startFingerDistance=this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),this._currentFingerDistance=this._startFingerDistance,this.activateGizmos(!1))})),Rl(this,"onPinchMove",(()=>{var e,t;if(this.enabled&&this.enableZoom&&this.domElement){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);const n=12;this._state!=Fl.SCALE&&(this._startFingerDistance=this._currentFingerDistance,this.updateTbState(Fl.SCALE,!0)),this._currentFingerDistance=Math.max(this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),n*this._devPxRatio);const r=this._currentFingerDistance/this._startFingerDistance;let i;this.enablePan?this.camera instanceof s.OrthographicCamera?i=null==(e=this.unprojectOnTbPlane(this.camera,Ll.x,Ll.y,this.domElement))?void 0:e.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position):this.camera instanceof s.PerspectiveCamera&&(i=null==(t=this.unprojectOnTbPlane(this.camera,Ll.x,Ll.y,this.domElement))?void 0:t.applyQuaternion(this.camera.quaternion).add(this._gizmos.position)):i=this._gizmos.position,void 0!==i&&this.applyTransformMatrix(this.applyScale(r,i)),this.dispatchEvent(Ul)}})),Rl(this,"onPinchEnd",(()=>{this.updateTbState(Fl.IDLE,!1),this.dispatchEvent(Vl)})),Rl(this,"onTriplePanStart",(()=>{if(this.enabled&&this.enableZoom&&this.domElement){this.dispatchEvent(Nl),this.updateTbState(Fl.SCALE,!0);let e=0,t=0;const n=this._touchCurrent.length;for(let r=0;r<n;r++)e+=this._touchCurrent[r].clientX,t+=this._touchCurrent[r].clientY;this.setCenter(e/n,t/n),this._startCursorPosition.setY(.5*this.getCursorNDC(Ll.x,Ll.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition)}})),Rl(this,"onTriplePanMove",(()=>{if(this.enabled&&this.enableZoom&&this.camera&&this.domElement){let e=0,t=0;const n=this._touchCurrent.length;for(let s=0;s<n;s++)e+=this._touchCurrent[s].clientX,t+=this._touchCurrent[s].clientY;this.setCenter(e/n,t/n);const r=8;this._currentCursorPosition.setY(.5*this.getCursorNDC(Ll.x,Ll.y,this.domElement).y);const i=this._currentCursorPosition.y-this._startCursorPosition.y;let o=1;i<0?o=1/Math.pow(this.scaleFactor,-i*r):i>0&&(o=Math.pow(this.scaleFactor,i*r)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const a=this._v3_1.distanceTo(this._gizmos.position);let c=a/o;c=s.MathUtils.clamp(c,this.minDistance,this.maxDistance);const l=a*Math.tan(s.MathUtils.DEG2RAD*this._fovState*.5);let u=s.MathUtils.RAD2DEG*(2*Math.atan(l/c));u=s.MathUtils.clamp(u,this.minFov,this.maxFov);const h=l/Math.tan(s.MathUtils.DEG2RAD*(u/2));o=a/h,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(u),this.applyTransformMatrix(this.applyScale(o,this._v3_2,!1));const d=this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(h/a);this._m4_1.makeTranslation(d.x,d.y,d.z),this.dispatchEvent(Ul)}})),Rl(this,"onTriplePanEnd",(()=>{this.updateTbState(Fl.IDLE,!1),this.dispatchEvent(Vl)})),Rl(this,"setCenter",((e,t)=>{Ll.x=e,Ll.y=t})),Rl(this,"initializeMouseActions",(()=>{this.setMouseAction("PAN",0,"CTRL"),this.setMouseAction("PAN",2),this.setMouseAction("ROTATE",0),this.setMouseAction("ZOOM","WHEEL"),this.setMouseAction("ZOOM",1),this.setMouseAction("FOV","WHEEL","SHIFT"),this.setMouseAction("FOV",1,"SHIFT")})),Rl(this,"setMouseAction",((e,t,n=null)=>{let r;if(!["PAN","ROTATE","ZOOM","FOV"].includes(e)||![0,1,2,"WHEEL"].includes(t)||!["CTRL","SHIFT",null].includes(n))return!1;if("WHEEL"==t&&"ZOOM"!=e&&"FOV"!=e)return!1;switch(e){case"PAN":r=Fl.PAN;break;case"ROTATE":r=Fl.ROTATE;break;case"ZOOM":r=Fl.SCALE;break;case"FOV":r=Fl.FOV}const i={operation:e,mouse:t,key:n,state:r};for(let o=0;o<this.mouseActions.length;o++)if(this.mouseActions[o].mouse==i.mouse&&this.mouseActions[o].key==i.key)return this.mouseActions.splice(o,1,i),!0;return this.mouseActions.push(i),!0})),Rl(this,"getOpFromAction",((e,t)=>{let n;for(let r=0;r<this.mouseActions.length;r++)if(n=this.mouseActions[r],n.mouse==e&&n.key==t)return n.operation;if(t)for(let r=0;r<this.mouseActions.length;r++)if(n=this.mouseActions[r],n.mouse==e&&null==n.key)return n.operation;return null})),Rl(this,"getOpStateFromAction",((e,t)=>{let n;for(let r=0;r<this.mouseActions.length;r++)if(n=this.mouseActions[r],n.mouse==e&&n.key==t)return n.state;if(t)for(let r=0;r<this.mouseActions.length;r++)if(n=this.mouseActions[r],n.mouse==e&&null==n.key)return n.state;return null})),Rl(this,"getAngle",((e,t)=>180*Math.atan2(t.clientY-e.clientY,t.clientX-e.clientX)/Math.PI)),Rl(this,"updateTouchEvent",(e=>{for(let t=0;t<this._touchCurrent.length;t++)if(this._touchCurrent[t].pointerId==e.pointerId){this._touchCurrent.splice(t,1,e);break}})),Rl(this,"calculateAngularSpeed",((e,t,n,r)=>{const i=(r-n)/1e3;return 0==i?0:(t-e)/i})),Rl(this,"calculatePointersDistance",((e,t)=>Math.sqrt(Math.pow(t.clientX-e.clientX,2)+Math.pow(t.clientY-e.clientY,2)))),Rl(this,"calculateRotationAxis",((e,t)=>(this._rotationMatrix.extractRotation(this._cameraMatrixState),this._quat.setFromRotationMatrix(this._rotationMatrix),this._rotationAxis.crossVectors(e,t).applyQuaternion(this._quat),this._rotationAxis.normalize().clone()))),Rl(this,"calculateTbRadius",(e=>{const t=e.position.distanceTo(this._gizmos.position);if(e instanceof s.PerspectiveCamera){const n=s.MathUtils.DEG2RAD*e.fov*.5,r=Math.atan(e.aspect*Math.tan(n));return Math.tan(Math.min(n,r))*t*.67}if(e instanceof s.OrthographicCamera)return.67*Math.min(e.top,e.right)})),Rl(this,"focus",((e,t,n=1)=>{if(this.camera){const r=e.clone();r.sub(this._gizmos.position).multiplyScalar(n),this._translationMatrix.makeTranslation(r.x,r.y,r.z);const i=this._gizmoMatrixState.clone();this._gizmoMatrixState.premultiply(this._translationMatrix),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale);const o=this._cameraMatrixState.clone();this._cameraMatrixState.premultiply(this._translationMatrix),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.enableZoom&&this.applyTransformMatrix(this.applyScale(t,this._gizmos.position)),this._gizmoMatrixState.copy(i),this._cameraMatrixState.copy(o)}})),Rl(this,"drawGrid",(()=>{if(this.scene){const e=8947848,t=3;let n,r,i,o;if(this.camera instanceof s.OrthographicCamera){const e=this.camera.right-this.camera.left,s=this.camera.bottom-this.camera.top;i=Math.max(e,s),o=i/20,n=i/this.camera.zoom*t,r=n/o*this.camera.zoom}else if(this.camera instanceof s.PerspectiveCamera){const e=this.camera.position.distanceTo(this._gizmos.position),a=s.MathUtils.DEG2RAD*this.camera.fov*.5,c=Math.atan(this.camera.aspect*Math.tan(a));i=Math.tan(Math.max(a,c))*e*2,o=i/20,n=i*t,r=n/o}null==this._grid&&this.camera&&(this._grid=new s.GridHelper(n,r,e,e),this._grid.position.copy(this._gizmos.position),this._gridPosition.copy(this._grid.position),this._grid.quaternion.copy(this.camera.quaternion),this._grid.rotateX(.5*Math.PI),this.scene.add(this._grid))}})),Rl(this,"connect",(e=>{e===document&&console.error('THREE.ArcballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=e,this.domElement.style.touchAction="none",this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onWheel)})),Rl(this,"dispose",(()=>{var e,t,n,r,i;-1!=this._animationId&&window.cancelAnimationFrame(this._animationId),null==(e=this.domElement)||e.removeEventListener("pointerdown",this.onPointerDown),null==(t=this.domElement)||t.removeEventListener("pointercancel",this.onPointerCancel),null==(n=this.domElement)||n.removeEventListener("wheel",this.onWheel),null==(r=this.domElement)||r.removeEventListener("contextmenu",this.onContextMenu),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("resize",this.onWindowResize),null==(i=this.scene)||i.remove(this._gizmos),this.disposeGrid()})),Rl(this,"disposeGrid",(()=>{this._grid&&this.scene&&(this.scene.remove(this._grid),this._grid=null)})),Rl(this,"easeOutCubic",(e=>1-Math.pow(1-e,3))),Rl(this,"activateGizmos",(e=>{for(const t of this._gizmos.children)t.material.setValues({opacity:e?1:.6})})),Rl(this,"getCursorNDC",((e,t,n)=>{const r=n.getBoundingClientRect();return this._v2_1.setX((e-r.left)/r.width*2-1),this._v2_1.setY((r.bottom-t)/r.height*2-1),this._v2_1.clone()})),Rl(this,"getCursorPosition",((e,t,n)=>(this._v2_1.copy(this.getCursorNDC(e,t,n)),this.camera instanceof s.OrthographicCamera&&(this._v2_1.x*=.5*(this.camera.right-this.camera.left),this._v2_1.y*=.5*(this.camera.top-this.camera.bottom)),this._v2_1.clone()))),Rl(this,"setCamera",(e=>{if(e){e.lookAt(this.target),e.updateMatrix(),e instanceof s.PerspectiveCamera&&(this._fov0=e.fov,this._fovState=e.fov),this._cameraMatrixState0.copy(e.matrix),this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraProjectionState.copy(e.projectionMatrix),this._zoom0=e.zoom,this._zoomState=this._zoom0,this._initialNear=e.near,this._nearPos0=e.position.distanceTo(this.target)-e.near,this._nearPos=this._initialNear,this._initialFar=e.far,this._farPos0=e.position.distanceTo(this.target)-e.far,this._farPos=this._initialFar,this._up0.copy(e.up),this._upState.copy(e.up),this.camera=e,this.camera.updateProjectionMatrix();const t=this.calculateTbRadius(e);void 0!==t&&(this._tbRadius=t),this.makeGizmos(this.target,this._tbRadius)}})),Rl(this,"makeGizmos",((e,t)=>{const n=new s.EllipseCurve(0,0,t,t).getPoints(this._curvePts),r=(new s.BufferGeometry).setFromPoints(n),i=new s.LineBasicMaterial({color:16744576,fog:!1,transparent:!0,opacity:.6}),o=new s.LineBasicMaterial({color:8454016,fog:!1,transparent:!0,opacity:.6}),a=new s.LineBasicMaterial({color:8421631,fog:!1,transparent:!0,opacity:.6}),c=new s.Line(r,i),l=new s.Line(r,o),u=new s.Line(r,a),h=.5*Math.PI;if(c.rotation.x=h,l.rotation.y=h,this._gizmoMatrixState0.identity().setPosition(e),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this.camera&&1!=this.camera.zoom){const t=1/this.camera.zoom;this._scaleMatrix.makeScale(t,t,t),this._translationMatrix.makeTranslation(-e.x,-e.y,-e.z),this._gizmoMatrixState.premultiply(this._translationMatrix).premultiply(this._scaleMatrix),this._translationMatrix.makeTranslation(e.x,e.y,e.z),this._gizmoMatrixState.premultiply(this._translationMatrix)}this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.clear(),this._gizmos.add(c),this._gizmos.add(l),this._gizmos.add(u)})),Rl(this,"onFocusAnim",((e,t,n,r)=>{if(-1==this._timeStart&&(this._timeStart=e),this._state==Fl.ANIMATION_FOCUS){const i=(e-this._timeStart)/this.focusAnimationTime;if(this._gizmoMatrixState.copy(r),i>=1)this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(t,this.scaleFactor),this._timeStart=-1,this.updateTbState(Fl.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Ul);else{const e=this.easeOutCubic(i),o=1-e+this.scaleFactor*e;this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(t,o,e),this.dispatchEvent(Ul);const s=this;this._animationId=window.requestAnimationFrame((function(e){s.onFocusAnim(e,t,n,r.clone())}))}}else this._animationId=-1,this._timeStart=-1})),Rl(this,"onRotationAnim",((e,t,n)=>{if(-1==this._timeStart&&(this._anglePrev=0,this._angleCurrent=0,this._timeStart=e),this._state==Fl.ANIMATION_ROTATE){const r=(e-this._timeStart)/1e3;if(n+-this.dampingFactor*r>0){this._angleCurrent=.5*-this.dampingFactor*Math.pow(r,2)+n*r+0,this.applyTransformMatrix(this.rotate(t,this._angleCurrent)),this.dispatchEvent(Ul);const e=this;this._animationId=window.requestAnimationFrame((function(r){e.onRotationAnim(r,t,n)}))}else this._animationId=-1,this._timeStart=-1,this.updateTbState(Fl.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Ul)}else this._animationId=-1,this._timeStart=-1,this._state!=Fl.ROTATE&&(this.activateGizmos(!1),this.dispatchEvent(Ul))})),Rl(this,"pan",((e,t,n=!1)=>{if(this.camera){const r=e.clone().sub(t);if(this.camera instanceof s.OrthographicCamera&&r.multiplyScalar(1/this.camera.zoom),this.camera instanceof s.PerspectiveCamera&&n){this._v3_1.setFromMatrixPosition(this._cameraMatrixState0),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0);const e=this._v3_1.distanceTo(this._v3_2)/this.camera.position.distanceTo(this._gizmos.position);r.multiplyScalar(1/e)}this._v3_1.set(r.x,r.y,0).applyQuaternion(this.camera.quaternion),this._m4_1.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z),this.setTransformationMatrices(this._m4_1,this._m4_1)}return Ol})),Rl(this,"reset",(()=>{if(this.camera){this.camera.zoom=this._zoom0,this.camera instanceof s.PerspectiveCamera&&(this.camera.fov=this._fov0),this.camera.near=this._nearPos,this.camera.far=this._farPos,this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(this._up0),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this._gizmoMatrixState0.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix();const e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e),this.makeGizmos(this._gizmos.position,this._tbRadius),this.camera.lookAt(this._gizmos.position),this.updateTbState(Fl.IDLE,!1),this.dispatchEvent(Ul)}})),Rl(this,"rotate",((e,t)=>{const n=this._gizmos.position;return this._translationMatrix.makeTranslation(-n.x,-n.y,-n.z),this._rotationMatrix.makeRotationAxis(e,-t),this._m4_1.makeTranslation(n.x,n.y,n.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1),Ol})),Rl(this,"copyState",(()=>{if(this.camera){const e=JSON.stringify(this.camera instanceof s.OrthographicCamera?{arcballState:{cameraFar:this.camera.far,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}}:{arcballState:{cameraFar:this.camera.far,cameraFov:this.camera.fov,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}});navigator.clipboard.writeText(e)}})),Rl(this,"pasteState",(()=>{const e=this;navigator.clipboard.readText().then((function(t){e.setStateFromJSON(t)}))})),Rl(this,"saveState",(()=>{this.camera&&(this._cameraMatrixState0.copy(this.camera.matrix),this._gizmoMatrixState0.copy(this._gizmos.matrix),this._nearPos=this.camera.near,this._farPos=this.camera.far,this._zoom0=this.camera.zoom,this._up0.copy(this.camera.up),this.camera instanceof s.PerspectiveCamera&&(this._fov0=this.camera.fov))})),Rl(this,"applyScale",((e,t,n=!0)=>{if(!this.camera)return;const r=t.clone();let i=1/e;if(this.camera instanceof s.OrthographicCamera){this.camera.zoom=this._zoomState,this.camera.zoom*=e,this.camera.zoom>this.maxZoom?(this.camera.zoom=this.maxZoom,i=this._zoomState/this.maxZoom):this.camera.zoom<this.minZoom&&(this.camera.zoom=this.minZoom,i=this._zoomState/this.minZoom),this.camera.updateProjectionMatrix(),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState),this._scaleMatrix.makeScale(i,i,i),this._translationMatrix.makeTranslation(-this._v3_1.x,-this._v3_1.y,-this._v3_1.z),this._m4_2.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z).multiply(this._scaleMatrix),this._m4_2.multiply(this._translationMatrix),r.sub(this._v3_1);const t=r.clone().multiplyScalar(i);return r.sub(t),this._m4_1.makeTranslation(r.x,r.y,r.z),this._m4_2.premultiply(this._m4_1),this.setTransformationMatrices(this._m4_1,this._m4_2),Ol}if(this.camera instanceof s.PerspectiveCamera){this._v3_1.setFromMatrixPosition(this._cameraMatrixState),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);let e=this._v3_1.distanceTo(r),t=e-e*i;const o=e-t;o<this.minDistance?(i=this.minDistance/e,t=e-e*i):o>this.maxDistance&&(i=this.maxDistance/e,t=e-e*i);let s=r.clone().sub(this._v3_1).normalize().multiplyScalar(t);if(this._m4_1.makeTranslation(s.x,s.y,s.z),n){const n=this._v3_2;e=n.distanceTo(r),t=e-e*i,s=r.clone().sub(this._v3_2).normalize().multiplyScalar(t),this._translationMatrix.makeTranslation(n.x,n.y,n.z),this._scaleMatrix.makeScale(i,i,i),this._m4_2.makeTranslation(s.x,s.y,s.z).multiply(this._translationMatrix),this._m4_2.multiply(this._scaleMatrix),this._translationMatrix.makeTranslation(-n.x,-n.y,-n.z),this._m4_2.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1,this._m4_2)}else this.setTransformationMatrices(this._m4_1);return Ol}})),Rl(this,"setFov",(e=>{this.camera instanceof s.PerspectiveCamera&&(this.camera.fov=s.MathUtils.clamp(e,this.minFov,this.maxFov),this.camera.updateProjectionMatrix())})),Rl(this,"setTarget",((e,t,n)=>{if(this.camera){this.target.set(e,t,n),this._gizmos.position.set(e,t,n);const r=this.calculateTbRadius(this.camera);void 0!==r&&(this._tbRadius=r),this.makeGizmos(this.target,this._tbRadius),this.camera.lookAt(this.target)}})),Rl(this,"zRotate",((e,t)=>(this._rotationMatrix.makeRotationAxis(this._rotationAxis,t),this._translationMatrix.makeTranslation(-e.x,-e.y,-e.z),this._m4_1.makeTranslation(e.x,e.y,e.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState).sub(e),this._v3_2.copy(this._v3_1).applyAxisAngle(this._rotationAxis,t),this._v3_2.sub(this._v3_1),this._m4_2.makeTranslation(this._v3_2.x,this._v3_2.y,this._v3_2.z),this.setTransformationMatrices(this._m4_1,this._m4_2),Ol))),Rl(this,"unprojectOnObj",((e,t)=>{if(!this.scene)return null;const n=new s.Raycaster;n.near=t.near,n.far=t.far,n.setFromCamera(e,t);const r=n.intersectObjects(this.scene.children,!0);for(let i=0;i<r.length;i++)if(r[i].object.uuid!=this._gizmos.uuid&&r[i].face)return r[i].point.clone();return null})),Rl(this,"unprojectOnTbSurface",((e,t,n,r,i)=>{if(e instanceof s.OrthographicCamera){this._v2_1.copy(this.getCursorPosition(t,n,r)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0);const e=Math.pow(this._v2_1.x,2),i=Math.pow(this._v2_1.y,2),o=Math.pow(this._tbRadius,2);return e+i<=.5*o?this._v3_1.setZ(Math.sqrt(o-(e+i))):this._v3_1.setZ(.5*o/Math.sqrt(e+i)),this._v3_1}if(e instanceof s.PerspectiveCamera){this._v2_1.copy(this.getCursorNDC(t,n,r)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(e.projectionMatrixInverse);const o=this._v3_1.clone().normalize(),a=e.position.distanceTo(this._gizmos.position),c=Math.pow(i,2),l=this._v3_1.z,u=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));if(0==u)return o.set(this._v3_1.x,this._v3_1.y,i),o;const h=l/u,d=a;let A=Math.pow(h,2)+1,m=2*h*d,p=Math.pow(d,2)-c,f=Math.pow(m,2)-4*A*p;if(f>=0){this._v2_1.setX((-m-Math.sqrt(f))/(2*A)),this._v2_1.setY(h*this._v2_1.x+d);if(s.MathUtils.RAD2DEG*this._v2_1.angle()>=45){const e=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(a-this._v2_1.y,2));return o.multiplyScalar(e),o.z+=a,o}}A=h,m=d,p=.5*-c,f=Math.pow(m,2)-4*A*p,this._v2_1.setX((-m-Math.sqrt(f))/(2*A)),this._v2_1.setY(h*this._v2_1.x+d);const g=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(a-this._v2_1.y,2));return o.multiplyScalar(g),o.z+=a,o}})),Rl(this,"unprojectOnTbPlane",((e,t,n,r,i=!1)=>{if(e instanceof s.OrthographicCamera)return this._v2_1.copy(this.getCursorPosition(t,n,r)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0),this._v3_1.clone();if(e instanceof s.PerspectiveCamera){this._v2_1.copy(this.getCursorNDC(t,n,r)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(e.projectionMatrixInverse);const o=this._v3_1.clone().normalize(),s=this._v3_1.z,a=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));let c;if(c=i?this._v3_1.setFromMatrixPosition(this._cameraMatrixState0).distanceTo(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0)):e.position.distanceTo(this._gizmos.position),0==a)return o.set(0,0,0),o;const l=c,u=-l/(s/a),h=Math.sqrt(Math.pow(l,2)+Math.pow(u,2));return o.multiplyScalar(h),o.z=0,o}})),Rl(this,"updateMatrixState",(()=>{this.camera&&(this._cameraMatrixState.copy(this.camera.matrix),this._gizmoMatrixState.copy(this._gizmos.matrix),this.camera instanceof s.OrthographicCamera&&(this._cameraProjectionState.copy(this.camera.projectionMatrix),this.camera.updateProjectionMatrix(),this._zoomState=this.camera.zoom),this.camera instanceof s.PerspectiveCamera&&(this._fovState=this.camera.fov))})),Rl(this,"updateTbState",((e,t)=>{this._state=e,t&&this.updateMatrixState()})),Rl(this,"update",(()=>{const e=1e-6;if(!this.target.equals(this._currentTarget)&&this.camera){this._gizmos.position.set(this.target.x,this.target.y,this.target.z);const e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e),this.makeGizmos(this.target,this._tbRadius),this._currentTarget.copy(this.target)}if(this.camera){if(this.camera instanceof s.OrthographicCamera&&(this.camera.zoom>this.maxZoom||this.camera.zoom<this.minZoom)){const e=s.MathUtils.clamp(this.camera.zoom,this.minZoom,this.maxZoom);this.applyTransformMatrix(this.applyScale(e/this.camera.zoom,this._gizmos.position,!0))}if(this.camera instanceof s.PerspectiveCamera){const t=this.camera.position.distanceTo(this._gizmos.position);if(t>this.maxDistance+e||t<this.minDistance-e){const e=s.MathUtils.clamp(t,this.minDistance,this.maxDistance);this.applyTransformMatrix(this.applyScale(e/t,this._gizmos.position)),this.updateMatrixState()}(this.camera.fov<this.minFov||this.camera.fov>this.maxFov)&&(this.camera.fov=s.MathUtils.clamp(this.camera.fov,this.minFov,this.maxFov),this.camera.updateProjectionMatrix());const n=this._tbRadius,r=this.calculateTbRadius(this.camera);if(void 0!==r&&(this._tbRadius=r),n<this._tbRadius-e||n>this._tbRadius+e){const e=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3,t=this._tbRadius/e,n=new s.EllipseCurve(0,0,t,t).getPoints(this._curvePts),r=(new s.BufferGeometry).setFromPoints(n);for(const i in this._gizmos.children){this._gizmos.children[i].geometry=r}}}this.camera.lookAt(this._gizmos.position)}})),Rl(this,"setStateFromJSON",(e=>{const t=JSON.parse(e);if(t.arcballState&&this.camera){this._cameraMatrixState.fromArray(t.arcballState.cameraMatrix.elements),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(t.arcballState.cameraUp),this.camera.near=t.arcballState.cameraNear,this.camera.far=t.arcballState.cameraFar,this.camera.zoom=t.arcballState.cameraZoom,this.camera instanceof s.PerspectiveCamera&&(this.camera.fov=t.arcballState.cameraFov),this._gizmoMatrixState.fromArray(t.arcballState.gizmoMatrix.elements),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmos.updateMatrix();const e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e);const n=(new s.Matrix4).copy(this._gizmoMatrixState0);this.makeGizmos(this._gizmos.position,this._tbRadius),this._gizmoMatrixState0.copy(n),this.camera.lookAt(this._gizmos.position),this.updateTbState(Fl.IDLE,!1),this.dispatchEvent(Ul)}})),this.camera=null,this.domElement=t,this.scene=n,this.mouseActions=[],this._mouseOp=null,this._v2_1=new s.Vector2,this._v3_1=new s.Vector3,this._v3_2=new s.Vector3,this._m4_1=new s.Matrix4,this._m4_2=new s.Matrix4,this._quat=new s.Quaternion,this._translationMatrix=new s.Matrix4,this._rotationMatrix=new s.Matrix4,this._scaleMatrix=new s.Matrix4,this._rotationAxis=new s.Vector3,this._cameraMatrixState=new s.Matrix4,this._cameraProjectionState=new s.Matrix4,this._fovState=1,this._upState=new s.Vector3,this._zoomState=1,this._nearPos=0,this._farPos=0,this._gizmoMatrixState=new s.Matrix4,this._up0=new s.Vector3,this._zoom0=1,this._fov0=0,this._initialNear=0,this._nearPos0=0,this._initialFar=0,this._farPos0=0,this._cameraMatrixState0=new s.Matrix4,this._gizmoMatrixState0=new s.Matrix4,this._button=-1,this._touchStart=[],this._touchCurrent=[],this._input=kl.NONE,this._switchSensibility=32,this._startFingerDistance=0,this._currentFingerDistance=0,this._startFingerRotation=0,this._currentFingerRotation=0,this._devPxRatio=0,this._downValid=!0,this._nclicks=0,this._downEvents=[],this._clickStart=0,this._maxDownTime=250,this._maxInterval=300,this._posThreshold=24,this._movementThreshold=24,this._currentCursorPosition=new s.Vector3,this._startCursorPosition=new s.Vector3,this._grid=null,this._gridPosition=new s.Vector3,this._gizmos=new s.Group,this._curvePts=128,this._timeStart=-1,this._animationId=-1,this.focusAnimationTime=500,this._timePrev=0,this._timeCurrent=0,this._anglePrev=0,this._angleCurrent=0,this._cursorPosPrev=new s.Vector3,this._cursorPosCurr=new s.Vector3,this._wPrev=0,this._wCurr=0,this.adjustNearFar=!1,this.scaleFactor=1.1,this.dampingFactor=25,this.wMax=20,this.enableAnimations=!0,this.enableGrid=!1,this.cursorZoom=!1,this.minFov=5,this.maxFov=90,this.enabled=!0,this.enablePan=!0,this.enableRotate=!0,this.enableZoom=!0,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.target=new s.Vector3(0,0,0),this._currentTarget=new s.Vector3(0,0,0),this._tbRadius=1,this._state=Fl.IDLE,this.setCamera(e),this.scene&&this.scene.add(this._gizmos),this._devPxRatio=window.devicePixelRatio,this.initializeMouseActions(),this.domElement&&this.connect(this.domElement),window.addEventListener("resize",this.onWindowResize)}applyTransformMatrix(e){if((null==e?void 0:e.camera)&&this.camera&&(this._m4_1.copy(this._cameraMatrixState).premultiply(e.camera),this._m4_1.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.updateMatrix(),this._state!=Fl.ROTATE&&this._state!=Fl.ZROTATE&&this._state!=Fl.ANIMATION_ROTATE||this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion)),(null==e?void 0:e.gizmos)&&(this._m4_1.copy(this._gizmoMatrixState).premultiply(e.gizmos),this._m4_1.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix()),(this._state==Fl.SCALE||this._state==Fl.FOCUS||this._state==Fl.ANIMATION_FOCUS)&&this.camera){const e=this.calculateTbRadius(this.camera);if(void 0!==e&&(this._tbRadius=e),this.adjustNearFar){const e=this.camera.position.distanceTo(this._gizmos.position),t=new s.Box3;t.setFromObject(this._gizmos);const n=new s.Sphere;t.getBoundingSphere(n);const r=Math.max(this._nearPos0,n.radius+n.center.length()),i=e-this._initialNear,o=Math.min(r,i);this.camera.near=e-o;const a=Math.min(this._farPos0,-n.radius+n.center.length()),c=e-this._initialFar,l=Math.min(a,c);this.camera.far=e-l,this.camera.updateProjectionMatrix()}else{let e=!1;this.camera.near!=this._initialNear&&(this.camera.near=this._initialNear,e=!0),this.camera.far!=this._initialFar&&(this.camera.far=this._initialFar,e=!0),e&&this.camera.updateProjectionMatrix()}}}setGizmosVisible(e){this._gizmos.visible=e,this.dispatchEvent(Ul)}setTransformationMatrices(e=null,t=null){e?Ol.camera?Ol.camera.copy(e):Ol.camera=e.clone():Ol.camera=null,t?Ol.gizmos?Ol.gizmos.copy(t):Ol.gizmos=t.clone():Ol.gizmos=null}}const jl=(0,i.forwardRef)((({camera:e,makeDefault:t,regress:n,domElement:o,onChange:s,onStart:c,onEnd:l,...u},h)=>{const d=(0,a.D)((e=>e.invalidate)),A=(0,a.D)((e=>e.camera)),m=(0,a.D)((e=>e.gl)),p=(0,a.D)((e=>e.events)),f=(0,a.D)((e=>e.set)),g=(0,a.D)((e=>e.get)),y=(0,a.D)((e=>e.performance)),v=e||A,x=o||p.connected||m.domElement,E=(0,i.useMemo)((()=>new Gl(v)),[v]);return(0,a.F)((()=>{E.enabled&&E.update()}),-1),(0,i.useEffect)((()=>(E.connect(x),()=>{E.dispose()})),[x,n,E,d]),(0,i.useEffect)((()=>{const e=e=>{d(),n&&y.regress(),s&&s(e)};return E.addEventListener("change",e),c&&E.addEventListener("start",c),l&&E.addEventListener("end",l),()=>{E.removeEventListener("change",e),c&&E.removeEventListener("start",c),l&&E.removeEventListener("end",l)}}),[s,c,l]),(0,i.useEffect)((()=>{if(t){const e=g().controls;return f({controls:E}),()=>f({controls:e})}}),[t,E]),i.createElement("primitive",(0,r.Z)({ref:h,object:E},u))}));var Hl=Object.defineProperty,ql=(e,t,n)=>(((e,t,n)=>{t in e?Hl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);class Wl extends s.Object3D{constructor(e,t){super(),ql(this,"isTransformControls",!0),ql(this,"visible",!1),ql(this,"domElement"),ql(this,"raycaster",new s.Raycaster),ql(this,"gizmo"),ql(this,"plane"),ql(this,"tempVector",new s.Vector3),ql(this,"tempVector2",new s.Vector3),ql(this,"tempQuaternion",new s.Quaternion),ql(this,"unit",{X:new s.Vector3(1,0,0),Y:new s.Vector3(0,1,0),Z:new s.Vector3(0,0,1)}),ql(this,"pointStart",new s.Vector3),ql(this,"pointEnd",new s.Vector3),ql(this,"offset",new s.Vector3),ql(this,"rotationAxis",new s.Vector3),ql(this,"startNorm",new s.Vector3),ql(this,"endNorm",new s.Vector3),ql(this,"rotationAngle",0),ql(this,"cameraPosition",new s.Vector3),ql(this,"cameraQuaternion",new s.Quaternion),ql(this,"cameraScale",new s.Vector3),ql(this,"parentPosition",new s.Vector3),ql(this,"parentQuaternion",new s.Quaternion),ql(this,"parentQuaternionInv",new s.Quaternion),ql(this,"parentScale",new s.Vector3),ql(this,"worldPositionStart",new s.Vector3),ql(this,"worldQuaternionStart",new s.Quaternion),ql(this,"worldScaleStart",new s.Vector3),ql(this,"worldPosition",new s.Vector3),ql(this,"worldQuaternion",new s.Quaternion),ql(this,"worldQuaternionInv",new s.Quaternion),ql(this,"worldScale",new s.Vector3),ql(this,"eye",new s.Vector3),ql(this,"positionStart",new s.Vector3),ql(this,"quaternionStart",new s.Quaternion),ql(this,"scaleStart",new s.Vector3),ql(this,"camera"),ql(this,"object"),ql(this,"enabled",!0),ql(this,"axis",null),ql(this,"mode","translate"),ql(this,"translationSnap",null),ql(this,"rotationSnap",null),ql(this,"scaleSnap",null),ql(this,"space","world"),ql(this,"size",1),ql(this,"dragging",!1),ql(this,"showX",!0),ql(this,"showY",!0),ql(this,"showZ",!0),ql(this,"changeEvent",{type:"change"}),ql(this,"mouseDownEvent",{type:"mouseDown",mode:this.mode}),ql(this,"mouseUpEvent",{type:"mouseUp",mode:this.mode}),ql(this,"objectChangeEvent",{type:"objectChange"}),ql(this,"intersectObjectWithRay",((e,t,n)=>{const r=t.intersectObject(e,!0);for(let i=0;i<r.length;i++)if(r[i].object.visible||n)return r[i];return!1})),ql(this,"attach",(e=>(this.object=e,this.visible=!0,this))),ql(this,"detach",(()=>(this.object=void 0,this.visible=!1,this.axis=null,this))),ql(this,"reset",(()=>this.enabled?(this.dragging&&void 0!==this.object&&(this.object.position.copy(this.positionStart),this.object.quaternion.copy(this.quaternionStart),this.object.scale.copy(this.scaleStart),this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent),this.pointStart.copy(this.pointEnd)),this):this)),ql(this,"updateMatrixWorld",(()=>{void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this.parentPosition,this.parentQuaternion,this.parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this.worldScale),this.parentQuaternionInv.copy(this.parentQuaternion).invert(),this.worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this.cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld()})),ql(this,"pointerHover",(e=>{if(void 0===this.object||!0===this.dragging)return;this.raycaster.setFromCamera(e,this.camera);const t=this.intersectObjectWithRay(this.gizmo.picker[this.mode],this.raycaster);this.axis=t?t.object.name:null})),ql(this,"pointerDown",(e=>{if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){this.raycaster.setFromCamera(e,this.camera);const t=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(t){let e=this.space;if("scale"===this.mode?e="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(e="world"),"local"===e&&"rotate"===this.mode){const e=this.rotationSnap;"X"===this.axis&&e&&(this.object.rotation.x=Math.round(this.object.rotation.x/e)*e),"Y"===this.axis&&e&&(this.object.rotation.y=Math.round(this.object.rotation.y/e)*e),"Z"===this.axis&&e&&(this.object.rotation.z=Math.round(this.object.rotation.z/e)*e)}this.object.updateMatrixWorld(),this.object.parent&&this.object.parent.updateMatrixWorld(),this.positionStart.copy(this.object.position),this.quaternionStart.copy(this.object.quaternion),this.scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this.worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)}this.dragging=!0,this.mouseDownEvent.mode=this.mode,this.dispatchEvent(this.mouseDownEvent)}})),ql(this,"pointerMove",(e=>{const t=this.axis,n=this.mode,r=this.object;let i=this.space;if("scale"===n?i="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(i="world"),void 0===r||null===t||!1===this.dragging||-1!==e.button)return;this.raycaster.setFromCamera(e,this.camera);const o=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),"translate"===n)this.offset.copy(this.pointEnd).sub(this.pointStart),"local"===i&&"XYZ"!==t&&this.offset.applyQuaternion(this.worldQuaternionInv),-1===t.indexOf("X")&&(this.offset.x=0),-1===t.indexOf("Y")&&(this.offset.y=0),-1===t.indexOf("Z")&&(this.offset.z=0),"local"===i&&"XYZ"!==t?this.offset.applyQuaternion(this.quaternionStart).divide(this.parentScale):this.offset.applyQuaternion(this.parentQuaternionInv).divide(this.parentScale),r.position.copy(this.offset).add(this.positionStart),this.translationSnap&&("local"===i&&(r.position.applyQuaternion(this.tempQuaternion.copy(this.quaternionStart).invert()),-1!==t.search("X")&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.position.applyQuaternion(this.quaternionStart)),"world"===i&&(r.parent&&r.position.add(this.tempVector.setFromMatrixPosition(r.parent.matrixWorld)),-1!==t.search("X")&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.parent&&r.position.sub(this.tempVector.setFromMatrixPosition(r.parent.matrixWorld))));else if("scale"===n){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(e*=-1),this.tempVector2.set(e,e,e)}else this.tempVector.copy(this.pointStart),this.tempVector2.copy(this.pointEnd),this.tempVector.applyQuaternion(this.worldQuaternionInv),this.tempVector2.applyQuaternion(this.worldQuaternionInv),this.tempVector2.divide(this.tempVector),-1===t.search("X")&&(this.tempVector2.x=1),-1===t.search("Y")&&(this.tempVector2.y=1),-1===t.search("Z")&&(this.tempVector2.z=1);r.scale.copy(this.scaleStart).multiply(this.tempVector2),this.scaleSnap&&this.object&&(-1!==t.search("X")&&(this.object.scale.x=Math.round(r.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(r.scale.y=Math.round(r.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(r.scale.z=Math.round(r.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===n){this.offset.copy(this.pointEnd).sub(this.pointStart);const e=20/this.worldPosition.distanceTo(this.tempVector.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this.startNorm.copy(this.pointStart).normalize(),this.endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this.endNorm.cross(this.startNorm).dot(this.eye)<0?1:-1):"XYZE"===t?(this.rotationAxis.copy(this.offset).cross(this.eye).normalize(),this.rotationAngle=this.offset.dot(this.tempVector.copy(this.rotationAxis).cross(this.eye))*e):"X"!==t&&"Y"!==t&&"Z"!==t||(this.rotationAxis.copy(this.unit[t]),this.tempVector.copy(this.unit[t]),"local"===i&&this.tempVector.applyQuaternion(this.worldQuaternion),this.rotationAngle=this.offset.dot(this.tempVector.cross(this.eye).normalize())*e),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===i&&"E"!==t&&"XYZE"!==t?(r.quaternion.copy(this.quaternionStart),r.quaternion.multiply(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this.parentQuaternionInv),r.quaternion.copy(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),r.quaternion.multiply(this.quaternionStart).normalize())}this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent)}})),ql(this,"pointerUp",(e=>{0===e.button&&(this.dragging&&null!==this.axis&&(this.mouseUpEvent.mode=this.mode,this.dispatchEvent(this.mouseUpEvent)),this.dragging=!1,this.axis=null)})),ql(this,"getPointer",(e=>{var t;if(this.domElement&&(null==(t=this.domElement.ownerDocument)?void 0:t.pointerLockElement))return{x:0,y:0,button:e.button};{const t=e.changedTouches?e.changedTouches[0]:e,n=this.domElement.getBoundingClientRect();return{x:(t.clientX-n.left)/n.width*2-1,y:-(t.clientY-n.top)/n.height*2+1,button:e.button}}})),ql(this,"onPointerHover",(e=>{if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this.getPointer(e))}})),ql(this,"onPointerDown",(e=>{this.enabled&&this.domElement&&(this.domElement.style.touchAction="none",this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.pointerHover(this.getPointer(e)),this.pointerDown(this.getPointer(e)))})),ql(this,"onPointerMove",(e=>{this.enabled&&this.pointerMove(this.getPointer(e))})),ql(this,"onPointerUp",(e=>{this.enabled&&this.domElement&&(this.domElement.style.touchAction="",this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.pointerUp(this.getPointer(e)))})),ql(this,"getMode",(()=>this.mode)),ql(this,"setMode",(e=>{this.mode=e})),ql(this,"setTranslationSnap",(e=>{this.translationSnap=e})),ql(this,"setRotationSnap",(e=>{this.rotationSnap=e})),ql(this,"setScaleSnap",(e=>{this.scaleSnap=e})),ql(this,"setSize",(e=>{this.size=e})),ql(this,"setSpace",(e=>{this.space=e})),ql(this,"update",(()=>{console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")})),ql(this,"connect",(e=>{e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=e,this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointermove",this.onPointerHover),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp)})),ql(this,"dispose",(()=>{var e,t,n,r,i,o;null==(e=this.domElement)||e.removeEventListener("pointerdown",this.onPointerDown),null==(t=this.domElement)||t.removeEventListener("pointermove",this.onPointerHover),null==(r=null==(n=this.domElement)?void 0:n.ownerDocument)||r.removeEventListener("pointermove",this.onPointerMove),null==(o=null==(i=this.domElement)?void 0:i.ownerDocument)||o.removeEventListener("pointerup",this.onPointerUp),this.traverse((e=>{const t=e;t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()}))})),this.domElement=t,this.camera=e,this.gizmo=new Yl,this.add(this.gizmo),this.plane=new Xl,this.add(this.plane);const n=(e,t)=>{let n=t;Object.defineProperty(this,e,{get:function(){return void 0!==n?n:t},set:function(t){n!==t&&(n=t,this.plane[e]=t,this.gizmo[e]=t,this.dispatchEvent({type:e+"-changed",value:t}),this.dispatchEvent(this.changeEvent))}}),this[e]=t,this.plane[e]=t,this.gizmo[e]=t};n("camera",this.camera),n("object",this.object),n("enabled",this.enabled),n("axis",this.axis),n("mode",this.mode),n("translationSnap",this.translationSnap),n("rotationSnap",this.rotationSnap),n("scaleSnap",this.scaleSnap),n("space",this.space),n("size",this.size),n("dragging",this.dragging),n("showX",this.showX),n("showY",this.showY),n("showZ",this.showZ),n("worldPosition",this.worldPosition),n("worldPositionStart",this.worldPositionStart),n("worldQuaternion",this.worldQuaternion),n("worldQuaternionStart",this.worldQuaternionStart),n("cameraPosition",this.cameraPosition),n("cameraQuaternion",this.cameraQuaternion),n("pointStart",this.pointStart),n("pointEnd",this.pointEnd),n("rotationAxis",this.rotationAxis),n("rotationAngle",this.rotationAngle),n("eye",this.eye),void 0!==t&&this.connect(t)}}class Yl extends s.Object3D{constructor(){super(),ql(this,"isTransformControlsGizmo",!0),ql(this,"type","TransformControlsGizmo"),ql(this,"tempVector",new s.Vector3(0,0,0)),ql(this,"tempEuler",new s.Euler),ql(this,"alignVector",new s.Vector3(0,1,0)),ql(this,"zeroVector",new s.Vector3(0,0,0)),ql(this,"lookAtMatrix",new s.Matrix4),ql(this,"tempQuaternion",new s.Quaternion),ql(this,"tempQuaternion2",new s.Quaternion),ql(this,"identityQuaternion",new s.Quaternion),ql(this,"unitX",new s.Vector3(1,0,0)),ql(this,"unitY",new s.Vector3(0,1,0)),ql(this,"unitZ",new s.Vector3(0,0,1)),ql(this,"gizmo"),ql(this,"picker"),ql(this,"helper"),ql(this,"rotationAxis",new s.Vector3),ql(this,"cameraPosition",new s.Vector3),ql(this,"worldPositionStart",new s.Vector3),ql(this,"worldQuaternionStart",new s.Quaternion),ql(this,"worldPosition",new s.Vector3),ql(this,"worldQuaternion",new s.Quaternion),ql(this,"eye",new s.Vector3),ql(this,"camera",null),ql(this,"enabled",!0),ql(this,"axis",null),ql(this,"mode","translate"),ql(this,"space","world"),ql(this,"size",1),ql(this,"dragging",!1),ql(this,"showX",!0),ql(this,"showY",!0),ql(this,"showZ",!0),ql(this,"updateMatrixWorld",(()=>{let e=this.space;"scale"===this.mode&&(e="local");const t="local"===e?this.worldQuaternion:this.identityQuaternion;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let r=0;r<n.length;r++){const e=n[r];let i;if(e.visible=!0,e.rotation.set(0,0,0),e.position.copy(this.worldPosition),i=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),e.scale.set(1,1,1).multiplyScalar(i*this.size/7),"helper"!==e.tag){if(e.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){const n=.99,r=.2,i=0;"X"!==e.name&&"XYZX"!==e.name||Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))>n&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"Y"!==e.name&&"XYZY"!==e.name||Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))>n&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"Z"!==e.name&&"XYZZ"!==e.name||Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))>n&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"XY"===e.name&&Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))<r&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"YZ"===e.name&&Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))<r&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"XZ"===e.name&&Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))<r&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),-1!==e.name.search("X")&&(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye)<i?"fwd"===e.tag?e.visible=!1:e.scale.x*=-1:"bwd"===e.tag&&(e.visible=!1)),-1!==e.name.search("Y")&&(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye)<i?"fwd"===e.tag?e.visible=!1:e.scale.y*=-1:"bwd"===e.tag&&(e.visible=!1)),-1!==e.name.search("Z")&&(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye)<i?"fwd"===e.tag?e.visible=!1:e.scale.z*=-1:"bwd"===e.tag&&(e.visible=!1))}else"rotate"===this.mode&&(this.tempQuaternion2.copy(t),this.alignVector.copy(this.eye).applyQuaternion(this.tempQuaternion.copy(t).invert()),-1!==e.name.search("E")&&e.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.eye,this.zeroVector,this.unitY)),"X"===e.name&&(this.tempQuaternion.setFromAxisAngle(this.unitX,Math.atan2(-this.alignVector.y,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),e.quaternion.copy(this.tempQuaternion)),"Y"===e.name&&(this.tempQuaternion.setFromAxisAngle(this.unitY,Math.atan2(this.alignVector.x,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),e.quaternion.copy(this.tempQuaternion)),"Z"===e.name&&(this.tempQuaternion.setFromAxisAngle(this.unitZ,Math.atan2(this.alignVector.y,this.alignVector.x)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),e.quaternion.copy(this.tempQuaternion)));e.visible=e.visible&&(-1===e.name.indexOf("X")||this.showX),e.visible=e.visible&&(-1===e.name.indexOf("Y")||this.showY),e.visible=e.visible&&(-1===e.name.indexOf("Z")||this.showZ),e.visible=e.visible&&(-1===e.name.indexOf("E")||this.showX&&this.showY&&this.showZ),e.material.tempOpacity=e.material.tempOpacity||e.material.opacity,e.material.tempColor=e.material.tempColor||e.material.color.clone(),e.material.color.copy(e.material.tempColor),e.material.opacity=e.material.tempOpacity,this.enabled?this.axis&&(e.name===this.axis||this.axis.split("").some((function(t){return e.name===t}))?(e.material.opacity=1,e.material.color.lerp(new s.Color(1,1,1),.5)):(e.material.opacity*=.25,e.material.color.lerp(new s.Color(1,1,1),.5))):(e.material.opacity*=.5,e.material.color.lerp(new s.Color(1,1,1),.5))}else e.visible=!1,"AXIS"===e.name?(e.position.copy(this.worldPositionStart),e.visible=!!this.axis,"X"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,0)),e.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),"Y"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,Math.PI/2)),e.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),"Z"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),e.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),"XYZE"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),this.alignVector.copy(this.rotationAxis),e.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.zeroVector,this.alignVector,this.unitY)),e.quaternion.multiply(this.tempQuaternion),e.visible=this.dragging),"E"===this.axis&&(e.visible=!1)):"START"===e.name?(e.position.copy(this.worldPositionStart),e.visible=this.dragging):"END"===e.name?(e.position.copy(this.worldPosition),e.visible=this.dragging):"DELTA"===e.name?(e.position.copy(this.worldPositionStart),e.quaternion.copy(this.worldQuaternionStart),this.tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),this.tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),e.scale.copy(this.tempVector),e.visible=this.dragging):(e.quaternion.copy(t),this.dragging?e.position.copy(this.worldPositionStart):e.position.copy(this.worldPosition),this.axis&&(e.visible=-1!==this.axis.search(e.name)))}super.updateMatrixWorld()}));const e=new s.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:s.DoubleSide,fog:!1,toneMapped:!1}),t=new s.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),n=e.clone();n.opacity=.15;const r=e.clone();r.opacity=.33;const i=e.clone();i.color.set(16711680);const o=e.clone();o.color.set(65280);const a=e.clone();a.color.set(255);const c=e.clone();c.opacity=.25;const l=c.clone();l.color.set(16776960);const u=c.clone();u.color.set(65535);const h=c.clone();h.color.set(16711935);e.clone().color.set(16776960);const d=t.clone();d.color.set(16711680);const A=t.clone();A.color.set(65280);const m=t.clone();m.color.set(255);const p=t.clone();p.color.set(65535);const f=t.clone();f.color.set(16711935);const g=t.clone();g.color.set(16776960);const y=t.clone();y.color.set(7895160);const v=g.clone();v.opacity=.25;const x=new s.CylinderGeometry(0,.05,.2,12,1,!1),E=new s.BoxGeometry(.125,.125,.125),w=new s.BufferGeometry;w.setAttribute("position",new s.Float32BufferAttribute([0,0,0,1,0,0],3));const C=(e,t)=>{const n=new s.BufferGeometry,r=[];for(let i=0;i<=64*t;++i)r.push(0,Math.cos(i/32*Math.PI)*e,Math.sin(i/32*Math.PI)*e);return n.setAttribute("position",new s.Float32BufferAttribute(r,3)),n},I={X:[[new s.Mesh(x,i),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new s.Mesh(x,i),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new s.Line(w,d)]],Y:[[new s.Mesh(x,o),[0,1,0],null,null,"fwd"],[new s.Mesh(x,o),[0,1,0],[Math.PI,0,0],null,"bwd"],[new s.Line(w,A),null,[0,0,Math.PI/2]]],Z:[[new s.Mesh(x,a),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new s.Mesh(x,a),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new s.Line(w,m),null,[0,-Math.PI/2,0]]],XYZ:[[new s.Mesh(new s.OctahedronGeometry(.1,0),c.clone()),[0,0,0],[0,0,0]]],XY:[[new s.Mesh(new s.PlaneGeometry(.295,.295),l.clone()),[.15,.15,0]],[new s.Line(w,g),[.18,.3,0],null,[.125,1,1]],[new s.Line(w,g),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new s.Mesh(new s.PlaneGeometry(.295,.295),u.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new s.Line(w,p),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new s.Line(w,p),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new s.Mesh(new s.PlaneGeometry(.295,.295),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new s.Line(w,f),[.18,0,.3],null,[.125,1,1]],[new s.Line(w,f),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},_={X:[[new s.Mesh(new s.CylinderGeometry(.2,0,1,4,1,!1),n),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new s.Mesh(new s.CylinderGeometry(.2,0,1,4,1,!1),n),[0,.6,0]]],Z:[[new s.Mesh(new s.CylinderGeometry(.2,0,1,4,1,!1),n),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new s.Mesh(new s.OctahedronGeometry(.2,0),n)]],XY:[[new s.Mesh(new s.PlaneGeometry(.4,.4),n),[.2,.2,0]]],YZ:[[new s.Mesh(new s.PlaneGeometry(.4,.4),n),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new s.Mesh(new s.PlaneGeometry(.4,.4),n),[.2,0,.2],[-Math.PI/2,0,0]]]},b={START:[[new s.Mesh(new s.OctahedronGeometry(.01,2),r),null,null,null,"helper"]],END:[[new s.Mesh(new s.OctahedronGeometry(.01,2),r),null,null,null,"helper"]],DELTA:[[new s.Line((()=>{const e=new s.BufferGeometry;return e.setAttribute("position",new s.Float32BufferAttribute([0,0,0,1,1,1],3)),e})(),r),null,null,null,"helper"]],X:[[new s.Line(w,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new s.Line(w,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new s.Line(w,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},B={X:[[new s.Line(C(1,.5),d)],[new s.Mesh(new s.OctahedronGeometry(.04,0),i),[0,0,.99],null,[1,3,1]]],Y:[[new s.Line(C(1,.5),A),null,[0,0,-Math.PI/2]],[new s.Mesh(new s.OctahedronGeometry(.04,0),o),[0,0,.99],null,[3,1,1]]],Z:[[new s.Line(C(1,.5),m),null,[0,Math.PI/2,0]],[new s.Mesh(new s.OctahedronGeometry(.04,0),a),[.99,0,0],null,[1,3,1]]],E:[[new s.Line(C(1.25,1),v),null,[0,Math.PI/2,0]],[new s.Mesh(new s.CylinderGeometry(.03,0,.15,4,1,!1),v),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new s.Mesh(new s.CylinderGeometry(.03,0,.15,4,1,!1),v),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new s.Mesh(new s.CylinderGeometry(.03,0,.15,4,1,!1),v),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new s.Mesh(new s.CylinderGeometry(.03,0,.15,4,1,!1),v),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new s.Line(C(1,1),y),null,[0,Math.PI/2,0]]]},M={AXIS:[[new s.Line(w,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},S={X:[[new s.Mesh(new s.TorusGeometry(1,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new s.Mesh(new s.TorusGeometry(1,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new s.Mesh(new s.TorusGeometry(1,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new s.Mesh(new s.TorusGeometry(1.25,.1,2,24),n)]],XYZE:[[new s.Mesh(new s.SphereGeometry(.7,10,8),n)]]},D={X:[[new s.Mesh(E,i),[.8,0,0],[0,0,-Math.PI/2]],[new s.Line(w,d),null,null,[.8,1,1]]],Y:[[new s.Mesh(E,o),[0,.8,0]],[new s.Line(w,A),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new s.Mesh(E,a),[0,0,.8],[Math.PI/2,0,0]],[new s.Line(w,m),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new s.Mesh(E,l),[.85,.85,0],null,[2,2,.2]],[new s.Line(w,g),[.855,.98,0],null,[.125,1,1]],[new s.Line(w,g),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new s.Mesh(E,u),[0,.85,.85],null,[.2,2,2]],[new s.Line(w,p),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new s.Line(w,p),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new s.Mesh(E,h),[.85,0,.85],null,[2,.2,2]],[new s.Line(w,f),[.855,0,.98],null,[.125,1,1]],[new s.Line(w,f),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new s.Mesh(new s.BoxGeometry(.125,.125,.125),c.clone()),[1.1,0,0]]],XYZY:[[new s.Mesh(new s.BoxGeometry(.125,.125,.125),c.clone()),[0,1.1,0]]],XYZZ:[[new s.Mesh(new s.BoxGeometry(.125,.125,.125),c.clone()),[0,0,1.1]]]},T={X:[[new s.Mesh(new s.CylinderGeometry(.2,0,.8,4,1,!1),n),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new s.Mesh(new s.CylinderGeometry(.2,0,.8,4,1,!1),n),[0,.5,0]]],Z:[[new s.Mesh(new s.CylinderGeometry(.2,0,.8,4,1,!1),n),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new s.Mesh(E,n),[.85,.85,0],null,[3,3,.2]]],YZ:[[new s.Mesh(E,n),[0,.85,.85],null,[.2,3,3]]],XZ:[[new s.Mesh(E,n),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new s.Mesh(new s.BoxGeometry(.2,.2,.2),n),[1.1,0,0]]],XYZY:[[new s.Mesh(new s.BoxGeometry(.2,.2,.2),n),[0,1.1,0]]],XYZZ:[[new s.Mesh(new s.BoxGeometry(.2,.2,.2),n),[0,0,1.1]]]},Q={X:[[new s.Line(w,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new s.Line(w,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new s.Line(w,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},P=e=>{const t=new s.Object3D;for(let n in e)for(let r=e[n].length;r--;){const i=e[n][r][0].clone(),o=e[n][r][1],s=e[n][r][2],a=e[n][r][3],c=e[n][r][4];i.name=n,i.tag=c,o&&i.position.set(o[0],o[1],o[2]),s&&i.rotation.set(s[0],s[1],s[2]),a&&i.scale.set(a[0],a[1],a[2]),i.updateMatrix();const l=i.geometry.clone();l.applyMatrix4(i.matrix),i.geometry=l,i.renderOrder=1/0,i.position.set(0,0,0),i.rotation.set(0,0,0),i.scale.set(1,1,1),t.add(i)}return t};this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=P(I)),this.add(this.gizmo.rotate=P(B)),this.add(this.gizmo.scale=P(D)),this.add(this.picker.translate=P(_)),this.add(this.picker.rotate=P(S)),this.add(this.picker.scale=P(T)),this.add(this.helper.translate=P(b)),this.add(this.helper.rotate=P(M)),this.add(this.helper.scale=P(Q)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}}class Xl extends s.Mesh{constructor(){super(new s.PlaneGeometry(1e5,1e5,2,2),new s.MeshBasicMaterial({visible:!1,wireframe:!0,side:s.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),ql(this,"isTransformControlsPlane",!0),ql(this,"type","TransformControlsPlane"),ql(this,"unitX",new s.Vector3(1,0,0)),ql(this,"unitY",new s.Vector3(0,1,0)),ql(this,"unitZ",new s.Vector3(0,0,1)),ql(this,"tempVector",new s.Vector3),ql(this,"dirVector",new s.Vector3),ql(this,"alignVector",new s.Vector3),ql(this,"tempMatrix",new s.Matrix4),ql(this,"identityQuaternion",new s.Quaternion),ql(this,"cameraQuaternion",new s.Quaternion),ql(this,"worldPosition",new s.Vector3),ql(this,"worldQuaternion",new s.Quaternion),ql(this,"eye",new s.Vector3),ql(this,"axis",null),ql(this,"mode","translate"),ql(this,"space","world"),ql(this,"updateMatrixWorld",(()=>{let e=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(e="local"),this.unitX.set(1,0,0).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.unitY.set(0,1,0).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.unitZ.set(0,0,1).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.alignVector.copy(this.unitY),this.mode){case"translate":case"scale":switch(this.axis){case"X":this.alignVector.copy(this.eye).cross(this.unitX),this.dirVector.copy(this.unitX).cross(this.alignVector);break;case"Y":this.alignVector.copy(this.eye).cross(this.unitY),this.dirVector.copy(this.unitY).cross(this.alignVector);break;case"Z":this.alignVector.copy(this.eye).cross(this.unitZ),this.dirVector.copy(this.unitZ).cross(this.alignVector);break;case"XY":this.dirVector.copy(this.unitZ);break;case"YZ":this.dirVector.copy(this.unitX);break;case"XZ":this.alignVector.copy(this.unitZ),this.dirVector.copy(this.unitY);break;case"XYZ":case"E":this.dirVector.set(0,0,0)}break;default:this.dirVector.set(0,0,0)}0===this.dirVector.length()?this.quaternion.copy(this.cameraQuaternion):(this.tempMatrix.lookAt(this.tempVector.set(0,0,0),this.dirVector,this.alignVector),this.quaternion.setFromRotationMatrix(this.tempMatrix)),super.updateMatrixWorld()}))}}const Zl=i.forwardRef((({children:e,domElement:t,onChange:n,onMouseDown:o,onMouseUp:c,onObjectChange:l,object:u,makeDefault:h,camera:d,enabled:A,axis:m,mode:p,translationSnap:f,rotationSnap:g,scaleSnap:y,space:v,size:x,showX:E,showY:w,showZ:C,...I},_)=>{const b=(0,a.D)((e=>e.controls)),B=(0,a.D)((e=>e.gl)),M=(0,a.D)((e=>e.events)),S=(0,a.D)((e=>e.camera)),D=(0,a.D)((e=>e.invalidate)),T=(0,a.D)((e=>e.get)),Q=(0,a.D)((e=>e.set)),P=d||S,z=t||M.connected||B.domElement,R=i.useMemo((()=>new Wl(P,z)),[P,z]),F=i.useRef(null);i.useLayoutEffect((()=>(u?R.attach(u instanceof s.Object3D?u:u.current):F.current instanceof s.Object3D&&R.attach(F.current),()=>{R.detach()})),[u,e,R]),i.useEffect((()=>{if(b){const e=e=>b.enabled=!e.value;return R.addEventListener("dragging-changed",e),()=>R.removeEventListener("dragging-changed",e)}}),[R,b]);const k=i.useRef(),L=i.useRef(),O=i.useRef(),U=i.useRef();return i.useLayoutEffect((()=>{k.current=n}),[n]),i.useLayoutEffect((()=>{L.current=o}),[o]),i.useLayoutEffect((()=>{O.current=c}),[c]),i.useLayoutEffect((()=>{U.current=l}),[l]),i.useEffect((()=>{const e=e=>{D(),null==k.current||k.current(e)},t=e=>null==L.current?void 0:L.current(e),n=e=>null==O.current?void 0:O.current(e),r=e=>null==U.current?void 0:U.current(e);return R.addEventListener("change",e),R.addEventListener("mouseDown",t),R.addEventListener("mouseUp",n),R.addEventListener("objectChange",r),()=>{R.removeEventListener("change",e),R.removeEventListener("mouseDown",t),R.removeEventListener("mouseUp",n),R.removeEventListener("objectChange",r)}}),[D,R]),i.useEffect((()=>{if(h){const e=T().controls;return Q({controls:R}),()=>Q({controls:e})}}),[h,R]),i.createElement(i.Fragment,null,i.createElement("primitive",{ref:_,object:R,enabled:A,axis:m,mode:p,translationSnap:f,rotationSnap:g,scaleSnap:y,space:v,size:x,showX:E,showY:w,showZ:C}),i.createElement("group",(0,r.Z)({ref:F},I),e))}));var Kl=Object.defineProperty,Jl=(e,t,n)=>(((e,t,n)=>{t in e?Kl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);const $l=new s.Euler(0,0,0,"YXZ"),eu=new s.Vector3,tu={type:"change"},nu={type:"lock"},ru={type:"unlock"},iu=Math.PI/2;class ou extends s.EventDispatcher{constructor(e,t){super(),Jl(this,"camera"),Jl(this,"domElement"),Jl(this,"isLocked"),Jl(this,"minPolarAngle"),Jl(this,"maxPolarAngle"),Jl(this,"pointerSpeed"),Jl(this,"onMouseMove",(e=>{if(!this.domElement||!1===this.isLocked)return;const t=e.movementX||e.mozMovementX||e.webkitMovementX||0,n=e.movementY||e.mozMovementY||e.webkitMovementY||0;$l.setFromQuaternion(this.camera.quaternion),$l.y-=.002*t*this.pointerSpeed,$l.x-=.002*n*this.pointerSpeed,$l.x=Math.max(iu-this.maxPolarAngle,Math.min(iu-this.minPolarAngle,$l.x)),this.camera.quaternion.setFromEuler($l),this.dispatchEvent(tu)})),Jl(this,"onPointerlockChange",(()=>{this.domElement&&(this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(nu),this.isLocked=!0):(this.dispatchEvent(ru),this.isLocked=!1))})),Jl(this,"onPointerlockError",(()=>{console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")})),Jl(this,"connect",(e=>{this.domElement=e||this.domElement,this.domElement&&(this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError))})),Jl(this,"disconnect",(()=>{this.domElement&&(this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError))})),Jl(this,"dispose",(()=>{this.disconnect()})),Jl(this,"getObject",(()=>this.camera)),Jl(this,"direction",new s.Vector3(0,0,-1)),Jl(this,"getDirection",(e=>e.copy(this.direction).applyQuaternion(this.camera.quaternion))),Jl(this,"moveForward",(e=>{eu.setFromMatrixColumn(this.camera.matrix,0),eu.crossVectors(this.camera.up,eu),this.camera.position.addScaledVector(eu,e)})),Jl(this,"moveRight",(e=>{eu.setFromMatrixColumn(this.camera.matrix,0),this.camera.position.addScaledVector(eu,e)})),Jl(this,"lock",(()=>{this.domElement&&this.domElement.requestPointerLock()})),Jl(this,"unlock",(()=>{this.domElement&&this.domElement.ownerDocument.exitPointerLock()})),this.camera=e,this.domElement=t,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,t&&this.connect(t)}}const su=i.forwardRef((({domElement:e,selector:t,onChange:n,onLock:o,onUnlock:s,enabled:c=!0,makeDefault:l,...u},h)=>{const{camera:d,...A}=u,m=(0,a.D)((e=>e.setEvents)),p=(0,a.D)((e=>e.gl)),f=(0,a.D)((e=>e.camera)),g=(0,a.D)((e=>e.invalidate)),y=(0,a.D)((e=>e.events)),v=(0,a.D)((e=>e.get)),x=(0,a.D)((e=>e.set)),E=d||f,w=e||y.connected||p.domElement,C=i.useMemo((()=>new ou(E)),[E]);return i.useEffect((()=>{if(c){C.connect(w);const e=v().events.compute;return m({compute(e,t){const n=t.size.width/2,r=t.size.height/2;t.pointer.set(n/t.size.width*2-1,-r/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),()=>{C.disconnect(),m({compute:e})}}}),[c,C]),i.useEffect((()=>{const e=e=>{g(),n&&n(e)};C.addEventListener("change",e),o&&C.addEventListener("lock",o),s&&C.addEventListener("unlock",s);const r=()=>C.lock(),i=t?Array.from(document.querySelectorAll(t)):[document];return i.forEach((e=>e&&e.addEventListener("click",r))),()=>{C.removeEventListener("change",e),o&&C.removeEventListener("lock",o),s&&C.removeEventListener("unlock",s),i.forEach((e=>e?e.removeEventListener("click",r):void 0))}}),[n,o,s,t,C,g]),i.useEffect((()=>{if(l){const e=v().controls;return x({controls:C}),()=>x({controls:e})}}),[l,C]),i.createElement("primitive",(0,r.Z)({ref:h,object:C},A))}));var au=Object.defineProperty,cu=(e,t,n)=>(((e,t,n)=>{t in e?au(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);const lu=new s.Vector3;class uu extends s.EventDispatcher{constructor(e,t){super(),cu(this,"object"),cu(this,"domElement"),cu(this,"enabled",!0),cu(this,"movementSpeed",1),cu(this,"lookSpeed",.005),cu(this,"lookVertical",!0),cu(this,"autoForward",!1),cu(this,"activeLook",!0),cu(this,"heightSpeed",!1),cu(this,"heightCoef",1),cu(this,"heightMin",0),cu(this,"heightMax",1),cu(this,"constrainVertical",!1),cu(this,"verticalMin",0),cu(this,"verticalMax",Math.PI),cu(this,"mouseDragOn",!1),cu(this,"autoSpeedFactor",0),cu(this,"mouseX",0),cu(this,"mouseY",0),cu(this,"moveForward",!1),cu(this,"moveBackward",!1),cu(this,"moveLeft",!1),cu(this,"moveRight",!1),cu(this,"moveUp",!1),cu(this,"moveDown",!1),cu(this,"viewHalfX",0),cu(this,"viewHalfY",0),cu(this,"lat",0),cu(this,"lon",0),cu(this,"lookDirection",new s.Vector3),cu(this,"spherical",new s.Spherical),cu(this,"target",new s.Vector3),cu(this,"connect",(e=>{e.setAttribute("tabindex","-1"),e.style.touchAction="none",e.addEventListener("contextmenu",this.contextmenu),e.addEventListener("mousemove",this.onMouseMove),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("mouseup",this.onMouseUp),this.domElement=e,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize()})),cu(this,"dispose",(()=>{var e,t,n,r;null==(e=this.domElement)||e.removeEventListener("contextmenu",this.contextmenu),null==(t=this.domElement)||t.removeEventListener("mousedown",this.onMouseDown),null==(n=this.domElement)||n.removeEventListener("mousemove",this.onMouseMove),null==(r=this.domElement)||r.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)})),cu(this,"handleResize",(()=>{this.domElement&&(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)})),cu(this,"onMouseDown",(e=>{var t;if(null==(t=this.domElement)||t.focus(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0})),cu(this,"onMouseUp",(e=>{if(this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1})),cu(this,"onMouseMove",(e=>{this.domElement&&(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)})),cu(this,"onKeyDown",(e=>{switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}})),cu(this,"onKeyUp",(e=>{switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}})),cu(this,"lookAt",((e,t,n)=>(e instanceof s.Vector3?this.target.copy(e):t&&n&&this.target.set(e,t,n),this.object.lookAt(this.target),this.setOrientation(),this))),cu(this,"update",(e=>{if(!this.enabled)return;if(this.heightSpeed){const t=s.MathUtils.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(t*this.heightCoef)}else this.autoSpeedFactor=0;const t=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(t+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(t),this.moveLeft&&this.object.translateX(-t),this.moveRight&&this.object.translateX(t),this.moveUp&&this.object.translateY(t),this.moveDown&&this.object.translateY(-t);let n=e*this.lookSpeed;this.activeLook||(n=0);let r=1;this.constrainVertical&&(r=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.mouseX*n,this.lookVertical&&(this.lat-=this.mouseY*n*r),this.lat=Math.max(-85,Math.min(85,this.lat));let i=s.MathUtils.degToRad(90-this.lat);const o=s.MathUtils.degToRad(this.lon);this.constrainVertical&&(i=s.MathUtils.mapLinear(i,0,Math.PI,this.verticalMin,this.verticalMax));const a=this.object.position;lu.setFromSphericalCoords(1,i,o).add(a),this.object.lookAt(lu)})),cu(this,"contextmenu",(e=>e.preventDefault())),cu(this,"setOrientation",(()=>{this.lookDirection.set(0,0,-1).applyQuaternion(this.object.quaternion),this.spherical.setFromVector3(this.lookDirection),this.lat=90-s.MathUtils.radToDeg(this.spherical.phi),this.lon=s.MathUtils.radToDeg(this.spherical.theta)})),this.object=e,this.domElement=t,this.setOrientation(),t&&this.connect(t)}}const hu=i.forwardRef((({domElement:e,makeDefault:t,...n},o)=>{const s=(0,a.D)((e=>e.camera)),c=(0,a.D)((e=>e.gl)),l=(0,a.D)((e=>e.events)),u=(0,a.D)((e=>e.get)),h=(0,a.D)((e=>e.set)),d=e||l.connected||c.domElement,[A]=i.useState((()=>new uu(s,d)));return i.useEffect((()=>{if(t){const e=u().controls;return h({controls:A}),()=>h({controls:e})}}),[t,A]),(0,a.F)(((e,t)=>{A.update(t)}),-1),A?i.createElement("primitive",(0,r.Z)({ref:o,object:A},n)):null})),du=1,Au=2,mu=4,pu=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),fu=0,gu=1,yu=-1;function vu(e){return e.isPerspectiveCamera}function xu(e){return e.isOrthographicCamera}const Eu=2*Math.PI,wu=Math.PI/2,Cu=1e-5,Iu=Math.PI/180;function _u(e,t,n){return Math.max(t,Math.min(n,e))}function bu(e,t=Cu){return Math.abs(e)<t}function Bu(e,t,n=Cu){return bu(e-t,n)}function Mu(e,t){return Math.round(e/t)*t}function Su(e){return isFinite(e)?e:e<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Du(e){return Math.abs(e)<Number.MAX_VALUE?e:e*(1/0)}function Tu(e,t,n,r,i=1/0,o){const s=2/(r=Math.max(1e-4,r)),a=s*o,c=1/(1+a+.48*a*a+.235*a*a*a);let l=e-t;const u=t,h=i*r;l=_u(l,-h,h),t=e-l;const d=(n.value+s*l)*o;n.value=(n.value-s*d)*c;let A=t+(l+d)*c;return u-e>0===A>u&&(A=u,n.value=(A-u)/o),A}function Qu(e,t,n,r,i=1/0,o,s){const a=2/(r=Math.max(1e-4,r)),c=a*o,l=1/(1+c+.48*c*c+.235*c*c*c);let u=t.x,h=t.y,d=t.z,A=e.x-u,m=e.y-h,p=e.z-d;const f=u,g=h,y=d,v=i*r,x=A*A+m*m+p*p;if(x>v*v){const e=Math.sqrt(x);A=A/e*v,m=m/e*v,p=p/e*v}u=e.x-A,h=e.y-m,d=e.z-p;const E=(n.x+a*A)*o,w=(n.y+a*m)*o,C=(n.z+a*p)*o;n.x=(n.x-a*E)*l,n.y=(n.y-a*w)*l,n.z=(n.z-a*C)*l,s.x=u+(A+E)*l,s.y=h+(m+w)*l,s.z=d+(p+C)*l;const I=f-e.x,_=g-e.y,b=y-e.z;return I*(s.x-f)+_*(s.y-g)+b*(s.z-y)>0&&(s.x=f,s.y=g,s.z=y,n.x=(s.x-f)/o,n.y=(s.y-g)/o,n.z=(s.z-y)/o),s}function Pu(e,t){t.set(0,0),e.forEach((e=>{t.x+=e.clientX,t.y+=e.clientY})),t.x/=e.length,t.y/=e.length}function zu(e,t){return!!xu(e)&&(console.warn(`${t} is not supported in OrthographicCamera`),!0)}class Ru{constructor(){this._listeners={}}addEventListener(e,t){const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}removeAllEventListeners(e){e?Array.isArray(this._listeners[e])&&(this._listeners[e].length=0):this._listeners={}}dispatchEvent(e){const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e)}}}var Fu;const ku=1/8,Lu=/Mac/.test(null===(Fu=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===Fu?void 0:Fu.platform);let Ou,Uu,Nu,Vu,Gu,ju,Hu,qu,Wu,Yu,Xu,Zu,Ku,Ju,$u,eh,th,nh,rh,ih,oh,sh,ah;class ch extends Ru{static install(e){Ou=e.THREE,Uu=Object.freeze(new Ou.Vector3(0,0,0)),Nu=Object.freeze(new Ou.Vector3(0,1,0)),Vu=Object.freeze(new Ou.Vector3(0,0,1)),Gu=new Ou.Vector2,ju=new Ou.Vector3,Hu=new Ou.Vector3,qu=new Ou.Vector3,Wu=new Ou.Vector3,Yu=new Ou.Vector3,Xu=new Ou.Vector3,Zu=new Ou.Vector3,Ku=new Ou.Vector3,Ju=new Ou.Vector3,$u=new Ou.Spherical,eh=new Ou.Spherical,th=new Ou.Box3,nh=new Ou.Box3,rh=new Ou.Sphere,ih=new Ou.Quaternion,oh=new Ou.Quaternion,sh=new Ou.Matrix4,ah=new Ou.Raycaster}static get ACTION(){return pu}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=pu.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=fu,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new Ou.Vector3,this._focalOffsetVelocity=new Ou.Vector3,this._zoomVelocity={value:0},this._truckInternal=(e,t,n)=>{let r,i;if(vu(this._camera)){const n=ju.copy(this._camera.position).sub(this._target),o=this._camera.getEffectiveFOV()*Iu,s=n.length()*Math.tan(.5*o);r=this.truckSpeed*e*s/this._elementRect.height,i=this.truckSpeed*t*s/this._elementRect.height}else{if(!xu(this._camera))return;{const n=this._camera;r=e*(n.right-n.left)/n.zoom/this._elementRect.width,i=t*(n.top-n.bottom)/n.zoom/this._elementRect.height}}this.verticalDragToForward?(n?this.setFocalOffset(this._focalOffsetEnd.x+r,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(r,0,!0),this.forward(-i,!0)):n?this.setFocalOffset(this._focalOffsetEnd.x+r,this._focalOffsetEnd.y+i,this._focalOffsetEnd.z,!0):this.truck(r,i,!0)},this._rotateInternal=(e,t)=>{const n=Eu*this.azimuthRotateSpeed*e/this._elementRect.height,r=Eu*this.polarRotateSpeed*t/this._elementRect.height;this.rotate(n,r,!0)},this._dollyInternal=(e,t,n)=>{const r=Math.pow(.95,-e*this.dollySpeed),i=this._sphericalEnd.radius,o=this._sphericalEnd.radius*r,s=_u(o,this.minDistance,this.maxDistance),a=s-o;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(o,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(a,!0),this._dollyToNoClamp(s,!0)):this._dollyToNoClamp(s,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?o:s)-i,this._dollyControlCoord.set(t,n)),this._lastDollyDirection=Math.sign(-e)},this._zoomInternal=(e,t,n)=>{const r=Math.pow(.95,e*this.dollySpeed),i=this._zoom,o=this._zoom*r;this.zoomTo(o,!0),this.dollyToCursor&&(this._changedZoom+=o-i,this._dollyControlCoord.set(t,n))},"undefined"===typeof Ou&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=(new Ou.Quaternion).setFromUnitVectors(this._camera.up,Nu),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=pu.NONE,this._target=new Ou.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new Ou.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=(new Ou.Spherical).setFromVector3(ju.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new Ou.Vector3,new Ou.Vector3,new Ou.Vector3,new Ou.Vector3],this._updateNearPlaneCorners(),this._boundary=new Ou.Box3(new Ou.Vector3(-1/0,-1/0,-1/0),new Ou.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new Ou.Vector2,this.mouseButtons={left:pu.ROTATE,middle:pu.DOLLY,right:pu.TRUCK,wheel:vu(this._camera)?pu.DOLLY:xu(this._camera)?pu.ZOOM:pu.NONE},this.touches={one:pu.TOUCH_ROTATE,two:vu(this._camera)?pu.TOUCH_DOLLY_TRUCK:xu(this._camera)?pu.TOUCH_ZOOM_TRUCK:pu.NONE,three:pu.TOUCH_TRUCK};const n=new Ou.Vector2,r=new Ou.Vector2,i=new Ou.Vector2,o=e=>{if(!this._enabled||!this._domElement)return;if(0!==this._interactiveArea.left||0!==this._interactiveArea.top||1!==this._interactiveArea.width||1!==this._interactiveArea.height){const t=this._domElement.getBoundingClientRect(),n=e.clientX/t.width,r=e.clientY/t.height;if(n<this._interactiveArea.left||n>this._interactiveArea.right||r<this._interactiveArea.top||r>this._interactiveArea.bottom)return}const t="mouse"!==e.pointerType?null:(e.buttons&du)===du?du:(e.buttons&mu)===mu?mu:(e.buttons&Au)===Au?Au:null;if(null!==t){const e=this._findPointerByMouseButton(t);e&&this._disposePointer(e)}if((e.buttons&du)===du&&this._lockedPointer)return;const n={pointerId:e.pointerId,clientX:e.clientX,clientY:e.clientY,deltaX:0,deltaY:0,mouseButton:t};this._activePointers.push(n),this._domElement.ownerDocument.removeEventListener("pointermove",s,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",a),this._domElement.ownerDocument.addEventListener("pointermove",s,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",a),this._isDragging=!0,h(e)},s=e=>{e.cancelable&&e.preventDefault();const t=e.pointerId,n=this._lockedPointer||this._findPointerById(t);if(n){if(n.clientX=e.clientX,n.clientY=e.clientY,n.deltaX=e.movementX,n.deltaY=e.movementY,this._state=0,"touch"===e.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(e.buttons&du)===du)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(e.buttons&mu)===mu&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(e.buttons&Au)===Au&&(this._state=this._state|this.mouseButtons.right);d()}},a=e=>{const t=this._findPointerById(e.pointerId);if(!t||t!==this._lockedPointer){if(t&&this._disposePointer(t),"touch"===e.pointerType)switch(this._activePointers.length){case 0:this._state=pu.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._state=pu.NONE;A()}};let c=-1;const l=e=>{if(!this._domElement)return;if(!this._enabled||this.mouseButtons.wheel===pu.NONE)return;if(0!==this._interactiveArea.left||0!==this._interactiveArea.top||1!==this._interactiveArea.width||1!==this._interactiveArea.height){const t=this._domElement.getBoundingClientRect(),n=e.clientX/t.width,r=e.clientY/t.height;if(n<this._interactiveArea.left||n>this._interactiveArea.right||r<this._interactiveArea.top||r>this._interactiveArea.bottom)return}if(e.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===pu.ROTATE||this.mouseButtons.wheel===pu.TRUCK){const e=performance.now();c-e<1e3&&this._getClientRect(this._elementRect),c=e}const t=Lu?-1:-3,n=1===e.deltaMode?e.deltaY/t:e.deltaY/(10*t),r=this.dollyToCursor?(e.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,i=this.dollyToCursor?(e.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case pu.ROTATE:this._rotateInternal(e.deltaX,e.deltaY),this._isUserControllingRotate=!0;break;case pu.TRUCK:this._truckInternal(e.deltaX,e.deltaY,!1),this._isUserControllingTruck=!0;break;case pu.OFFSET:this._truckInternal(e.deltaX,e.deltaY,!0),this._isUserControllingOffset=!0;break;case pu.DOLLY:this._dollyInternal(-n,r,i),this._isUserControllingDolly=!0;break;case pu.ZOOM:this._zoomInternal(-n,r,i),this._isUserControllingZoom=!0}this.dispatchEvent({type:"control"})},u=e=>{if(this._domElement&&this._enabled){if(this.mouseButtons.right===ch.ACTION.NONE){const t=e instanceof PointerEvent?e.pointerId:0,n=this._findPointerById(t);return n&&this._disposePointer(n),this._domElement.ownerDocument.removeEventListener("pointermove",s,{passive:!1}),void this._domElement.ownerDocument.removeEventListener("pointerup",a)}e.preventDefault()}},h=e=>{if(!this._enabled)return;Pu(this._activePointers,Gu),this._getClientRect(this._elementRect),n.copy(Gu),r.copy(Gu);if(this._activePointers.length>=2){const e=Gu.x-this._activePointers[1].clientX,t=Gu.y-this._activePointers[1].clientY,n=Math.sqrt(e*e+t*t);i.set(0,n);const o=.5*(this._activePointers[0].clientX+this._activePointers[1].clientX),s=.5*(this._activePointers[0].clientY+this._activePointers[1].clientY);r.set(o,s)}if(this._state=0,e)if("pointerType"in e&&"touch"===e.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._lockedPointer||(e.buttons&du)!==du||(this._state=this._state|this.mouseButtons.left),(e.buttons&mu)===mu&&(this._state=this._state|this.mouseButtons.middle),(e.buttons&Au)===Au&&(this._state=this._state|this.mouseButtons.right);else this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);(this._state&pu.ROTATE)!==pu.ROTATE&&(this._state&pu.TOUCH_ROTATE)!==pu.TOUCH_ROTATE&&(this._state&pu.TOUCH_DOLLY_ROTATE)!==pu.TOUCH_DOLLY_ROTATE&&(this._state&pu.TOUCH_ZOOM_ROTATE)!==pu.TOUCH_ZOOM_ROTATE||(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),(this._state&pu.TRUCK)!==pu.TRUCK&&(this._state&pu.TOUCH_TRUCK)!==pu.TOUCH_TRUCK&&(this._state&pu.TOUCH_DOLLY_TRUCK)!==pu.TOUCH_DOLLY_TRUCK&&(this._state&pu.TOUCH_ZOOM_TRUCK)!==pu.TOUCH_ZOOM_TRUCK||(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),(this._state&pu.DOLLY)!==pu.DOLLY&&(this._state&pu.TOUCH_DOLLY)!==pu.TOUCH_DOLLY&&(this._state&pu.TOUCH_DOLLY_TRUCK)!==pu.TOUCH_DOLLY_TRUCK&&(this._state&pu.TOUCH_DOLLY_OFFSET)!==pu.TOUCH_DOLLY_OFFSET&&(this._state&pu.TOUCH_DOLLY_ROTATE)!==pu.TOUCH_DOLLY_ROTATE||(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),(this._state&pu.ZOOM)!==pu.ZOOM&&(this._state&pu.TOUCH_ZOOM)!==pu.TOUCH_ZOOM&&(this._state&pu.TOUCH_ZOOM_TRUCK)!==pu.TOUCH_ZOOM_TRUCK&&(this._state&pu.TOUCH_ZOOM_OFFSET)!==pu.TOUCH_ZOOM_OFFSET&&(this._state&pu.TOUCH_ZOOM_ROTATE)!==pu.TOUCH_ZOOM_ROTATE||(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),(this._state&pu.OFFSET)!==pu.OFFSET&&(this._state&pu.TOUCH_OFFSET)!==pu.TOUCH_OFFSET&&(this._state&pu.TOUCH_DOLLY_OFFSET)!==pu.TOUCH_DOLLY_OFFSET&&(this._state&pu.TOUCH_ZOOM_OFFSET)!==pu.TOUCH_ZOOM_OFFSET||(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},d=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,Pu(this._activePointers,Gu);const e=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,t=e?-e.deltaX:r.x-Gu.x,o=e?-e.deltaY:r.y-Gu.y;if(r.copy(Gu),(this._state&pu.ROTATE)!==pu.ROTATE&&(this._state&pu.TOUCH_ROTATE)!==pu.TOUCH_ROTATE&&(this._state&pu.TOUCH_DOLLY_ROTATE)!==pu.TOUCH_DOLLY_ROTATE&&(this._state&pu.TOUCH_ZOOM_ROTATE)!==pu.TOUCH_ZOOM_ROTATE||(this._rotateInternal(t,o),this._isUserControllingRotate=!0),(this._state&pu.DOLLY)===pu.DOLLY||(this._state&pu.ZOOM)===pu.ZOOM){const e=this.dollyToCursor?(n.x-this._elementRect.x)/this._elementRect.width*2-1:0,t=this.dollyToCursor?(n.y-this._elementRect.y)/this._elementRect.height*-2+1:0,r=this.dollyDragInverted?-1:1;(this._state&pu.DOLLY)===pu.DOLLY?(this._dollyInternal(r*o*ku,e,t),this._isUserControllingDolly=!0):(this._zoomInternal(r*o*ku,e,t),this._isUserControllingZoom=!0)}if((this._state&pu.TOUCH_DOLLY)===pu.TOUCH_DOLLY||(this._state&pu.TOUCH_ZOOM)===pu.TOUCH_ZOOM||(this._state&pu.TOUCH_DOLLY_TRUCK)===pu.TOUCH_DOLLY_TRUCK||(this._state&pu.TOUCH_ZOOM_TRUCK)===pu.TOUCH_ZOOM_TRUCK||(this._state&pu.TOUCH_DOLLY_OFFSET)===pu.TOUCH_DOLLY_OFFSET||(this._state&pu.TOUCH_ZOOM_OFFSET)===pu.TOUCH_ZOOM_OFFSET||(this._state&pu.TOUCH_DOLLY_ROTATE)===pu.TOUCH_DOLLY_ROTATE||(this._state&pu.TOUCH_ZOOM_ROTATE)===pu.TOUCH_ZOOM_ROTATE){const e=Gu.x-this._activePointers[1].clientX,t=Gu.y-this._activePointers[1].clientY,n=Math.sqrt(e*e+t*t),o=i.y-n;i.set(0,n);const s=this.dollyToCursor?(r.x-this._elementRect.x)/this._elementRect.width*2-1:0,a=this.dollyToCursor?(r.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&pu.TOUCH_DOLLY)===pu.TOUCH_DOLLY||(this._state&pu.TOUCH_DOLLY_ROTATE)===pu.TOUCH_DOLLY_ROTATE||(this._state&pu.TOUCH_DOLLY_TRUCK)===pu.TOUCH_DOLLY_TRUCK||(this._state&pu.TOUCH_DOLLY_OFFSET)===pu.TOUCH_DOLLY_OFFSET?(this._dollyInternal(o*ku,s,a),this._isUserControllingDolly=!0):(this._zoomInternal(o*ku,s,a),this._isUserControllingZoom=!0)}(this._state&pu.TRUCK)!==pu.TRUCK&&(this._state&pu.TOUCH_TRUCK)!==pu.TOUCH_TRUCK&&(this._state&pu.TOUCH_DOLLY_TRUCK)!==pu.TOUCH_DOLLY_TRUCK&&(this._state&pu.TOUCH_ZOOM_TRUCK)!==pu.TOUCH_ZOOM_TRUCK||(this._truckInternal(t,o,!1),this._isUserControllingTruck=!0),(this._state&pu.OFFSET)!==pu.OFFSET&&(this._state&pu.TOUCH_OFFSET)!==pu.TOUCH_OFFSET&&(this._state&pu.TOUCH_DOLLY_OFFSET)!==pu.TOUCH_DOLLY_OFFSET&&(this._state&pu.TOUCH_ZOOM_OFFSET)!==pu.TOUCH_ZOOM_OFFSET||(this._truckInternal(t,o,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},A=()=>{Pu(this._activePointers,Gu),r.copy(Gu),this._dragNeedsUpdate=!1,(0===this._activePointers.length||1===this._activePointers.length&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),0===this._activePointers.length&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",s,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",a),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{this._enabled&&this._domElement&&(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",s,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",a),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",m),this._domElement.ownerDocument.addEventListener("pointerlockerror",p),this._domElement.ownerDocument.addEventListener("pointermove",s,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",a),h())},this.unlockPointer=()=>{var e,t,n;null!==this._lockedPointer&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),null===(e=this._domElement)||void 0===e||e.ownerDocument.exitPointerLock(),null===(t=this._domElement)||void 0===t||t.ownerDocument.removeEventListener("pointerlockchange",m),null===(n=this._domElement)||void 0===n||n.ownerDocument.removeEventListener("pointerlockerror",p),this.cancel()};const m=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},p=()=>{this.unlockPointer()};this._addAllEventListeners=e=>{this._domElement=e,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",o),this._domElement.addEventListener("pointercancel",a),this._domElement.addEventListener("wheel",l,{passive:!1}),this._domElement.addEventListener("contextmenu",u)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",o),this._domElement.removeEventListener("pointercancel",a),this._domElement.removeEventListener("wheel",l,{passive:!1}),this._domElement.removeEventListener("contextmenu",u),this._domElement.ownerDocument.removeEventListener("pointermove",s,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",a),this._domElement.ownerDocument.removeEventListener("pointerlockchange",m),this._domElement.ownerDocument.removeEventListener("pointerlockerror",p))},this.cancel=()=>{this._state!==pu.NONE&&(this._state=pu.NONE,this._activePointers.length=0,A())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=_u(e.width,0,1),this._interactiveArea.height=_u(e.height,0,1),this._interactiveArea.x=_u(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=_u(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,n=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,n)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,n=!1){this._isUserControllingRotate=!1;const r=_u(e,this.minAzimuthAngle,this.maxAzimuthAngle),i=_u(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=r,this._sphericalEnd.phi=i,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,n||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const o=!n||Bu(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Bu(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(o)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=fu,this._changedDolly=0,this._dollyToNoClamp(_u(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const n=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const t=this._collisionTest(),r=Bu(t,this._spherical.radius);if(!(n>e)&&r)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,t)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const r=!t||Bu(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(r)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(Wu).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const n=!t||Bu(this._target.x,this._targetEnd.x,this.restThreshold)&&Bu(this._target.y,this._targetEnd.y,this.restThreshold)&&Bu(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=_u(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const n=!t||Bu(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(n)}pan(e,t,n=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,n)}truck(e,t,n=!1){this._camera.updateMatrix(),Yu.setFromMatrixColumn(this._camera.matrix,0),Xu.setFromMatrixColumn(this._camera.matrix,1),Yu.multiplyScalar(e),Xu.multiplyScalar(-t);const r=ju.copy(Yu).add(Xu),i=Hu.copy(this._targetEnd).add(r);return this.moveTo(i.x,i.y,i.z,n)}forward(e,t=!1){ju.setFromMatrixColumn(this._camera.matrix,0),ju.crossVectors(this._camera.up,ju),ju.multiplyScalar(e);const n=Hu.copy(this._targetEnd).add(ju);return this.moveTo(n.x,n.y,n.z,t)}elevate(e,t=!1){return ju.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+ju.x,this._targetEnd.y+ju.y,this._targetEnd.z+ju.z,t)}moveTo(e,t,n,r=!1){this._isUserControllingTruck=!1;const i=ju.set(e,t,n).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,i,this.boundaryFriction),this._needsUpdate=!0,r||this._target.copy(this._targetEnd);const o=!r||Bu(this._target.x,this._targetEnd.x,this.restThreshold)&&Bu(this._target.y,this._targetEnd.y,this.restThreshold)&&Bu(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}lookInDirectionOf(e,t,n,r=!1){const i=ju.set(e,t,n).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(i.x,i.y,i.z,r)}fitToBox(e,t,{cover:n=!1,paddingLeft:r=0,paddingRight:i=0,paddingBottom:o=0,paddingTop:s=0}={}){const a=[],c=e.isBox3?th.copy(e):th.setFromObject(e);c.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const l=Mu(this._sphericalEnd.theta,wu),u=Mu(this._sphericalEnd.phi,wu);a.push(this.rotateTo(l,u,t));const h=ju.setFromSpherical(this._sphericalEnd).normalize(),d=ih.setFromUnitVectors(h,Vu),A=Bu(Math.abs(h.y),1);A&&d.multiply(oh.setFromAxisAngle(Nu,l)),d.multiply(this._yAxisUpSpaceInverse);const m=nh.makeEmpty();Hu.copy(c.min).applyQuaternion(d),m.expandByPoint(Hu),Hu.copy(c.min).setX(c.max.x).applyQuaternion(d),m.expandByPoint(Hu),Hu.copy(c.min).setY(c.max.y).applyQuaternion(d),m.expandByPoint(Hu),Hu.copy(c.max).setZ(c.min.z).applyQuaternion(d),m.expandByPoint(Hu),Hu.copy(c.min).setZ(c.max.z).applyQuaternion(d),m.expandByPoint(Hu),Hu.copy(c.max).setY(c.min.y).applyQuaternion(d),m.expandByPoint(Hu),Hu.copy(c.max).setX(c.min.x).applyQuaternion(d),m.expandByPoint(Hu),Hu.copy(c.max).applyQuaternion(d),m.expandByPoint(Hu),m.min.x-=r,m.min.y-=o,m.max.x+=i,m.max.y+=s,d.setFromUnitVectors(Vu,h),A&&d.premultiply(oh.invert()),d.premultiply(this._yAxisUpSpace);const p=m.getSize(ju),f=m.getCenter(Hu).applyQuaternion(d);if(vu(this._camera)){const e=this.getDistanceToFitBox(p.x,p.y,p.z,n);a.push(this.moveTo(f.x,f.y,f.z,t)),a.push(this.dollyTo(e,t)),a.push(this.setFocalOffset(0,0,0,t))}else if(xu(this._camera)){const e=this._camera,r=e.right-e.left,i=e.top-e.bottom,o=n?Math.max(r/p.x,i/p.y):Math.min(r/p.x,i/p.y);a.push(this.moveTo(f.x,f.y,f.z,t)),a.push(this.zoomTo(o,t)),a.push(this.setFocalOffset(0,0,0,t))}return Promise.all(a)}fitToSphere(e,t){const n=[],r="isObject3D"in e?ch.createBoundingSphere(e,rh):rh.copy(e);if(n.push(this.moveTo(r.center.x,r.center.y,r.center.z,t)),vu(this._camera)){const e=this.getDistanceToFitSphere(r.radius);n.push(this.dollyTo(e,t))}else if(xu(this._camera)){const e=this._camera.right-this._camera.left,i=this._camera.top-this._camera.bottom,o=2*r.radius,s=Math.min(e/o,i/o);n.push(this.zoomTo(s,t))}return n.push(this.setFocalOffset(0,0,0,t)),Promise.all(n)}setLookAt(e,t,n,r,i,o,s=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=fu,this._changedDolly=0;const a=Hu.set(r,i,o),c=ju.set(e,t,n);this._targetEnd.copy(a),this._sphericalEnd.setFromVector3(c.sub(a).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,s||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const l=!s||Bu(this._target.x,this._targetEnd.x,this.restThreshold)&&Bu(this._target.y,this._targetEnd.y,this.restThreshold)&&Bu(this._target.z,this._targetEnd.z,this.restThreshold)&&Bu(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Bu(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Bu(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(l)}lerpLookAt(e,t,n,r,i,o,s,a,c,l,u,h,d,A=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=fu,this._changedDolly=0;const m=ju.set(r,i,o),p=Hu.set(e,t,n);$u.setFromVector3(p.sub(m).applyQuaternion(this._yAxisUpSpace));const f=qu.set(l,u,h),g=Hu.set(s,a,c);eh.setFromVector3(g.sub(f).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(m.lerp(f,d));const y=eh.theta-$u.theta,v=eh.phi-$u.phi,x=eh.radius-$u.radius;this._sphericalEnd.set($u.radius+x*d,$u.phi+v*d,$u.theta+y*d),this.normalizeRotations(),this._needsUpdate=!0,A||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const E=!A||Bu(this._target.x,this._targetEnd.x,this.restThreshold)&&Bu(this._target.y,this._targetEnd.y,this.restThreshold)&&Bu(this._target.z,this._targetEnd.z,this.restThreshold)&&Bu(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Bu(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Bu(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(E)}setPosition(e,t,n,r=!1){return this.setLookAt(e,t,n,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,r)}setTarget(e,t,n,r=!1){const i=this.getPosition(ju),o=this.setLookAt(i.x,i.y,i.z,e,t,n,r);return this._sphericalEnd.phi=_u(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),o}setFocalOffset(e,t,n,r=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,n),this._needsUpdate=!0,r||this._focalOffset.copy(this._focalOffsetEnd);const i=!r||Bu(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&Bu(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&Bu(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(i)}setOrbitPoint(e,t,n){this._camera.updateMatrixWorld(),Yu.setFromMatrixColumn(this._camera.matrixWorldInverse,0),Xu.setFromMatrixColumn(this._camera.matrixWorldInverse,1),Zu.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const r=ju.set(e,t,n),i=r.distanceTo(this._camera.position),o=r.sub(this._camera.position);Yu.multiplyScalar(o.x),Xu.multiplyScalar(o.y),Zu.multiplyScalar(o.z),ju.copy(Yu).add(Xu).add(Zu),ju.z=ju.z+i,this.dollyTo(i,!1),this.setFocalOffset(-ju.x,ju.y,-ju.z,!1),this.moveTo(e,t,n,!1)}setBoundary(e){if(!e)return this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),void(this._needsUpdate=!0);this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,n,r){null!==e?(this._viewport=this._viewport||new Ou.Vector4,"number"===typeof e?this._viewport.set(e,t,n,r):this._viewport.copy(e)):this._viewport=null}getDistanceToFitBox(e,t,n,r=!1){if(zu(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const i=e/t,o=this._camera.getEffectiveFOV()*Iu,s=this._camera.aspect;return.5*((r?i>s:i<s)?t:e/s)/Math.tan(.5*o)+.5*n}getDistanceToFitSphere(e){if(zu(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*Iu,n=2*Math.atan(Math.tan(.5*t)*this._camera.aspect),r=1<this._camera.aspect?t:n;return e/Math.sin(.5*r)}getTarget(e,t=!0){return(e&&e.isVector3?e:new Ou.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new Ou.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e||new Ou.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new Ou.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%Eu,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=Eu),this._spherical.theta+=Eu*Math.round((this._sphericalEnd.theta-this._spherical.theta)/Eu)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(e=!1){if(!Bu(this._camera.up.x,this._cameraUp0.x)||!Bu(this._camera.up.y,this._cameraUp0.y)||!Bu(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const e=this.getPosition(ju);this.updateCameraUp(),this.setPosition(e.x,e.y,e.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,Nu),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=ju.subVectors(this._target,this._camera.position).normalize(),t=Hu.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const n=this.getPosition(ju);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,n=this._sphericalEnd.phi-this._spherical.phi,r=this._sphericalEnd.radius-this._spherical.radius,i=Ku.subVectors(this._targetEnd,this._target),o=Ju.subVectors(this._focalOffsetEnd,this._focalOffset),s=this._zoomEnd-this._zoom;if(bu(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const t=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=Tu(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,t,1/0,e),this._needsUpdate=!0}if(bu(n))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const t=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=Tu(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,t,1/0,e),this._needsUpdate=!0}if(bu(r))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const t=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=Tu(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,t,this.maxSpeed,e),this._needsUpdate=!0}if(bu(i.x)&&bu(i.y)&&bu(i.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const t=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;Qu(this._target,this._targetEnd,this._targetVelocity,t,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(bu(o.x)&&bu(o.y)&&bu(o.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const t=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;Qu(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,t,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(bu(s))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const t=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=Tu(this._zoom,this._zoomEnd,this._zoomVelocity,t,1/0,e)}if(this.dollyToCursor)if(vu(this._camera)&&0!==this._changedDolly){const e=this._spherical.radius-this._lastDistance,t=this._camera,n=this._getCameraDirection(Wu),r=ju.copy(n).cross(t.up).normalize();0===r.lengthSq()&&(r.x=1);const i=Hu.crossVectors(r,n),o=this._sphericalEnd.radius*Math.tan(t.getEffectiveFOV()*Iu*.5),s=(this._sphericalEnd.radius-e-this._sphericalEnd.radius)/this._sphericalEnd.radius,a=qu.copy(this._targetEnd).add(r.multiplyScalar(this._dollyControlCoord.x*o*t.aspect)).add(i.multiplyScalar(this._dollyControlCoord.y*o)),c=ju.copy(this._targetEnd).lerp(a,s),l=this._lastDollyDirection===gu&&this._spherical.radius<=this.minDistance,u=this._lastDollyDirection===yu&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(l||u)){this._sphericalEnd.radius-=e,this._spherical.radius-=e;const t=Hu.copy(n).multiplyScalar(-e);c.add(t)}this._boundary.clampPoint(c,c);const h=Hu.subVectors(c,this._targetEnd);this._targetEnd.copy(c),this._target.add(h),this._changedDolly-=e,bu(this._changedDolly)&&(this._changedDolly=0)}else if(xu(this._camera)&&0!==this._changedZoom){const e=this._zoom-this._lastZoom,t=this._camera,n=ju.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(t.near+t.far)/(t.near-t.far)).unproject(t),r=Hu.set(0,0,-1).applyQuaternion(t.quaternion),i=qu.copy(n).add(r.multiplyScalar(-n.dot(t.up))),o=-(this._zoom-e-this._zoom)/this._zoom,s=this._getCameraDirection(Wu),a=this._targetEnd.dot(s),c=ju.copy(this._targetEnd).lerp(i,o),l=c.dot(s),u=s.multiplyScalar(l-a);c.sub(u),this._boundary.clampPoint(c,c);const h=Hu.subVectors(c,this._targetEnd);this._targetEnd.copy(c),this._target.add(h),this._changedZoom-=e,bu(this._changedZoom)&&(this._changedZoom=0)}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const a=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,a),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target);(!bu(this._focalOffset.x)||!bu(this._focalOffset.y)||!bu(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),Yu.setFromMatrixColumn(this._camera.matrix,0),Xu.setFromMatrixColumn(this._camera.matrix,1),Zu.setFromMatrixColumn(this._camera.matrix,2),Yu.multiplyScalar(this._focalOffset.x),Xu.multiplyScalar(-this._focalOffset.y),Zu.multiplyScalar(this._focalOffset.z),ju.copy(Yu).add(Xu).add(Zu),this._camera.position.add(ju)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),ju.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const c=this._needsUpdate;return c&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):c?(this.dispatchEvent({type:"update"}),bu(t,this.restThreshold)&&bu(n,this.restThreshold)&&bu(r,this.restThreshold)&&bu(i.x,this.restThreshold)&&bu(i.y,this.restThreshold)&&bu(i.z,this.restThreshold)&&bu(o.x,this.restThreshold)&&bu(o.y,this.restThreshold)&&bu(o.z,this.restThreshold)&&bu(s,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!c&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=c,this._needsUpdate=!1,c}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Su(this.maxDistance),minZoom:this.minZoom,maxZoom:Su(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Su(this.maxPolarAngle),minAzimuthAngle:Su(this.minAzimuthAngle),maxAzimuthAngle:Su(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:ju.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const n=JSON.parse(e);this.enabled=n.enabled,this.minDistance=n.minDistance,this.maxDistance=Du(n.maxDistance),this.minZoom=n.minZoom,this.maxZoom=Du(n.maxZoom),this.minPolarAngle=n.minPolarAngle,this.maxPolarAngle=Du(n.maxPolarAngle),this.minAzimuthAngle=Du(n.minAzimuthAngle),this.maxAzimuthAngle=Du(n.maxAzimuthAngle),this.smoothTime=n.smoothTime,this.draggingSmoothTime=n.draggingSmoothTime,this.dollySpeed=n.dollySpeed,this.truckSpeed=n.truckSpeed,this.dollyToCursor=n.dollyToCursor,this.verticalDragToForward=n.verticalDragToForward,this._target0.fromArray(n.target0),this._position0.fromArray(n.position0),this._zoom0=n.zoom0,this._focalOffset0.fromArray(n.focalOffset0),this.moveTo(n.target[0],n.target[1],n.target[2],t),$u.setFromVector3(ju.fromArray(n.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo($u.theta,$u.phi,t),this.dollyTo($u.radius,t),this.zoomTo(n.zoom,t),this.setFocalOffset(n.focalOffset[0],n.focalOffset[1],n.focalOffset[2],t),this._needsUpdate=!0}connect(e){this._domElement?console.warn("camera-controls is already connected."):(e.setAttribute("data-camera-controls-version","2.9.0"),this._addAllEventListeners(e),this._getClientRect(this._elementRect))}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find((t=>t.pointerId===e))}_findPointerByMouseButton(e){return this._activePointers.find((t=>t.mouseButton===e))}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,n){const r=t.lengthSq();if(0===r)return e;const i=Hu.copy(t).add(e),o=this._boundary.clampPoint(i,qu).sub(i),s=o.lengthSq();if(0===s)return e.add(t);if(s===r)return e;if(0===n)return e.add(t).add(o);{const r=1+n*s/t.dot(o);return e.add(Hu.copy(t).multiplyScalar(r)).add(o.multiplyScalar(1-n))}}_updateNearPlaneCorners(){if(vu(this._camera)){const e=this._camera,t=e.near,n=e.getEffectiveFOV()*Iu,r=Math.tan(.5*n)*t,i=r*e.aspect;this._nearPlaneCorners[0].set(-i,-r,0),this._nearPlaneCorners[1].set(i,-r,0),this._nearPlaneCorners[2].set(i,r,0),this._nearPlaneCorners[3].set(-i,r,0)}else if(xu(this._camera)){const e=this._camera,t=1/e.zoom,n=e.left*t,r=e.right*t,i=e.top*t,o=e.bottom*t;this._nearPlaneCorners[0].set(n,i,0),this._nearPlaneCorners[1].set(r,i,0),this._nearPlaneCorners[2].set(r,o,0),this._nearPlaneCorners[3].set(n,o,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1))return e;if(zu(this._camera,"_collisionTest"))return e;const t=this._getTargetDirection(Wu);sh.lookAt(Uu,t,this._camera.up);for(let n=0;n<4;n++){const r=Hu.copy(this._nearPlaneCorners[n]);r.applyMatrix4(sh);const i=qu.addVectors(this._target,r);ah.set(i,t),ah.far=this._spherical.radius+1;const o=ah.intersectObjects(this.colliderMeshes);0!==o.length&&o[0].distance<e&&(e=o[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise((e=>{const t=()=>{this.removeEventListener("rest",t),e()};this.addEventListener("rest",t)})))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new Ou.Sphere){const n=t,r=n.center;th.makeEmpty(),e.traverseVisible((e=>{e.isMesh&&th.expandByObject(e)})),th.getCenter(r);let i=0;return e.traverseVisible((e=>{if(!e.isMesh)return;const t=e,n=t.geometry.clone();n.applyMatrix4(t.matrixWorld);const o=n.attributes.position;for(let s=0,a=o.count;s<a;s++)ju.fromBufferAttribute(o,s),i=Math.max(i,r.distanceToSquared(ju))})),n.radius=Math.sqrt(i),n}}const lh=(0,i.forwardRef)(((e,t)=>{(0,i.useMemo)((()=>{const e={Box3:s.Box3,MathUtils:{clamp:s.MathUtils.clamp},Matrix4:s.Matrix4,Quaternion:s.Quaternion,Raycaster:s.Raycaster,Sphere:s.Sphere,Spherical:s.Spherical,Vector2:s.Vector2,Vector3:s.Vector3,Vector4:s.Vector4};ch.install({THREE:e}),(0,a.e)({CameraControlsImpl:ch})}),[]);const{camera:n,domElement:o,makeDefault:c,onStart:l,onEnd:u,onChange:h,regress:d,...A}=e,m=(0,a.D)((e=>e.camera)),p=(0,a.D)((e=>e.gl)),f=(0,a.D)((e=>e.invalidate)),g=(0,a.D)((e=>e.events)),y=(0,a.D)((e=>e.setEvents)),v=(0,a.D)((e=>e.set)),x=(0,a.D)((e=>e.get)),E=(0,a.D)((e=>e.performance)),w=n||m,C=o||g.connected||p.domElement,I=(0,i.useMemo)((()=>new ch(w)),[w]);return(0,a.F)(((e,t)=>{I.enabled&&I.update(t)}),-1),(0,i.useEffect)((()=>(I.connect(C),()=>{I.disconnect()})),[C,I]),(0,i.useEffect)((()=>{const e=e=>{f(),d&&E.regress(),h&&h(e)},t=e=>{l&&l(e)},n=e=>{u&&u(e)};return I.addEventListener("update",e),I.addEventListener("controlstart",t),I.addEventListener("controlend",n),I.addEventListener("control",e),I.addEventListener("transitionstart",e),I.addEventListener("wake",e),()=>{I.removeEventListener("update",e),I.removeEventListener("controlstart",t),I.removeEventListener("controlend",n),I.removeEventListener("control",e),I.removeEventListener("transitionstart",e),I.removeEventListener("wake",e)}}),[I,l,u,f,y,d,h]),(0,i.useEffect)((()=>{if(c){const e=x().controls;return v({controls:I}),()=>v({controls:e})}}),[c,I]),i.createElement("primitive",(0,r.Z)({ref:t,object:I},A))})),uh=i.createContext(null);function hh(){return i.useContext(uh)}function dh({points:e=50}){const{path:t}=hh(),[n,r]=i.useState([]),[o]=i.useState((()=>new s.MeshBasicMaterial({color:"black"}))),[a]=i.useState((()=>new s.SphereGeometry(.025,16,16))),c=i.useRef([]);return i.useEffect((()=>{t.curves!==c.current&&(r(t.getPoints(e)),c.current=t.curves)})),i.createElement(i.Fragment,null,n.map(((e,t)=>i.createElement("mesh",{key:t,material:o,geometry:a,position:[e.x,e.y,e.z]}))))}const Ah=i.forwardRef((({children:e,curves:t=[],object:n,debug:o=!1,smooth:c=!1,focus:l,offset:u,eps:h=1e-5,damping:d=.1,focusDamping:A=.1,maxSpeed:m=1/0,...p},f)=>{const{camera:g}=(0,a.D)(),y=i.useRef(),[v]=i.useState((()=>new s.CurvePath)),x=i.useRef(null!==u&&void 0!==u?u:0),E=i.useMemo((()=>({focus:l,object:(null==n?void 0:n.current)instanceof s.Object3D?n:{current:g},path:v,current:x.current,offset:x.current,point:new s.Vector3,tangent:new s.Vector3,next:new s.Vector3})),[l,n]);i.useLayoutEffect((()=>{var e;v.curves=[];const n=t.length>0?t:null==(e=y.current)?void 0:e.__r3f.objects;for(var r=0;r<n.length;r++)v.add(n[r]);if(c){const e=v.getPoints("number"===typeof c?c:1),t=new s.CatmullRomCurve3(e);v.curves=[t]}v.updateArcLengths()})),i.useImperativeHandle(f,(()=>y.current),[]),i.useLayoutEffect((()=>{x.current=yt.repeat(x.current,1)}),[u]);let w=0;const[C]=i.useState((()=>new s.Vector3));return(0,a.F)(((e,t)=>{if(w=E.offset,Sn.damp(x,"current",void 0!==u?u:E.current,d,t,m,void 0,h),E.offset=yt.repeat(x.current,1),v.getCurveLengths().length>0){v.getPointAt(E.offset,E.point),v.getTangentAt(E.offset,E.tangent).normalize(),v.getPointAt(yt.repeat(x.current-(w-E.offset),1),E.next);const e=(null==n?void 0:n.current)instanceof s.Object3D?n.current:g;e.position.copy(E.point),l&&Sn.dampLookAt(e,(e=>(null==e?void 0:e.current)instanceof s.Object3D)(l)?l.current.getWorldPosition(C):l,A,t,m,void 0,h)}})),i.createElement("group",(0,r.Z)({ref:y},p),i.createElement(uh.Provider,{value:E},e,o&&i.createElement(dh,null)))}));function mh({defaultScene:e,defaultCamera:t,renderPriority:n=1}){const{gl:r,scene:o,camera:s}=(0,a.D)();let c;return(0,a.F)((()=>{c=r.autoClear,1===n&&(r.autoClear=!0,r.render(e,t)),r.autoClear=!1,r.clearDepth(),r.render(o,s),r.autoClear=c}),n),i.createElement("group",{onPointerOver:()=>null})}function ph({children:e,renderPriority:t=1}){const{scene:n,camera:r}=(0,a.D)(),[o]=i.useState((()=>new s.Scene));return i.createElement(i.Fragment,null,(0,a.h)(i.createElement(i.Fragment,null,e,i.createElement(mh,{defaultScene:n,defaultCamera:r,renderPriority:t})),o,{events:{priority:t+1}}))}const fh=i.createContext({}),gh=()=>i.useContext(fh),yh=2*Math.PI,vh=new s.Object3D,xh=new s.Matrix4,[Eh,wh]=[new s.Quaternion,new s.Quaternion],Ch=new s.Vector3,Ih=new s.Vector3,_h=e=>"getTarget"in e,bh=({alignment:e="bottom-right",margin:t=[80,80],renderPriority:n=1,onUpdate:r,onTarget:o,children:c})=>{const l=(0,a.D)((e=>e.size)),u=(0,a.D)((e=>e.camera)),h=(0,a.D)((e=>e.controls)),d=(0,a.D)((e=>e.invalidate)),A=i.useRef(null),m=i.useRef(null),p=i.useRef(!1),f=i.useRef(0),g=i.useRef(new s.Vector3(0,0,0)),y=i.useRef(new s.Vector3(0,0,0));i.useEffect((()=>{y.current.copy(u.up)}),[u]);const v=i.useCallback((e=>{p.current=!0,(h||o)&&(g.current=(null==o?void 0:o())||(_h(h)?h.getTarget(g.current):null==h?void 0:h.target)),f.current=u.position.distanceTo(Ch),Eh.copy(u.quaternion),Ih.copy(e).multiplyScalar(f.current).add(Ch),vh.lookAt(Ih),wh.copy(vh.quaternion),d()}),[h,u,o,d]);(0,a.F)(((e,t)=>{if(m.current&&A.current){var n;if(p.current)if(Eh.angleTo(wh)<.01)p.current=!1,"minPolarAngle"in h&&u.up.copy(y.current);else{const e=t*yh;Eh.rotateTowards(wh,e),u.position.set(0,0,1).applyQuaternion(Eh).multiplyScalar(f.current).add(g.current),u.up.set(0,1,0).applyQuaternion(Eh).normalize(),u.quaternion.copy(Eh),_h(h)&&h.setPosition(u.position.x,u.position.y,u.position.z),r?r():h&&h.update(t),d()}xh.copy(u.matrix).invert(),null==(n=A.current)||n.quaternion.setFromRotationMatrix(xh)}}));const x=i.useMemo((()=>({tweenCamera:v})),[v]),[E,w]=t,C=e.endsWith("-center")?0:e.endsWith("-left")?-l.width/2+E:l.width/2-E,I=e.startsWith("center-")?0:e.startsWith("top-")?l.height/2-w:-l.height/2+w;return i.createElement(ph,{renderPriority:n},i.createElement(fh.Provider,{value:x},i.createElement(al,{makeDefault:!0,ref:m,position:[0,0,200]}),i.createElement("group",{ref:A,position:[C,I,0]},c)))},Bh="#f0f0f0",Mh="#999",Sh="black",Dh="black",Th=["Right","Left","Top","Bottom","Front","Back"],Qh=e=>new s.Vector3(...e).multiplyScalar(.38),Ph=[[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1],[-1,1,1],[-1,1,-1],[-1,-1,1],[-1,-1,-1]].map(Qh),zh=[.25,.25,.25],Rh=[[1,1,0],[1,0,1],[1,0,-1],[1,-1,0],[0,1,1],[0,1,-1],[0,-1,1],[0,-1,-1],[-1,1,0],[-1,0,1],[-1,0,-1],[-1,-1,0]].map(Qh),Fh=Rh.map((e=>e.toArray().map((e=>0==e?.5:.25)))),kh=({hover:e,index:t,font:n="20px Inter var, Arial, sans-serif",faces:r=Th,color:o=Bh,hoverColor:c=Mh,textColor:l=Sh,strokeColor:u=Dh,opacity:h=1})=>{const d=(0,a.D)((e=>e.gl)),A=i.useMemo((()=>{const e=document.createElement("canvas");e.width=128,e.height=128;const i=e.getContext("2d");return i.fillStyle=o,i.fillRect(0,0,e.width,e.height),i.strokeStyle=u,i.strokeRect(0,0,e.width,e.height),i.font=n,i.textAlign="center",i.fillStyle=l,i.fillText(r[t].toUpperCase(),64,76),new s.CanvasTexture(e)}),[t,r,n,o,l,u]);return i.createElement("meshBasicMaterial",{map:A,"map-anisotropy":d.capabilities.getMaxAnisotropy()||1,attach:`material-${t}`,color:e?c:"white",transparent:!0,opacity:h})},Lh=e=>{const{tweenCamera:t}=gh(),[n,o]=i.useState(null);return i.createElement("mesh",{onPointerOut:e=>{e.stopPropagation(),o(null)},onPointerMove:e=>{e.stopPropagation(),o(Math.floor(e.faceIndex/2))},onClick:e.onClick||(e=>{e.stopPropagation(),t(e.face.normal)})},[...Array(6)].map(((t,o)=>i.createElement(kh,(0,r.Z)({key:o,index:o,hover:n===o},e)))),i.createElement("boxGeometry",null))},Oh=({onClick:e,dimensions:t,position:n,hoverColor:r=Mh})=>{const{tweenCamera:o}=gh(),[s,a]=i.useState(!1);return i.createElement("mesh",{scale:1.01,position:n,onPointerOver:e=>{e.stopPropagation(),a(!0)},onPointerOut:e=>{e.stopPropagation(),a(!1)},onClick:e||(e=>{e.stopPropagation(),o(n)})},i.createElement("meshBasicMaterial",{color:s?r:"white",transparent:!0,opacity:.6,visible:s}),i.createElement("boxGeometry",{args:t}))},Uh=e=>i.createElement("group",{scale:[60,60,60]},i.createElement(Lh,e),Rh.map(((t,n)=>i.createElement(Oh,(0,r.Z)({key:n,position:t,dimensions:Fh[n]},e)))),Ph.map(((t,n)=>i.createElement(Oh,(0,r.Z)({key:n,position:t,dimensions:zh},e)))));function Nh({scale:e=[.8,.05,.05],color:t,rotation:n}){return i.createElement("group",{rotation:n},i.createElement("mesh",{position:[.4,0,0]},i.createElement("boxGeometry",{args:e}),i.createElement("meshBasicMaterial",{color:t,toneMapped:!1})))}function Vh({onClick:e,font:t,disabled:n,arcStyle:o,label:c,labelColor:l,axisHeadScale:u=1,...h}){const d=(0,a.D)((e=>e.gl)),A=i.useMemo((()=>{const e=document.createElement("canvas");e.width=64,e.height=64;const n=e.getContext("2d");return n.beginPath(),n.arc(32,32,16,0,2*Math.PI),n.closePath(),n.fillStyle=o,n.fill(),c&&(n.font=t,n.textAlign="center",n.fillStyle=l,n.fillText(c,32,41)),new s.CanvasTexture(e)}),[o,c,l,t]),[m,p]=i.useState(!1),f=(c?1:.75)*(m?1.2:1)*u;return i.createElement("sprite",(0,r.Z)({scale:f,onPointerOver:n?void 0:e=>{e.stopPropagation(),p(!0)},onPointerOut:n?void 0:e||(e=>{e.stopPropagation(),p(!1)})},h),i.createElement("spriteMaterial",{map:A,"map-anisotropy":d.capabilities.getMaxAnisotropy()||1,alphaTest:.3,opacity:c?1:.75,toneMapped:!1}))}const Gh=({hideNegativeAxes:e,hideAxisHeads:t,disabled:n,font:o="18px Inter var, Arial, sans-serif",axisColors:s=["#ff2060","#20df80","#2080ff"],axisHeadScale:a=1,axisScale:c,labels:l=["X","Y","Z"],labelColor:u="#000",onClick:h,...d})=>{const[A,m,p]=s,{tweenCamera:f}=gh(),g={font:o,disabled:n,labelColor:u,onClick:h,axisHeadScale:a,onPointerDown:n?void 0:e=>{f(e.object.position),e.stopPropagation()}};return i.createElement("group",(0,r.Z)({scale:40},d),i.createElement(Nh,{color:A,rotation:[0,0,0],scale:c}),i.createElement(Nh,{color:m,rotation:[0,0,Math.PI/2],scale:c}),i.createElement(Nh,{color:p,rotation:[0,-Math.PI/2,0],scale:c}),!t&&i.createElement(i.Fragment,null,i.createElement(Vh,(0,r.Z)({arcStyle:A,position:[1,0,0],label:l[0]},g)),i.createElement(Vh,(0,r.Z)({arcStyle:m,position:[0,1,0],label:l[1]},g)),i.createElement(Vh,(0,r.Z)({arcStyle:p,position:[0,0,1],label:l[2]},g)),!e&&i.createElement(i.Fragment,null,i.createElement(Vh,(0,r.Z)({arcStyle:A,position:[-1,0,0]},g)),i.createElement(Vh,(0,r.Z)({arcStyle:m,position:[0,-1,0]},g)),i.createElement(Vh,(0,r.Z)({arcStyle:p,position:[0,0,-1]},g)))))},jh=cc({cellSize:.5,sectionSize:1,fadeDistance:100,fadeStrength:1,fadeFrom:1,cellThickness:.5,sectionThickness:1,cellColor:new s.Color,sectionColor:new s.Color,infiniteGrid:!1,followCamera:!1,worldCamProjPosition:new s.Vector3,worldPlanePosition:new s.Vector3},"\n    varying vec3 localPosition;\n    varying vec4 worldPosition;\n\n    uniform vec3 worldCamProjPosition;\n    uniform vec3 worldPlanePosition;\n    uniform float fadeDistance;\n    uniform bool infiniteGrid;\n    uniform bool followCamera;\n\n    void main() {\n      localPosition = position.xzy;\n      if (infiniteGrid) localPosition *= 1.0 + fadeDistance;\n      \n      worldPosition = modelMatrix * vec4(localPosition, 1.0);\n      if (followCamera) {\n        worldPosition.xyz += (worldCamProjPosition - worldPlanePosition);\n        localPosition = (inverse(modelMatrix) * worldPosition).xyz;\n      }\n\n      gl_Position = projectionMatrix * viewMatrix * worldPosition;\n    }\n  ",`\n    varying vec3 localPosition;\n    varying vec4 worldPosition;\n\n    uniform vec3 worldCamProjPosition;\n    uniform float cellSize;\n    uniform float sectionSize;\n    uniform vec3 cellColor;\n    uniform vec3 sectionColor;\n    uniform float fadeDistance;\n    uniform float fadeStrength;\n    uniform float fadeFrom;\n    uniform float cellThickness;\n    uniform float sectionThickness;\n\n    float getGrid(float size, float thickness) {\n      vec2 r = localPosition.xz / size;\n      vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);\n      float line = min(grid.x, grid.y) + 1.0 - thickness;\n      return 1.0 - min(line, 1.0);\n    }\n\n    void main() {\n      float g1 = getGrid(cellSize, cellThickness);\n      float g2 = getGrid(sectionSize, sectionThickness);\n\n      vec3 from = worldCamProjPosition*vec3(fadeFrom);\n      float dist = distance(from, worldPosition.xyz);\n      float d = 1.0 - min(dist / fadeDistance, 1.0);\n      vec3 color = mix(cellColor, sectionColor, min(1.0, sectionThickness * g2));\n\n      gl_FragColor = vec4(color, (g1 + g2) * pow(d, fadeStrength));\n      gl_FragColor.a = mix(0.75 * gl_FragColor.a, gl_FragColor.a, g2);\n      if (gl_FragColor.a <= 0.0) discard;\n\n      #include <tonemapping_fragment>\n      #include <${dc>=154?"colorspace_fragment":"encodings_fragment"}>\n    }\n  `),Hh=i.forwardRef((({args:e,cellColor:t="#000000",sectionColor:n="#2080ff",cellSize:o=.5,sectionSize:c=1,followCamera:l=!1,infiniteGrid:u=!1,fadeDistance:h=100,fadeStrength:d=1,fadeFrom:A=1,cellThickness:m=.5,sectionThickness:p=1,side:f=s.BackSide,...g},y)=>{(0,a.e)({GridMaterial:jh});const v=i.useRef(null);i.useImperativeHandle(y,(()=>v.current),[]);const x=new s.Plane,E=new s.Vector3(0,1,0),w=new s.Vector3(0,0,0);(0,a.F)((e=>{x.setFromNormalAndCoplanarPoint(E,w).applyMatrix4(v.current.matrixWorld);const t=v.current.material,n=t.uniforms.worldCamProjPosition,r=t.uniforms.worldPlanePosition;x.projectPoint(e.camera.position,n.value),r.value.set(0,0,0).applyMatrix4(v.current.matrixWorld)}));const C={cellSize:o,sectionSize:c,cellColor:t,sectionColor:n,cellThickness:m,sectionThickness:p},I={fadeDistance:h,fadeStrength:d,fadeFrom:A,infiniteGrid:u,followCamera:l};return i.createElement("mesh",(0,r.Z)({ref:v,frustumCulled:!1},g),i.createElement("gridMaterial",(0,r.Z)({transparent:!0,"extensions-derivatives":!0,side:f},C,I)),i.createElement("planeGeometry",{args:e}))}));function qh(e,{path:t}){const[n]=(0,a.H)(s.CubeTextureLoader,[e],(e=>e.setPath(t)));return n}function Wh({children:e,files:t,...n}){const r=qh(t,{...n});return i.createElement(i.Fragment,null,null==e?void 0:e(r))}qh.preload=(e,{path:t})=>a.H.preload(s.CubeTextureLoader,[e],(e=>e.setPath(t)));var Yh=Uint8Array,Xh=Uint16Array,Zh=Uint32Array,Kh=new Yh([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Jh=new Yh([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),$h=new Yh([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ed=function(e,t){for(var n=new Xh(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var i=new Zh(n[30]);for(r=1;r<30;++r)for(var o=n[r];o<n[r+1];++o)i[o]=o-n[r]<<5|r;return[n,i]},td=ed(Kh,2),nd=td[0],rd=td[1];nd[28]=258,rd[258]=28;for(var id=ed(Jh,0),od=id[0],sd=(id[1],new Xh(32768)),ad=0;ad<32768;++ad){var cd=(43690&ad)>>>1|(21845&ad)<<1;cd=(61680&(cd=(52428&cd)>>>2|(13107&cd)<<2))>>>4|(3855&cd)<<4,sd[ad]=((65280&cd)>>>8|(255&cd)<<8)>>>1}var ld=function(e,t,n){for(var r=e.length,i=0,o=new Xh(t);i<r;++i)++o[e[i]-1];var s,a=new Xh(t);for(i=0;i<t;++i)a[i]=a[i-1]+o[i-1]<<1;if(n){s=new Xh(1<<t);var c=15-t;for(i=0;i<r;++i)if(e[i])for(var l=i<<4|e[i],u=t-e[i],h=a[e[i]-1]++<<u,d=h|(1<<u)-1;h<=d;++h)s[sd[h]>>>c]=l}else for(s=new Xh(r),i=0;i<r;++i)e[i]&&(s[i]=sd[a[e[i]-1]++]>>>15-e[i]);return s},ud=new Yh(288);for(ad=0;ad<144;++ad)ud[ad]=8;for(ad=144;ad<256;++ad)ud[ad]=9;for(ad=256;ad<280;++ad)ud[ad]=7;for(ad=280;ad<288;++ad)ud[ad]=8;var hd=new Yh(32);for(ad=0;ad<32;++ad)hd[ad]=5;var dd=ld(ud,9,1),Ad=ld(hd,5,1),md=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},pd=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},fd=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},gd=function(e){return(e/8|0)+(7&e&&1)},yd=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var r=new(e instanceof Xh?Xh:e instanceof Zh?Zh:Yh)(n-t);return r.set(e.subarray(t,n)),r},vd=function(e,t,n){var r=e.length;if(!r||n&&!n.l&&r<5)return t||new Yh(0);var i=!t||n,o=!n||n.i;n||(n={}),t||(t=new Yh(3*r));var s=function(e){var n=t.length;if(e>n){var r=new Yh(Math.max(2*n,e));r.set(t),t=r}},a=n.f||0,c=n.p||0,l=n.b||0,u=n.l,h=n.d,d=n.m,A=n.n,m=8*r;do{if(!u){n.f=a=pd(e,c,1);var p=pd(e,c+1,3);if(c+=3,!p){var f=e[(B=gd(c)+4)-4]|e[B-3]<<8,g=B+f;if(g>r){if(o)throw"unexpected EOF";break}i&&s(l+f),t.set(e.subarray(B,g),l),n.b=l+=f,n.p=c=8*g;continue}if(1==p)u=dd,h=Ad,d=9,A=5;else{if(2!=p)throw"invalid block type";var y=pd(e,c,31)+257,v=pd(e,c+10,15)+4,x=y+pd(e,c+5,31)+1;c+=14;for(var E=new Yh(x),w=new Yh(19),C=0;C<v;++C)w[$h[C]]=pd(e,c+3*C,7);c+=3*v;var I=md(w),_=(1<<I)-1,b=ld(w,I,1);for(C=0;C<x;){var B,M=b[pd(e,c,_)];if(c+=15&M,(B=M>>>4)<16)E[C++]=B;else{var S=0,D=0;for(16==B?(D=3+pd(e,c,3),c+=2,S=E[C-1]):17==B?(D=3+pd(e,c,7),c+=3):18==B&&(D=11+pd(e,c,127),c+=7);D--;)E[C++]=S}}var T=E.subarray(0,y),Q=E.subarray(y);d=md(T),A=md(Q),u=ld(T,d,1),h=ld(Q,A,1)}if(c>m){if(o)throw"unexpected EOF";break}}i&&s(l+131072);for(var P=(1<<d)-1,z=(1<<A)-1,R=c;;R=c){var F=(S=u[fd(e,c)&P])>>>4;if((c+=15&S)>m){if(o)throw"unexpected EOF";break}if(!S)throw"invalid length/literal";if(F<256)t[l++]=F;else{if(256==F){R=c,u=null;break}var k=F-254;if(F>264){var L=Kh[C=F-257];k=pd(e,c,(1<<L)-1)+nd[C],c+=L}var O=h[fd(e,c)&z],U=O>>>4;if(!O)throw"invalid distance";c+=15&O;Q=od[U];if(U>3){L=Jh[U];Q+=fd(e,c)&(1<<L)-1,c+=L}if(c>m){if(o)throw"unexpected EOF";break}i&&s(l+131072);for(var N=l+k;l<N;l+=4)t[l]=t[l-Q],t[l+1]=t[l+1-Q],t[l+2]=t[l+2-Q],t[l+3]=t[l+3-Q];l=N}}n.l=u,n.p=R,n.b=l,u&&(a=1,n.m=d,n.d=h,n.n=A)}while(!a);return l==t.length?t:yd(t,0,l)},xd=new Yh(0),Ed=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function wd(e,t){return vd((Ed(e),e.subarray(2,-4)),t)}var Cd="undefined"!=typeof TextDecoder&&new TextDecoder;try{Cd.decode(xd,{stream:!0}),1}catch(lm){}function Id(e,t,n){const r=n.length-e-1;if(t>=n[r])return r-1;if(t<=n[e])return e;let i=e,o=r,s=Math.floor((i+o)/2);for(;t<n[s]||t>=n[s+1];)t<n[s]?o=s:i=s,s=Math.floor((i+o)/2);return s}function _d(e,t,n,r){const i=[],o=[],s=[];i[0]=1;for(let a=1;a<=n;++a){o[a]=t-r[e+1-a],s[a]=r[e+a]-t;let n=0;for(let e=0;e<a;++e){const t=s[e+1],r=o[a-e],c=i[e]/(t+r);i[e]=n+t*c,n=r*c}i[a]=n}return i}function bd(e,t){let n=1;for(let i=2;i<=e;++i)n*=i;let r=1;for(let i=2;i<=t;++i)r*=i;for(let i=2;i<=e-t;++i)r*=i;return n/r}function Bd(e,t,n,r,i){const o=function(e,t,n,r,i){const o=i<e?i:e,a=[],c=Id(e,r,t),l=function(e,t,n,r,i){const o=[];for(let h=0;h<=n;++h)o[h]=0;const s=[];for(let h=0;h<=r;++h)s[h]=o.slice(0);const a=[];for(let h=0;h<=n;++h)a[h]=o.slice(0);a[0][0]=1;const c=o.slice(0),l=o.slice(0);for(let h=1;h<=n;++h){c[h]=t-i[e+1-h],l[h]=i[e+h]-t;let n=0;for(let e=0;e<h;++e){const t=l[e+1],r=c[h-e];a[h][e]=t+r;const i=a[e][h-1]/a[h][e];a[e][h]=n+t*i,n=r*i}a[h][h]=n}for(let h=0;h<=n;++h)s[0][h]=a[h][n];for(let h=0;h<=n;++h){let e=0,t=1;const i=[];for(let r=0;r<=n;++r)i[r]=o.slice(0);i[0][0]=1;for(let o=1;o<=r;++o){let r=0;const c=h-o,l=n-o;h>=o&&(i[t][0]=i[e][0]/a[l+1][c],r=i[t][0]*a[c][l]);const u=h-1<=l?o-1:n-h;for(let n=c>=-1?1:-c;n<=u;++n)i[t][n]=(i[e][n]-i[e][n-1])/a[l+1][c+n],r+=i[t][n]*a[c+n][l];h<=l&&(i[t][o]=-i[e][o-1]/a[l+1][h],r+=i[t][o]*a[h][l]),s[o][h]=r;const d=e;e=t,t=d}}let u=n;for(let h=1;h<=r;++h){for(let e=0;e<=n;++e)s[h][e]*=u;u*=n-h}return s}(c,r,e,o,t),u=[];for(let s=0;s<n.length;++s){const e=n[s].clone(),t=e.w;e.x*=t,e.y*=t,e.z*=t,u[s]=e}for(let s=0;s<=o;++s){const t=u[c-e].clone().multiplyScalar(l[s][0]);for(let n=1;n<=e;++n)t.add(u[c-e+n].clone().multiplyScalar(l[s][n]));a[s]=t}for(let h=o+1;h<=i+1;++h)a[h]=new s.Vector4(0,0,0);return a}(e,t,n,r,i);return function(e){const t=e.length,n=[],r=[];for(let o=0;o<t;++o){const t=e[o];n[o]=new s.Vector3(t.x,t.y,t.z),r[o]=t.w}const i=[];for(let o=0;o<t;++o){const e=n[o].clone();for(let t=1;t<=o;++t)e.sub(i[o-t].clone().multiplyScalar(bd(o,t)*r[t]));i[o]=e.divideScalar(r[0])}return i}(o)}class Md extends s.Curve{constructor(e,t,n,r,i){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=r||0,this.endKnot=i||this.knots.length-1;for(let o=0;o<n.length;++o){const e=n[o];this.controlPoints[o]=new s.Vector4(e.x,e.y,e.z,e.w)}}getPoint(e,t){const n=t||new s.Vector3,r=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),i=function(e,t,n,r){const i=Id(e,r,t),o=_d(i,r,e,t),a=new s.Vector4(0,0,0,0);for(let s=0;s<=e;++s){const t=n[i-e+s],r=o[s],c=t.w*r;a.x+=t.x*c,a.y+=t.y*c,a.z+=t.z*c,a.w+=t.w*r}return a}(this.degree,this.knots,this.controlPoints,r);return 1!=i.w&&i.divideScalar(i.w),n.set(i.x,i.y,i.z)}getTangent(e,t){const n=t||new s.Vector3,r=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),i=Bd(this.degree,this.knots,this.controlPoints,r,1);return n.copy(i[1]).normalize(),n}}var Sd=n(10248);let Dd,Td,Qd;class Pd extends s.Loader{constructor(e){super(e)}load(e,t,n,r){const i=this,o=""===i.path?s.LoaderUtils.extractUrlBase(e):i.path,a=new s.FileLoader(this.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(n,o))}catch(lm){r?r(lm):console.error(lm),i.manager.itemError(e)}}),n,r)}parse(e,t){if(function(e){const t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===Zd(e,0,t.length)}(e))Dd=(new Ld).parse(e);else{const t=Zd(e);if(!function(e){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function r(t){const r=e[t-1];return e=e.slice(n+t),n++,r}for(let i=0;i<t.length;++i){if(r(1)===t[i])return!1}return!0}(t))throw new Error("THREE.FBXLoader: Unknown format.");if(Nd(t)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Nd(t));Dd=(new kd).parse(t)}const n=new s.TextureLoader(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new zd(n,this.manager).parse(Dd)}}class zd{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){Td=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),r=this.parseDeformers(),i=(new Rd).parse(r);return this.parseScene(r,i,n),Qd}parseConnections(){const e=new Map;if("Connections"in Dd){Dd.Connections.connections.forEach((function(t){const n=t[0],r=t[1],i=t[2];e.has(n)||e.set(n,{parents:[],children:[]});const o={ID:r,relationship:i};e.get(n).parents.push(o),e.has(r)||e.set(r,{parents:[],children:[]});const s={ID:n,relationship:i};e.get(r).children.push(s)}))}return e}parseImages(){const e={},t={};if("Video"in Dd.Objects){const n=Dd.Objects.Video;for(const r in n){const i=n[r];if(e[parseInt(r)]=i.RelativeFilename||i.Filename,"Content"in i){const e=i.Content instanceof ArrayBuffer&&i.Content.byteLength>0,o="string"===typeof i.Content&&""!==i.Content;if(e||o){const e=this.parseImage(n[r]);t[i.RelativeFilename||i.Filename]=e}}}}for(const n in e){const r=e[n];void 0!==t[r]?e[n]=t[r]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,r=n.slice(n.lastIndexOf(".")+1).toLowerCase();let i;switch(r){case"bmp":i="image/bmp";break;case"jpg":case"jpeg":i="image/jpeg";break;case"png":i="image/png";break;case"tif":i="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),i="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+r+'" is not supported.')}if("string"===typeof t)return"data:"+i+";base64,"+t;{const e=new Uint8Array(t);return window.URL.createObjectURL(new Blob([e],{type:i}))}}parseTextures(e){const t=new Map;if("Texture"in Dd.Objects){const n=Dd.Objects.Texture;for(const r in n){const i=this.parseTexture(n[r],e);t.set(parseInt(r),i)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const r=e.WrapModeU,i=e.WrapModeV,o=void 0!==r?r.value:0,a=void 0!==i?i.value:0;if(n.wrapS=0===o?s.RepeatWrapping:s.ClampToEdgeWrapping,n.wrapT=0===a?s.RepeatWrapping:s.ClampToEdgeWrapping,"Scaling"in e){const t=e.Scaling.value;n.repeat.x=t[0],n.repeat.y=t[1]}return n}loadTexture(e,t){let n;const r=this.textureLoader.path,i=Td.get(e.id).children;let o;void 0!==i&&i.length>0&&void 0!==t[i[0].ID]&&(n=t[i[0].ID],0!==n.indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));const a=e.FileName.slice(-3).toLowerCase();if("tga"===a){const t=this.manager.getHandler(".tga");null===t?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),o=new s.Texture):(t.setPath(this.textureLoader.path),o=t.load(n))}else"psd"===a?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),o=new s.Texture):o=this.textureLoader.load(n);return this.textureLoader.setPath(r),o}parseMaterials(e){const t=new Map;if("Material"in Dd.Objects){const n=Dd.Objects.Material;for(const r in n){const i=this.parseMaterial(n[r],e);null!==i&&t.set(parseInt(r),i)}}return t}parseMaterial(e,t){const n=e.id,r=e.attrName;let i=e.ShadingModel;if("object"===typeof i&&(i=i.value),!Td.has(n))return null;const o=this.parseParameters(e,t,n);let a;switch(i.toLowerCase()){case"phong":a=new s.MeshPhongMaterial;break;case"lambert":a=new s.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',i),a=new s.MeshPhongMaterial}return a.setValues(o),a.name=r,a}parseParameters(e,t,n){const r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=(new s.Color).fromArray(e.Diffuse.value):!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(r.color=(new s.Color).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=(new s.Color).fromArray(e.Emissive.value):!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(r.emissive=(new s.Color).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=(new s.Color).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(r.specular=(new s.Color).fromArray(e.SpecularColor.value));const i=this;return Td.get(n).children.forEach((function(e){const n=e.relationship;switch(n){case"Bump":r.bumpMap=i.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":r.aoMap=i.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=i.getTexture(t,e.ID),void 0!==r.map&&("colorSpace"in r.map?r.map.colorSpace="srgb":r.map.encoding=3001);break;case"DisplacementColor":r.displacementMap=i.getTexture(t,e.ID);break;case"EmissiveColor":r.emissiveMap=i.getTexture(t,e.ID),void 0!==r.emissiveMap&&("colorSpace"in r.emissiveMap?r.emissiveMap.colorSpace="srgb":r.emissiveMap.encoding=3001);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=i.getTexture(t,e.ID);break;case"ReflectionColor":r.envMap=i.getTexture(t,e.ID),void 0!==r.envMap&&(r.envMap.mapping=s.EquirectangularReflectionMapping,"colorSpace"in r.envMap?r.envMap.colorSpace="srgb":r.envMap.encoding=3001);break;case"SpecularColor":r.specularMap=i.getTexture(t,e.ID),void 0!==r.specularMap&&("colorSpace"in r.specularMap?r.specularMap.colorSpace="srgb":r.specularMap.encoding=3001);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=i.getTexture(t,e.ID),r.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",n)}})),r}getTexture(e,t){return"LayeredTexture"in Dd.Objects&&t in Dd.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=Td.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in Dd.Objects){const n=Dd.Objects.Deformer;for(const r in n){const i=n[r],o=Td.get(parseInt(r));if("Skin"===i.attrType){const t=this.parseSkeleton(o,n);t.ID=r,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=o.parents[0].ID,e[r]=t}else if("BlendShape"===i.attrType){const e={id:r};e.rawTargets=this.parseMorphTargets(o,n),e.id=r,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[r]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach((function(e){const r=t[e.ID];if("Cluster"!==r.attrType)return;const i={ID:e.ID,indices:[],weights:[],transformLink:(new s.Matrix4).fromArray(r.TransformLink.a)};"Indexes"in r&&(i.indices=r.Indexes.a,i.weights=r.Weights.a),n.push(i)})),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let r=0;r<e.children.length;r++){const i=e.children[r],o=t[i.ID],s={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if("BlendShapeChannel"!==o.attrType)return;s.geoID=Td.get(parseInt(i.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,n.push(s)}return n}parseScene(e,t,n){Qd=new s.Group;const r=this.parseModels(e.skeletons,t,n),i=Dd.Objects.Model,o=this;r.forEach((function(e){const t=i[e.ID];o.setLookAtProperties(e,t);Td.get(e.ID).parents.forEach((function(t){const n=r.get(t.ID);void 0!==n&&n.add(e)})),null===e.parent&&Qd.add(e)})),this.bindSkeleton(e.skeletons,t,r),this.createAmbientLight(),Qd.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);const t=Wd(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));const a=(new Fd).parse();1===Qd.children.length&&Qd.children[0].isGroup&&(Qd.children[0].animations=a,Qd=Qd.children[0]),Qd.animations=a}parseModels(e,t,n){const r=new Map,i=Dd.Objects.Model;for(const o in i){const a=parseInt(o),c=i[o],l=Td.get(a);let u=this.buildSkeleton(l,e,a,c.attrName);if(!u){switch(c.attrType){case"Camera":u=this.createCamera(l);break;case"Light":u=this.createLight(l);break;case"Mesh":u=this.createMesh(l,t,n);break;case"NurbsCurve":u=this.createCurve(l,t);break;case"LimbNode":case"Root":u=new s.Bone;break;default:u=new s.Group}u.name=c.attrName?s.PropertyBinding.sanitizeNodeName(c.attrName):"",u.ID=a}this.getTransformData(u,c),r.set(a,u)}return r}buildSkeleton(e,t,n,r){let i=null;return e.parents.forEach((function(e){for(const o in t){const a=t[o];a.rawBones.forEach((function(t,o){if(t.ID===e.ID){const e=i;i=new s.Bone,i.matrixWorld.copy(t.transformLink),i.name=r?s.PropertyBinding.sanitizeNodeName(r):"",i.ID=n,a.bones[o]=i,null!==e&&i.add(e)}}))}})),i}createCamera(e){let t,n;if(e.children.forEach((function(e){const t=Dd.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)t=new s.Object3D;else{let e=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(e=1);let r=1;void 0!==n.NearPlane&&(r=n.NearPlane.value/1e3);let i=1e3;void 0!==n.FarPlane&&(i=n.FarPlane.value/1e3);let o=window.innerWidth,a=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(o=n.AspectWidth.value,a=n.AspectHeight.value);const c=o/a;let l=45;void 0!==n.FieldOfView&&(l=n.FieldOfView.value);const u=n.FocalLength?n.FocalLength.value:null;switch(e){case 0:t=new s.PerspectiveCamera(l,c,r,i),null!==u&&t.setFocalLength(u);break;case 1:t=new s.OrthographicCamera(-o/2,o/2,a/2,-a/2,r,i);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),t=new s.Object3D}}return t}createLight(e){let t,n;if(e.children.forEach((function(e){const t=Dd.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)t=new s.Object3D;else{let e;e=void 0===n.LightType?0:n.LightType.value;let r=16777215;void 0!==n.Color&&(r=(new s.Color).fromArray(n.Color.value));let i=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(i=0);let o=0;void 0!==n.FarAttenuationEnd&&(o=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);const a=1;switch(e){case 0:t=new s.PointLight(r,i,o,a);break;case 1:t=new s.DirectionalLight(r,i);break;case 2:let e=Math.PI/3;void 0!==n.InnerAngle&&(e=s.MathUtils.degToRad(n.InnerAngle.value));let c=0;void 0!==n.OuterAngle&&(c=s.MathUtils.degToRad(n.OuterAngle.value),c=Math.max(c,1)),t=new s.SpotLight(r,i,o,e,c,a);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new s.PointLight(r,i)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,n){let r,i=null,o=null;const a=[];return e.children.forEach((function(e){t.has(e.ID)&&(i=t.get(e.ID)),n.has(e.ID)&&a.push(n.get(e.ID))})),a.length>1?o=a:a.length>0?o=a[0]:(o=new s.MeshPhongMaterial({color:13421772}),a.push(o)),"color"in i.attributes&&a.forEach((function(e){e.vertexColors=!0})),i.FBX_Deformer?(r=new s.SkinnedMesh(i,o),r.normalizeSkinWeights()):r=new s.Mesh(i,o),r}createCurve(e,t){const n=e.children.reduce((function(e,n){return t.has(n.ID)&&(e=t.get(n.ID)),e}),null),r=new s.LineBasicMaterial({color:3342591,linewidth:1});return new s.Line(n,r)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?Yd(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){if("LookAtProperty"in t){Td.get(e.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){const n=Dd.Objects.Model[t.ID];if("Lcl_Translation"in n){const t=n.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(t),Qd.add(e.target)):e.lookAt((new s.Vector3).fromArray(t))}}}))}}bindSkeleton(e,t,n){const r=this.parsePoseNodes();for(const i in e){const o=e[i];Td.get(parseInt(o.ID)).parents.forEach((function(e){if(t.has(e.ID)){const t=e.ID;Td.get(t).parents.forEach((function(e){if(n.has(e.ID)){n.get(e.ID).bind(new s.Skeleton(o.bones),r[e.ID])}}))}}))}}parsePoseNodes(){const e={};if("Pose"in Dd.Objects){const t=Dd.Objects.Pose;for(const n in t)if("BindPose"===t[n].attrType&&t[n].NbPoseNodes>0){const r=t[n].PoseNode;Array.isArray(r)?r.forEach((function(t){e[t.Node]=(new s.Matrix4).fromArray(t.Matrix.a)})):e[r.Node]=(new s.Matrix4).fromArray(r.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in Dd&&"AmbientColor"in Dd.GlobalSettings){const e=Dd.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],r=e[2];if(0!==t||0!==n||0!==r){const e=new s.Color(t,n,r);Qd.add(new s.AmbientLight(e,1))}}}}class Rd{parse(e){const t=new Map;if("Geometry"in Dd.Objects){const n=Dd.Objects.Geometry;for(const r in n){const i=Td.get(parseInt(r)),o=this.parseGeometry(i,n[r],e);t.set(parseInt(r),o)}}return t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const r=n.skeletons,i=[],o=e.parents.map((function(e){return Dd.Objects.Model[e.ID]}));if(0===o.length)return;const s=e.children.reduce((function(e,t){return void 0!==r[t.ID]&&(e=r[t.ID]),e}),null);e.children.forEach((function(e){void 0!==n.morphTargets[e.ID]&&i.push(n.morphTargets[e.ID])}));const a=o[0],c={};"RotationOrder"in a&&(c.eulerOrder=Yd(a.RotationOrder.value)),"InheritType"in a&&(c.inheritType=parseInt(a.InheritType.value)),"GeometricTranslation"in a&&(c.translation=a.GeometricTranslation.value),"GeometricRotation"in a&&(c.rotation=a.GeometricRotation.value),"GeometricScaling"in a&&(c.scale=a.GeometricScaling.value);const l=Wd(c);return this.genGeometry(t,s,i,l)}genGeometry(e,t,n,r){const i=new s.BufferGeometry;e.attrName&&(i.name=e.attrName);const o=this.parseGeoNode(e,t),a=this.genBuffers(o),c=new s.Float32BufferAttribute(a.vertex,3);if(c.applyMatrix4(r),i.setAttribute("position",c),a.colors.length>0&&i.setAttribute("color",new s.Float32BufferAttribute(a.colors,3)),t&&(i.setAttribute("skinIndex",new s.Uint16BufferAttribute(a.weightsIndices,4)),i.setAttribute("skinWeight",new s.Float32BufferAttribute(a.vertexWeights,4)),i.FBX_Deformer=t),a.normal.length>0){const e=(new s.Matrix3).getNormalMatrix(r),t=new s.Float32BufferAttribute(a.normal,3);t.applyNormalMatrix(e),i.setAttribute("normal",t)}if(a.uvs.forEach((function(e,t){"uv2"===Js&&t++;const n=0===t?"uv":`uv${t}`;i.setAttribute(n,new s.Float32BufferAttribute(a.uvs[t],2))})),o.material&&"AllSame"!==o.material.mappingType){let e=a.materialIndex[0],t=0;if(a.materialIndex.forEach((function(n,r){n!==e&&(i.addGroup(t,r-t,e),e=n,t=r)})),i.groups.length>0){const t=i.groups[i.groups.length-1],n=t.start+t.count;n!==a.materialIndex.length&&i.addGroup(n,a.materialIndex.length-n,e)}0===i.groups.length&&i.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(i,e,n,r),i}parseGeoNode(e,t){const n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(r,i){void 0===n.weightTable[r]&&(n.weightTable[r]=[]),n.weightTable[r].push({id:t,weight:e.weights[i]})}))}))),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,r=0,i=!1,o=[],s=[],a=[],c=[],l=[],u=[];const h=this;return e.vertexIndices.forEach((function(d,A){let m,p=!1;d<0&&(d^=-1,p=!0);let f=[],g=[];if(o.push(3*d,3*d+1,3*d+2),e.color){const t=jd(A,n,d,e.color);a.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach((function(e){g.push(e.weight),f.push(e.id)})),g.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);const e=[0,0,0,0],t=[0,0,0,0];g.forEach((function(n,r){let i=n,o=f[r];t.forEach((function(t,n,r){if(i>t){r[n]=i,i=t;const s=e[n];e[n]=o,o=s}}))})),f=e,g=t}for(;g.length<4;)g.push(0),f.push(0);for(let e=0;e<4;++e)l.push(g[e]),u.push(f[e])}if(e.normal){const t=jd(A,n,d,e.normal);s.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(m=jd(A,n,d,e.material)[0]),e.uv&&e.uv.forEach((function(e,t){const r=jd(A,n,d,e);void 0===c[t]&&(c[t]=[]),c[t].push(r[0]),c[t].push(r[1])})),r++,p&&(h.genFace(t,e,o,m,s,a,c,l,u,r),n++,r=0,o=[],s=[],a=[],c=[],l=[],u=[])})),t}genFace(e,t,n,r,i,o,s,a,c,l){for(let u=2;u<l;u++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(u-1)]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+2]]),e.vertex.push(t.vertexPositions[n[3*u]]),e.vertex.push(t.vertexPositions[n[3*u+1]]),e.vertex.push(t.vertexPositions[n[3*u+2]]),t.skeleton&&(e.vertexWeights.push(a[0]),e.vertexWeights.push(a[1]),e.vertexWeights.push(a[2]),e.vertexWeights.push(a[3]),e.vertexWeights.push(a[4*(u-1)]),e.vertexWeights.push(a[4*(u-1)+1]),e.vertexWeights.push(a[4*(u-1)+2]),e.vertexWeights.push(a[4*(u-1)+3]),e.vertexWeights.push(a[4*u]),e.vertexWeights.push(a[4*u+1]),e.vertexWeights.push(a[4*u+2]),e.vertexWeights.push(a[4*u+3]),e.weightsIndices.push(c[0]),e.weightsIndices.push(c[1]),e.weightsIndices.push(c[2]),e.weightsIndices.push(c[3]),e.weightsIndices.push(c[4*(u-1)]),e.weightsIndices.push(c[4*(u-1)+1]),e.weightsIndices.push(c[4*(u-1)+2]),e.weightsIndices.push(c[4*(u-1)+3]),e.weightsIndices.push(c[4*u]),e.weightsIndices.push(c[4*u+1]),e.weightsIndices.push(c[4*u+2]),e.weightsIndices.push(c[4*u+3])),t.color&&(e.colors.push(o[0]),e.colors.push(o[1]),e.colors.push(o[2]),e.colors.push(o[3*(u-1)]),e.colors.push(o[3*(u-1)+1]),e.colors.push(o[3*(u-1)+2]),e.colors.push(o[3*u]),e.colors.push(o[3*u+1]),e.colors.push(o[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(i[0]),e.normal.push(i[1]),e.normal.push(i[2]),e.normal.push(i[3*(u-1)]),e.normal.push(i[3*(u-1)+1]),e.normal.push(i[3*(u-1)+2]),e.normal.push(i[3*u]),e.normal.push(i[3*u+1]),e.normal.push(i[3*u+2])),t.uv&&t.uv.forEach((function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(s[n][0]),e.uvs[n].push(s[n][1]),e.uvs[n].push(s[n][2*(u-1)]),e.uvs[n].push(s[n][2*(u-1)+1]),e.uvs[n].push(s[n][2*u]),e.uvs[n].push(s[n][2*u+1])}))}addMorphTargets(e,t,n,r){if(0===n.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const i=this;n.forEach((function(n){n.rawTargets.forEach((function(n){const o=Dd.Objects.Geometry[n.geoID];void 0!==o&&i.genMorphGeometry(e,t,o,r,n.name)}))}))}genMorphGeometry(e,t,n,r,i){const o=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],a=void 0!==n.Vertices?n.Vertices.a:[],c=void 0!==n.Indexes?n.Indexes.a:[],l=3*e.attributes.position.count,u=new Float32Array(l);for(let s=0;s<c.length;s++){const e=3*c[s];u[e]=a[3*s],u[e+1]=a[3*s+1],u[e+2]=a[3*s+2]}const h={vertexIndices:o,vertexPositions:u},d=this.genBuffers(h),A=new s.Float32BufferAttribute(d.vertex,3);A.name=i||n.attrName,A.applyMatrix4(r),e.morphAttributes.position.push(A)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Normals.a;let i=[];return"IndexToDirect"===n&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:i,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.UV.a;let i=[];return"IndexToDirect"===n&&(i=e.UVIndex.a),{dataSize:2,buffer:r,indices:i,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Colors.a;let i=[];return"IndexToDirect"===n&&(i=e.ColorIndex.a),{dataSize:4,buffer:r,indices:i,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const r=e.Materials.a,i=[];for(let o=0;o<r.length;++o)i.push(o);return{dataSize:1,buffer:r,indices:i,mappingType:t,referenceType:n}}parseNurbsGeometry(e){if(void 0===Md)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new s.BufferGeometry;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new s.BufferGeometry;const n=t-1,r=e.KnotVector.a,i=[],o=e.Points.a;for(let u=0,h=o.length;u<h;u+=4)i.push((new s.Vector4).fromArray(o,u));let a,c;if("Closed"===e.Form)i.push(i[0]);else if("Periodic"===e.Form){a=n,c=r.length-1-a;for(let e=0;e<n;++e)i.push(i[e])}const l=new Md(n,r,i,a,c).getPoints(12*i.length);return(new s.BufferGeometry).setFromPoints(l)}}class Fd{parse(){const e=[],t=this.parseClips();if(void 0!==t)for(const n in t){const r=t[n],i=this.addClip(r);e.push(i)}return e}parseClips(){if(void 0===Dd.Objects.AnimationCurve)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=Dd.Objects.AnimationCurveNode,t=new Map;for(const n in e){const r=e[n];if(null!==r.attrName.match(/S|R|T|DeformPercent/)){const e={id:r.id,attr:r.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){const t=Dd.Objects.AnimationCurve;for(const n in t){const r={id:t[n].id,times:t[n].KeyTime.a.map(Vd),values:t[n].KeyValueFloat.a},i=Td.get(r.id);if(void 0!==i){const t=i.parents[0].ID,n=i.parents[0].relationship;n.match(/X/)?e.get(t).curves.x=r:n.match(/Y/)?e.get(t).curves.y=r:n.match(/Z/)?e.get(t).curves.z=r:n.match(/d|DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=r)}}}parseAnimationLayers(e){const t=Dd.Objects.AnimationLayer,n=new Map;for(const r in t){const t=[],i=Td.get(parseInt(r));if(void 0!==i){i.children.forEach((function(n,r){if(e.has(n.ID)){const i=e.get(n.ID);if(void 0!==i.curves.x||void 0!==i.curves.y||void 0!==i.curves.z){if(void 0===t[r]){const e=Td.get(n.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==e){const i=Dd.Objects.Model[e.toString()];if(void 0===i)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",n);const o={modelName:i.attrName?s.PropertyBinding.sanitizeNodeName(i.attrName):"",ID:i.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Qd.traverse((function(e){e.ID===i.id&&(o.transform=e.matrix,e.userData.transformData&&(o.eulerOrder=e.userData.transformData.eulerOrder))})),o.transform||(o.transform=new s.Matrix4),"PreRotation"in i&&(o.preRotation=i.PreRotation.value),"PostRotation"in i&&(o.postRotation=i.PostRotation.value),t[r]=o}}t[r]&&(t[r][i.attr]=i)}else if(void 0!==i.curves.morph){if(void 0===t[r]){const e=Td.get(n.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,i=Td.get(e).parents[0].ID,o=Td.get(i).parents[0].ID,a=Td.get(o).parents[0].ID,c=Dd.Objects.Model[a],l={modelName:c.attrName?s.PropertyBinding.sanitizeNodeName(c.attrName):"",morphName:Dd.Objects.Deformer[e].attrName};t[r]=l}t[r][i.attr]=i}}})),n.set(parseInt(r),t)}}return n}parseAnimStacks(e){const t=Dd.Objects.AnimationStack,n={};for(const r in t){const i=Td.get(parseInt(r)).children;i.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(i[0].ID);n[r]={name:t[r].attrName,layer:o}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach((function(e){t=t.concat(n.generateTracks(e))})),new s.AnimationClip(e.name,-1,t)}generateTracks(e){const t=[];let n=new s.Vector3,r=new s.Quaternion,i=new s.Vector3;if(e.transform&&e.transform.decompose(n,r,i),n=n.toArray(),r=(new s.Euler).setFromQuaternion(r,e.eulerOrder).toArray(),i=i.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){const r=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");void 0!==r&&t.push(r)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){const n=this.generateRotationTrack(e.modelName,e.R.curves,r,e.preRotation,e.postRotation,e.eulerOrder);void 0!==n&&t.push(n)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){const n=this.generateVectorTrack(e.modelName,e.S.curves,i,"scale");void 0!==n&&t.push(n)}if(void 0!==e.DeformPercent){const n=this.generateMorphTrack(e);void 0!==n&&t.push(n)}return t}generateVectorTrack(e,t,n,r){const i=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(i,t,n);return new s.VectorKeyframeTrack(e+"."+r,i,o)}generateRotationTrack(e,t,n,r,i,o){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(s.MathUtils.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(s.MathUtils.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(s.MathUtils.degToRad));const a=this.getTimesForAllAxes(t),c=this.getKeyframeTrackValues(a,t,n);void 0!==r&&((r=r.map(s.MathUtils.degToRad)).push(o),r=(new s.Euler).fromArray(r),r=(new s.Quaternion).setFromEuler(r)),void 0!==i&&((i=i.map(s.MathUtils.degToRad)).push(o),i=(new s.Euler).fromArray(i),i=(new s.Quaternion).setFromEuler(i).invert());const l=new s.Quaternion,u=new s.Euler,h=[];for(let s=0;s<c.length;s+=3)u.set(c[s],c[s+1],c[s+2],o),l.setFromEuler(u),void 0!==r&&l.premultiply(r),void 0!==i&&l.multiply(i),l.toArray(h,s/3*4);return new s.QuaternionKeyframeTrack(e+".quaternion",a,h)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map((function(e){return e/100})),r=Qd.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new s.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+r+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})),t.length>1){let e=1,n=t[0];for(let r=1;r<t.length;r++){const i=t[r];i!==n&&(t[e]=i,n=i,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,n){const r=n,i=[];let o=-1,s=-1,a=-1;return e.forEach((function(e){if(t.x&&(o=t.x.times.indexOf(e)),t.y&&(s=t.y.times.indexOf(e)),t.z&&(a=t.z.times.indexOf(e)),-1!==o){const e=t.x.values[o];i.push(e),r[0]=e}else i.push(r[0]);if(-1!==s){const e=t.y.values[s];i.push(e),r[1]=e}else i.push(r[1]);if(-1!==a){const e=t.z.values[a];i.push(e),r[2]=e}else i.push(r[2])})),i}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],r=e.values[t]-n,i=Math.abs(r);if(i>=180){const o=i/180,s=r/o;let a=n+s;const c=e.times[t-1],l=(e.times[t]-c)/o;let u=c+l;const h=[],d=[];for(;u<e.times[t];)h.push(u),u+=l,d.push(a),a+=s;e.times=Kd(e.times,t,h),e.values=Kd(e.values,t,d)}}}}class kd{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new Ud,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach((function(e,r){const i=e.match(/^[\s\t]*;/),o=e.match(/^[\s\t]*$/);if(i||o)return;const s=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),a=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),c=e.match("^\\t{"+(t.currentIndent-1)+"}}");s?t.parseNodeBegin(e,s):a?t.parseNodeProperty(e,a,n[++r]):c?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)})),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),i={name:n},o=this.parseNodeAttr(r),s=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,i):n in s?("PoseNode"===n?s.PoseNode.push(i):void 0!==s[n].id&&(s[n]={},s[n][s[n].id]=s[n]),""!==o.id&&(s[n][o.id]=i)):"number"===typeof o.id?(s[n]={},s[n][o.id]=i):"Properties70"!==n&&(s[n]="PoseNode"===n?[i]:i),"number"===typeof o.id&&(i.id=o.id),""!==o.name&&(i.attrName=o.name),""!==o.type&&(i.attrType=o.type),this.pushStack(i)}parseNodeAttr(e){let t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",r="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:n,type:r}}parseNodeProperty(e,t,n){let r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),i=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===i&&(i=n.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if("Properties70"!==o.name){if("C"===r){const e=i.split(",").slice(1),t=parseInt(e[0]),n=parseInt(e[1]);let s=i.split(",").slice(3);s=s.map((function(e){return e.trim().replace(/^"/,"")})),r="connections",i=[t,n],function(e,t){for(let n=0,r=e.length,i=t.length;n<i;n++,r++)e[r]=t[n]}(i,s),void 0===o[r]&&(o[r]=[])}"Node"===r&&(o.id=i),r in o&&Array.isArray(o[r])?o[r].push(i):"a"!==r?o[r]=i:o.a=i,this.setCurrentProp(o,r),"a"===r&&","!==i.slice(-1)&&(o.a=Xd(i))}else this.parseNodeSpecialProperty(e,r,i)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=Xd(t.a))}parseNodeSpecialProperty(e,t,n){const r=n.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),i=r[0],o=r[1],s=r[2],a=r[3];let c=r[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=Xd(c)}this.getPrevNode()[i]={type:o,type2:s,flag:a,value:c},this.setCurrentProp(this.getPrevNode(),i)}}class Ld{parse(e){const t=new Od(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const r=new Ud;for(;!this.endOfContent(t);){const e=this.parseNode(t,n);null!==e&&r.add(e.name,e)}return r}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},r=t>=7500?e.getUint64():e.getUint32(),i=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),s=e.getString(o);if(0===r)return null;const a=[];for(let h=0;h<i;h++)a.push(this.parseProperty(e));const c=a.length>0?a[0]:"",l=a.length>1?a[1]:"",u=a.length>2?a[2]:"";for(n.singleProperty=1===i&&e.getOffset()===r;r>e.getOffset();){const r=this.parseNode(e,t);null!==r&&this.parseSubNode(s,n,r)}return n.propertyList=a,"number"===typeof c&&(n.id=c),""!==l&&(n.attrName=l),""!==u&&(n.attrType=u),""!==s&&(n.name=s),n}parseSubNode(e,t,n){if(!0===n.singleProperty){const e=n.propertyList[0];Array.isArray(e)?(t[n.name]=n,n.a=e):t[n.name]=e}else if("Connections"===e&&"C"===n.name){const e=[];n.propertyList.forEach((function(t,n){0!==n&&e.push(t)})),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===n.name){Object.keys(n).forEach((function(e){t[e]=n[e]}))}else if("Properties70"===e&&"P"===n.name){let e=n.propertyList[0],r=n.propertyList[1];const i=n.propertyList[2],o=n.propertyList[3];let s;0===e.indexOf("Lcl ")&&(e=e.replace("Lcl ","Lcl_")),0===r.indexOf("Lcl ")&&(r=r.replace("Lcl ","Lcl_")),s="Color"===r||"ColorRGB"===r||"Vector"===r||"Vector3D"===r||0===r.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[e]={type:r,type2:i,flag:o,value:s}}else void 0===t[n.name]?"number"===typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=e.getUint32(),i=e.getUint32(),o=e.getUint32();if(0===i)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}const s=wd(new Uint8Array(e.getArrayBuffer(o))),a=new Od(s.buffer);switch(t){case"b":case"c":return a.getBooleanArray(r);case"d":return a.getFloat64Array(r);case"f":return a.getFloat32Array(r);case"i":return a.getInt32Array(r);case"l":return a.getInt64Array(r)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class Od{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return 1===(1&this.getUint8())}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let r=0;r<e;r++)t[r]=this.getUint8();const n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),(0,Sd.r)(new Uint8Array(t))}}class Ud{add(e,t){this[e]=t}}function Nd(e){const t=e.match(/FBXVersion: (\d+)/);if(t){return parseInt(t[1])}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Vd(e){return e/46186158e3}const Gd=[];function jd(e,t,n,r){let i;switch(r.mappingType){case"ByPolygonVertex":i=e;break;case"ByPolygon":i=t;break;case"ByVertice":i=n;break;case"AllSame":i=r.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+r.mappingType)}"IndexToDirect"===r.referenceType&&(i=r.indices[i]);const o=i*r.dataSize,s=o+r.dataSize;return function(e,t,n,r){for(let i=n,o=0;i<r;i++,o++)e[o]=t[i];return e}(Gd,r.buffer,o,s)}const Hd=new s.Euler,qd=new s.Vector3;function Wd(e){const t=new s.Matrix4,n=new s.Matrix4,r=new s.Matrix4,i=new s.Matrix4,o=new s.Matrix4,a=new s.Matrix4,c=new s.Matrix4,l=new s.Matrix4,u=new s.Matrix4,h=new s.Matrix4,d=new s.Matrix4,A=new s.Matrix4,m=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(qd.fromArray(e.translation)),e.preRotation){const t=e.preRotation.map(s.MathUtils.degToRad);t.push(e.eulerOrder),n.makeRotationFromEuler(Hd.fromArray(t))}if(e.rotation){const t=e.rotation.map(s.MathUtils.degToRad);t.push(e.eulerOrder),r.makeRotationFromEuler(Hd.fromArray(t))}if(e.postRotation){const t=e.postRotation.map(s.MathUtils.degToRad);t.push(e.eulerOrder),i.makeRotationFromEuler(Hd.fromArray(t)),i.invert()}e.scale&&o.scale(qd.fromArray(e.scale)),e.scalingOffset&&c.setPosition(qd.fromArray(e.scalingOffset)),e.scalingPivot&&a.setPosition(qd.fromArray(e.scalingPivot)),e.rotationOffset&&l.setPosition(qd.fromArray(e.rotationOffset)),e.rotationPivot&&u.setPosition(qd.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(d.copy(e.parentMatrix),h.copy(e.parentMatrixWorld));const p=n.clone().multiply(r).multiply(i),f=new s.Matrix4;f.extractRotation(h);const g=new s.Matrix4;g.copyPosition(h);const y=g.clone().invert().multiply(h),v=f.clone().invert().multiply(y),x=o,E=new s.Matrix4;if(0===m)E.copy(f).multiply(p).multiply(v).multiply(x);else if(1===m)E.copy(f).multiply(v).multiply(p).multiply(x);else{const e=(new s.Matrix4).scale((new s.Vector3).setFromMatrixScale(d)).clone().invert(),t=v.clone().multiply(e);E.copy(f).multiply(p).multiply(t).multiply(x)}const w=u.clone().invert(),C=a.clone().invert();let I=t.clone().multiply(l).multiply(u).multiply(n).multiply(r).multiply(i).multiply(w).multiply(c).multiply(a).multiply(o).multiply(C);const _=(new s.Matrix4).copyPosition(I),b=h.clone().multiply(_);return A.copyPosition(b),I=A.clone().multiply(E),I.premultiply(h.invert()),I}function Yd(e){const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function Xd(e){return e.split(",").map((function(e){return parseFloat(e)}))}function Zd(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),(0,Sd.r)(new Uint8Array(e,t,n))}function Kd(e,t,n){return e.slice(0,t).concat(n).concat(e.slice(t))}function Jd(e){return(0,a.H)(Pd,e)}function $d({path:e,...t}){const n=Jd(e).children[0];return i.createElement(kc.o,(0,r.Z)({},t,{object:n}))}Jd.preload=e=>a.H.preload(Pd,e),Jd.clear=e=>a.H.clear(Pd,e);class eA{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const n=this.workersResolve[e];if(n&&n(t),this.queue.length){const{resolve:t,msg:n,transfer:r}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(n,r)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise((n=>{const r=this._getIdleWorker();-1!==r?(this._initWorker(r),this.workerStatus|=1<<r,this.workersResolve[r]=n,this.workers[r].postMessage(e,t)):this.queue.push({resolve:n,msg:e,transfer:t})}))}dispose(){this.workers.forEach((e=>e.terminate())),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}var tA=n(50022).Buffer;const nA=2,rA=0,iA=1,oA=10;class sA{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:iA,transferFunction:nA,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class aA{constructor(e,t,n,r){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=r,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){void 0===t&&(t=0);const n=this._offset;let r=0;for(;this._dataView.getUint8(this._offset)!==t&&r<e;)r++,this._offset++;return r<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,r)}}const cA=[171,75,84,88,32,50,48,187,13,10,26,10];function lA(e){return"undefined"!==typeof TextDecoder?(new TextDecoder).decode(e):tA.from(e).toString("utf8")}var uA=n(50022).Buffer;let hA,dA,AA;const mA={env:{emscripten_notify_memory_growth:function(e){AA=new Uint8Array(dA.exports.memory.buffer)}}};class pA{init(){return hA||(hA="undefined"!==typeof fetch?fetch("data:application/wasm;base64,"+fA).then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,mA))).then(this._init):WebAssembly.instantiate(uA.from(fA,"base64"),mA).then(this._init),hA)}_init(e){dA=e.instance,mA.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!dA)throw new Error("ZSTDDecoder: Await .init() before decoding.");const n=e.byteLength,r=dA.exports.malloc(n);AA.set(e,r),t=t||Number(dA.exports.ZSTD_findDecompressedSize(r,n));const i=dA.exports.malloc(t),o=dA.exports.ZSTD_decompress(i,t,r,n),s=AA.slice(i,i+o);return dA.exports.free(r),dA.exports.free(i),s}}const fA="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ";class gA extends s.CompressedTexture{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,s.CubeReflectionMapping),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class yA extends s.CompressedTexture{constructor(e,t,n,r,i,o){super(e,t,n,i,o),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=s.ClampToEdgeWrapping}}class vA extends s.Texture{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=s.NearestFilter,this.minFilter=s.NearestFilter,this.wrapR=s.ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}var xA=Object.defineProperty,EA=(e,t,n)=>(((e,t,n)=>{t in e?xA(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);const wA=3e3,CA=3001,IA="",_A="display-p3",bA="display-p3-linear",BA="srgb-linear",MA="srgb",SA=new WeakMap;let DA,TA=0;const QA=class extends s.Loader{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new eA,this.workerSourceURL="",this.workerConfig=null,"undefined"!==typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const e=new s.FileLoader(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),n=new s.FileLoader(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const r=n.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,r]).then((([e,t])=>{const n=QA.BasisWorker.toString(),r=["/* constants */","let _EngineFormat = "+JSON.stringify(QA.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(QA.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(QA.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r])),this.transcoderBinary=t,this.workerPool.setWorkerCreator((()=>{const e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e}))})),TA>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),TA++}return this.transcoderPending}load(e,t,n,r){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const i=new s.FileLoader(this.manager);i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials),i.load(e,(e=>{if(SA.has(e)){return SA.get(e).promise.then(t).catch(r)}this._createTexture(e).then((e=>t?t(e):null)).catch(r)}),n,r)}_createTextureFrom(e,t){const{faces:n,width:r,height:i,format:o,type:a,error:c,dfdFlags:l}=e;if("error"===a)return Promise.reject(c);let u;if(6===t.faceCount)u=new gA(n,o,s.UnsignedByteType);else{const e=n[0].mipmaps;u=t.layerCount>1?new yA(e,r,i,t.layerCount,o,s.UnsignedByteType):new s.CompressedTexture(e,r,i,o,s.UnsignedByteType)}u.minFilter=1===n[0].mipmaps.length?s.LinearFilter:s.LinearMipmapLinearFilter,u.magFilter=s.LinearFilter,u.generateMipmaps=!1,u.needsUpdate=!0;const h=kA(t);return"colorSpace"in u?u.colorSpace=h:u.encoding=h===MA?3001:3e3,u.premultiplyAlpha=!!(1&l),u}async _createTexture(e,t={}){const n=function(e){const t=new Uint8Array(e.buffer,e.byteOffset,cA.length);if(t[0]!==cA[0]||t[1]!==cA[1]||t[2]!==cA[2]||t[3]!==cA[3]||t[4]!==cA[4]||t[5]!==cA[5]||t[6]!==cA[6]||t[7]!==cA[7]||t[8]!==cA[8]||t[9]!==cA[9]||t[10]!==cA[10]||t[11]!==cA[11])throw new Error("Missing KTX 2.0 identifier.");const n=new sA,r=17*Uint32Array.BYTES_PER_ELEMENT,i=new aA(e,cA.length,r,!0);n.vkFormat=i._nextUint32(),n.typeSize=i._nextUint32(),n.pixelWidth=i._nextUint32(),n.pixelHeight=i._nextUint32(),n.pixelDepth=i._nextUint32(),n.layerCount=i._nextUint32(),n.faceCount=i._nextUint32();const o=i._nextUint32();n.supercompressionScheme=i._nextUint32();const s=i._nextUint32(),a=i._nextUint32(),c=i._nextUint32(),l=i._nextUint32(),u=i._nextUint64(),h=i._nextUint64(),d=new aA(e,cA.length+r,3*o*8,!0);for(let P=0;P<o;P++)n.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+d._nextUint64(),d._nextUint64()),uncompressedByteLength:d._nextUint64()});const A=new aA(e,s,a,!0),m={vendorId:A._skip(4)._nextUint16(),descriptorType:A._nextUint16(),versionNumber:A._nextUint16(),descriptorBlockSize:A._nextUint16(),colorModel:A._nextUint8(),colorPrimaries:A._nextUint8(),transferFunction:A._nextUint8(),flags:A._nextUint8(),texelBlockDimension:[A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8()],bytesPlane:[A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8()],samples:[]},p=(m.descriptorBlockSize/4-6)/4;for(let P=0;P<p;P++){const e={bitOffset:A._nextUint16(),bitLength:A._nextUint8(),channelType:A._nextUint8(),samplePosition:[A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&e.channelType?(e.sampleLower=A._nextInt32(),e.sampleUpper=A._nextInt32()):(e.sampleLower=A._nextUint32(),e.sampleUpper=A._nextUint32()),m.samples[P]=e}n.dataFormatDescriptor.length=0,n.dataFormatDescriptor.push(m);const f=new aA(e,c,l,!0);for(;f._offset<l;){const e=f._nextUint32(),t=f._scan(e),r=lA(t);if(n.keyValue[r]=f._nextUint8Array(e-t.byteLength-1),r.match(/^ktx/i)){const e=lA(n.keyValue[r]);n.keyValue[r]=e.substring(0,e.lastIndexOf("\0"))}const i=e%4?4-e%4:0;f._skip(i)}if(h<=0)return n;const g=new aA(e,u,h,!0),y=g._nextUint16(),v=g._nextUint16(),x=g._nextUint32(),E=g._nextUint32(),w=g._nextUint32(),C=g._nextUint32(),I=[];for(let P=0;P<o;P++)I.push({imageFlags:g._nextUint32(),rgbSliceByteOffset:g._nextUint32(),rgbSliceByteLength:g._nextUint32(),alphaSliceByteOffset:g._nextUint32(),alphaSliceByteLength:g._nextUint32()});const _=u+g._offset,b=_+x,B=b+E,M=B+w,S=new Uint8Array(e.buffer,e.byteOffset+_,x),D=new Uint8Array(e.buffer,e.byteOffset+b,E),T=new Uint8Array(e.buffer,e.byteOffset+B,w),Q=new Uint8Array(e.buffer,e.byteOffset+M,C);return n.globalData={endpointCount:y,selectorCount:v,imageDescs:I,endpointsData:S,selectorsData:D,tablesData:T,extendedData:Q},n}(new Uint8Array(e));if(0!==n.vkFormat)return async function(e){const{vkFormat:t}=e;if(void 0===RA[t])throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let n;2===e.supercompressionScheme&&(DA||(DA=new Promise((async e=>{const t=new pA;await t.init(),e(t)}))),n=await DA);const r=[];for(let a=0;a<e.levels.length;a++){const i=Math.max(1,e.pixelWidth>>a),o=Math.max(1,e.pixelHeight>>a),c=e.pixelDepth?Math.max(1,e.pixelDepth>>a):0,l=e.levels[a];let u,h;if(0===e.supercompressionScheme)u=l.levelData;else{if(2!==e.supercompressionScheme)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");u=n.decode(l.levelData,l.uncompressedByteLength)}h=FA[t]===s.FloatType?new Float32Array(u.buffer,u.byteOffset,u.byteLength/Float32Array.BYTES_PER_ELEMENT):FA[t]===s.HalfFloatType?new Uint16Array(u.buffer,u.byteOffset,u.byteLength/Uint16Array.BYTES_PER_ELEMENT):u,r.push({data:h,width:i,height:o,depth:c})}let i;if(zA.has(RA[t]))i=0===e.pixelDepth?new s.DataTexture(r[0].data,e.pixelWidth,e.pixelHeight):new vA(r[0].data,e.pixelWidth,e.pixelHeight,e.pixelDepth);else{if(e.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");i=new s.CompressedTexture(r,e.pixelWidth,e.pixelHeight)}i.mipmaps=r,i.type=FA[t],i.format=RA[t],i.needsUpdate=!0;const o=kA(e);"colorSpace"in i?i.colorSpace=o:i.encoding=o===MA?CA:wA;return Promise.resolve(i)}(n);const r=t,i=this.init().then((()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:r},[e]))).then((e=>this._createTextureFrom(e.data,n)));return SA.set(e,{promise:i}),i}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),TA--,this}};let PA=QA;EA(PA,"BasisFormat",{ETC1S:0,UASTC_4x4:1}),EA(PA,"TranscoderFormat",{ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16}),EA(PA,"EngineFormat",{RGBAFormat:s.RGBAFormat,RGBA_ASTC_4x4_Format:s.RGBA_ASTC_4x4_Format,RGBA_BPTC_Format:s.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:s.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:s.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:s.RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:s.RGB_ETC1_Format,RGB_ETC2_Format:s.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:s.RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format:s.RGB_S3TC_DXT1_Format}),EA(PA,"BasisWorker",(function(){let e,t,n;const r=_EngineFormat,i=_TranscoderFormat,o=_BasisFormat;self.addEventListener("message",(function(s){const h=s.data;switch(h.type){case"init":e=h.config,d=h.transcoderBinary,t=new Promise((e=>{n={wasmBinary:d,onRuntimeInitialized:e},BASIS(n)})).then((()=>{n.initializeBasis(),void 0===n.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")}));break;case"transcode":t.then((()=>{try{const{faces:t,buffers:s,width:d,height:A,hasAlpha:m,format:p,dfdFlags:f}=function(t){const s=new n.KTX2File(new Uint8Array(t));function h(){s.close(),s.delete()}if(!s.isValid())throw h(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");const d=s.isUASTC()?o.UASTC_4x4:o.ETC1S,A=s.getWidth(),m=s.getHeight(),p=s.getLayers()||1,f=s.getLevels(),g=s.getFaces(),y=s.getHasAlpha(),v=s.getDFDFlags(),{transcoderFormat:x,engineFormat:E}=function(t,n,s,u){let h,d;const A=t===o.ETC1S?a:c;for(let r=0;r<A.length;r++){const i=A[r];if(e[i.if]&&(i.basisFormat.includes(t)&&!(u&&i.transcoderFormat.length<2)&&(!i.needsPowerOfTwo||l(n)&&l(s))))return h=i.transcoderFormat[u?1:0],d=i.engineFormat[u?1:0],{transcoderFormat:h,engineFormat:d}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),h=i.RGBA32,d=r.RGBAFormat,{transcoderFormat:h,engineFormat:d}}(d,A,m,y);if(!A||!m||!f)throw h(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!s.startTranscoding())throw h(),new Error("THREE.KTX2Loader: .startTranscoding failed");const w=[],C=[];for(let e=0;e<g;e++){const t=[];for(let n=0;n<f;n++){const r=[];let i,o;for(let t=0;t<p;t++){const a=s.getImageLevelInfo(n,t,e);0!==e||0!==n||0!==t||a.origWidth%4===0&&a.origHeight%4===0||console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),f>1?(i=a.origWidth,o=a.origHeight):(i=a.width,o=a.height);const c=new Uint8Array(s.getImageTranscodedSizeInBytes(n,t,0,x));if(!s.transcodeImage(c,n,t,e,x,0,-1,-1))throw h(),new Error("THREE.KTX2Loader: .transcodeImage failed.");r.push(c)}const a=u(r);t.push({data:a,width:i,height:o}),C.push(a.buffer)}w.push({mipmaps:t,width:A,height:m,format:E})}return h(),{faces:w,buffers:C,width:A,height:m,hasAlpha:y,format:E,dfdFlags:v}}(h.buffer);self.postMessage({type:"transcode",id:h.id,faces:t,width:d,height:A,hasAlpha:m,format:p,dfdFlags:f},s)}catch(t){console.error(t),self.postMessage({type:"error",id:h.id,error:t.message})}}))}var d}));const s=[{if:"astcSupported",basisFormat:[o.UASTC_4x4],transcoderFormat:[i.ASTC_4x4,i.ASTC_4x4],engineFormat:[r.RGBA_ASTC_4x4_Format,r.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[i.BC7_M5,i.BC7_M5],engineFormat:[r.RGBA_BPTC_Format,r.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[i.BC1,i.BC3],engineFormat:[r.RGB_S3TC_DXT1_Format,r.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[i.ETC1,i.ETC2],engineFormat:[r.RGB_ETC2_Format,r.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[i.ETC1],engineFormat:[r.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[i.PVRTC1_4_RGB,i.PVRTC1_4_RGBA],engineFormat:[r.RGB_PVRTC_4BPPV1_Format,r.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],a=s.sort((function(e,t){return e.priorityETC1S-t.priorityETC1S})),c=s.sort((function(e,t){return e.priorityUASTC-t.priorityUASTC}));function l(e){return e<=2||0===(e&e-1)&&0!==e}function u(e){if(1===e.length)return e[0];let t=0;for(let i=0;i<e.length;i++){t+=e[i].byteLength}const n=new Uint8Array(t);let r=0;for(let i=0;i<e.length;i++){const t=e[i];n.set(t,r),r+=t.byteLength}return n}}));const zA=new Set([s.RGBAFormat,s.RGFormat,s.RedFormat]),RA={109:s.RGBAFormat,97:s.RGBAFormat,37:s.RGBAFormat,43:s.RGBAFormat,103:s.RGFormat,83:s.RGFormat,16:s.RGFormat,22:s.RGFormat,100:s.RedFormat,76:s.RedFormat,15:s.RedFormat,9:s.RedFormat,166:s.RGBA_ASTC_6x6_Format,165:s.RGBA_ASTC_6x6_Format},FA={109:s.FloatType,97:s.HalfFloatType,37:s.UnsignedByteType,43:s.UnsignedByteType,103:s.FloatType,83:s.HalfFloatType,16:s.UnsignedByteType,22:s.UnsignedByteType,100:s.FloatType,76:s.HalfFloatType,15:s.UnsignedByteType,9:s.UnsignedByteType,166:s.UnsignedByteType,165:s.UnsignedByteType};function kA(e){const t=e.dataFormatDescriptor[0];return t.colorPrimaries===iA?t.transferFunction===nA?MA:BA:t.colorPrimaries===oA?t.transferFunction===nA?_A:bA:(t.colorPrimaries===rA||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${t.colorPrimaries}"`),IA)}const LA="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master";function OA(e,t=`${LA}/basis/`){const n=(0,a.D)((e=>e.gl)),r=(0,a.H)(PA,lc(e)?Object.values(e):e,(e=>{e.detectSupport(n),e.setTranscoderPath(t)}));if((0,i.useEffect)((()=>{(Array.isArray(r)?r:[r]).forEach(n.initTexture)}),[n,r]),lc(e)){const t=Object.keys(e),n={};return t.forEach((e=>Object.assign(n,{[e]:r[t.indexOf(e)]}))),n}return r}OA.preload=(e,t=`${LA}/basis/`)=>a.H.preload(PA,e,(e=>{e.setTranscoderPath(t)})),OA.clear=e=>a.H.clear(PA,e);const UA=({children:e,input:t,basisPath:n})=>{const r=OA(t,n);return i.createElement(i.Fragment,null,null==e?void 0:e(r))};var NA,VA;const GA="undefined"!==typeof window&&"function"===typeof(null==(NA=window.document)?void 0:NA.createElement)&&"string"===typeof(null==(VA=window.navigator)?void 0:VA.userAgent);let jA=null;function HA(e,{unsuspend:t="loadedmetadata",start:r=!0,crossOrigin:o="anonymous",muted:c=!0,loop:l=!0,hls:u={},...h}={}){const d=new URL("string"===typeof e?e:"",window.location.href),A=(0,i.useRef)(null),m=(0,i.useRef)(null),p=(0,a.D)((e=>e.gl)),f=(0,_a.Rq)((()=>new Promise((async r=>{const i=Object.assign(document.createElement("video"),{src:"string"===typeof e&&e||void 0,srcObject:e instanceof MediaStream&&e||void 0,crossOrigin:o,loop:l,muted:c,...h});if(m.current=i,"string"===typeof e){const t=A.current=await async function(e,t){var r;return GA&&e.pathname.endsWith(".m3u8")&&(null!==(r=jA)&&void 0!==r||(jA=await n.e(1570).then(n.t.bind(n,13396,23))),jA.default.isSupported())?new jA.default({...t}):null}(d,u);t?(t.attachMedia(i),t.on("hlsMediaAttached",(()=>{t.loadSource(e)}))):i.src=e}else e instanceof MediaStream&&(i.srcObject=e);const a=new s.VideoTexture(i);"colorSpace"in a?a.colorSpace=p.outputColorSpace:a.encoding=p.outputEncoding,i.addEventListener(t,(()=>r(a)))}))),[e]);return(0,i.useEffect)((()=>(r&&f.image.play(),()=>{A.current&&(A.current.destroy(),A.current=null)})),[f,r]),f}const qA=({children:e,src:t,...n})=>{const r=HA(t,n);return i.createElement(i.Fragment,null,null==e?void 0:e(r))},WA=e=>{if(Array.isArray(e))return e[0];if("object"===typeof e&&null!==e){return e[Object.keys(e)[0]][0]}return{w:0,h:0}},YA=e=>{for(let t=3;t<e.length;t+=4)if(0!==e[t])return!1;return!0},XA=(e,t,n,r)=>{const i=t*(r.aspect>e/t?r.width/e:r.height/t),o=e*(r.aspect>e/t?r.width/e:r.height/t)*n,a=i*n;let c=Math.min(1,o),l=Math.min(1,a);return o>1&&(c=1,l=a/o*1),new s.Vector3(c,l,1)};function ZA(e,t,n,r,o){const c=(0,a.D)((e=>e.viewport)),l=i.useRef(null),u=i.useRef(0),[h,d]=(0,i.useState)(null),[A,m]=i.useState(new s.Texture),p=new s.TextureLoader,[f,g]=(0,i.useState)(null);function y(t){(t||e)&&new Promise((n=>{p.load(null!==t&&void 0!==t?t:e,n)})).then((e=>{x(null,e)}))}function v(e,t,n){const r=fetch(e).then((e=>e.json())),i=new Promise((e=>{p.load(t,e)}));Promise.all([r,i]).then((e=>{n(e[0],e[1])}))}i.useLayoutEffect((()=>(t&&e?v(t,e,x):e&&y(),()=>{e&&a.H.clear(s.TextureLoader,e)})),[]);const x=(e,t)=>{let n=new s.Vector3(1,1,1);if(null===e){if(t&&r){const e=t.image.width,i=t.image.height;u.current=r;const{rows:o,columns:s,frameWidth:a,frameHeight:h,emptyFrames:d}=E(t,r);l.current={frames:[],meta:{version:"1.0",size:{w:e,h:i},rows:o,columns:s,frameWidth:a,frameHeight:h,scale:"1"}};for(let t=0;t<o;t++)for(let e=0;e<s;e++){(null!==d&&void 0!==d?d:[]).some((n=>n.row===t&&n.col===e))||l.current.frames.push({frame:{x:e*a,y:t*h,w:a,h:h},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:a,h:h},sourceSize:{w:a,h:h}})}n=XA(a,h,.1,c)}l.current.frames=C(l.current.frames)}else if(t){l.current=e,l.current.frames=w(),u.current=Array.isArray(e.frames)?e.frames.length:Object.keys(e.frames).length;const{w:t,h:r}=WA(e.frames).sourceSize;n=XA(t,r,.1,c)}d(l.current),"encoding"in t?t.encoding=3001:t.colorSpace=s.SRGBColorSpace,m(t),g({spriteTexture:t,spriteData:l.current,aspect:n})},E=(e,t)=>{if(e.image){const n=document.createElement("canvas"),r=n.getContext("2d");n.width=e.image.width,n.height=e.image.height,r.drawImage(e.image,0,0);const i=e.image.width,o=e.image.height,s=Math.round(Math.sqrt(t*(i/o))),a=Math.round(t/s),c=i/s,l=o/a,u=[];for(let e=0;e<a;e++)for(let n=0;n<s;n++){if(e*s+n>=t){u.push({row:e,col:n});continue}const i=r.getImageData(n*c,e*l,c,l).data;YA(i)&&u.push({row:e,col:n})}return{rows:a,columns:s,frameWidth:c,frameHeight:l,emptyFrames:u}}return{rows:0,columns:0,frameWidth:0,frameHeight:0,emptyFrames:[]}},w=()=>{const e={},t=l.current,r=n;if(r&&Array.isArray(t.frames)){for(let n=0;n<r.length;n++){e[r[n]]=[];for(const i of t.frames){const t=i.frame,o=t.x,s=t.y,a=t.w,c=t.h,l=i.sourceSize.w,u=i.sourceSize.h;"string"===typeof i.filename&&-1!==i.filename.toLowerCase().indexOf(r[n].toLowerCase())&&e[r[n]].push({x:o,y:s,w:a,h:c,frame:t,sourceSize:{w:l,h:u}})}}for(const t in e)e[t].frame=C(e[t]);return e}if(r&&"object"===typeof t.frames){for(let n=0;n<r.length;n++){e[r[n]]=[];for(const i in t.frames){const o=t.frames[i],s=o.frame,a=s.x,c=s.y,l=s.w,u=s.h,h=o.sourceSize.w,d=o.sourceSize.h;"string"===typeof i&&-1!==i.toLowerCase().indexOf(r[n].toLowerCase())&&e[r[n]].push({x:a,y:c,w:l,h:u,frame:s,sourceSize:{w:h,h:d}})}}for(const t in e)e[t].frame=C(e[t]);return e}{let e=[];for(const n in t.frames)e.push(t.frames[n]);return e=C(e),e}},C=e=>{let t=null;for(const i of e){const{w:e,h:n}=i.frame,r=e*n;(!t||r>t.area)&&(t={...i.frame,area:r})}for(const i of e){var n;const{w:e,h:o}=i.frame,s=e*o;var r;if(s===(null==(n=t)?void 0:n.area))i.scaleRatio=1;else i.scaleRatio=Math.sqrt(s/(null==(r=t)?void 0:r.area))}return e};return i.useLayoutEffect((()=>{null==o||o(A,h)}),[A,h]),{spriteObj:f,loadJsonAndTexture:function(e,t){t&&e?v(t,e,x):y(e)}}}function KA(e,t,...n){const r=i.useRef(),o=(0,a.D)((e=>e.scene));return i.useLayoutEffect((()=>{let i;if(e&&null!=e&&e.current&&t&&(r.current=i=new t(e.current,...n)),i)return i.traverse((e=>e.raycast=()=>null)),o.add(i),()=>{r.current=void 0,o.remove(i),null==i.dispose||i.dispose()}}),[o,t,e,...n]),(0,a.F)((()=>{var e;null==(e=r.current)||null==e.update||e.update()})),r}ZA.preload=e=>a.H.preload(s.TextureLoader,e),ZA.clear=e=>a.H.clear(s.TextureLoader,e);const JA=({type:e,args:t=[]})=>{const n=i.useRef(null),r=i.useRef(null);return i.useLayoutEffect((()=>{r.current=n.current.parent})),KA(r,e,...t),i.createElement("object3D",{ref:n})};var $A=n(18729),em=n.n($A);function tm(e,t){"function"===typeof e?e(t):null!=e&&(e.current=t)}function nm({showPanel:e=0,className:t,parent:n}){const r=function(e,t=[],n){const[r,o]=i.useState();return i.useLayoutEffect((()=>{const t=e();return o(t),tm(n,t),()=>tm(n,null)}),t),r}((()=>new(em())),[]);return i.useEffect((()=>{if(r){const i=n&&n.current||document.body;r.showPanel(e),null==i||i.appendChild(r.dom);const o=(null!==t&&void 0!==t?t:"").split(" ").filter((e=>e));o.length&&r.dom.classList.add(...o);const s=(0,a.o)((()=>r.begin())),c=(0,a.p)((()=>r.end()));return()=>{o.length&&r.dom.classList.remove(...o),null==i||i.removeChild(r.dom),s(),c()}}}),[n,r,t,e]),null}const rm=class e{constructor({logsPerSecond:t=20,samplesLog:n=100,samplesGraph:r=10,precision:i=2,minimal:o=!1,horizontal:s=!0,mode:a=0}={}){this.totalCpuDuration=0,this.totalGpuDuration=0,this.totalGpuDurationCompute=0,this.totalFps=0,this.activeQuery=null,this.gpuQueries=[],this.renderCount=0,this.mode=a,this.horizontal=s,this.dom=document.createElement("div"),this.dom.style.cssText="position:fixed;top:0;left:0;opacity:0.9;z-index:10000;",o&&(this.dom.style.cssText+="cursor:pointer"),this.gl=null,this.query=null,this.isRunningCPUProfiling=!1,this.minimal=o,this.beginTime=(performance||Date).now(),this.prevTime=this.beginTime,this.prevCpuTime=this.beginTime,this.frames=0,this.renderCount=0,this.threeRendererPatched=!1,this.averageCpu={logs:[],graph:[]},this.averageGpu={logs:[],graph:[]},this.averageGpuCompute={logs:[],graph:[]},this.queryCreated=!1,this.fpsPanel=this.addPanel(new e.Panel("FPS","#0ff","#002"),0),this.msPanel=this.addPanel(new e.Panel("CPU","#0f0","#020"),1),this.gpuPanel=null,this.gpuPanelCompute=null,this.samplesLog=n,this.samplesGraph=r,this.precision=i,this.logsPerSecond=t,this.minimal?(this.dom.addEventListener("click",(e=>{e.preventDefault(),this.showPanel(++this.mode%this.dom.children.length)}),!1),this.mode=a,this.showPanel(this.mode)):window.addEventListener("resize",(()=>{this.resizePanel(this.fpsPanel,0),this.resizePanel(this.msPanel,1),this.gpuPanel&&this.resizePanel(this.gpuPanel,2),this.gpuPanelCompute&&this.resizePanel(this.gpuPanelCompute,3)}))}patchThreeRenderer(e){const t=e.render,n=this;e.render=function(e,r){n.begin(),t.call(this,e,r),n.end()},this.threeRendererPatched=!0}resizePanel(e,t){e.canvas.style.position="absolute",this.minimal?e.canvas.style.display="none":(e.canvas.style.display="block",this.horizontal?(e.canvas.style.top="0px",e.canvas.style.left=t*e.WIDTH/e.PR+"px"):(e.canvas.style.left="0px",e.canvas.style.top=t*e.HEIGHT/e.PR+"px"))}addPanel(e,t){return e.canvas&&(this.dom.appendChild(e.canvas),this.resizePanel(e,t)),e}showPanel(e){for(let t=0;t<this.dom.children.length;t++){this.dom.children[t].style.display=t===e?"block":"none"}this.mode=e}async init(t){if(t){if(t.isWebGLRenderer&&!this.threeRendererPatched){const e=t;this.patchThreeRenderer(e),this.gl=e.getContext()}else!this.gl&&t instanceof WebGL2RenderingContext&&(this.gl=t);if(t.isWebGPURenderer)return t.backend.trackTimestamp=!0,void(await t.hasFeatureAsync("timestamp-query")&&(this.gpuPanel=this.addPanel(new e.Panel("GPU","#ff0","#220"),2),this.gpuPanelCompute=this.addPanel(new e.Panel("CPT","#e1e1e1","#212121"),3),this.info=t.info));if(!this.gl&&t instanceof HTMLCanvasElement||t instanceof OffscreenCanvas){if(this.gl=t.getContext("webgl2"),!this.gl)return void console.error("Stats: Unable to obtain WebGL2 context.")}else if(!this.gl)return void console.error("Stats: Invalid input type. Expected WebGL2RenderingContext, HTMLCanvasElement, or OffscreenCanvas.");this.ext=this.gl.getExtension("EXT_disjoint_timer_query_webgl2"),this.ext&&(this.gpuPanel=this.addPanel(new e.Panel("GPU","#ff0","#220"),2))}else console.error('Stats: The "canvas" parameter is undefined.')}begin(){this.isRunningCPUProfiling||this.beginProfiling("cpu-started"),this.gl&&this.ext&&this.gl&&this.ext&&(this.activeQuery&&this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.activeQuery=this.gl.createQuery(),null!==this.activeQuery&&this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.activeQuery))}end(){this.renderCount++,this.gl&&this.ext&&this.activeQuery&&(this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.gpuQueries.push({query:this.activeQuery}),this.activeQuery=null)}processGpuQueries(){this.gl&&this.ext&&(this.totalGpuDuration=0,this.gpuQueries.forEach(((e,t)=>{if(this.gl){const n=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT_AVAILABLE),r=this.gl.getParameter(this.ext.GPU_DISJOINT_EXT);if(n&&!r){const n=1e-6*this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT);this.totalGpuDuration+=n,this.gl.deleteQuery(e.query),this.gpuQueries.splice(t,1)}}})))}update(){void 0===this.info?this.processGpuQueries():(this.totalGpuDuration=this.info.render.timestamp,this.totalGpuDurationCompute=this.info.compute.timestamp,this.addToAverage(this.totalGpuDurationCompute,this.averageGpuCompute)),this.endProfiling("cpu-started","cpu-finished","cpu-duration"),this.addToAverage(this.totalCpuDuration,this.averageCpu),this.addToAverage(this.totalGpuDuration,this.averageGpu),this.renderCount=0,0===this.totalCpuDuration&&this.beginProfiling("cpu-started"),this.totalCpuDuration=0,this.totalFps=0,this.beginTime=this.endInternal()}endInternal(){this.frames++;const e=(performance||Date).now();if(e>=this.prevCpuTime+1e3/this.logsPerSecond&&(this.updatePanel(this.msPanel,this.averageCpu),this.updatePanel(this.gpuPanel,this.averageGpu),this.gpuPanelCompute&&this.updatePanel(this.gpuPanelCompute,this.averageGpuCompute),this.prevCpuTime=e),e>=this.prevTime+1e3){const t=1e3*this.frames/(e-this.prevTime);this.fpsPanel.update(t,t,100,100,0),this.prevTime=e,this.frames=0}return e}addToAverage(e,t){t.logs.push(e),t.logs.length>this.samplesLog&&t.logs.shift(),t.graph.push(e),t.graph.length>this.samplesGraph&&t.graph.shift()}beginProfiling(e){window.performance&&(window.performance.mark(e),this.isRunningCPUProfiling=!0)}endProfiling(e,t,n){if(window.performance&&t&&this.isRunningCPUProfiling){window.performance.mark(t);const r=performance.measure(n,e,t);this.totalCpuDuration+=r.duration,this.isRunningCPUProfiling=!1}}updatePanel(e,t){if(t.logs.length>0){let n=0,r=.01;for(let e=0;e<t.logs.length;e++)n+=t.logs[e],t.logs[e]>r&&(r=t.logs[e]);let i=0,o=.01;for(let e=0;e<t.graph.length;e++)i+=t.graph[e],t.graph[e]>o&&(o=t.graph[e]);e&&e.update(n/Math.min(t.logs.length,this.samplesLog),i/Math.min(t.graph.length,this.samplesGraph),r,o,this.precision)}}get domElement(){return this.dom}get container(){return console.warn("Stats: Deprecated! this.container as been replaced to this.dom "),this.dom}};rm.Panel=class{constructor(e,t,n){this.name=e,this.fg=t,this.bg=n,this.PR=Math.round(window.devicePixelRatio||1),this.WIDTH=90*this.PR,this.HEIGHT=48*this.PR,this.TEXT_X=3*this.PR,this.TEXT_Y=2*this.PR,this.GRAPH_X=3*this.PR,this.GRAPH_Y=15*this.PR,this.GRAPH_WIDTH=84*this.PR,this.GRAPH_HEIGHT=30*this.PR,this.canvas=document.createElement("canvas"),this.canvas.width=90*this.PR,this.canvas.height=48*this.PR,this.canvas.style.width="90px",this.canvas.style.position="absolute",this.canvas.style.height="48px",this.canvas.style.cssText="width:90px;height:48px",this.context=this.canvas.getContext("2d"),this.context&&(this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.HEIGHT),this.context.fillStyle=this.fg,this.context.fillText(this.name,this.TEXT_X,this.TEXT_Y),this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT))}update(e,t,n,r,i=0){let o=1/0,s=0;this.context&&(o=Math.min(o,e),s=Math.max(n,e),r=Math.max(r,t),this.context.fillStyle=this.bg,this.context.globalAlpha=1,this.context.fillRect(0,0,this.WIDTH,this.GRAPH_Y),this.context.fillStyle=this.fg,this.context.fillText(e.toFixed(i)+" "+this.name+" ("+o.toFixed(i)+"-"+parseFloat(s.toFixed(i))+")",this.TEXT_X,this.TEXT_Y),this.context.drawImage(this.canvas,this.GRAPH_X+this.PR,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT,this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT),this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y,this.PR,this.GRAPH_HEIGHT),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y,this.PR,(1-t/r)*this.GRAPH_HEIGHT))}};let im=rm;const om=i.forwardRef((({className:e,parent:t,id:n,clearStatsGlStyle:r,...o},s)=>{const c=(0,a.D)((e=>e.gl)),l=i.useMemo((()=>{const e=new im({...o});return e.init(c),e}),[c]);return i.useImperativeHandle(s,(()=>l.dom)),i.useEffect((()=>{if(l){const i=t&&t.current||document.body;null==i||i.appendChild(l.dom),l.dom.querySelectorAll("canvas").forEach((e=>{e.style.removeProperty("position")})),n&&(l.dom.id=n),r&&l.dom.removeAttribute("style"),l.dom.removeAttribute("style");const o=(null!==e&&void 0!==e?e:"").split(" ").filter((e=>e));o.length&&l.dom.classList.add(...o);const s=(0,a.p)((()=>l.update()));return()=>{o.length&&l.dom.classList.remove(...o),null==i||i.removeChild(l.dom),s()}}}),[t,l,e,n,r]),null}));function sm({size:e=256,frames:t=1/0}={}){const n=(0,a.D)((e=>e.viewport.dpr)),{width:r,height:o}=(0,a.D)((e=>e.size)),c=e||r*n,l=e||o*n,u=i.useMemo((()=>{const e=new s.DepthTexture(c,l);return e.format=s.DepthFormat,e.type=s.UnsignedShortType,{depthTexture:e}}),[c,l]);let h=0;const d=ol(c,l,u);return(0,a.F)((e=>{(t===1/0||h<t)&&(e.gl.setRenderTarget(d),e.gl.render(e.scene,e.camera),e.gl.setRenderTarget(null),h++)})),d.depthTexture}function am(e,t,n=1){const r=(0,a.D)((e=>e.viewport)),i=t*(r.aspect>e/t?r.width/e:r.height/t);return[e*(r.aspect>e/t?r.width/e:r.height/t)*n,i*n,1]}function cm(e,t){const n=(0,a.D)((e=>e.pointer)),[r]=i.useState((()=>{const r=new s.Raycaster;return t&&(0,a.k)(r,t,{}),function(t,i){r.setFromCamera(n,e instanceof s.Camera?e:e.current);const o=this.constructor.prototype.raycast.bind(this);o&&o(r,i)}}));return r}function lm(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}om.displayName="StatsGl","function"==typeof SuppressedError&&SuppressedError;const um=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function hm(e){return e.toLowerCase().replace(/.*angle ?\((.+)\)(?: on vulkan [0-9.]+)?$/i,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}const dm="undefined"==typeof window,Am=(()=>{if(dm)return;const{userAgent:e,platform:t,maxTouchPoints:n}=window.navigator,r=/(iphone|ipod|ipad)/i.test(e),i="iPad"===t||"MacIntel"===t&&n>0&&!window.MSStream;return{isIpad:i,isMobile:/android/i.test(e)||r||i,isSafari12:/Version\/12.+Safari/.test(e),isFirefox:/Firefox/.test(e)}})();class mm extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}const pm=[],fm=[];function gm(e,t){if(e===t)return 0;const n=e;e.length>t.length&&(e=t,t=n);let r=e.length,i=t.length;for(;r>0&&e.charCodeAt(~-r)===t.charCodeAt(~-i);)r--,i--;let o,s=0;for(;s<r&&e.charCodeAt(s)===t.charCodeAt(s);)s++;if(r-=s,i-=s,0===r)return i;let a,c,l=0,u=0,h=0;for(;u<r;)fm[u]=e.charCodeAt(s+u),pm[u]=++u;for(;h<i;)for(o=t.charCodeAt(s+h),a=h++,l=h,u=0;u<r;u++)c=o===fm[u]?a:a+1,a=pm[u],l=pm[u]=a>l?c>l?l+1:c:c>a?a+1:c;return l}function ym(e){return null!=e}const vm=({mobileTiers:e=[0,15,30,60],desktopTiers:t=[0,15,30,60],override:n={},glContext:r,failIfMajorPerformanceCaveat:i=!1,benchmarksURL:o="https://unpkg.com/detect-gpu@5.0.45/dist/benchmarks"}={})=>lm(void 0,void 0,void 0,(function*(){const s={};if(dm)return{tier:0,type:"SSR"};const{isIpad:a=!!(null==Am?void 0:Am.isIpad),isMobile:c=!!(null==Am?void 0:Am.isMobile),screenSize:l=window.screen,loadBenchmarks:u=(e=>lm(void 0,void 0,void 0,(function*(){const t=yield fetch(`${o}/${e}`).then((e=>e.json()));if(parseInt(t.shift().split(".")[0],10)<4)throw new mm("Detect GPU benchmark data is out of date. Please update to version 4x");return t})))}=n;let{renderer:h}=n;const d=(e,t,n,r,i)=>({device:i,fps:r,gpu:n,isMobile:c,tier:e,type:t});let A,m="";if(h)h=hm(h),A=[h];else{const e=r||function(e,t=!1){const n={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:t,powerPreference:"high-performance",stencil:!1};e&&delete n.powerPreference;const r=window.document.createElement("canvas"),i=r.getContext("webgl",n)||r.getContext("experimental-webgl",n);return null!=i?i:void 0}(null==Am?void 0:Am.isSafari12,i);if(!e)return d(0,"WEBGL_UNSUPPORTED");const t=(null==Am?void 0:Am.isFirefox)?null:e.getExtension("WEBGL_debug_renderer_info");if(h=t?e.getParameter(t.UNMASKED_RENDERER_WEBGL):e.getParameter(e.RENDERER),!h)return d(1,"FALLBACK");m=h,h=hm(h),A=function(e,t,n){return"apple gpu"===t?function(e,t,n){if(!n)return[t];const r=function(e){const t=e.createShader(35633),n=e.createShader(35632),r=e.createProgram();if(!(n&&t&&r))return;e.shaderSource(t,"\n    precision highp float;\n    attribute vec3 aPosition;\n    varying float vvv;\n    void main() {\n      vvv = 0.31622776601683794;\n      gl_Position = vec4(aPosition, 1.0);\n    }\n  "),e.shaderSource(n,"\n    precision highp float;\n    varying float vvv;\n    void main() {\n      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;\n      enc = fract(enc);\n      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n      gl_FragColor = enc;\n    }\n  "),e.compileShader(t),e.compileShader(n),e.attachShader(r,t),e.attachShader(r,n),e.linkProgram(r),e.detachShader(r,t),e.detachShader(r,n),e.deleteShader(t),e.deleteShader(n),e.useProgram(r);const i=e.createBuffer();e.bindBuffer(34962,i),e.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const o=e.getAttribLocation(r,"aPosition");e.vertexAttribPointer(o,3,5126,!1,0,0),e.enableVertexAttribArray(o),e.clearColor(1,1,1,1),e.clear(16384),e.viewport(0,0,1,1),e.drawArrays(4,0,3);const s=new Uint8Array(4);return e.readPixels(0,0,1,1,6408,5121,s),e.deleteProgram(r),e.deleteBuffer(i),s.join("")}(e),i="801621810",o="8016218135",s="80162181161",a=(null==Am?void 0:Am.isIpad)?[["a7",s,12],["a8",o,15],["a8x",o,15],["a9",o,15],["a9x",o,15],["a10",o,15],["a10x",o,15],["a12",i,15],["a12x",i,15],["a12z",i,15],["a14",i,15],["a15",i,15],["m1",i,15],["m2",i,15]]:[["a7",s,12],["a8",o,12],["a9",o,15],["a10",o,15],["a11",i,15],["a12",i,15],["a13",i,15],["a14",i,15],["a15",i,15],["a16",i,15],["a17",i,15]];let c;return"80162181255"===r?c=a.filter((([,,e])=>e>=14)):(c=a.filter((([,e])=>e===r)),c.length||(c=a)),c.map((([e])=>`apple ${e} gpu`))}(e,t,n):[t]}(e,h,c)}const p=(yield Promise.all(A.map((function(e){var t;return lm(this,void 0,void 0,(function*(){const n=(e=>{const t=c?["adreno","apple","mali-t","mali","nvidia","powervr","samsung"]:["intel","apple","amd","radeon","nvidia","geforce","adreno"];for(const n of t)if(e.includes(n))return n})(e);if(!n)return;const r=`${c?"m":"d"}-${n}${a?"-ipad":""}.json`,i=s[r]=null!==(t=s[r])&&void 0!==t?t:u(r);let o;try{o=yield i}catch(n){if(n instanceof mm)throw n;return}const h=function(e){var t;const n=(e=e.replace(/\([^)]+\)/,"")).match(/\d+/)||e.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return null!==(t=null==n?void 0:n.join("").replace(/\W|amd/g,""))&&void 0!==t?t:""}(e);let d=o.filter((([,e])=>e===h));d.length||(d=o.filter((([t])=>t.includes(e))));const A=d.length;if(0===A)return;const m=e.split(/[.,()\[\]/\s]/g).sort().filter(((e,t,n)=>0===t||e!==n[t-1])).join(" ");let p,[f,,,,g]=A>1?d.map((e=>[e,gm(m,e[2])])).sort((([,e],[,t])=>e-t))[0][0]:d[0],y=Number.MAX_VALUE;const{devicePixelRatio:v}=window,x=l.width*v*l.height*v;for(const e of g){const[t,n]=e,r=t*n,i=Math.abs(x-r);i<y&&(y=i,p=e)}if(!p)return;const[,,E,w]=p;return[y,E,f,w]}))})))).filter(ym).sort((([e=Number.MAX_VALUE,t],[n=Number.MAX_VALUE,r])=>e===n?t-r:e-n));if(!p.length){const e=um.find((e=>h.includes(e)));return e?d(0,"BLOCKLISTED",e):d(1,"FALLBACK",`${h} (${m})`)}const[,f,g,y]=p[0];if(-1===f)return d(0,"BLOCKLISTED",g,f,y);const v=c?e:t;let x=0;for(let e=0;e<v.length;e++)f>=v[e]&&(x=e);return d(x,"BENCHMARK",g,f,y)})),xm=e=>(0,_a.Rq)((()=>vm(e)),["useDetectGPU"]);function Em({children:e,...t}){const n=xm(t);return i.createElement(i.Fragment,null,null==e?void 0:e(n))}const wm=0,Cm=1,Im=2,_m=2,bm=1.25,Bm=1,Mm=32,Sm=65535,Dm=Math.pow(2,-24),Tm=Symbol("SKIP_GENERATION");function Qm(e,t,n){return null===e?null:(e.point.applyMatrix4(t.matrixWorld),e.distance=e.point.distanceTo(n.ray.origin),e.object=t,e)}function Pm(e){return e.index?e.index.count:e.attributes.position.count}function zm(e){return Pm(e)/3}function Rm(e,t=ArrayBuffer){return e>65535?new Uint32Array(new t(4*e)):new Uint16Array(new t(2*e))}function Fm(e,t){const n=zm(e),r=t||e.drawRange,i=r.start/3,o=(r.start+r.count)/3,s=Math.max(0,i),a=Math.min(n,o)-s;return[{offset:Math.floor(s),count:Math.floor(a)}]}function km(e,t){if(!e.groups||!e.groups.length)return Fm(e,t);const n=[],r=new Set,i=t||e.drawRange,o=i.start/3,s=(i.start+i.count)/3;for(const c of e.groups){const e=c.start/3,t=(c.start+c.count)/3;r.add(Math.max(o,e)),r.add(Math.min(s,t))}const a=Array.from(r.values()).sort(((e,t)=>e-t));for(let c=0;c<a.length-1;c++){const e=a[c],t=a[c+1];n.push({offset:Math.floor(e),count:Math.floor(t-e)})}return n}function Lm(e,t,n,r,i){let o=1/0,s=1/0,a=1/0,c=-1/0,l=-1/0,u=-1/0,h=1/0,d=1/0,A=1/0,m=-1/0,p=-1/0,f=-1/0;for(let g=6*t,y=6*(t+n);g<y;g+=6){const t=e[g+0],n=e[g+1],r=t-n,i=t+n;r<o&&(o=r),i>c&&(c=i),t<h&&(h=t),t>m&&(m=t);const y=e[g+2],v=e[g+3],x=y-v,E=y+v;x<s&&(s=x),E>l&&(l=E),y<d&&(d=y),y>p&&(p=y);const w=e[g+4],C=e[g+5],I=w-C,_=w+C;I<a&&(a=I),_>u&&(u=_),w<A&&(A=w),w>f&&(f=w)}r[0]=o,r[1]=s,r[2]=a,r[3]=c,r[4]=l,r[5]=u,i[0]=h,i[1]=d,i[2]=A,i[3]=m,i[4]=p,i[5]=f}function Om(e,t,n){return n.min.x=t[e],n.min.y=t[e+1],n.min.z=t[e+2],n.max.x=t[e+3],n.max.y=t[e+4],n.max.z=t[e+5],n}function Um(e){let t=-1,n=-1/0;for(let r=0;r<3;r++){const i=e[r+3]-e[r];i>n&&(n=i,t=r)}return t}function Nm(e,t){t.set(e)}function Vm(e,t,n){let r,i;for(let o=0;o<3;o++){const s=o+3;r=e[o],i=t[o],n[o]=r<i?r:i,r=e[s],i=t[s],n[s]=r>i?r:i}}function Gm(e,t,n){for(let r=0;r<3;r++){const i=t[e+2*r],o=t[e+2*r+1],s=i-o,a=i+o;s<n[r]&&(n[r]=s),a>n[r+3]&&(n[r+3]=a)}}function jm(e){const t=e[3]-e[0],n=e[4]-e[1],r=e[5]-e[2];return 2*(t*n+n*r+r*t)}const Hm=32,qm=(e,t)=>e.candidate-t.candidate,Wm=new Array(Hm).fill().map((()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}))),Ym=new Float32Array(6);class Xm{constructor(){this.boundingData=new Float32Array(6)}}function Zm(e,t,n,r,i,o){let s=r,a=r+i-1;const c=o.pos,l=2*o.axis;for(;;){for(;s<=a&&n[6*s+l]<c;)s++;for(;s<=a&&n[6*a+l]>=c;)a--;if(!(s<a))return s;for(let e=0;e<3;e++){let n=t[3*s+e];t[3*s+e]=t[3*a+e],t[3*a+e]=n}for(let e=0;e<6;e++){let t=n[6*s+e];n[6*s+e]=n[6*a+e],n[6*a+e]=t}s++,a--}}function Km(e,t,n,r,i,o){let s=r,a=r+i-1;const c=o.pos,l=2*o.axis;for(;;){for(;s<=a&&n[6*s+l]<c;)s++;for(;s<=a&&n[6*a+l]>=c;)a--;if(!(s<a))return s;{let t=e[s];e[s]=e[a],e[a]=t;for(let e=0;e<6;e++){let t=n[6*s+e];n[6*s+e]=n[6*a+e],n[6*a+e]=t}s++,a--}}}function Jm(e,t){return 65535===t[e+15]}function $m(e,t){return t[e+6]}function ep(e,t){return t[e+14]}function tp(e){return e+8}function np(e,t){return t[e+6]}function rp(e,t){return t[e+7]}let ip,op,sp,ap;const cp=Math.pow(2,32);function lp(e){return"count"in e?1:1+lp(e.left)+lp(e.right)}function up(e,t,n){return ip=new Float32Array(n),op=new Uint32Array(n),sp=new Uint16Array(n),ap=new Uint8Array(n),hp(e,t)}function hp(e,t){const n=e/4,r=e/2,i="count"in t,o=t.boundingData;for(let s=0;s<6;s++)ip[n+s]=o[s];if(i){if(t.buffer){const r=t.buffer;ap.set(new Uint8Array(r),e);for(let t=e,i=e+r.byteLength;t<i;t+=Mm){Jm(t/2,sp)||(op[t/4+6]+=n)}return e+r.byteLength}{const i=t.offset,o=t.count;return op[n+6]=i,sp[r+14]=o,sp[r+15]=Sm,e+Mm}}{const r=t.left,i=t.right,o=t.splitAxis;let s;if(s=hp(e+Mm,r),s/4>cp)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return op[n+6]=s/4,s=hp(s,i),op[n+7]=o,s}}function dp(e,t,n,r,i){const{maxDepth:o,verbose:s,maxLeafTris:a,strategy:c,onProgress:l,indirect:u}=i,h=e._indirectBuffer,d=e.geometry,A=d.index?d.index.array:null,m=u?Km:Zm,p=zm(d),f=new Float32Array(6);let g=!1;const y=new Xm;return Lm(t,n,r,y.boundingData,f),function e(n,r,i,l=null,u=0){!g&&u>=o&&(g=!0,s&&(console.warn(`MeshBVH: Max depth of ${o} reached when generating BVH. Consider increasing maxDepth.`),console.warn(d)));if(i<=a||u>=o)return v(r+i),n.offset=r,n.count=i,n;const p=function(e,t,n,r,i,o){let s=-1,a=0;if(o===wm)s=Um(t),-1!==s&&(a=(t[s]+t[s+3])/2);else if(o===Cm)s=Um(e),-1!==s&&(a=function(e,t,n,r){let i=0;for(let o=t,s=t+n;o<s;o++)i+=e[6*o+2*r];return i/n}(n,r,i,s));else if(o===Im){const o=jm(e);let c=bm*i;const l=6*r,u=6*(r+i);for(let e=0;e<3;e++){const r=t[e],h=(t[e+3]-r)/Hm;if(i<Hm/4){const t=[...Wm];t.length=i;let r=0;for(let i=l;i<u;i+=6,r++){const o=t[r];o.candidate=n[i+2*e],o.count=0;const{bounds:s,leftCacheBounds:a,rightCacheBounds:c}=o;for(let e=0;e<3;e++)c[e]=1/0,c[e+3]=-1/0,a[e]=1/0,a[e+3]=-1/0,s[e]=1/0,s[e+3]=-1/0;Gm(i,n,s)}t.sort(qm);let h=i;for(let e=0;e<h;e++){const n=t[e];for(;e+1<h&&t[e+1].candidate===n.candidate;)t.splice(e+1,1),h--}for(let i=l;i<u;i+=6){const r=n[i+2*e];for(let e=0;e<h;e++){const o=t[e];r>=o.candidate?Gm(i,n,o.rightCacheBounds):(Gm(i,n,o.leftCacheBounds),o.count++)}}for(let n=0;n<h;n++){const r=t[n],l=r.count,u=i-r.count,h=r.leftCacheBounds,d=r.rightCacheBounds;let A=0;0!==l&&(A=jm(h)/o);let m=0;0!==u&&(m=jm(d)/o);const p=Bm+bm*(A*l+m*u);p<c&&(s=e,c=p,a=r.candidate)}}else{for(let e=0;e<Hm;e++){const t=Wm[e];t.count=0,t.candidate=r+h+e*h;const n=t.bounds;for(let e=0;e<3;e++)n[e]=1/0,n[e+3]=-1/0}for(let i=l;i<u;i+=6){let t=~~((n[i+2*e]-r)/h);t>=Hm&&(t=Hm-1);const o=Wm[t];o.count++,Gm(i,n,o.bounds)}const t=Wm[Hm-1];Nm(t.bounds,t.rightCacheBounds);for(let e=Hm-2;e>=0;e--){const t=Wm[e],n=Wm[e+1];Vm(t.bounds,n.rightCacheBounds,t.rightCacheBounds)}let d=0;for(let n=0;n<Hm-1;n++){const t=Wm[n],r=t.count,l=t.bounds,u=Wm[n+1].rightCacheBounds;0!==r&&(0===d?Nm(l,Ym):Vm(l,Ym,Ym)),d+=r;let h=0,A=0;0!==d&&(h=jm(Ym)/o);const m=i-d;0!==m&&(A=jm(u)/o);const p=Bm+bm*(h*d+A*m);p<c&&(s=e,c=p,a=t.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${o} used.`);return{axis:s,pos:a}}(n.boundingData,l,t,r,i,c);if(-1===p.axis)return v(r+i),n.offset=r,n.count=i,n;const y=m(h,A,t,r,i,p);if(y===r||y===r+i)v(r+i),n.offset=r,n.count=i;else{n.splitAxis=p.axis;const o=new Xm,s=r,a=y-r;n.left=o,Lm(t,s,a,o.boundingData,f),e(o,s,a,f,u+1);const c=new Xm,l=y,h=i-a;n.right=c,Lm(t,l,h,c.boundingData,f),e(c,l,h,f,u+1)}return n}(y,n,r,f),y;function v(e){l&&l(e/p)}}function Ap(e,t){const n=e.geometry;t.indirect&&(e._indirectBuffer=function(e,t){const n=(e.index?e.index.count:e.attributes.position.count)/3,r=n>65536,i=r?4:2,o=t?new SharedArrayBuffer(n*i):new ArrayBuffer(n*i),s=r?new Uint32Array(o):new Uint16Array(o);for(let a=0,c=s.length;a<c;a++)s[a]=a;return s}(n,t.useSharedArrayBuffer),function(e,t){const n=zm(e),r=km(e,t).sort(((e,t)=>e.offset-t.offset)),i=r[r.length-1];i.count=Math.min(n-i.offset,i.count);let o=0;return r.forEach((({count:e})=>o+=e)),n!==o}(n,t.range)&&!t.verbose&&console.warn('MeshBVH: Provided geometry contains groups or a range that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),e._indirectBuffer||function(e,t){if(!e.index){const n=e.attributes.position.count,r=Rm(n,t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);e.setIndex(new s.BufferAttribute(r,1));for(let e=0;e<n;e++)r[e]=e}}(n,t);const r=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,i=function(e,t=null,n=null,r=null){const i=e.attributes.position,o=e.index?e.index.array:null,s=zm(e),a=i.normalized;let c;null===t?(c=new Float32Array(6*s*4),n=0,r=s):(c=t,n=n||0,r=r||s);const l=i.array,u=i.offset||0;let h=3;i.isInterleavedBufferAttribute&&(h=i.data.stride);const d=["getX","getY","getZ"];for(let A=n;A<n+r;A++){const e=3*A,t=6*A;let n=e+0,r=e+1,s=e+2;o&&(n=o[n],r=o[r],s=o[s]),a||(n=n*h+u,r=r*h+u,s=s*h+u);for(let o=0;o<3;o++){let e,u,h;a?(e=i[d[o]](n),u=i[d[o]](r),h=i[d[o]](s)):(e=l[n+o],u=l[r+o],h=l[s+o]);let A=e;u<A&&(A=u),h<A&&(A=h);let m=e;u>m&&(m=u),h>m&&(m=h);const p=(m-A)/2,f=2*o;c[t+f+0]=A+p,c[t+f+1]=p+(Math.abs(A)+p)*Dm}}return c}(n),o=t.indirect?Fm(n,t.range):km(n,t.range);e._roots=o.map((n=>{const o=dp(e,i,n.offset,n.count,t),s=lp(o),a=new r(Mm*s);return up(0,o,a),a}))}class mp{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let n=1/0,r=-1/0;for(let i=0,o=e.length;i<o;i++){const o=e[i][t];n=o<n?o:n,r=o>r?o:r}this.min=n,this.max=r}setFromPoints(e,t){let n=1/0,r=-1/0;for(let i=0,o=t.length;i<o;i++){const o=t[i],s=e.dot(o);n=s<n?s:n,r=s>r?s:r}this.min=n,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}}mp.prototype.setFromBox=function(){const e=new s.Vector3;return function(t,n){const r=n.min,i=n.max;let o=1/0,s=-1/0;for(let a=0;a<=1;a++)for(let n=0;n<=1;n++)for(let c=0;c<=1;c++){e.x=r.x*a+i.x*(1-a),e.y=r.y*n+i.y*(1-n),e.z=r.z*c+i.z*(1-c);const l=t.dot(e);o=Math.min(l,o),s=Math.max(l,s)}this.min=o,this.max=s}}();!function(){const e=new mp}();const pp=function(){const e=new s.Vector3,t=new s.Vector3,n=new s.Vector3;return function(r,i,o){const s=r.start,a=e,c=i.start,l=t;n.subVectors(s,c),e.subVectors(r.end,r.start),t.subVectors(i.end,i.start);const u=n.dot(l),h=l.dot(a),d=l.dot(l),A=n.dot(a),m=a.dot(a)*d-h*h;let p,f;p=0!==m?(u*h-A*d)/m:0,f=(u+p*h)/d,o.x=p,o.y=f}}(),fp=function(){const e=new s.Vector2,t=new s.Vector3,n=new s.Vector3;return function(r,i,o,s){pp(r,i,e);let a=e.x,c=e.y;if(a>=0&&a<=1&&c>=0&&c<=1)return r.at(a,o),void i.at(c,s);if(a>=0&&a<=1)return c<0?i.at(0,s):i.at(1,s),void r.closestPointToPoint(s,!0,o);if(c>=0&&c<=1)return a<0?r.at(0,o):r.at(1,o),void i.closestPointToPoint(o,!0,s);{let e,l;e=a<0?r.start:r.end,l=c<0?i.start:i.end;const u=t,h=n;return r.closestPointToPoint(l,!0,t),i.closestPointToPoint(e,!0,n),u.distanceToSquared(l)<=h.distanceToSquared(e)?(o.copy(u),void s.copy(l)):(o.copy(e),void s.copy(h))}}}(),gp=function(){const e=new s.Vector3,t=new s.Vector3,n=new s.Plane,r=new s.Line3;return function(i,o){const{radius:s,center:a}=i,{a:c,b:l,c:u}=o;r.start=c,r.end=l;if(r.closestPointToPoint(a,!0,e).distanceTo(a)<=s)return!0;r.start=c,r.end=u;if(r.closestPointToPoint(a,!0,e).distanceTo(a)<=s)return!0;r.start=l,r.end=u;if(r.closestPointToPoint(a,!0,e).distanceTo(a)<=s)return!0;const h=o.getPlane(n);if(Math.abs(h.distanceToPoint(a))<=s){const e=h.projectPoint(a,t);if(o.containsPoint(e))return!0}return!1}}();function yp(e){return Math.abs(e)<1e-15}class vp extends s.Triangle{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new s.Vector3)),this.satBounds=new Array(4).fill().map((()=>new mp)),this.points=[this.a,this.b,this.c],this.sphere=new s.Sphere,this.plane=new s.Plane,this.needsUpdate=!0}intersectsSphere(e){return gp(e,this)}update(){const e=this.a,t=this.b,n=this.c,r=this.points,i=this.satAxes,o=this.satBounds,s=i[0],a=o[0];this.getNormal(s),a.setFromPoints(s,r);const c=i[1],l=o[1];c.subVectors(e,t),l.setFromPoints(c,r);const u=i[2],h=o[2];u.subVectors(t,n),h.setFromPoints(u,r);const d=i[3],A=o[3];d.subVectors(n,e),A.setFromPoints(d,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(s,e),this.needsUpdate=!1}}vp.prototype.closestPointToSegment=function(){const e=new s.Vector3,t=new s.Vector3,n=new s.Line3;return function(r,i=null,o=null){const{start:s,end:a}=r,c=this.points;let l,u=1/0;for(let h=0;h<3;h++){const s=(h+1)%3;n.start.copy(c[h]),n.end.copy(c[s]),fp(n,r,e,t),l=e.distanceToSquared(t),l<u&&(u=l,i&&i.copy(e),o&&o.copy(t))}return this.closestPointToPoint(s,e),l=s.distanceToSquared(e),l<u&&(u=l,i&&i.copy(e),o&&o.copy(s)),this.closestPointToPoint(a,e),l=a.distanceToSquared(e),l<u&&(u=l,i&&i.copy(e),o&&o.copy(a)),Math.sqrt(u)}}(),vp.prototype.intersectsTriangle=function(){const e=new vp,t=new Array(3),n=new Array(3),r=new mp,i=new mp,o=new s.Vector3,a=new s.Vector3,c=new s.Vector3,l=new s.Vector3,u=new s.Vector3,h=new s.Line3,d=new s.Line3,A=new s.Line3,m=new s.Vector3;function p(e,t,n){const r=e.points;let i=0,o=-1;for(let s=0;s<3;s++){const{start:e,end:c}=h;e.copy(r[s]),c.copy(r[(s+1)%3]),h.delta(a);const l=yp(t.distanceToPoint(e));if(yp(t.normal.dot(a))&&l){n.copy(h),i=2;break}const u=t.intersectLine(h,m);if(!u&&l&&m.copy(e),(u||l)&&!yp(m.distanceTo(c))){if(i<=1){(1===i?n.start:n.end).copy(m),l&&(o=i)}else if(i>=2){(1===o?n.start:n.end).copy(m),i=2;break}if(i++,2===i&&-1===o)break}}return i}return function(s,a=null,h=!1){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(e.copy(s),e.update(),s=e);const m=this.plane,f=s.plane;if(Math.abs(m.normal.dot(f.normal))>1-1e-10){const e=this.satBounds,c=this.satAxes;n[0]=s.a,n[1]=s.b,n[2]=s.c;for(let t=0;t<4;t++){const i=e[t],o=c[t];if(r.setFromPoints(o,n),i.isSeparated(r))return!1}const l=s.satBounds,u=s.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let n=0;n<4;n++){const e=l[n],i=u[n];if(r.setFromPoints(i,t),e.isSeparated(r))return!1}for(let s=0;s<4;s++){const e=c[s];for(let s=0;s<4;s++){const a=u[s];if(o.crossVectors(e,a),r.setFromPoints(o,t),i.setFromPoints(o,n),r.isSeparated(i))return!1}}return a&&(h||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),a.start.set(0,0,0),a.end.set(0,0,0)),!0}{const e=p(this,f,d);if(1===e&&s.containsPoint(d.end))return a&&(a.start.copy(d.end),a.end.copy(d.end)),!0;if(2!==e)return!1;const t=p(s,m,A);if(1===t&&this.containsPoint(A.end))return a&&(a.start.copy(A.end),a.end.copy(A.end)),!0;if(2!==t)return!1;if(d.delta(c),A.delta(l),c.dot(l)<0){let e=A.start;A.start=A.end,A.end=e}const n=d.start.dot(c),r=d.end.dot(c),i=A.start.dot(c),o=A.end.dot(c);return(n===o||i===r||r<i!==n<o)&&(a&&(u.subVectors(d.start,A.start),u.dot(c)>0?a.start.copy(d.start):a.start.copy(A.start),u.subVectors(d.end,A.end),u.dot(c)<0?a.end.copy(d.end):a.end.copy(A.end)),!0)}}}(),vp.prototype.distanceToPoint=function(){const e=new s.Vector3;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),vp.prototype.distanceToTriangle=function(){const e=new s.Vector3,t=new s.Vector3,n=["a","b","c"],r=new s.Line3,i=new s.Line3;return function(o,s=null,a=null){const c=s||a?r:null;if(this.intersectsTriangle(o,c))return(s||a)&&(s&&c.getCenter(s),a&&c.getCenter(a)),0;let l=1/0;for(let t=0;t<3;t++){let r;const i=n[t],c=o[i];this.closestPointToPoint(c,e),r=c.distanceToSquared(e),r<l&&(l=r,s&&s.copy(e),a&&a.copy(c));const u=this[i];o.closestPointToPoint(u,e),r=u.distanceToSquared(e),r<l&&(l=r,s&&s.copy(u),a&&a.copy(e))}for(let u=0;u<3;u++){const c=n[u],h=n[(u+1)%3];r.set(this[c],this[h]);for(let u=0;u<3;u++){const c=n[u],h=n[(u+1)%3];i.set(o[c],o[h]),fp(r,i,e,t);const d=e.distanceToSquared(t);d<l&&(l=d,s&&s.copy(e),a&&a.copy(t))}}return Math.sqrt(l)}}();class xp{constructor(e,t,n){this.isOrientedBox=!0,this.min=new s.Vector3,this.max=new s.Vector3,this.matrix=new s.Matrix4,this.invMatrix=new s.Matrix4,this.points=new Array(8).fill().map((()=>new s.Vector3)),this.satAxes=new Array(3).fill().map((()=>new s.Vector3)),this.satBounds=new Array(3).fill().map((()=>new mp)),this.alignedSatBounds=new Array(3).fill().map((()=>new mp)),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),n&&this.matrix.copy(n)}set(e,t,n){this.min.copy(e),this.max.copy(t),this.matrix.copy(n),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}xp.prototype.update=function(){const e=this.matrix,t=this.min,n=this.max,r=this.points;for(let c=0;c<=1;c++)for(let i=0;i<=1;i++)for(let o=0;o<=1;o++){const s=r[1*c|2*i|4*o];s.x=c?n.x:t.x,s.y=i?n.y:t.y,s.z=o?n.z:t.z,s.applyMatrix4(e)}const i=this.satBounds,o=this.satAxes,s=r[0];for(let c=0;c<3;c++){const e=o[c],t=i[c],n=r[1<<c];e.subVectors(s,n),t.setFromPoints(e,r)}const a=this.alignedSatBounds;a[0].setFromPointsField(r,"x"),a[1].setFromPointsField(r,"y"),a[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},xp.prototype.intersectsBox=function(){const e=new mp;return function(t){this.needsUpdate&&this.update();const n=t.min,r=t.max,i=this.satBounds,o=this.satAxes,s=this.alignedSatBounds;if(e.min=n.x,e.max=r.x,s[0].isSeparated(e))return!1;if(e.min=n.y,e.max=r.y,s[1].isSeparated(e))return!1;if(e.min=n.z,e.max=r.z,s[2].isSeparated(e))return!1;for(let a=0;a<3;a++){const n=o[a],r=i[a];if(e.setFromBox(n,t),r.isSeparated(e))return!1}return!0}}(),xp.prototype.intersectsTriangle=function(){const e=new vp,t=new Array(3),n=new mp,r=new mp,i=new s.Vector3;return function(o){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(e.copy(o),e.update(),o=e);const s=this.satBounds,a=this.satAxes;t[0]=o.a,t[1]=o.b,t[2]=o.c;for(let e=0;e<3;e++){const r=s[e],i=a[e];if(n.setFromPoints(i,t),r.isSeparated(n))return!1}const c=o.satBounds,l=o.satAxes,u=this.points;for(let e=0;e<3;e++){const t=c[e],r=l[e];if(n.setFromPoints(r,u),t.isSeparated(n))return!1}for(let e=0;e<3;e++){const o=a[e];for(let e=0;e<4;e++){const s=l[e];if(i.crossVectors(o,s),n.setFromPoints(i,t),r.setFromPoints(i,u),n.isSeparated(r))return!1}}return!0}}(),xp.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},xp.prototype.distanceToPoint=function(){const e=new s.Vector3;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),xp.prototype.distanceToBox=function(){const e=["x","y","z"],t=new Array(12).fill().map((()=>new s.Line3)),n=new Array(12).fill().map((()=>new s.Line3)),r=new s.Vector3,i=new s.Vector3;return function(o,s=0,a=null,c=null){if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(a||c)&&(o.getCenter(i),this.closestPointToPoint(i,r),o.closestPointToPoint(r,i),a&&a.copy(r),c&&c.copy(i)),0;const l=s*s,u=o.min,h=o.max,d=this.points;let A=1/0;for(let e=0;e<8;e++){const t=d[e];i.copy(t).clamp(u,h);const n=t.distanceToSquared(i);if(n<A&&(A=n,a&&a.copy(t),c&&c.copy(i),n<l))return Math.sqrt(n)}let m=0;for(let r=0;r<3;r++)for(let i=0;i<=1;i++)for(let o=0;o<=1;o++){const s=(r+1)%3,a=(r+2)%3,c=1<<r|i<<s|o<<a,l=d[i<<s|o<<a],A=d[c];t[m].set(l,A);const p=e[r],f=e[s],g=e[a],y=n[m],v=y.start,x=y.end;v[p]=u[p],v[f]=i?u[f]:h[f],v[g]=o?u[g]:h[f],x[p]=h[p],x[f]=i?u[f]:h[f],x[g]=o?u[g]:h[f],m++}for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let n=0;n<=1;n++){i.x=e?h.x:u.x,i.y=t?h.y:u.y,i.z=n?h.z:u.z,this.closestPointToPoint(i,r);const o=i.distanceToSquared(r);if(o<A&&(A=o,a&&a.copy(r),c&&c.copy(i),o<l))return Math.sqrt(o)}for(let e=0;e<12;e++){const o=t[e];for(let e=0;e<12;e++){const t=n[e];fp(o,t,r,i);const s=r.distanceToSquared(i);if(s<A&&(A=s,a&&a.copy(r),c&&c.copy(i),s<l))return Math.sqrt(s)}}return Math.sqrt(A)}}();class Ep{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class wp extends Ep{constructor(){super((()=>new vp))}}const Cp=new wp;const Ip=new class{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=n=>{t&&e.push(t),t=n,this.float32Array=new Float32Array(n),this.uint16Array=new Uint16Array(n),this.uint32Array=new Uint32Array(n)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,0!==e.length&&this.setBuffer(e.pop())}}};let _p,bp;const Bp=[],Mp=new Ep((()=>new s.Box3));function Sp(e,t,n,r,i,o){_p=Mp.getPrimitive(),bp=Mp.getPrimitive(),Bp.push(_p,bp),Ip.setBuffer(e._roots[t]);const s=Dp(0,e.geometry,n,r,i,o);Ip.clearBuffer(),Mp.releasePrimitive(_p),Mp.releasePrimitive(bp),Bp.pop(),Bp.pop();const a=Bp.length;return a>0&&(bp=Bp[a-1],_p=Bp[a-2]),s}function Dp(e,t,n,r,i=null,o=0,s=0){const{float32Array:a,uint16Array:c,uint32Array:l}=Ip;let u=2*e;if(Jm(u,c)){const h=$m(e,l),d=ep(u,c);return Om(e,a,_p),r(h,d,!1,s,o+e,_p)}{const A=tp(e),m=np(e,l);let p,f,g,y,v=A,x=m;if(i&&(g=_p,y=bp,Om(v,a,g),Om(x,a,y),p=i(g),f=i(y),f<p)){v=m,x=A;const B=p;p=f,f=B,g=y}g||(g=_p,Om(v,a,g));const E=n(g,Jm(2*v,c),p,s+1,o+v);let w;if(E===_m){const M=_(v);w=r(M,b(v)-M,!0,s+1,o+v,g)}else w=E&&Dp(v,t,n,r,i,o,s+1);if(w)return!0;y=bp,Om(x,a,y);const C=n(y,Jm(2*x,c),f,s+1,o+x);let I;if(C===_m){const S=_(x);I=r(S,b(x)-S,!0,s+1,o+x,y)}else I=C&&Dp(x,t,n,r,i,o,s+1);return!!I;function _(e){const{uint16Array:t,uint32Array:n}=Ip;let r=2*e;for(;!Jm(r,t);)r=2*(e=tp(e));return $m(e,n)}function b(e){const{uint16Array:t,uint32Array:n}=Ip;let r=2*e;for(;!Jm(r,t);)r=2*(e=np(e,n));return $m(e,n)+ep(r,t)}}}const Tp=new s.Vector3,Qp=new s.Vector3;const Pp=new s.Vector3,zp=new s.Vector3,Rp=new s.Vector3,Fp=new s.Vector2,kp=new s.Vector2,Lp=new s.Vector2,Op=new s.Vector3,Up=new s.Vector3,Np=new s.Vector3,Vp=new s.Vector3;function Gp(e,t,n,r,i,o,a,c,l,u,h){Pp.fromBufferAttribute(t,o),zp.fromBufferAttribute(t,a),Rp.fromBufferAttribute(t,c);const d=function(e,t,n,r,i,o,a,c){let l;if(l=o===s.BackSide?e.intersectTriangle(r,n,t,!0,i):e.intersectTriangle(t,n,r,o!==s.DoubleSide,i),null===l)return null;const u=e.origin.distanceTo(i);return u<a||u>c?null:{distance:u,point:i.clone()}}(e,Pp,zp,Rp,Vp,l,u,h);if(d){r&&(Fp.fromBufferAttribute(r,o),kp.fromBufferAttribute(r,a),Lp.fromBufferAttribute(r,c),d.uv=s.Triangle.getInterpolation(Vp,Pp,zp,Rp,Fp,kp,Lp,new s.Vector2)),i&&(Fp.fromBufferAttribute(i,o),kp.fromBufferAttribute(i,a),Lp.fromBufferAttribute(i,c),d.uv1=s.Triangle.getInterpolation(Vp,Pp,zp,Rp,Fp,kp,Lp,new s.Vector2)),n&&(Op.fromBufferAttribute(n,o),Up.fromBufferAttribute(n,a),Np.fromBufferAttribute(n,c),d.normal=s.Triangle.getInterpolation(Vp,Pp,zp,Rp,Op,Up,Np,new s.Vector3),d.normal.dot(e.direction)>0&&d.normal.multiplyScalar(-1));const t={a:o,b:a,c:c,normal:new s.Vector3,materialIndex:0};s.Triangle.getNormal(Pp,zp,Rp,t.normal),d.face=t,d.faceIndex=o}return d}function jp(e,t,n,r,i,o,s){const a=3*r;let c=a+0,l=a+1,u=a+2;const h=e.index;e.index&&(c=h.getX(c),l=h.getX(l),u=h.getX(u));const{position:d,normal:A,uv:m,uv1:p}=e.attributes,f=Gp(n,d,A,m,p,c,l,u,t,o,s);return f?(f.faceIndex=r,i&&i.push(f),f):null}function Hp(e,t,n,r){const i=e.a,o=e.b,s=e.c;let a=t,c=t+1,l=t+2;n&&(a=n.getX(a),c=n.getX(c),l=n.getX(l)),i.x=r.getX(a),i.y=r.getY(a),i.z=r.getZ(a),o.x=r.getX(c),o.y=r.getY(c),o.z=r.getZ(c),s.x=r.getX(l),s.y=r.getY(l),s.z=r.getZ(l)}function qp(e,t,n,r,i,o,s){const{geometry:a}=n,{index:c}=a,l=a.attributes.position;for(let u=e,h=t+e;u<h;u++){let e;if(e=u,Hp(s,3*e,c,l),s.needsUpdate=!0,r(s,e,i,o))return!0}return!1}function Wp(e,t=null){t&&Array.isArray(t)&&(t=new Set(t));const n=e.geometry,r=n.index?n.index.array:null,i=n.attributes.position;let o,s,a,c,l=0;const u=e._roots;for(let d=0,A=u.length;d<A;d++)o=u[d],s=new Uint32Array(o),a=new Uint16Array(o),c=new Float32Array(o),h(0,l),l+=o.byteLength;function h(e,n,o=!1){const l=2*e;if(a[l+15]===Sm){const t=s[e+6];let n=1/0,o=1/0,u=1/0,h=-1/0,d=-1/0,A=-1/0;for(let e=3*t,s=3*(t+a[l+14]);e<s;e++){let t=r[e];const s=i.getX(t),a=i.getY(t),c=i.getZ(t);s<n&&(n=s),s>h&&(h=s),a<o&&(o=a),a>d&&(d=a),c<u&&(u=c),c>A&&(A=c)}return(c[e+0]!==n||c[e+1]!==o||c[e+2]!==u||c[e+3]!==h||c[e+4]!==d||c[e+5]!==A)&&(c[e+0]=n,c[e+1]=o,c[e+2]=u,c[e+3]=h,c[e+4]=d,c[e+5]=A,!0)}{const r=e+8,i=s[e+6],a=r+n,l=i+n;let u=o,d=!1,A=!1;t?u||(d=t.has(a),A=t.has(l),u=!d&&!A):(d=!0,A=!0);const m=u||A;let p=!1;(u||d)&&(p=h(r,n,u));let f=!1;m&&(f=h(i,n,u));const g=p||f;if(g)for(let t=0;t<3;t++){const n=r+t,o=i+t,s=c[n],a=c[n+3],l=c[o],u=c[o+3];c[e+t]=s<l?s:l,c[e+t+3]=a>u?a:u}return g}}}function Yp(e,t,n,r,i){let o,s,a,c,l,u;const h=1/n.direction.x,d=1/n.direction.y,A=1/n.direction.z,m=n.origin.x,p=n.origin.y,f=n.origin.z;let g=t[e],y=t[e+3],v=t[e+1],x=t[e+3+1],E=t[e+2],w=t[e+3+2];return h>=0?(o=(g-m)*h,s=(y-m)*h):(o=(y-m)*h,s=(g-m)*h),d>=0?(a=(v-p)*d,c=(x-p)*d):(a=(x-p)*d,c=(v-p)*d),!(o>c||a>s)&&((a>o||isNaN(o))&&(o=a),(c<s||isNaN(s))&&(s=c),A>=0?(l=(E-f)*A,u=(w-f)*A):(l=(w-f)*A,u=(E-f)*A),!(o>u||l>s)&&((l>o||o!==o)&&(o=l),(u<s||s!==s)&&(s=u),o<=i&&s>=r))}function Xp(e,t,n,r,i,o,s){Ip.setBuffer(e._roots[t]),Zp(0,e,n,r,i,o,s),Ip.clearBuffer()}function Zp(e,t,n,r,i,o,s){const{float32Array:a,uint16Array:c,uint32Array:l}=Ip,u=2*e;if(Jm(u,c)){!function(e,t,n,r,i,o,s,a){const{geometry:c,_indirectBuffer:l}=e;for(let u=r,h=r+i;u<h;u++)jp(c,t,n,u,o,s,a)}(t,n,r,$m(e,l),ep(u,c),i,o,s)}else{const c=tp(e);Yp(c,a,r,o,s)&&Zp(c,t,n,r,i,o,s);const u=np(e,l);Yp(u,a,r,o,s)&&Zp(u,t,n,r,i,o,s)}}const Kp=["x","y","z"];function Jp(e,t,n,r,i,o){Ip.setBuffer(e._roots[t]);const s=$p(0,e,n,r,i,o);return Ip.clearBuffer(),s}function $p(e,t,n,r,i,o){const{float32Array:s,uint16Array:a,uint32Array:c}=Ip;let l=2*e;if(Jm(l,a)){return function(e,t,n,r,i,o,s){const{geometry:a,_indirectBuffer:c}=e;let l=1/0,u=null;for(let h=r,d=r+i;h<d;h++){let e;e=jp(a,t,n,h,null,o,s),e&&e.distance<l&&(u=e,l=e.distance)}return u}(t,n,r,$m(e,c),ep(l,a),i,o)}{const a=rp(e,c),l=Kp[a],u=r.direction[l]>=0;let h,d;u?(h=tp(e),d=np(e,c)):(h=np(e,c),d=tp(e));const A=Yp(h,s,r,i,o)?$p(h,t,n,r,i,o):null;if(A){const e=A.point[l];if(u?e<=s[d+a]:e>=s[d+a+3])return A}const m=Yp(d,s,r,i,o)?$p(d,t,n,r,i,o):null;return A&&m?A.distance<=m.distance?A:m:A||m||null}}const ef=new s.Box3,tf=new vp,nf=new vp,rf=new s.Matrix4,of=new xp,sf=new xp;function af(e,t,n,r){Ip.setBuffer(e._roots[t]);const i=cf(0,e,n,r);return Ip.clearBuffer(),i}function cf(e,t,n,r,i=null){const{float32Array:o,uint16Array:s,uint32Array:a}=Ip;let c=2*e;null===i&&(n.boundingBox||n.computeBoundingBox(),of.set(n.boundingBox.min,n.boundingBox.max,r),i=of);if(!Jm(c,s)){const s=e+8,c=a[e+6];Om(s,o,ef);if(i.intersectsBox(ef)&&cf(s,t,n,r,i))return!0;Om(c,o,ef);return!!(i.intersectsBox(ef)&&cf(c,t,n,r,i))}{const i=t.geometry,l=i.index,u=i.attributes.position,h=n.index,d=n.attributes.position,A=$m(e,a),m=ep(c,s);if(rf.copy(r).invert(),n.boundsTree){Om(e,o,sf),sf.matrix.copy(rf),sf.needsUpdate=!0;const t=n.boundsTree.shapecast({intersectsBounds:e=>sf.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(r),e.b.applyMatrix4(r),e.c.applyMatrix4(r),e.needsUpdate=!0;for(let t=3*A,n=3*(m+A);t<n;t+=3)if(Hp(nf,t,l,u),nf.needsUpdate=!0,e.intersectsTriangle(nf))return!0;return!1}});return t}for(let e=3*A,t=3*(m+A);e<t;e+=3){Hp(tf,e,l,u),tf.a.applyMatrix4(rf),tf.b.applyMatrix4(rf),tf.c.applyMatrix4(rf),tf.needsUpdate=!0;for(let e=0,t=h.count;e<t;e+=3)if(Hp(nf,e,h,d),nf.needsUpdate=!0,tf.intersectsTriangle(nf))return!0}}}const lf=new s.Matrix4,uf=new xp,hf=new xp,df=new s.Vector3,Af=new s.Vector3,mf=new s.Vector3,pf=new s.Vector3;function ff(e,t,n,r={},i={},o=0,s=1/0){t.boundingBox||t.computeBoundingBox(),uf.set(t.boundingBox.min,t.boundingBox.max,n),uf.needsUpdate=!0;const a=e.geometry,c=a.attributes.position,l=a.index,u=t.attributes.position,h=t.index,d=Cp.getPrimitive(),A=Cp.getPrimitive();let m=df,p=Af,f=null,g=null;i&&(f=mf,g=pf);let y=1/0,v=null,x=null;return lf.copy(n).invert(),hf.matrix.copy(lf),e.shapecast({boundsTraverseOrder:e=>uf.distanceToBox(e),intersectsBounds:(e,t,n)=>n<y&&n<s&&(t&&(hf.min.copy(e.min),hf.max.copy(e.max),hf.needsUpdate=!0),!0),intersectsRange:(e,r)=>{if(t.boundsTree){return t.boundsTree.shapecast({boundsTraverseOrder:e=>hf.distanceToBox(e),intersectsBounds:(e,t,n)=>n<y&&n<s,intersectsRange:(t,i)=>{for(let s=t,a=t+i;s<a;s++){Hp(A,3*s,h,u),A.a.applyMatrix4(n),A.b.applyMatrix4(n),A.c.applyMatrix4(n),A.needsUpdate=!0;for(let t=e,n=e+r;t<n;t++){Hp(d,3*t,l,c),d.needsUpdate=!0;const e=d.distanceToTriangle(A,m,f);if(e<y&&(p.copy(m),g&&g.copy(f),y=e,v=t,x=s),e<o)return!0}}}})}for(let i=0,s=zm(t);i<s;i++){Hp(A,3*i,h,u),A.a.applyMatrix4(n),A.b.applyMatrix4(n),A.c.applyMatrix4(n),A.needsUpdate=!0;for(let t=e,n=e+r;t<n;t++){Hp(d,3*t,l,c),d.needsUpdate=!0;const e=d.distanceToTriangle(A,m,f);if(e<y&&(p.copy(m),g&&g.copy(f),y=e,v=t,x=i),e<o)return!0}}}}),Cp.releasePrimitive(d),Cp.releasePrimitive(A),y===1/0?null:(r.point?r.point.copy(p):r.point=p.clone(),r.distance=y,r.faceIndex=v,i&&(i.point?i.point.copy(g):i.point=g.clone(),i.point.applyMatrix4(lf),p.applyMatrix4(lf),i.distance=p.sub(i.point).length(),i.faceIndex=x),r)}function gf(e,t,n,r,i,o,s){const{geometry:a}=n,{index:c}=a,l=a.attributes.position;for(let u=e,h=t+e;u<h;u++){let e;if(e=n.resolveTriangleIndex(u),Hp(s,3*e,c,l),s.needsUpdate=!0,r(s,e,i,o))return!0}return!1}function yf(e,t=null){t&&Array.isArray(t)&&(t=new Set(t));const n=e.geometry,r=n.index?n.index.array:null,i=n.attributes.position;let o,s,a,c,l=0;const u=e._roots;for(let d=0,A=u.length;d<A;d++)o=u[d],s=new Uint32Array(o),a=new Uint16Array(o),c=new Float32Array(o),h(0,l),l+=o.byteLength;function h(n,o,l=!1){const u=2*n;if(a[u+15]===Sm){const t=s[n+6];let o=1/0,l=1/0,h=1/0,d=-1/0,A=-1/0,m=-1/0;for(let n=t,s=t+a[u+14];n<s;n++){const t=3*e.resolveTriangleIndex(n);for(let e=0;e<3;e++){let n=t+e;n=r?r[n]:n;const s=i.getX(n),a=i.getY(n),c=i.getZ(n);s<o&&(o=s),s>d&&(d=s),a<l&&(l=a),a>A&&(A=a),c<h&&(h=c),c>m&&(m=c)}}return(c[n+0]!==o||c[n+1]!==l||c[n+2]!==h||c[n+3]!==d||c[n+4]!==A||c[n+5]!==m)&&(c[n+0]=o,c[n+1]=l,c[n+2]=h,c[n+3]=d,c[n+4]=A,c[n+5]=m,!0)}{const e=n+8,r=s[n+6],i=e+o,a=r+o;let u=l,d=!1,A=!1;t?u||(d=t.has(i),A=t.has(a),u=!d&&!A):(d=!0,A=!0);const m=u||A;let p=!1;(u||d)&&(p=h(e,o,u));let f=!1;m&&(f=h(r,o,u));const g=p||f;if(g)for(let t=0;t<3;t++){const i=e+t,o=r+t,s=c[i],a=c[i+3],l=c[o],u=c[o+3];c[n+t]=s<l?s:l,c[n+t+3]=a>u?a:u}return g}}}function vf(e,t,n,r,i,o,s){Ip.setBuffer(e._roots[t]),xf(0,e,n,r,i,o,s),Ip.clearBuffer()}function xf(e,t,n,r,i,o,s){const{float32Array:a,uint16Array:c,uint32Array:l}=Ip,u=2*e;if(Jm(u,c)){!function(e,t,n,r,i,o,s,a){const{geometry:c,_indirectBuffer:l}=e;for(let u=r,h=r+i;u<h;u++)jp(c,t,n,l?l[u]:u,o,s,a)}(t,n,r,$m(e,l),ep(u,c),i,o,s)}else{const c=tp(e);Yp(c,a,r,o,s)&&xf(c,t,n,r,i,o,s);const u=np(e,l);Yp(u,a,r,o,s)&&xf(u,t,n,r,i,o,s)}}const Ef=["x","y","z"];function wf(e,t,n,r,i,o){Ip.setBuffer(e._roots[t]);const s=Cf(0,e,n,r,i,o);return Ip.clearBuffer(),s}function Cf(e,t,n,r,i,o){const{float32Array:s,uint16Array:a,uint32Array:c}=Ip;let l=2*e;if(Jm(l,a)){return function(e,t,n,r,i,o,s){const{geometry:a,_indirectBuffer:c}=e;let l=1/0,u=null;for(let h=r,d=r+i;h<d;h++){let e;e=jp(a,t,n,c?c[h]:h,null,o,s),e&&e.distance<l&&(u=e,l=e.distance)}return u}(t,n,r,$m(e,c),ep(l,a),i,o)}{const a=rp(e,c),l=Ef[a],u=r.direction[l]>=0;let h,d;u?(h=tp(e),d=np(e,c)):(h=np(e,c),d=tp(e));const A=Yp(h,s,r,i,o)?Cf(h,t,n,r,i,o):null;if(A){const e=A.point[l];if(u?e<=s[d+a]:e>=s[d+a+3])return A}const m=Yp(d,s,r,i,o)?Cf(d,t,n,r,i,o):null;return A&&m?A.distance<=m.distance?A:m:A||m||null}}const If=new s.Box3,_f=new vp,bf=new vp,Bf=new s.Matrix4,Mf=new xp,Sf=new xp;function Df(e,t,n,r){Ip.setBuffer(e._roots[t]);const i=Tf(0,e,n,r);return Ip.clearBuffer(),i}function Tf(e,t,n,r,i=null){const{float32Array:o,uint16Array:s,uint32Array:a}=Ip;let c=2*e;null===i&&(n.boundingBox||n.computeBoundingBox(),Mf.set(n.boundingBox.min,n.boundingBox.max,r),i=Mf);if(!Jm(c,s)){const s=e+8,c=a[e+6];Om(s,o,If);if(i.intersectsBox(If)&&Tf(s,t,n,r,i))return!0;Om(c,o,If);return!!(i.intersectsBox(If)&&Tf(c,t,n,r,i))}{const i=t.geometry,l=i.index,u=i.attributes.position,h=n.index,d=n.attributes.position,A=$m(e,a),m=ep(c,s);if(Bf.copy(r).invert(),n.boundsTree){Om(e,o,Sf),Sf.matrix.copy(Bf),Sf.needsUpdate=!0;const i=n.boundsTree.shapecast({intersectsBounds:e=>Sf.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(r),e.b.applyMatrix4(r),e.c.applyMatrix4(r),e.needsUpdate=!0;for(let n=A,r=m+A;n<r;n++)if(Hp(bf,3*t.resolveTriangleIndex(n),l,u),bf.needsUpdate=!0,e.intersectsTriangle(bf))return!0;return!1}});return i}for(let e=A,n=m+A;e<n;e++){const n=t.resolveTriangleIndex(e);Hp(_f,3*n,l,u),_f.a.applyMatrix4(Bf),_f.b.applyMatrix4(Bf),_f.c.applyMatrix4(Bf),_f.needsUpdate=!0;for(let e=0,t=h.count;e<t;e+=3)if(Hp(bf,e,h,d),bf.needsUpdate=!0,_f.intersectsTriangle(bf))return!0}}}const Qf=new s.Matrix4,Pf=new xp,zf=new xp,Rf=new s.Vector3,Ff=new s.Vector3,kf=new s.Vector3,Lf=new s.Vector3;function Of(e,t,n,r={},i={},o=0,s=1/0){t.boundingBox||t.computeBoundingBox(),Pf.set(t.boundingBox.min,t.boundingBox.max,n),Pf.needsUpdate=!0;const a=e.geometry,c=a.attributes.position,l=a.index,u=t.attributes.position,h=t.index,d=Cp.getPrimitive(),A=Cp.getPrimitive();let m=Rf,p=Ff,f=null,g=null;i&&(f=kf,g=Lf);let y=1/0,v=null,x=null;return Qf.copy(n).invert(),zf.matrix.copy(Qf),e.shapecast({boundsTraverseOrder:e=>Pf.distanceToBox(e),intersectsBounds:(e,t,n)=>n<y&&n<s&&(t&&(zf.min.copy(e.min),zf.max.copy(e.max),zf.needsUpdate=!0),!0),intersectsRange:(r,i)=>{if(t.boundsTree){const a=t.boundsTree;return a.shapecast({boundsTraverseOrder:e=>zf.distanceToBox(e),intersectsBounds:(e,t,n)=>n<y&&n<s,intersectsRange:(t,s)=>{for(let E=t,w=t+s;E<w;E++){const t=a.resolveTriangleIndex(E);Hp(A,3*t,h,u),A.a.applyMatrix4(n),A.b.applyMatrix4(n),A.c.applyMatrix4(n),A.needsUpdate=!0;for(let n=r,s=r+i;n<s;n++){const t=e.resolveTriangleIndex(n);Hp(d,3*t,l,c),d.needsUpdate=!0;const r=d.distanceToTriangle(A,m,f);if(r<y&&(p.copy(m),g&&g.copy(f),y=r,v=n,x=E),r<o)return!0}}}})}for(let s=0,a=zm(t);s<a;s++){Hp(A,3*s,h,u),A.a.applyMatrix4(n),A.b.applyMatrix4(n),A.c.applyMatrix4(n),A.needsUpdate=!0;for(let t=r,n=r+i;t<n;t++){const n=e.resolveTriangleIndex(t);Hp(d,3*n,l,c),d.needsUpdate=!0;const r=d.distanceToTriangle(A,m,f);if(r<y&&(p.copy(m),g&&g.copy(f),y=r,v=t,x=s),r<o)return!0}}}}),Cp.releasePrimitive(d),Cp.releasePrimitive(A),y===1/0?null:(r.point?r.point.copy(p):r.point=p.clone(),r.distance=y,r.faceIndex=v,i&&(i.point?i.point.copy(g):i.point=g.clone(),i.point.applyMatrix4(Qf),p.applyMatrix4(Qf),i.distance=p.sub(i.point).length(),i.faceIndex=x),r)}const Uf=new Ip.constructor,Nf=new Ip.constructor,Vf=new Ep((()=>new s.Box3)),Gf=new s.Box3,jf=new s.Box3,Hf=new s.Box3,qf=new s.Box3;let Wf=!1;function Yf(e,t,n,r,i,o=0,s=0,a=0,c=0,l=null,u=!1){let h,d;u?(h=Nf,d=Uf):(h=Uf,d=Nf);const A=h.float32Array,m=h.uint32Array,p=h.uint16Array,f=d.float32Array,g=d.uint32Array,y=d.uint16Array,v=2*t,x=Jm(2*e,p),E=Jm(v,y);let w=!1;if(E&&x)w=u?i($m(t,g),ep(2*t,y),$m(e,m),ep(2*e,p),c,s+t,a,o+e):i($m(e,m),ep(2*e,p),$m(t,g),ep(2*t,y),a,o+e,c,s+t);else if(E){const l=Vf.getPrimitive();Om(t,f,l),l.applyMatrix4(n);const h=tp(e),d=np(e,m);Om(h,A,Gf),Om(d,A,jf);const p=l.intersectsBox(Gf),g=l.intersectsBox(jf);w=p&&Yf(t,h,r,n,i,s,o,c,a+1,l,!u)||g&&Yf(t,d,r,n,i,s,o,c,a+1,l,!u),Vf.releasePrimitive(l)}else{const h=tp(t),d=np(t,g);Om(h,f,Hf),Om(d,f,qf);const p=l.intersectsBox(Hf),y=l.intersectsBox(qf);if(p&&y)w=Yf(e,h,n,r,i,o,s,a,c+1,l,u)||Yf(e,d,n,r,i,o,s,a,c+1,l,u);else if(p)if(x)w=Yf(e,h,n,r,i,o,s,a,c+1,l,u);else{const t=Vf.getPrimitive();t.copy(Hf).applyMatrix4(n);const l=tp(e),d=np(e,m);Om(l,A,Gf),Om(d,A,jf);const p=t.intersectsBox(Gf),f=t.intersectsBox(jf);w=p&&Yf(h,l,r,n,i,s,o,c,a+1,t,!u)||f&&Yf(h,d,r,n,i,s,o,c,a+1,t,!u),Vf.releasePrimitive(t)}else if(y)if(x)w=Yf(e,d,n,r,i,o,s,a,c+1,l,u);else{const t=Vf.getPrimitive();t.copy(qf).applyMatrix4(n);const l=tp(e),h=np(e,m);Om(l,A,Gf),Om(h,A,jf);const p=t.intersectsBox(Gf),f=t.intersectsBox(jf);w=p&&Yf(d,l,r,n,i,s,o,c,a+1,t,!u)||f&&Yf(d,h,r,n,i,s,o,c,a+1,t,!u),Vf.releasePrimitive(t)}}return w}const Xf=new xp,Zf=new s.Box3,Kf={strategy:wm,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0,range:null};class Jf{static serialize(e,t={}){t={cloneBuffers:!0,...t};const n=e.geometry,r=e._roots,i=e._indirectBuffer,o=n.getIndex();let s;return s=t.cloneBuffers?{roots:r.map((e=>e.slice())),index:o?o.array.slice():null,indirectBuffer:i?i.slice():null}:{roots:r,index:o?o.array:null,indirectBuffer:i},s}static deserialize(e,t,n={}){n={setIndex:!0,indirect:Boolean(e.indirectBuffer),...n};const{index:r,roots:i,indirectBuffer:o}=e,a=new Jf(t,{...n,[Tm]:!0});if(a._roots=i,a._indirectBuffer=o||null,n.setIndex){const n=t.getIndex();if(null===n){const n=new s.BufferAttribute(e.index,1,!1);t.setIndex(n)}else n.array!==r&&(n.array.set(r),n.needsUpdate=!0)}return a}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((t=Object.assign({...Kf,[Tm]:!1},t)).useSharedArrayBuffer&&"undefined"===typeof SharedArrayBuffer)throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[Tm]||(Ap(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new s.Box3))),this.resolveTriangleIndex=t.indirect?e=>this._indirectBuffer[e]:e=>e}refit(e=null){return(this.indirect?yf:Wp)(this,e)}traverse(e,t=0){const n=this._roots[t],r=new Uint32Array(n),i=new Uint16Array(n);!function t(o,s=0){const a=2*o,c=i[a+15]===Sm;if(c){const t=r[o+6],l=i[a+14];e(s,c,new Float32Array(n,4*o,6),t,l)}else{const i=o+Mm/4,a=r[o+6],l=r[o+7];e(s,c,new Float32Array(n,4*o,6),l)||(t(i,s+1),t(a,s+1))}}(0)}raycast(e,t=s.FrontSide,n=0,r=1/0){const i=this._roots,o=this.geometry,a=[],c=t.isMaterial,l=Array.isArray(t),u=o.groups,h=c?t.side:t,d=this.indirect?vf:Xp;for(let s=0,A=i.length;s<A;s++){const i=l?t[u[s].materialIndex].side:h,o=a.length;if(d(this,s,i,e,a,n,r),l){const e=u[s].materialIndex;for(let t=o,n=a.length;t<n;t++)a[t].face.materialIndex=e}}return a}raycastFirst(e,t=s.FrontSide,n=0,r=1/0){const i=this._roots,o=this.geometry,a=t.isMaterial,c=Array.isArray(t);let l=null;const u=o.groups,h=a?t.side:t,d=this.indirect?wf:Jp;for(let s=0,A=i.length;s<A;s++){const i=d(this,s,c?t[u[s].materialIndex].side:h,e,n,r);null!=i&&(null==l||i.distance<l.distance)&&(l=i,c&&(i.face.materialIndex=u[s].materialIndex))}return l}intersectsGeometry(e,t){let n=!1;const r=this._roots,i=this.indirect?Df:af;for(let o=0,s=r.length;o<s&&(n=i(this,o,e,t),!n);o++);return n}shapecast(e){const t=Cp.getPrimitive(),n=this.indirect?gf:qp;let{boundsTraverseOrder:r,intersectsBounds:i,intersectsRange:o,intersectsTriangle:s}=e;if(o&&s){const e=o;o=(r,i,o,a,c)=>!!e(r,i,o,a,c)||n(r,i,this,s,o,a,t)}else o||(o=s?(e,r,i,o)=>n(e,r,this,s,i,o,t):(e,t,n)=>n);let a=!1,c=0;const l=this._roots;for(let u=0,h=l.length;u<h;u++){const e=l[u];if(a=Sp(this,u,i,o,r,c),a)break;c+=e.byteLength}return Cp.releasePrimitive(t),a}bvhcast(e,t,n){let{intersectsRanges:r,intersectsTriangles:i}=n;const o=Cp.getPrimitive(),a=this.geometry.index,c=this.geometry.attributes.position,l=this.indirect?e=>{const t=this.resolveTriangleIndex(e);Hp(o,3*t,a,c)}:e=>{Hp(o,3*e,a,c)},u=Cp.getPrimitive(),h=e.geometry.index,d=e.geometry.attributes.position,A=e.indirect?t=>{const n=e.resolveTriangleIndex(t);Hp(u,3*n,h,d)}:e=>{Hp(u,3*e,h,d)};if(i){const e=(e,n,r,s,a,c,h,d)=>{for(let m=r,p=r+s;m<p;m++){A(m),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let t=e,r=e+n;t<r;t++)if(l(t),o.needsUpdate=!0,i(o,u,t,m,a,c,h,d))return!0}return!1};if(r){const t=r;r=function(n,r,i,o,s,a,c,l){return!!t(n,r,i,o,s,a,c,l)||e(n,r,i,o,s,a,c,l)}}else r=e}return function(e,t,n,r){if(Wf)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");Wf=!0;const i=e._roots,o=t._roots;let a,c=0,l=0;const u=(new s.Matrix4).copy(n).invert();for(let s=0,h=i.length;s<h;s++){Uf.setBuffer(i[s]),l=0;const e=Vf.getPrimitive();Om(0,Uf.float32Array,e),e.applyMatrix4(u);for(let t=0,i=o.length;t<i&&(Nf.setBuffer(o[t]),a=Yf(0,0,n,u,r,c,l,0,0,e),Nf.clearBuffer(),l+=o[t].length,!a);t++);if(Vf.releasePrimitive(e),Uf.clearBuffer(),c+=i[s].length,a)break}return Wf=!1,a}(this,e,t,r)}intersectsBox(e,t){return Xf.set(e.min,e.max,t),Xf.needsUpdate=!0,this.shapecast({intersectsBounds:e=>Xf.intersectsBox(e),intersectsTriangle:e=>Xf.intersectsTriangle(e)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,n={},r={},i=0,o=1/0){return(this.indirect?Of:ff)(this,e,t,n,r,i,o)}closestPointToPoint(e,t={},n=0,r=1/0){return function(e,t,n={},r=0,i=1/0){const o=r*r,s=i*i;let a=1/0,c=null;if(e.shapecast({boundsTraverseOrder:e=>(Tp.copy(t).clamp(e.min,e.max),Tp.distanceToSquared(t)),intersectsBounds:(e,t,n)=>n<a&&n<s,intersectsTriangle:(e,n)=>{e.closestPointToPoint(t,Tp);const r=t.distanceToSquared(Tp);return r<a&&(Qp.copy(Tp),a=r,c=n),r<o}}),a===1/0)return null;const l=Math.sqrt(a);return n.point?n.point.copy(Qp):n.point=Qp.clone(),n.distance=l,n.faceIndex=c,n}(this,e,t,n,r)}getBoundingBox(e){e.makeEmpty();return this._roots.forEach((t=>{Om(0,new Float32Array(t),Zf),e.union(Zf)})),e}}const $f=s.BatchedMesh||null,eg=(parseInt(s.REVISION),new s.Ray),tg=new s.Vector3,ng=new s.Matrix4,rg=s.Mesh.prototype.raycast,ig=null!==$f?$f.prototype.raycast:null,og=new s.Vector3,sg=new s.Mesh,ag=[];function cg(e,t){this.isBatchedMesh?lg.call(this,e,t):ug.call(this,e,t)}function lg(e,t){if(this.boundsTrees){const n=this.boundsTrees,r=this._drawInfo,i=this._drawRanges,o=this.matrixWorld;sg.material=this.material,sg.geometry=this.geometry;const a=sg.geometry.boundsTree,c=sg.geometry.drawRange;null===sg.geometry.boundingSphere&&(sg.geometry.boundingSphere=new s.Sphere);for(let s=0,l=r.length;s<l;s++){if(!this.getVisibleAt(s))continue;const a=r[s].geometryIndex;if(sg.geometry.boundsTree=n[a],this.getMatrixAt(s,sg.matrixWorld).premultiply(o),!sg.geometry.boundsTree){this.getBoundingBoxAt(a,sg.geometry.boundingBox),this.getBoundingSphereAt(a,sg.geometry.boundingSphere);const e=i[a];sg.geometry.setDrawRange(e.start,e.count)}sg.raycast(e,ag);for(let e=0,n=ag.length;e<n;e++){const n=ag[e];n.object=this,n.batchId=s,t.push(n)}ag.length=0}sg.geometry.boundsTree=a,sg.geometry.drawRange=c,sg.material=null,sg.geometry=null}else ig.call(this,e,t)}function ug(e,t){if(this.geometry.boundsTree){if(void 0===this.material)return;ng.copy(this.matrixWorld).invert(),eg.copy(e.ray).applyMatrix4(ng),og.setFromMatrixScale(this.matrixWorld),tg.copy(eg.direction).multiply(og);const n=tg.length(),r=e.near/n,i=e.far/n,o=this.geometry.boundsTree;if(!0===e.firstHitOnly){const n=Qm(o.raycastFirst(eg,this.material,r,i),this,e);n&&t.push(n)}else{const n=o.raycast(eg,this.material,r,i);for(let r=0,i=n.length;r<i;r++){const i=Qm(n[r],this,e);i&&t.push(i)}}}else rg.call(this,e,t)}function hg(e={}){return this.boundsTree=new Jf(this,e),this.boundsTree}function dg(){this.boundsTree=null}const Ag=e=>e.isMesh;function mg(e,t){t={strategy:Im,verbose:!1,setBoundingBox:!0,maxDepth:40,maxLeafTris:10,indirect:!1,...t},i.useEffect((()=>{if(e.current){e.current.raycast=cg;const n=e.current.geometry;return n.computeBoundsTree=hg,n.disposeBoundsTree=dg,n.computeBoundsTree(t),()=>{n.boundsTree&&n.disposeBoundsTree()}}}),[e,JSON.stringify(t)])}const pg=i.forwardRef((({enabled:e=!0,firstHitOnly:t=!1,children:n,strategy:o=Im,verbose:c=!1,setBoundingBox:l=!0,maxDepth:u=40,maxLeafTris:h=10,indirect:d=!1,...A},m)=>{const p=i.useRef(null),f=(0,a.D)((e=>e.raycaster));return i.useImperativeHandle(m,(()=>p.current),[]),i.useEffect((()=>{if(e){const e={strategy:o,verbose:c,setBoundingBox:l,maxDepth:u,maxLeafTris:h,indirect:d},n=p.current;return f.firstHitOnly=t,n.traverse((t=>{Ag(t)&&!t.geometry.boundsTree&&t.raycast===s.Mesh.prototype.raycast&&(t.raycast=cg,t.geometry.computeBoundsTree=hg,t.geometry.disposeBoundsTree=dg,t.geometry.computeBoundsTree(e))})),()=>{delete f.firstHitOnly,n.traverse((e=>{Ag(e)&&e.geometry.boundsTree&&(e.geometry.disposeBoundsTree(),e.raycast=s.Mesh.prototype.raycast)}))}}}),[]),i.createElement("group",(0,r.Z)({ref:p},A),n)}));function fg(...e){const t=i.useRef([]);return t.current=e.map((e=>i.useContext(e))),i.useMemo((()=>({children:n})=>e.reduceRight(((e,n,r)=>i.createElement(n.Provider,{value:t.current[r],children:e})),n)),[])}function gg(e,t){const n=i.useRef(),[r]=i.useState((()=>t?t instanceof s.Object3D?{current:t}:t:n)),[o]=i.useState((()=>new s.AnimationMixer(void 0)));i.useLayoutEffect((()=>{t&&(r.current=t instanceof s.Object3D?t:t.current),o._root=r.current}));const c=i.useRef({}),l=i.useMemo((()=>{const t={};return e.forEach((e=>Object.defineProperty(t,e.name,{enumerable:!0,get(){if(r.current)return c.current[e.name]||(c.current[e.name]=o.clipAction(e,r.current))},configurable:!0}))),{ref:r,clips:e,actions:t,names:e.map((e=>e.name)),mixer:o}}),[e]);return(0,a.F)(((e,t)=>o.update(t))),i.useEffect((()=>{const e=r.current;return()=>{c.current={},o.stopAllAction(),Object.values(l.actions).forEach((t=>{e&&o.uncacheAction(t,e)}))}}),[e]),l}function yg(e){const t=i.useRef(null),n=i.useRef(!1),r=i.useRef(!1),o=i.useRef(e);return i.useLayoutEffect((()=>{o.current=e}),[e]),i.useEffect((()=>{const e=t.current;if(e){const t=(0,a.o)((()=>(n.current=!1,!0))),i=e.onBeforeRender;e.onBeforeRender=()=>n.current=!0;const s=(0,a.p)((()=>(n.current!==r.current&&(null==o.current||o.current(r.current=n.current)),!0)));return()=>{e.onBeforeRender=i,t(),s()}}}),[]),t}const vg="\n#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n  vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n  #ifdef BOX_PROJECTED_ENV_MAP\n    vWorldPosition = worldPosition.xyz;\n  #endif\n#endif\n",xg="\n#ifdef BOX_PROJECTED_ENV_MAP\n  uniform vec3 envMapSize;\n  uniform vec3 envMapPosition;\n  varying vec3 vWorldPosition;\n    \n  vec3 parallaxCorrectNormal( vec3 v, vec3 cubeSize, vec3 cubePos ) {\n    vec3 nDir = normalize( v );\n    vec3 rbmax = ( .5 * cubeSize + cubePos - vWorldPosition ) / nDir;\n    vec3 rbmin = ( -.5 * cubeSize + cubePos - vWorldPosition ) / nDir;\n    vec3 rbminmax;\n    rbminmax.x = ( nDir.x > 0. ) ? rbmax.x : rbmin.x;\n    rbminmax.y = ( nDir.y > 0. ) ? rbmax.y : rbmin.y;\n    rbminmax.z = ( nDir.z > 0. ) ? rbmax.z : rbmin.z;\n    float correction = min( min( rbminmax.x, rbminmax.y ), rbminmax.z );\n    vec3 boxIntersection = vWorldPosition + nDir * correction;    \n    return boxIntersection - cubePos;\n  }\n#endif\n",Eg="\n#ifdef BOX_PROJECTED_ENV_MAP\n  worldNormal = parallaxCorrectNormal( worldNormal, envMapSize, envMapPosition );\n#endif\n",wg="\n#ifdef BOX_PROJECTED_ENV_MAP\n  reflectVec = parallaxCorrectNormal( reflectVec, envMapSize, envMapPosition );\n#endif\n";function Cg(e=new s.Vector3,t=new s.Vector3){const[n]=i.useState((()=>({position:new s.Vector3,size:new s.Vector3})));(0,a.k)(n,{position:e,size:t});const r=i.useRef(null),o=i.useMemo((()=>({ref:r,onBeforeCompile:e=>function(e,t,n){e.defines.BOX_PROJECTED_ENV_MAP=!0,e.uniforms.envMapPosition={value:t},e.uniforms.envMapSize={value:n},e.vertexShader=`\n  varying vec3 vWorldPosition;\n  ${e.vertexShader.replace("#include <worldpos_vertex>",vg)}`,e.fragmentShader=`\n    ${xg}\n    ${e.fragmentShader.replace("#include <envmap_physical_pars_fragment>",s.ShaderChunk.envmap_physical_pars_fragment).replace("vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );",`vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n         ${Eg}\n         `).replace("reflectVec = inverseTransformDirection( reflectVec, viewMatrix );",`reflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n         ${wg}\n        `)}`}(e,n.position,n.size),customProgramCacheKey:()=>JSON.stringify(n.position.toArray())+JSON.stringify(n.size.toArray())})),[...n.position.toArray(),...n.size.toArray()]);return i.useLayoutEffect((()=>{r.current.needsUpdate=!0}),[n]),o}const Ig=new s.Box3,_g=new s.Vector3,bg=({anchor:e,...t})=>{const n=i.useRef(null),o=i.useRef(null);return i.useEffect((()=>{var e;null!=(e=n.current)&&null!=(e=e.parent)&&e.parent&&(o.current=n.current.parent,n.current.parent.parent.add(n.current))}),[]),(0,a.F)((()=>{o.current&&(Ig.setFromObject(o.current),Ig.getSize(_g),n.current.position.set(o.current.position.x+_g.x*(Array.isArray(e)?e[0]:e.x)/2,o.current.position.y+_g.y*(Array.isArray(e)?e[1]:e.y)/2,o.current.position.z+_g.z*(Array.isArray(e)?e[2]:e.z)/2))})),i.createElement("group",(0,r.Z)({ref:n},t))};const Bg=e=>Math.sqrt(1-Math.pow(e-1,2));class Mg{constructor({size:e=256,maxAge:t=750,radius:n=.3,intensity:r=.2,interpolate:i=0,smoothing:o=0,minForce:s=.3,blend:a="screen",ease:c=Bg}={}){this.size=e,this.maxAge=t,this.radius=n,this.intensity=r,this.ease=c,this.interpolate=i,this.smoothing=o,this.minForce=s,this.blend=a,this.trail=[],this.force=0,this.initTexture()}initTexture(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=this.size;const e=this.canvas.getContext("2d");if(null===e)throw new Error("2D not available");this.ctx=e,this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.texture=new s.Texture(this.canvas),this.canvas.id="touchTexture",this.canvas.style.width=this.canvas.style.height=`${this.canvas.width}px`}update(e){this.clear(),this.trail.forEach(((t,n)=>{t.age+=1e3*e,t.age>this.maxAge&&this.trail.splice(n,1)})),this.trail.length||(this.force=0),this.trail.forEach((e=>{this.drawTouch(e)})),this.texture.needsUpdate=!0}clear(){this.ctx.globalCompositeOperation="source-over",this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}addTouch(e){const t=this.trail[this.trail.length-1];if(t){const n=t.x-e.x,r=t.y-e.y,i=n*n+r*r,o=Math.max(this.minForce,Math.min(1e4*i,1));if(this.force=function(e,t,n=.9){return t*n+e*(1-n)}(o,this.force,this.smoothing),this.interpolate){const e=Math.ceil(i/Math.pow(.5*this.radius/this.interpolate,2));if(e>1)for(let i=1;i<e;i++)this.trail.push({x:t.x-n/e*i,y:t.y-r/e*i,age:0,force:o})}}this.trail.push({x:e.x,y:e.y,age:0,force:this.force})}drawTouch(e){const t={x:e.x*this.size,y:(1-e.y)*this.size};let n=1;n=e.age<.3*this.maxAge?this.ease(e.age/(.3*this.maxAge)):this.ease(1-(e.age-.3*this.maxAge)/(.7*this.maxAge)),n*=e.force,this.ctx.globalCompositeOperation=this.blend;const r=this.size*this.radius*n,i=this.ctx.createRadialGradient(t.x,t.y,Math.max(0,.25*r),t.x,t.y,Math.max(0,r));i.addColorStop(0,`rgba(255, 255, 255, ${this.intensity})`),i.addColorStop(1,"rgba(0, 0, 0, 0.0)"),this.ctx.beginPath(),this.ctx.fillStyle=i,this.ctx.arc(t.x,t.y,Math.max(0,r),0,2*Math.PI),this.ctx.fill()}}function Sg(e={}){const{size:t,maxAge:n,radius:r,intensity:o,interpolate:s,smoothing:c,minForce:l,blend:u,ease:h}=e,d=(0,i.useMemo)((()=>new Mg(e)),[t,n,r,o,s,c,l,u,h]);(0,a.F)(((e,t)=>{d.update(t)}));const A=(0,i.useCallback)((e=>d.addTouch(e.uv)),[d]);return[d.texture,A]}const Dg=({children:e,...t})=>{const n=Sg(t);return i.createElement(i.Fragment,null,null==e?void 0:e(n))},Tg=i.forwardRef((function({children:e,disable:t,disableX:n,disableY:o,disableZ:a,left:c,right:l,top:u,bottom:h,front:d,back:A,onCentered:m,precise:p=!0,cacheKey:f=0,...g},y){const v=i.useRef(null),x=i.useRef(null),E=i.useRef(null);return i.useLayoutEffect((()=>{x.current.matrixWorld.identity();const e=(new s.Box3).setFromObject(E.current,p),r=new s.Vector3,i=new s.Sphere,f=e.max.x-e.min.x,g=e.max.y-e.min.y,y=e.max.z-e.min.z;e.getCenter(r),e.getBoundingSphere(i);const w=u?g/2:h?-g/2:0,C=c?-f/2:l?f/2:0,I=d?y/2:A?-y/2:0;x.current.position.set(t||n?0:-r.x+C,t||o?0:-r.y+w,t||a?0:-r.z+I),"undefined"!==typeof m&&m({parent:v.current.parent,container:v.current,width:f,height:g,depth:y,boundingBox:e,boundingSphere:i,center:r,verticalAlignment:w,horizontalAlignment:C,depthAlignment:I})}),[f,m,u,c,d,t,n,o,a,p,l,h,A]),i.useImperativeHandle(y,(()=>v.current),[]),i.createElement("group",(0,r.Z)({ref:v},g),i.createElement("group",{ref:x},i.createElement("group",{ref:E},e)))})),Qg=i.forwardRef((({font:e,color:t="#cbcbcb",bevelSize:n=.04,debug:r=!1,children:o,...s},a)=>{const[c,l]=i.useState(0),u=i.useCallback(((e=1)=>l(c+e)),[c]),h=i.useCallback(((e=1)=>l(c-e)),[c]),d=i.useMemo((()=>({incr:u,decr:h})),[u,h]);return i.useImperativeHandle(a,(()=>d),[d]),i.createElement("group",s,i.createElement(i.Suspense,{fallback:null},i.createElement(Tg,{top:!0,cacheKey:JSON.stringify({counter:c,font:e})},i.createElement(La,{bevelEnabled:!0,bevelSize:n,font:e},r?i.createElement("meshNormalMaterial",{wireframe:!0}):i.createElement("meshStandardMaterial",{color:t}),c))),o)}));var Pg=n(31803),zg=n.n(Pg);function Rg(e){return Fg(e.children,e.components)}function Fg(e,t,n){if(n=n||[],!t[0])return e(n);function r(r){return Fg(e,t.slice(1),n.concat([r]))}return"function"===typeof t[0]?t[0]({results:n,render:r}):(0,i.cloneElement)(t[0],{children:r})}Rg.propTypes={children:zg().func.isRequired,components:zg().arrayOf(zg().oneOfType([zg().element,zg().func])).isRequired};const kg=(e,t)=>{"updateRanges"in e?e.updateRanges[0]=t:e.updateRange=t},Lg=3e3,Og=3001;const Ug=new s.Matrix4,Ng=new s.Matrix4,Vg=[],Gg=new s.Mesh;class jg extends s.Group{constructor(){super(),this.color=new s.Color("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return null==(e=this.instance.current)?void 0:e.geometry}raycast(e,t){const n=this.instance.current;if(!n)return;if(!n.geometry||!n.material)return;Gg.geometry=n.geometry;const r=n.matrixWorld,i=n.userData.instances.indexOf(this.instanceKey);if(!(-1===i||i>n.count)){n.getMatrixAt(i,Ug),Ng.multiplyMatrices(r,Ug),Gg.matrixWorld=Ng,n.material instanceof s.Material?Gg.material.side=n.material.side:Gg.material.side=n.material[0].side,Gg.raycast(e,Vg);for(let e=0,n=Vg.length;e<n;e++){const n=Vg[e];n.instanceId=i,n.object=this,t.push(n)}Vg.length=0}}}const Hg=i.createContext(null),qg=new s.Matrix4,Wg=new s.Matrix4,Yg=new s.Matrix4,Xg=new s.Vector3,Zg=new s.Quaternion,Kg=new s.Vector3,Jg=i.forwardRef((({context:e,children:t,...n},o)=>{i.useMemo((()=>(0,a.e)({PositionMesh:jg})),[]);const s=i.useRef();i.useImperativeHandle(o,(()=>s.current),[]);const{subscribe:c,getParent:l}=i.useContext(e||Hg);return i.useLayoutEffect((()=>c(s)),[]),i.createElement("positionMesh",(0,r.Z)({instance:l(),instanceKey:s,ref:s},n),t)})),$g=i.forwardRef((({context:e,children:t,range:n,limit:o=1e3,frames:c=1/0,...l},u)=>{const[{localContext:h,instance:d}]=i.useState((()=>{const e=i.createContext(null);return{localContext:e,instance:i.forwardRef(((t,n)=>i.createElement(Jg,(0,r.Z)({context:e},t,{ref:n}))))}})),A=i.useRef(null);i.useImperativeHandle(u,(()=>A.current),[]);const[m,p]=i.useState([]),[[f,g]]=i.useState((()=>{const e=new Float32Array(16*o);for(let t=0;t<o;t++)Yg.identity().toArray(e,16*t);return[e,new Float32Array([...new Array(3*o)].map((()=>1)))]}));i.useEffect((()=>{A.current.instanceMatrix.needsUpdate=!0}));let y=0,v=0;const x=i.useRef([]);i.useLayoutEffect((()=>{x.current=Object.entries(A.current.geometry.attributes).filter((([e,t])=>t.isInstancedBufferAttribute))})),(0,a.F)((()=>{if(c===1/0||y<c){A.current.updateMatrix(),A.current.updateMatrixWorld(),qg.copy(A.current.matrixWorld).invert(),v=Math.min(o,void 0!==n?n:o,m.length),A.current.count=v,kg(A.current.instanceMatrix,{offset:0,count:16*v}),kg(A.current.instanceColor,{offset:0,count:3*v});for(let e=0;e<m.length;e++){const t=m[e].current;t.matrixWorld.decompose(Xg,Zg,Kg),Wg.compose(Xg,Zg,Kg).premultiply(qg),Wg.toArray(f,16*e),A.current.instanceMatrix.needsUpdate=!0,t.color.toArray(g,3*e),A.current.instanceColor.needsUpdate=!0}y++}}));const E=i.useMemo((()=>({getParent:()=>A,subscribe:e=>(p((t=>[...t,e])),()=>p((t=>t.filter((t=>t.current!==e.current)))))})),[]);return i.createElement("instancedMesh",(0,r.Z)({userData:{instances:m,limit:o,frames:c},matrixAutoUpdate:!1,ref:A,args:[null,null,0],raycast:()=>null},l),i.createElement("instancedBufferAttribute",{attach:"instanceMatrix",count:f.length/16,array:f,itemSize:16,usage:s.DynamicDrawUsage}),i.createElement("instancedBufferAttribute",{attach:"instanceColor",count:g.length/3,array:g,itemSize:3,usage:s.DynamicDrawUsage}),"function"===typeof t?i.createElement(h.Provider,{value:E},t(d)):e?i.createElement(e.Provider,{value:E},t):i.createElement(Hg.Provider,{value:E},t))})),ey=i.forwardRef((function({meshes:e,children:t,...n},o){const s=Array.isArray(e);if(!s)for(const r of Object.keys(e))e[r].isMesh||delete e[r];return i.createElement("group",{ref:o},i.createElement(Rg,{components:(s?e:Object.values(e)).map((({geometry:e,material:t})=>i.createElement($g,(0,r.Z)({key:e.uuid,geometry:e,material:t},n))))},(n=>s?t(...n):t(Object.keys(e).filter((t=>e[t].isMesh)).reduce(((e,t,r)=>({...e,[t]:n[r]})),{})))))}));function ty(){const e=i.createContext(null);return[i.forwardRef(((t,n)=>i.createElement($g,(0,r.Z)({ref:n,context:e},t)))),i.forwardRef(((t,n)=>i.createElement(Jg,(0,r.Z)({ref:n,context:e},t))))]}const ny=i.forwardRef((({name:e,defaultValue:t,normalized:n,usage:r=s.DynamicDrawUsage},o)=>{const c=i.useRef(null);i.useImperativeHandle(o,(()=>c.current),[]),i.useLayoutEffect((()=>{const n=c.current.__r3f.parent;n.geometry.attributes[e]=c.current;const r=Array.isArray(t)?t:[t],i=Array.from({length:n.userData.limit},(()=>r)).flat();return c.current.array=new Float32Array(i),c.current.itemSize=r.length,c.current.count=i.length/c.current.itemSize,()=>{delete n.geometry.attributes[e]}}),[e]);let l=0;return(0,a.F)((()=>{const t=c.current.__r3f.parent;if(t.userData.frames===1/0||l<t.userData.frames){for(let n=0;n<t.userData.instances.length;n++){const r=t.userData.instances[n].current[e];void 0!==r&&(c.current.set(Array.isArray(r)?r:"function"===typeof r.toArray?r.toArray():[r],n*c.current.itemSize),c.current.needsUpdate=!0)}l++}})),i.createElement("instancedBufferAttribute",{ref:c,usage:r,normalized:n})})),ry=i.createContext(null);function iy(){return i.useContext(ry)}const oy=i.forwardRef((({startFrame:e,endFrame:t,fps:n,frameName:o,textureDataURL:c,textureImageURL:l,loop:u,numberOfFrames:h,autoPlay:d,animationNames:A,onStart:m,onEnd:p,onLoopEnd:f,onFrame:g,play:y,pause:v,flipX:x,alphaTest:E,children:w,asSprite:C,offset:I,playBackwards:_,resetOnEnd:b,maxItems:B,instanceItems:M,spriteDataset:S,...D},T)=>{var Q;const P=i.useRef(),z=i.useRef(null),R=i.useRef(),F=i.useRef(),k=i.useRef(window.performance.now()),L=i.useRef(e||0),O=i.useRef(o||""),U=1e3/(n||30),[N,V]=i.useState(new s.Texture),G=i.useRef(0),[j,H]=i.useState([1,1,1]),q=x?-1:1,[W,Y]=i.useState(null===C||void 0===C||C),X=i.useRef(v),Z=i.useRef(I),K=i.useRef(!1),J=i.useRef([]),{spriteObj:$,loadJsonAndTexture:ee}=ZA(null,null,A,h);function te(){}const ne=i.useMemo((()=>({current:Z.current,offset:Z.current,imageUrl:l,reset:te,hasEnded:!1,ref:T})),[l,S]);i.useImperativeHandle(T,(()=>P.current),[]),i.useLayoutEffect((()=>{Z.current=I}),[I]);const re=(e,t)=>{const n=t/e;return F.current&&F.current.scale.set(1,n,1),[1,n,1]};i.useEffect((()=>{var e;S?ie(null==S||null==(e=S.spriteTexture)?void 0:e.clone(),S.spriteData):ee(l,c)}),[S]),i.useEffect((()=>{var e;$&&ie(null==$||null==(e=$.spriteTexture)?void 0:e.clone(),null==$?void 0:$.spriteData)}),[$]),i.useEffect((()=>{Y(null===C||void 0===C||C)}),[C]),i.useEffect((()=>{ne.hasEnded=!1,z.current&&!0===_?L.current=z.current.frames.length-1:L.current=0}),[_]),i.useLayoutEffect((()=>{oe()}),[N,x]),i.useEffect((()=>{d&&(X.current=!1)}),[d]),i.useLayoutEffect((()=>{if(O.current!==o&&o&&(L.current=0,O.current=o,ne.hasEnded=!1,z.current)){const{w:e,h:t}=ae(z.current.frames).sourceSize,n=re(e,t);H(n)}}),[o]);const ie=(e,t=null)=>{if(null===t){if(h){const n=e.image.width,r=e.image.height;G.current=h,_&&(L.current=h-1),z.current={frames:[],meta:{version:"1.0",size:{w:n,h:r},scale:"1"}},z.current.frames=t}}else{z.current=t,G.current=z.current.frames.length,_&&(L.current=G.current-1);const{w:n,h:r}=ae(z.current.frames).sourceSize,i=re(n,r);H(i),R.current&&(R.current.map=e)}if(M)for(var n=0;n<M.length;n++){const e=Object.keys(z.current.frames),t=e[Math.floor(Math.random()*e.length)];J.current.push({key:n,frames:z.current.frames,selectedFrame:t,offset:{x:0,y:0}})}V(e)},oe=()=>{if(!z.current)return;const{meta:{size:e},frames:t}=z.current,{w:n,h:r}=Array.isArray(t)?t[0].sourceSize:o&&t[o]?t[o][0].sourceSize:{w:0,h:0};R.current.map.wrapS=R.current.map.wrapT=s.RepeatWrapping,R.current.map.center.set(0,0),R.current.map.repeat.set(1*q/(e.w/n),1/(e.h/r));const i=1/((e.h-1)/r);R.current.map.offset.x=0,R.current.map.offset.y=1-i,m&&m({currentFrameName:o,currentFrame:L.current})},se=(e,t,n,r)=>{var i=void 0===I?ne.current:I;const o=L.current;let s=0,a=0;re(e,t);const c=Math.round((n.w-1)/e),l=Math.round((n.h-1)/t);if(!r[o])return;const{frame:{x:u,y:h},sourceSize:{w:d,h:A}}=r[o],m=1/c,p=1/l;if(s=q>0?m*(u/d):m*(u/d)-R.current.map.repeat.x,a=Math.abs(1-p)-p*(h/A),R.current.map.offset.x=s,R.current.map.offset.y=a,void 0!==i&&null!==i){let e=Math.floor(i*r.length);e=Math.max(0,Math.min(e,r.length-1)),isNaN(e)&&(e=0),L.current=e}else _?L.current-=1:L.current+=1};(0,a.F)(((n,r)=>{var i,s;null!=(i=z.current)&&i.frames&&null!=(s=R.current)&&s.map&&(X.current||ne.hasEnded||!d&&!y||((()=>{const n=window.performance.now(),r=n-k.current,{meta:{size:i},frames:s}=z.current,{w:a,h:c}=ae(s).sourceSize,l=Array.isArray(s)?s:o?s[o]:[],h=t||l.length-1;var d=void 0===I?ne.current:I,A=_?L.current<0:L.current>h,g=_?L.current===h:0===L.current,y=_?L.current<0:L.current>=h;if(A){if(L.current=u&&null!==e&&void 0!==e?e:0,_&&(L.current=h),u?null==f||f({currentFrameName:o,currentFrame:L.current}):(null==p||p({currentFrameName:o,currentFrame:L.current}),ne.hasEnded=!b,b&&(X.current=!0)),!u)return}else g&&(null==m||m({currentFrameName:o,currentFrame:L.current}));void 0!==d&&y?!1===K.current&&(null==p||p({currentFrameName:o,currentFrame:L.current}),K.current=!0):K.current=!1,r<=U||(k.current=n-r%U,se(a,c,i,l))})(),g&&g({currentFrameName:O.current,currentFrame:L.current})))}));const ae=e=>{if(Array.isArray(e))return e[0];if("object"===typeof e&&null!==e){const t=Object.keys(e);return o?e[o][0]:e[t[0]][0]}return{w:0,h:0}};return i.createElement("group",(0,r.Z)({},D,{ref:P,scale:function(e,t){let n=[];"number"===typeof t?n=[t,t,t]:Array.isArray(t)?n=t:t instanceof s.Vector3&&(n=[t.x,t.y,t.z]);const r=e.map(((e,t)=>e*n[t]));return r}(null!==j&&void 0!==j?j:[1,1,1],null!==(Q=D.scale)&&void 0!==Q?Q:1)}),i.createElement(ry.Provider,{value:ne},i.createElement(i.Suspense,{fallback:null},W&&i.createElement("sprite",{ref:F,scale:1},i.createElement("spriteMaterial",{premultipliedAlpha:!1,toneMapped:!1,ref:R,map:N,transparent:!0,alphaTest:null!==E&&void 0!==E?E:0})),!W&&i.createElement($g,{limit:null!==B&&void 0!==B?B:1},i.createElement("planeGeometry",{args:[1,1]}),i.createElement("meshBasicMaterial",{premultipliedAlpha:!1,toneMapped:!1,side:s.DoubleSide,ref:R,map:N,transparent:!0,alphaTest:null!==E&&void 0!==E?E:0}),(null!==M&&void 0!==M?M:[0]).map(((e,t)=>i.createElement(Jg,{key:t,ref:1===(null==M?void 0:M.length)?F:null,position:e,scale:1}))))),w))}));var sy=Object.defineProperty,ay=(e,t,n)=>(((e,t,n)=>{t in e?sy(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);const cy=1024,ly=(e,t,n,r,i,o)=>{const s=e.image,{data:a}=s,c=4096*o;a[4*t+c+0]=n,a[4*t+c+1]=r,a[4*t+c+2]=i,a[4*t+c+3]=1};class uy{constructor(e,t=1){ay(this,"curveArray"),ay(this,"curveLengthArray"),ay(this,"object3D"),ay(this,"splineTexure"),ay(this,"uniforms");const n=e.clone(),r=((e=1)=>{const t=new Float32Array(4096*e*4),n=new s.DataTexture(t,cy,4*e,s.RGBAFormat,s.FloatType);return n.wrapS=s.RepeatWrapping,n.wrapT=s.RepeatWrapping,n.magFilter=s.NearestFilter,n.needsUpdate=!0,n})(t),i={spineTexture:{value:r},pathOffset:{type:"f",value:0},pathSegment:{type:"f",value:1},spineOffset:{type:"f",value:161},spineLength:{type:"f",value:400},flow:{type:"i",value:1}};n.traverse((e=>{(e instanceof s.Mesh||e instanceof s.InstancedMesh)&&(e.material=e.material.clone(),function(e,t,n=1){e.__ok||(e.__ok=!0,e.onBeforeCompile=e=>{if(e.__modified)return;e.__modified=!0,Object.assign(e.uniforms,t);const r=`\n\t\tuniform sampler2D spineTexture;\n\t\tuniform float pathOffset;\n\t\tuniform float pathSegment;\n\t\tuniform float spineOffset;\n\t\tuniform float spineLength;\n\t\tuniform int flow;\n\n\t\tfloat textureLayers = ${4*n}.;\n\t\tfloat textureStacks = 1.;\n\n\t\t${e.vertexShader}\n\t\t`.replace("#include <beginnormal_vertex>","").replace("#include <defaultnormal_vertex>","").replace("#include <begin_vertex>","").replace(/void\s*main\s*\(\)\s*\{/,"\n        void main() {\n        #include <beginnormal_vertex>\n\n        vec4 worldPos = modelMatrix * vec4(position, 1.);\n\n        bool bend = flow > 0;\n        float xWeight = bend ? 0. : 1.;\n\n        #ifdef USE_INSTANCING\n        float pathOffsetFromInstanceMatrix = instanceMatrix[3][2];\n        float spineLengthFromInstanceMatrix = instanceMatrix[3][0];\n        float spinePortion = bend ? (worldPos.x + spineOffset) / spineLengthFromInstanceMatrix : 0.;\n        float mt = (spinePortion * pathSegment + pathOffset + pathOffsetFromInstanceMatrix)*textureStacks;\n        #else\n        float spinePortion = bend ? (worldPos.x + spineOffset) / spineLength : 0.;\n        float mt = (spinePortion * pathSegment + pathOffset)*textureStacks;\n        #endif\n\n        mt = mod(mt, textureStacks);\n        float rowOffset = floor(mt);\n\n        #ifdef USE_INSTANCING\n        rowOffset += instanceMatrix[3][1] * 4.;\n        #endif\n\n        vec3 spinePos = texture2D(spineTexture, vec2(mt, (0. + rowOffset + 0.5) / textureLayers)).xyz;\n        vec3 a =        texture2D(spineTexture, vec2(mt, (1. + rowOffset + 0.5) / textureLayers)).xyz;\n        vec3 b =        texture2D(spineTexture, vec2(mt, (2. + rowOffset + 0.5) / textureLayers)).xyz;\n        vec3 c =        texture2D(spineTexture, vec2(mt, (3. + rowOffset + 0.5) / textureLayers)).xyz;\n        mat3 basis = mat3(a, b, c);\n\n        vec3 transformed = basis\n          * vec3(worldPos.x * xWeight, worldPos.y * 1., worldPos.z * 1.)\n          + spinePos;\n\n        vec3 transformedNormal = normalMatrix * (basis * objectNormal);\n\t\t\t").replace("#include <project_vertex>","vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\t\t\t\tgl_Position = projectionMatrix * mvPosition;");e.vertexShader=r})}(e.material,i,t))})),this.curveArray=new Array(t),this.curveLengthArray=new Array(t),this.object3D=n,this.splineTexure=r,this.uniforms=i}updateCurve(e,t){if(e>=this.curveArray.length)throw Error("Index out of range for Flow");const n=t.getLength();this.uniforms.spineLength.value=n,this.curveLengthArray[e]=n,this.curveArray[e]=t,((e,t,n=0)=>{const r=Math.floor(1024);t.arcLengthDivisions=r/2,t.updateArcLengths();const i=t.getSpacedPoints(r),o=t.computeFrenetFrames(r,!0);for(let s=0;s<r;s++){const t=Math.floor(s/cy),r=s%cy;let a=i[s];ly(e,r,a.x,a.y,a.z,0+t+4*n),a=o.tangents[s],ly(e,r,a.x,a.y,a.z,1+t+4*n),a=o.normals[s],ly(e,r,a.x,a.y,a.z,2+t+4*n),a=o.binormals[s],ly(e,r,a.x,a.y,a.z,3+t+4*n)}e.needsUpdate=!0})(this.splineTexure,t,e)}moveAlongCurve(e){this.uniforms.pathOffset.value+=e}}new s.Matrix4;const hy=i.forwardRef((({children:e,curve:t},n)=>{const[r]=i.useState((()=>new s.Scene)),[o,c]=i.useState(),l=i.useRef();return i.useEffect((()=>{l.current=new uy(r.children[0]),c(l.current.object3D)}),[e]),i.useEffect((()=>{var e;t&&(null==(e=l.current)||e.updateCurve(0,t))}),[t]),i.useImperativeHandle(n,(()=>({moveAlongCurve:e=>{var t;null==(t=l.current)||t.moveAlongCurve(e)}}))),i.createElement(i.Fragment,null,(0,a.h)(e,r),o&&i.createElement("primitive",{object:o}))}));class dy extends s.MeshPhysicalMaterial{constructor(e={}){super(e),this.setValues(e),this._time={value:0},this._distort={value:.4},this._radius={value:1}}onBeforeCompile(e){e.uniforms.time=this._time,e.uniforms.radius=this._radius,e.uniforms.distort=this._distort,e.vertexShader=`\n      uniform float time;\n      uniform float radius;\n      uniform float distort;\n      #define GLSLIFY 1\nvec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 permute(vec4 x){return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}float snoise(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}\n      ${e.vertexShader}\n    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","\n        float updateTime = time / 50.0;\n        float noise = snoise(vec3(position / 2.0 + updateTime * 5.0));\n        vec3 transformed = vec3(position * (noise * pow(distort, 2.0) + radius));\n        ")}get time(){return this._time.value}set time(e){this._time.value=e}get distort(){return this._distort.value}set distort(e){this._distort.value=e}get radius(){return this._radius.value}set radius(e){this._radius.value=e}}const Ay=i.forwardRef((({speed:e=1,...t},n)=>{const[o]=i.useState((()=>new dy));return(0,a.F)((t=>o&&(o.time=t.clock.getElapsedTime()*e))),i.createElement("primitive",(0,r.Z)({object:o,ref:n,attach:"material"},t))}));class my extends s.MeshStandardMaterial{constructor(e={}){super(e),this.setValues(e),this._time={value:0},this._factor={value:1}}onBeforeCompile(e){e.uniforms.time=this._time,e.uniforms.factor=this._factor,e.vertexShader=`\n      uniform float time;\n      uniform float factor;\n      ${e.vertexShader}\n    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","float theta = sin( time + position.y ) / 2.0 * factor;\n        float c = cos( theta );\n        float s = sin( theta );\n        mat3 m = mat3( c, 0, s, 0, 1, 0, -s, 0, c );\n        vec3 transformed = vec3( position ) * m;\n        vNormal = vNormal * m;")}get time(){return this._time.value}set time(e){this._time.value=e}get factor(){return this._factor.value}set factor(e){this._factor.value=e}}const py=i.forwardRef((({speed:e=1,...t},n)=>{const[o]=i.useState((()=>new my));return(0,a.F)((t=>o&&(o.time=t.clock.getElapsedTime()*e))),i.createElement("primitive",(0,r.Z)({object:o,ref:n,attach:"material"},t))}));class fy extends s.ShaderMaterial{constructor(e=new s.Vector2){super({uniforms:{inputBuffer:new s.Uniform(null),depthBuffer:new s.Uniform(null),resolution:new s.Uniform(new s.Vector2),texelSize:new s.Uniform(new s.Vector2),halfTexelSize:new s.Uniform(new s.Vector2),kernel:new s.Uniform(0),scale:new s.Uniform(1),cameraNear:new s.Uniform(0),cameraFar:new s.Uniform(1),minDepthThreshold:new s.Uniform(0),maxDepthThreshold:new s.Uniform(1),depthScale:new s.Uniform(0),depthToBlurRatioBias:new s.Uniform(.25)},fragmentShader:`#include <common>\n        #include <dithering_pars_fragment>      \n        uniform sampler2D inputBuffer;\n        uniform sampler2D depthBuffer;\n        uniform float cameraNear;\n        uniform float cameraFar;\n        uniform float minDepthThreshold;\n        uniform float maxDepthThreshold;\n        uniform float depthScale;\n        uniform float depthToBlurRatioBias;\n        varying vec2 vUv;\n        varying vec2 vUv0;\n        varying vec2 vUv1;\n        varying vec2 vUv2;\n        varying vec2 vUv3;\n\n        void main() {\n          float depthFactor = 0.0;\n          \n          #ifdef USE_DEPTH\n            vec4 depth = texture2D(depthBuffer, vUv);\n            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));\n            depthFactor *= depthScale;\n            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));\n          #endif\n          \n          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));\n          gl_FragColor = sum * 0.25 ;\n\n          #include <dithering_fragment>\n          #include <tonemapping_fragment>\n          #include <${dc>=154?"colorspace_fragment":"encodings_fragment"}>\n        }`,vertexShader:"uniform vec2 texelSize;\n        uniform vec2 halfTexelSize;\n        uniform float kernel;\n        uniform float scale;\n        varying vec2 vUv;\n        varying vec2 vUv0;\n        varying vec2 vUv1;\n        varying vec2 vUv2;\n        varying vec2 vUv3;\n\n        void main() {\n          vec2 uv = position.xy * 0.5 + 0.5;\n          vUv = uv;\n\n          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;\n          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);\n          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);\n          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);\n          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);\n\n          gl_Position = vec4(position.xy, 1.0, 1.0);\n        }",blending:s.NoBlending,depthWrite:!1,depthTest:!1}),this.toneMapped=!1,this.setTexelSize(e.x,e.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setResolution(e){this.uniforms.resolution.value.copy(e)}}class gy{constructor({gl:e,resolution:t,width:n=500,height:r=500,minDepthThreshold:i=0,maxDepthThreshold:o=1,depthScale:a=0,depthToBlurRatioBias:c=.25}){this.renderToScreen=!1,this.renderTargetA=new s.WebGLRenderTarget(t,t,{minFilter:s.LinearFilter,magFilter:s.LinearFilter,stencilBuffer:!1,depthBuffer:!1,type:s.HalfFloatType}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new fy,this.convolutionMaterial.setTexelSize(1/n,1/r),this.convolutionMaterial.setResolution(new s.Vector2(n,r)),this.scene=new s.Scene,this.camera=new s.Camera,this.convolutionMaterial.uniforms.minDepthThreshold.value=i,this.convolutionMaterial.uniforms.maxDepthThreshold.value=o,this.convolutionMaterial.uniforms.depthScale.value=a,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=c,this.convolutionMaterial.defines.USE_DEPTH=a>0;const l=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),u=new Float32Array([0,0,2,0,0,2]),h=new s.BufferGeometry;h.setAttribute("position",new s.BufferAttribute(l,3)),h.setAttribute("uv",new s.BufferAttribute(u,2)),this.screen=new s.Mesh(h,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(e,t,n){const r=this.scene,i=this.camera,o=this.renderTargetA,s=this.renderTargetB;let a=this.convolutionMaterial,c=a.uniforms;c.depthBuffer.value=t.depthTexture;const l=a.kernel;let u,h,d,A=t;for(h=0,d=l.length-1;h<d;++h)u=0===(1&h)?o:s,c.kernel.value=l[h],c.inputBuffer.value=A.texture,e.setRenderTarget(u),e.render(r,i),A=u;c.kernel.value=l[h],c.inputBuffer.value=A.texture,e.setRenderTarget(this.renderToScreen?null:n),e.render(r,i)}}class yy extends s.MeshStandardMaterial{constructor(e={}){super(e),this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this.setValues(e)}onBeforeCompile(e){var t;null!=(t=e.defines)&&t.USE_UV||(e.defines.USE_UV=""),e.uniforms.hasBlur=this._hasBlur,e.uniforms.tDiffuse=this._tDiffuse,e.uniforms.tDepth=this._tDepth,e.uniforms.distortionMap=this._distortionMap,e.uniforms.tDiffuseBlur=this._tDiffuseBlur,e.uniforms.textureMatrix=this._textureMatrix,e.uniforms.mirror=this._mirror,e.uniforms.mixBlur=this._mixBlur,e.uniforms.mixStrength=this._blurStrength,e.uniforms.minDepthThreshold=this._minDepthThreshold,e.uniforms.maxDepthThreshold=this._maxDepthThreshold,e.uniforms.depthScale=this._depthScale,e.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,e.uniforms.distortion=this._distortion,e.uniforms.mixContrast=this._mixContrast,e.vertexShader=`\n        uniform mat4 textureMatrix;\n        varying vec4 my_vUv;\n      ${e.vertexShader}`,e.vertexShader=e.vertexShader.replace("#include <project_vertex>","#include <project_vertex>\n        my_vUv = textureMatrix * vec4( position, 1.0 );\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );"),e.fragmentShader=`\n        uniform sampler2D tDiffuse;\n        uniform sampler2D tDiffuseBlur;\n        uniform sampler2D tDepth;\n        uniform sampler2D distortionMap;\n        uniform float distortion;\n        uniform float cameraNear;\n\t\t\t  uniform float cameraFar;\n        uniform bool hasBlur;\n        uniform float mixBlur;\n        uniform float mirror;\n        uniform float mixStrength;\n        uniform float minDepthThreshold;\n        uniform float maxDepthThreshold;\n        uniform float mixContrast;\n        uniform float depthScale;\n        uniform float depthToBlurRatioBias;\n        varying vec4 my_vUv;\n        ${e.fragmentShader}`,e.fragmentShader=e.fragmentShader.replace("#include <emissivemap_fragment>","#include <emissivemap_fragment>\n\n      float distortionFactor = 0.0;\n      #ifdef USE_DISTORTION\n        distortionFactor = texture2D(distortionMap, vUv).r * distortion;\n      #endif\n\n      vec4 new_vUv = my_vUv;\n      new_vUv.x += distortionFactor;\n      new_vUv.y += distortionFactor;\n\n      vec4 base = texture2DProj(tDiffuse, new_vUv);\n      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);\n\n      vec4 merge = base;\n\n      #ifdef USE_NORMALMAP\n        vec2 normal_uv = vec2(0.0);\n        vec4 normalColor = texture2D(normalMap, vUv * normalScale);\n        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\n        vec3 coord = new_vUv.xyz / new_vUv.w;\n        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;\n        vec4 base_normal = texture2D(tDiffuse, normal_uv);\n        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);\n        merge = base_normal;\n        blur = blur_normal;\n      #endif\n\n      float depthFactor = 0.0001;\n      float blurFactor = 0.0;\n\n      #ifdef USE_DEPTH\n        vec4 depth = texture2DProj(tDepth, new_vUv);\n        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));\n        depthFactor *= depthScale;\n        depthFactor = max(0.0001, min(1.0, depthFactor));\n\n        #ifdef USE_BLUR\n          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);\n          merge = merge * min(1.0, depthFactor + 0.5);\n        #else\n          merge = merge * depthFactor;\n        #endif\n\n      #endif\n\n      float reflectorRoughnessFactor = roughness;\n      #ifdef USE_ROUGHNESSMAP\n        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );\n        reflectorRoughnessFactor *= reflectorTexelRoughness.g;\n      #endif\n\n      #ifdef USE_BLUR\n        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);\n        merge = mix(merge, blur, blurFactor);\n      #endif\n\n      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);\n      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;\n      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;\n      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;\n\n      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);\n      ")}get tDiffuse(){return this._tDiffuse.value}set tDiffuse(e){this._tDiffuse.value=e}get tDepth(){return this._tDepth.value}set tDepth(e){this._tDepth.value=e}get distortionMap(){return this._distortionMap.value}set distortionMap(e){this._distortionMap.value=e}get tDiffuseBlur(){return this._tDiffuseBlur.value}set tDiffuseBlur(e){this._tDiffuseBlur.value=e}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(e){this._textureMatrix.value=e}get hasBlur(){return this._hasBlur.value}set hasBlur(e){this._hasBlur.value=e}get mirror(){return this._mirror.value}set mirror(e){this._mirror.value=e}get mixBlur(){return this._mixBlur.value}set mixBlur(e){this._mixBlur.value=e}get mixStrength(){return this._blurStrength.value}set mixStrength(e){this._blurStrength.value=e}get minDepthThreshold(){return this._minDepthThreshold.value}set minDepthThreshold(e){this._minDepthThreshold.value=e}get maxDepthThreshold(){return this._maxDepthThreshold.value}set maxDepthThreshold(e){this._maxDepthThreshold.value=e}get depthScale(){return this._depthScale.value}set depthScale(e){this._depthScale.value=e}get depthToBlurRatioBias(){return this._depthToBlurRatioBias.value}set depthToBlurRatioBias(e){this._depthToBlurRatioBias.value=e}get distortion(){return this._distortion.value}set distortion(e){this._distortion.value=e}get mixContrast(){return this._mixContrast.value}set mixContrast(e){this._mixContrast.value=e}}const vy=i.forwardRef((({mixBlur:e=0,mixStrength:t=1,resolution:n=256,blur:o=[0,0],minDepthThreshold:c=.9,maxDepthThreshold:l=1,depthScale:u=0,depthToBlurRatioBias:h=.25,mirror:d=0,distortion:A=1,mixContrast:m=1,distortionMap:p,reflectorOffset:f=0,...g},y)=>{(0,a.e)({MeshReflectorMaterialImpl:yy});const v=(0,a.D)((({gl:e})=>e)),x=(0,a.D)((({camera:e})=>e)),E=(0,a.D)((({scene:e})=>e)),w=(o=Array.isArray(o)?o:[o,o])[0]+o[1]>0,C=i.useRef(null);i.useImperativeHandle(y,(()=>C.current),[]);const[I]=i.useState((()=>new s.Plane)),[_]=i.useState((()=>new s.Vector3)),[b]=i.useState((()=>new s.Vector3)),[B]=i.useState((()=>new s.Vector3)),[M]=i.useState((()=>new s.Matrix4)),[S]=i.useState((()=>new s.Vector3(0,0,-1))),[D]=i.useState((()=>new s.Vector4)),[T]=i.useState((()=>new s.Vector3)),[Q]=i.useState((()=>new s.Vector3)),[P]=i.useState((()=>new s.Vector4)),[z]=i.useState((()=>new s.Matrix4)),[R]=i.useState((()=>new s.PerspectiveCamera)),F=i.useCallback((()=>{var e;const t=C.current.parent||(null==(e=C.current)?void 0:e.__r3f.parent);if(!t)return;if(b.setFromMatrixPosition(t.matrixWorld),B.setFromMatrixPosition(x.matrixWorld),M.extractRotation(t.matrixWorld),_.set(0,0,1),_.applyMatrix4(M),b.addScaledVector(_,f),T.subVectors(b,B),T.dot(_)>0)return;T.reflect(_).negate(),T.add(b),M.extractRotation(x.matrixWorld),S.set(0,0,-1),S.applyMatrix4(M),S.add(B),Q.subVectors(b,S),Q.reflect(_).negate(),Q.add(b),R.position.copy(T),R.up.set(0,1,0),R.up.applyMatrix4(M),R.up.reflect(_),R.lookAt(Q),R.far=x.far,R.updateMatrixWorld(),R.projectionMatrix.copy(x.projectionMatrix),z.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),z.multiply(R.projectionMatrix),z.multiply(R.matrixWorldInverse),z.multiply(t.matrixWorld),I.setFromNormalAndCoplanarPoint(_,b),I.applyMatrix4(R.matrixWorldInverse),D.set(I.normal.x,I.normal.y,I.normal.z,I.constant);const n=R.projectionMatrix;P.x=(Math.sign(D.x)+n.elements[8])/n.elements[0],P.y=(Math.sign(D.y)+n.elements[9])/n.elements[5],P.z=-1,P.w=(1+n.elements[10])/n.elements[14],D.multiplyScalar(2/D.dot(P)),n.elements[2]=D.x,n.elements[6]=D.y,n.elements[10]=D.z+1,n.elements[14]=D.w}),[x,f]),[k,L,O,U]=i.useMemo((()=>{const r={minFilter:s.LinearFilter,magFilter:s.LinearFilter,type:s.HalfFloatType},i=new s.WebGLRenderTarget(n,n,r);i.depthBuffer=!0,i.depthTexture=new s.DepthTexture(n,n),i.depthTexture.format=s.DepthFormat,i.depthTexture.type=s.UnsignedShortType;const a=new s.WebGLRenderTarget(n,n,r);return[i,a,new gy({gl:v,resolution:n,width:o[0],height:o[1],minDepthThreshold:c,maxDepthThreshold:l,depthScale:u,depthToBlurRatioBias:h}),{mirror:d,textureMatrix:z,mixBlur:e,tDiffuse:i.texture,tDepth:i.depthTexture,tDiffuseBlur:a.texture,hasBlur:w,mixStrength:t,minDepthThreshold:c,maxDepthThreshold:l,depthScale:u,depthToBlurRatioBias:h,distortion:A,distortionMap:p,mixContrast:m,"defines-USE_BLUR":w?"":void 0,"defines-USE_DEPTH":u>0?"":void 0,"defines-USE_DISTORTION":p?"":void 0}]}),[v,o,z,n,d,w,e,t,c,l,u,h,A,p,m]);return(0,a.F)((()=>{var e;const t=C.current.parent||(null==(e=C.current)?void 0:e.__r3f.parent);if(!t)return;t.visible=!1;const n=v.xr.enabled,r=v.shadowMap.autoUpdate;F(),v.xr.enabled=!1,v.shadowMap.autoUpdate=!1,v.setRenderTarget(k),v.state.buffers.depth.setMask(!0),v.autoClear||v.clear(),v.render(E,R),w&&O.render(v,k,L),v.xr.enabled=n,v.shadowMap.autoUpdate=r,t.visible=!0,v.setRenderTarget(null)})),i.createElement("meshReflectorMaterialImpl",(0,r.Z)({attach:"material",key:"key"+U["defines-USE_BLUR"]+U["defines-USE_DEPTH"]+U["defines-USE_DISTORTION"],ref:C},U,g))}));function xy(e){switch(e){case 1:return s.RedIntegerFormat;case 2:return s.RGIntegerFormat;case 3:case 4:return s.RGBAIntegerFormat}}class Ey extends s.DataTexture{constructor(){super(),this.minFilter=s.NearestFilter,this.magFilter=s.NearestFilter,this.generateMipmaps=!1,this.overrideItemSize=null,this._forcedType=null}updateFrom(e){const t=this.overrideItemSize,n=e.itemSize,r=e.count;if(null!==t){if(n*r%t!==0)throw new Error("VertexAttributeTexture: overrideItemSize must divide evenly into buffer length.");e.itemSize=t,e.count=r*n/t}const i=e.itemSize,o=e.count,a=e.normalized,c=e.array.constructor,l=c.BYTES_PER_ELEMENT;let u,h,d,A,m=this._forcedType,p=i;if(null===m)switch(c){case Float32Array:m=s.FloatType;break;case Uint8Array:case Uint16Array:case Uint32Array:m=s.UnsignedIntType;break;case Int8Array:case Int16Array:case Int32Array:m=s.IntType}let f=function(e){switch(e){case 1:return"R";case 2:return"RG";case 3:case 4:return"RGBA"}throw new Error}(i);switch(m){case s.FloatType:d=1,h=function(e){switch(e){case 1:return s.RedFormat;case 2:return s.RGFormat;case 3:case 4:return s.RGBAFormat}}(i),a&&1===l?(A=c,f+="8",c===Uint8Array?u=s.UnsignedByteType:(u=s.ByteType,f+="_SNORM")):(A=Float32Array,f+="32F",u=s.FloatType);break;case s.IntType:f+=8*l+"I",d=a?Math.pow(2,8*c.BYTES_PER_ELEMENT-1):1,h=xy(i),1===l?(A=Int8Array,u=s.ByteType):2===l?(A=Int16Array,u=s.ShortType):(A=Int32Array,u=s.IntType);break;case s.UnsignedIntType:f+=8*l+"UI",d=a?Math.pow(2,8*c.BYTES_PER_ELEMENT-1):1,h=xy(i),1===l?(A=Uint8Array,u=s.UnsignedByteType):2===l?(A=Uint16Array,u=s.UnsignedShortType):(A=Uint32Array,u=s.UnsignedIntType)}3!==p||h!==s.RGBAFormat&&h!==s.RGBAIntegerFormat||(p=4);const g=Math.ceil(Math.sqrt(o))||1,y=new A(p*g*g),v=e.normalized;e.normalized=!1;for(let s=0;s<o;s++){const t=p*s;y[t]=e.getX(s)/d,i>=2&&(y[t+1]=e.getY(s)/d),i>=3&&(y[t+2]=e.getZ(s)/d,4===p&&(y[t+3]=1)),i>=4&&(y[t+3]=e.getW(s)/d)}e.normalized=v,this.internalFormat=f,this.format=h,this.type=u,this.image.width=g,this.image.height=g,this.image.data=y,this.needsUpdate=!0,this.dispose(),e.itemSize=n,e.count=r}}class wy extends Ey{constructor(){super(),this._forcedType=s.UnsignedIntType}}class Cy extends Ey{constructor(){super(),this._forcedType=s.FloatType}}class Iy{constructor(){this.index=new wy,this.position=new Cy,this.bvhBounds=new s.DataTexture,this.bvhContents=new s.DataTexture,this._cachedIndexAttr=null,this.index.overrideItemSize=3}updateFrom(e){const{geometry:t}=e;if(function(e,t,n){const r=e._roots;if(1!==r.length)throw new Error("MeshBVHUniformStruct: Multi-root BVHs not supported.");const i=r[0],o=new Uint16Array(i),a=new Uint32Array(i),c=new Float32Array(i),l=i.byteLength/Mm,u=2*Math.ceil(Math.sqrt(l/2)),h=new Float32Array(4*u*u),d=Math.ceil(Math.sqrt(l)),A=new Uint32Array(2*d*d);for(let s=0;s<l;s++){const e=s*Mm/4,t=2*e,n=e;for(let r=0;r<3;r++)h[8*s+0+r]=c[n+0+r],h[8*s+4+r]=c[n+3+r];if(Jm(t,o)){const n=ep(t,o),r=$m(e,a),i=4294901760|n;A[2*s+0]=i,A[2*s+1]=r}else{const t=4*np(e,a)/Mm,n=rp(e,a);A[2*s+0]=n,A[2*s+1]=t}}t.image.data=h,t.image.width=u,t.image.height=u,t.format=s.RGBAFormat,t.type=s.FloatType,t.internalFormat="RGBA32F",t.minFilter=s.NearestFilter,t.magFilter=s.NearestFilter,t.generateMipmaps=!1,t.needsUpdate=!0,t.dispose(),n.image.data=A,n.image.width=d,n.image.height=d,n.format=s.RGIntegerFormat,n.type=s.UnsignedIntType,n.internalFormat="RG32UI",n.minFilter=s.NearestFilter,n.magFilter=s.NearestFilter,n.generateMipmaps=!1,n.needsUpdate=!0,n.dispose()}(e,this.bvhBounds,this.bvhContents),this.position.updateFrom(t.attributes.position),e.indirect){const n=e._indirectBuffer;if(null===this._cachedIndexAttr||this._cachedIndexAttr.count!==n.length)if(t.index)this._cachedIndexAttr=t.index.clone();else{const e=Rm(Pm(t));this._cachedIndexAttr=new s.BufferAttribute(e,1,!1)}!function(e,t,n){const r=n.array,i=e.index?e.index.array:null;for(let o=0,s=t.length;o<s;o++){const e=3*o,n=3*t[o];for(let t=0;t<3;t++)r[e+t]=i?i[n+t]:n+t}}(t,n,this._cachedIndexAttr),this.index.updateFrom(this._cachedIndexAttr)}else this.index.updateFrom(t.index)}dispose(){const{index:e,position:t,bvhBounds:n,bvhContents:r}=this;e&&e.dispose(),t&&t.dispose(),n&&n.dispose(),r&&r.dispose()}}const _y=cc({envMap:null,bounces:3,ior:2.4,correctMips:!0,aberrationStrength:.01,fresnel:0,bvh:new Iy,color:new s.Color("white"),opacity:1,resolution:new s.Vector2,viewMatrixInverse:new s.Matrix4,projectionMatrixInverse:new s.Matrix4},"\n  uniform mat4 viewMatrixInverse;\n\n  varying vec3 vWorldPosition;\n  varying vec3 vNormal;\n  varying mat4 vModelMatrixInverse;\n\n  #include <color_pars_vertex>\n\n  void main() {\n    #include <color_vertex>\n\n    vec4 transformedNormal = vec4(normal, 0.0);\n    vec4 transformedPosition = vec4(position, 1.0);\n    #ifdef USE_INSTANCING\n      transformedNormal = instanceMatrix * transformedNormal;\n      transformedPosition = instanceMatrix * transformedPosition;\n    #endif\n\n    #ifdef USE_INSTANCING\n      vModelMatrixInverse = inverse(modelMatrix * instanceMatrix);\n    #else\n      vModelMatrixInverse = inverse(modelMatrix);\n    #endif\n\n    vWorldPosition = (modelMatrix * transformedPosition).xyz;\n    vNormal = normalize((viewMatrixInverse * vec4(normalMatrix * transformedNormal.xyz, 0.0)).xyz);\n    gl_Position = projectionMatrix * viewMatrix * modelMatrix * transformedPosition;\n  }",`\n  #define ENVMAP_TYPE_CUBE_UV\n  precision highp isampler2D;\n  precision highp usampler2D;\n  varying vec3 vWorldPosition;\n  varying vec3 vNormal;\n  varying mat4 vModelMatrixInverse;\n\n  #include <color_pars_fragment>\n\n  #ifdef ENVMAP_TYPE_CUBEM\n    uniform samplerCube envMap;\n  #else\n    uniform sampler2D envMap;\n  #endif\n\n  uniform float bounces;\n  \nstruct BVH {\n\n\tusampler2D index;\n\tsampler2D position;\n\n\tsampler2D bvhBounds;\n\tusampler2D bvhContents;\n\n};\n\n  \n\t\n\n// A stack of uint32 indices can can store the indices for\n// a perfectly balanced tree with a depth up to 31. Lower stack\n// depth gets higher performance.\n//\n// However not all trees are balanced. Best value to set this to\n// is the trees max depth.\n#ifndef BVH_STACK_DEPTH\n#define BVH_STACK_DEPTH 60\n#endif\n\n#ifndef INFINITY\n#define INFINITY 1e20\n#endif\n\n// Utilities\nuvec4 uTexelFetch1D( usampler2D tex, uint index ) {\n\n\tuint width = uint( textureSize( tex, 0 ).x );\n\tuvec2 uv;\n\tuv.x = index % width;\n\tuv.y = index / width;\n\n\treturn texelFetch( tex, ivec2( uv ), 0 );\n\n}\n\nivec4 iTexelFetch1D( isampler2D tex, uint index ) {\n\n\tuint width = uint( textureSize( tex, 0 ).x );\n\tuvec2 uv;\n\tuv.x = index % width;\n\tuv.y = index / width;\n\n\treturn texelFetch( tex, ivec2( uv ), 0 );\n\n}\n\nvec4 texelFetch1D( sampler2D tex, uint index ) {\n\n\tuint width = uint( textureSize( tex, 0 ).x );\n\tuvec2 uv;\n\tuv.x = index % width;\n\tuv.y = index / width;\n\n\treturn texelFetch( tex, ivec2( uv ), 0 );\n\n}\n\nvec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {\n\n\treturn\n\t\tbarycoord.x * texelFetch1D( tex, faceIndices.x ) +\n\t\tbarycoord.y * texelFetch1D( tex, faceIndices.y ) +\n\t\tbarycoord.z * texelFetch1D( tex, faceIndices.z );\n\n}\n\nvoid ndcToCameraRay(\n\tvec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,\n\tout vec3 rayOrigin, out vec3 rayDirection\n) {\n\n\t// get camera look direction and near plane for camera clipping\n\tvec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );\n\tvec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );\n\tfloat near = abs( nearVector.z / nearVector.w );\n\n\t// get the camera direction and position from camera matrices\n\tvec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );\n\tdirection /= direction.w;\n\tdirection = cameraWorld * direction - origin;\n\n\t// slide the origin along the ray until it sits at the near clip plane position\n\torigin.xyz += direction.xyz * near / dot( direction, lookDirection );\n\n\trayOrigin = origin.xyz;\n\trayDirection = direction.xyz;\n\n}\n\n\t\n\n#ifndef TRI_INTERSECT_EPSILON\n#define TRI_INTERSECT_EPSILON 1e-5\n#endif\n\n// Raycasting\nbool intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax, out float dist ) {\n\n\t// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/\n\t// https://tavianator.com/2011/ray_box.html\n\tvec3 invDir = 1.0 / rayDirection;\n\n\t// find intersection distances for each plane\n\tvec3 tMinPlane = invDir * ( boundsMin - rayOrigin );\n\tvec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );\n\n\t// get the min and max distances from each intersection\n\tvec3 tMinHit = min( tMaxPlane, tMinPlane );\n\tvec3 tMaxHit = max( tMaxPlane, tMinPlane );\n\n\t// get the furthest hit distance\n\tvec2 t = max( tMinHit.xx, tMinHit.yz );\n\tfloat t0 = max( t.x, t.y );\n\n\t// get the minimum hit distance\n\tt = min( tMaxHit.xx, tMaxHit.yz );\n\tfloat t1 = min( t.x, t.y );\n\n\t// set distance to 0.0 if the ray starts inside the box\n\tdist = max( t0, 0.0 );\n\n\treturn t1 >= dist;\n\n}\n\nbool intersectsTriangle(\n\tvec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,\n\tout vec3 barycoord, out vec3 norm, out float dist, out float side\n) {\n\n\t// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d\n\tvec3 edge1 = b - a;\n\tvec3 edge2 = c - a;\n\tnorm = cross( edge1, edge2 );\n\n\tfloat det = - dot( rayDirection, norm );\n\tfloat invdet = 1.0 / det;\n\n\tvec3 AO = rayOrigin - a;\n\tvec3 DAO = cross( AO, rayDirection );\n\n\tvec4 uvt;\n\tuvt.x = dot( edge2, DAO ) * invdet;\n\tuvt.y = - dot( edge1, DAO ) * invdet;\n\tuvt.z = dot( AO, norm ) * invdet;\n\tuvt.w = 1.0 - uvt.x - uvt.y;\n\n\t// set the hit information\n\tbarycoord = uvt.wxy; // arranged in A, B, C order\n\tdist = uvt.z;\n\tside = sign( det );\n\tnorm = side * normalize( norm );\n\n\t// add an epsilon to avoid misses between triangles\n\tuvt += vec4( TRI_INTERSECT_EPSILON );\n\n\treturn all( greaterThanEqual( uvt, vec4( 0.0 ) ) );\n\n}\n\nbool intersectTriangles(\n\t// geometry info and triangle range\n\tsampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,\n\n\t// ray\n\tvec3 rayOrigin, vec3 rayDirection,\n\n\t// outputs\n\tinout float minDistance, inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,\n\tinout float side, inout float dist\n) {\n\n\tbool found = false;\n\tvec3 localBarycoord, localNormal;\n\tfloat localDist, localSide;\n\tfor ( uint i = offset, l = offset + count; i < l; i ++ ) {\n\n\t\tuvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;\n\t\tvec3 a = texelFetch1D( positionAttr, indices.x ).rgb;\n\t\tvec3 b = texelFetch1D( positionAttr, indices.y ).rgb;\n\t\tvec3 c = texelFetch1D( positionAttr, indices.z ).rgb;\n\n\t\tif (\n\t\t\tintersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )\n\t\t\t&& localDist < minDistance\n\t\t) {\n\n\t\t\tfound = true;\n\t\t\tminDistance = localDist;\n\n\t\t\tfaceIndices = uvec4( indices.xyz, i );\n\t\t\tfaceNormal = localNormal;\n\n\t\t\tside = localSide;\n\t\t\tbarycoord = localBarycoord;\n\t\t\tdist = localDist;\n\n\t\t}\n\n\t}\n\n\treturn found;\n\n}\n\nbool intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, sampler2D bvhBounds, uint currNodeIndex, out float dist ) {\n\n\tuint cni2 = currNodeIndex * 2u;\n\tvec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;\n\tvec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;\n\treturn intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax, dist );\n\n}\n\n// use a macro to hide the fact that we need to expand the struct into separate fields\n#define\tbvhIntersectFirstHit(\t\tbvh,\t\trayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist\t)\t_bvhIntersectFirstHit(\t\tbvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,\t\trayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist\t)\n\nbool _bvhIntersectFirstHit(\n\t// bvh info\n\tsampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,\n\n\t// ray\n\tvec3 rayOrigin, vec3 rayDirection,\n\n\t// output variables split into separate variables due to output precision\n\tinout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,\n\tinout float side, inout float dist\n) {\n\n\t// stack needs to be twice as long as the deepest tree we expect because\n\t// we push both the left and right child onto the stack every traversal\n\tint ptr = 0;\n\tuint stack[ BVH_STACK_DEPTH ];\n\tstack[ 0 ] = 0u;\n\n\tfloat triangleDistance = INFINITY;\n\tbool found = false;\n\twhile ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {\n\n\t\tuint currNodeIndex = stack[ ptr ];\n\t\tptr --;\n\n\t\t// check if we intersect the current bounds\n\t\tfloat boundsHitDistance;\n\t\tif (\n\t\t\t! intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh_bvhBounds, currNodeIndex, boundsHitDistance )\n\t\t\t|| boundsHitDistance > triangleDistance\n\t\t) {\n\n\t\t\tcontinue;\n\n\t\t}\n\n\t\tuvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;\n\t\tbool isLeaf = bool( boundsInfo.x & 0xffff0000u );\n\n\t\tif ( isLeaf ) {\n\n\t\t\tuint count = boundsInfo.x & 0x0000ffffu;\n\t\t\tuint offset = boundsInfo.y;\n\n\t\t\tfound = intersectTriangles(\n\t\t\t\tbvh_position, bvh_index, offset, count,\n\t\t\t\trayOrigin, rayDirection, triangleDistance,\n\t\t\t\tfaceIndices, faceNormal, barycoord, side, dist\n\t\t\t) || found;\n\n\t\t} else {\n\n\t\t\tuint leftIndex = currNodeIndex + 1u;\n\t\t\tuint splitAxis = boundsInfo.x & 0x0000ffffu;\n\t\t\tuint rightIndex = boundsInfo.y;\n\n\t\t\tbool leftToRight = rayDirection[ splitAxis ] >= 0.0;\n\t\t\tuint c1 = leftToRight ? leftIndex : rightIndex;\n\t\t\tuint c2 = leftToRight ? rightIndex : leftIndex;\n\n\t\t\t// set c2 in the stack so we traverse it later. We need to keep track of a pointer in\n\t\t\t// the stack while we traverse. The second pointer added is the one that will be\n\t\t\t// traversed first\n\t\t\tptr ++;\n\t\t\tstack[ ptr ] = c2;\n\n\t\t\tptr ++;\n\t\t\tstack[ ptr ] = c1;\n\n\t\t}\n\n\t}\n\n\treturn found;\n\n}\n\n\n  uniform BVH bvh;\n  uniform float ior;\n  uniform bool correctMips;\n  uniform vec2 resolution;\n  uniform float fresnel;\n  uniform mat4 modelMatrix;\n  uniform mat4 projectionMatrixInverse;\n  uniform mat4 viewMatrixInverse;\n  uniform float aberrationStrength;\n  uniform vec3 color;\n  uniform float opacity;\n\n  float fresnelFunc(vec3 viewDirection, vec3 worldNormal) {\n    return pow( 1.0 + dot( viewDirection, worldNormal), 10.0 );\n  }\n\n  vec3 totalInternalReflection(vec3 ro, vec3 rd, vec3 normal, float ior, mat4 modelMatrixInverse) {\n    vec3 rayOrigin = ro;\n    vec3 rayDirection = rd;\n    rayDirection = refract(rayDirection, normal, 1.0 / ior);\n    rayOrigin = vWorldPosition + rayDirection * 0.001;\n    rayOrigin = (modelMatrixInverse * vec4(rayOrigin, 1.0)).xyz;\n    rayDirection = normalize((modelMatrixInverse * vec4(rayDirection, 0.0)).xyz);\n    for(float i = 0.0; i < bounces; i++) {\n      uvec4 faceIndices = uvec4( 0u );\n      vec3 faceNormal = vec3( 0.0, 0.0, 1.0 );\n      vec3 barycoord = vec3( 0.0 );\n      float side = 1.0;\n      float dist = 0.0;\n      bvhIntersectFirstHit( bvh, rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist );\n      vec3 hitPos = rayOrigin + rayDirection * max(dist - 0.001, 0.0);\n      vec3 tempDir = refract(rayDirection, faceNormal, ior);\n      if (length(tempDir) != 0.0) {\n        rayDirection = tempDir;\n        break;\n      }\n      rayDirection = reflect(rayDirection, faceNormal);\n      rayOrigin = hitPos + rayDirection * 0.01;\n    }\n    rayDirection = normalize((modelMatrix * vec4(rayDirection, 0.0)).xyz);\n    return rayDirection;\n  }\n\n  #include <common>\n  #include <cube_uv_reflection_fragment>\n\n  #ifdef ENVMAP_TYPE_CUBEM\n    vec4 textureGradient(samplerCube envMap, vec3 rayDirection, vec3 directionCamPerfect) {\n      return textureGrad(envMap, rayDirection, dFdx(correctMips ? directionCamPerfect: rayDirection), dFdy(correctMips ? directionCamPerfect: rayDirection));\n    }\n  #else\n    vec4 textureGradient(sampler2D envMap, vec3 rayDirection, vec3 directionCamPerfect) {\n      vec2 uvv = equirectUv( rayDirection );\n      vec2 smoothUv = equirectUv( directionCamPerfect );\n      return textureGrad(envMap, uvv, dFdx(correctMips ? smoothUv : uvv), dFdy(correctMips ? smoothUv : uvv));\n    }\n  #endif\n\n  void main() {\n    vec2 uv = gl_FragCoord.xy / resolution;\n    vec3 directionCamPerfect = (projectionMatrixInverse * vec4(uv * 2.0 - 1.0, 0.0, 1.0)).xyz;\n    directionCamPerfect = (viewMatrixInverse * vec4(directionCamPerfect, 0.0)).xyz;\n    directionCamPerfect = normalize(directionCamPerfect);\n    vec3 normal = vNormal;\n    vec3 rayOrigin = cameraPosition;\n    vec3 rayDirection = normalize(vWorldPosition - cameraPosition);\n\n    vec4 diffuseColor = vec4(color, opacity);\n    #include <color_fragment>\n\n    #ifdef CHROMATIC_ABERRATIONS\n      vec3 rayDirectionG = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior, 1.0), vModelMatrixInverse);\n      #ifdef FAST_CHROMA\n        vec3 rayDirectionR = normalize(rayDirectionG + 1.0 * vec3(aberrationStrength / 2.0));\n        vec3 rayDirectionB = normalize(rayDirectionG - 1.0 * vec3(aberrationStrength / 2.0));\n      #else\n        vec3 rayDirectionR = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior * (1.0 - aberrationStrength), 1.0), vModelMatrixInverse);\n        vec3 rayDirectionB = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior * (1.0 + aberrationStrength), 1.0), vModelMatrixInverse);\n      #endif\n      float finalColorR = textureGradient(envMap, rayDirectionR, directionCamPerfect).r;\n      float finalColorG = textureGradient(envMap, rayDirectionG, directionCamPerfect).g;\n      float finalColorB = textureGradient(envMap, rayDirectionB, directionCamPerfect).b;\n      diffuseColor.rgb *= vec3(finalColorR, finalColorG, finalColorB);\n    #else\n      rayDirection = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior, 1.0), vModelMatrixInverse);\n      diffuseColor.rgb *= textureGradient(envMap, rayDirection, directionCamPerfect).rgb;\n    #endif\n\n    vec3 viewDirection = normalize(vWorldPosition - cameraPosition);\n    float nFresnel = fresnelFunc(viewDirection, normal) * fresnel;\n    gl_FragColor = vec4(mix(diffuseColor.rgb, vec3(1.0), nFresnel), diffuseColor.a);\n\n    #include <tonemapping_fragment>\n    #include <${dc>=154?"colorspace_fragment":"encodings_fragment"}>\n  }`),by=e=>e&&e.isCubeTexture;function By({aberrationStrength:e=0,fastChroma:t=!0,envMap:n,...o}){(0,a.e)({MeshRefractionMaterial:_y});const s=(0,i.useRef)(),{size:c}=(0,a.D)(),l=(0,i.useMemo)((()=>{var r,i;const o={},s=by(n),a=(null!==(r=s?null==(i=n.image[0])?void 0:i.width:n.image.width)&&void 0!==r?r:1024)/4,c=Math.floor(Math.log2(a)),l=Math.pow(2,c),u=3*Math.max(l,112),h=4*l;return s&&(o.ENVMAP_TYPE_CUBEM=""),o.CUBEUV_TEXEL_WIDTH=""+1/u,o.CUBEUV_TEXEL_HEIGHT=""+1/h,o.CUBEUV_MAX_MIP=`${c}.0`,e>0&&(o.CHROMATIC_ABERRATIONS=""),t&&(o.FAST_CHROMA=""),o}),[e,t]);return(0,i.useLayoutEffect)((()=>{var e;const t=null==(e=s.current)||null==(e=e.__r3f)||null==(e=e.parent)?void 0:e.geometry;t&&(s.current.bvh=new Iy,s.current.bvh.updateFrom(new Jf(t.clone().toNonIndexed(),{strategy:Im})))}),[]),(0,a.F)((({camera:e})=>{s.current.viewMatrixInverse=e.matrixWorld,s.current.projectionMatrixInverse=e.projectionMatrixInverse})),i.createElement("meshRefractionMaterial",(0,r.Z)({key:JSON.stringify(l),defines:l,ref:s,resolution:[c.width,c.height],aberrationStrength:e,envMap:n},o))}const My=cc({},"void main() { }","void main() { gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0); discard;  }");class Sy extends s.MeshPhysicalMaterial{constructor(e=6,t=!1){super(),this.uniforms={chromaticAberration:{value:.05},transmission:{value:0},_transmission:{value:1},transmissionMap:{value:null},roughness:{value:0},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:1/0},attenuationColor:{value:new s.Color("white")},anisotropicBlur:{value:.1},time:{value:0},distortion:{value:0},distortionScale:{value:.5},temporalDistortion:{value:0},buffer:{value:null}},this.onBeforeCompile=n=>{n.uniforms={...n.uniforms,...this.uniforms},this.anisotropy>0&&(n.defines.USE_ANISOTROPY=""),t?n.defines.USE_SAMPLER="":n.defines.USE_TRANSMISSION="",n.fragmentShader="\n      uniform float chromaticAberration;         \n      uniform float anisotropicBlur;      \n      uniform float time;\n      uniform float distortion;\n      uniform float distortionScale;\n      uniform float temporalDistortion;\n      uniform sampler2D buffer;\n\n      vec3 random3(vec3 c) {\n        float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));\n        vec3 r;\n        r.z = fract(512.0*j);\n        j *= .125;\n        r.x = fract(512.0*j);\n        j *= .125;\n        r.y = fract(512.0*j);\n        return r-0.5;\n      }\n\n      uint hash( uint x ) {\n        x += ( x << 10u );\n        x ^= ( x >>  6u );\n        x += ( x <<  3u );\n        x ^= ( x >> 11u );\n        x += ( x << 15u );\n        return x;\n      }\n\n      // Compound versions of the hashing algorithm I whipped together.\n      uint hash( uvec2 v ) { return hash( v.x ^ hash(v.y)                         ); }\n      uint hash( uvec3 v ) { return hash( v.x ^ hash(v.y) ^ hash(v.z)             ); }\n      uint hash( uvec4 v ) { return hash( v.x ^ hash(v.y) ^ hash(v.z) ^ hash(v.w) ); }\n\n      // Construct a float with half-open range [0:1] using low 23 bits.\n      // All zeroes yields 0.0, all ones yields the next smallest representable value below 1.0.\n      float floatConstruct( uint m ) {\n        const uint ieeeMantissa = 0x007FFFFFu; // binary32 mantissa bitmask\n        const uint ieeeOne      = 0x3F800000u; // 1.0 in IEEE binary32\n        m &= ieeeMantissa;                     // Keep only mantissa bits (fractional part)\n        m |= ieeeOne;                          // Add fractional part to 1.0\n        float  f = uintBitsToFloat( m );       // Range [1:2]\n        return f - 1.0;                        // Range [0:1]\n      }\n\n      // Pseudo-random value in half-open range [0:1].\n      float randomBase( float x ) { return floatConstruct(hash(floatBitsToUint(x))); }\n      float randomBase( vec2  v ) { return floatConstruct(hash(floatBitsToUint(v))); }\n      float randomBase( vec3  v ) { return floatConstruct(hash(floatBitsToUint(v))); }\n      float randomBase( vec4  v ) { return floatConstruct(hash(floatBitsToUint(v))); }\n      float rand(float seed) {\n        float result = randomBase(vec3(gl_FragCoord.xy, seed));\n        return result;\n      }\n\n      const float F3 =  0.3333333;\n      const float G3 =  0.1666667;\n\n      float snoise(vec3 p) {\n        vec3 s = floor(p + dot(p, vec3(F3)));\n        vec3 x = p - s + dot(s, vec3(G3));\n        vec3 e = step(vec3(0.0), x - x.yzx);\n        vec3 i1 = e*(1.0 - e.zxy);\n        vec3 i2 = 1.0 - e.zxy*(1.0 - e);\n        vec3 x1 = x - i1 + G3;\n        vec3 x2 = x - i2 + 2.0*G3;\n        vec3 x3 = x - 1.0 + 3.0*G3;\n        vec4 w, d;\n        w.x = dot(x, x);\n        w.y = dot(x1, x1);\n        w.z = dot(x2, x2);\n        w.w = dot(x3, x3);\n        w = max(0.6 - w, 0.0);\n        d.x = dot(random3(s), x);\n        d.y = dot(random3(s + i1), x1);\n        d.z = dot(random3(s + i2), x2);\n        d.w = dot(random3(s + 1.0), x3);\n        w *= w;\n        w *= w;\n        d *= w;\n        return dot(d, vec4(52.0));\n      }\n\n      float snoiseFractal(vec3 m) {\n        return 0.5333333* snoise(m)\n              +0.2666667* snoise(2.0*m)\n              +0.1333333* snoise(4.0*m)\n              +0.0666667* snoise(8.0*m);\n      }\n"+n.fragmentShader,n.fragmentShader=n.fragmentShader.replace("#include <transmission_pars_fragment>","\n        #ifdef USE_TRANSMISSION\n          // Transmission code is based on glTF-Sampler-Viewer\n          // https://github.com/KhronosGroup/glTF-Sample-Viewer\n          uniform float _transmission;\n          uniform float thickness;\n          uniform float attenuationDistance;\n          uniform vec3 attenuationColor;\n          #ifdef USE_TRANSMISSIONMAP\n            uniform sampler2D transmissionMap;\n          #endif\n          #ifdef USE_THICKNESSMAP\n            uniform sampler2D thicknessMap;\n          #endif\n          uniform vec2 transmissionSamplerSize;\n          uniform sampler2D transmissionSamplerMap;\n          uniform mat4 modelMatrix;\n          uniform mat4 projectionMatrix;\n          varying vec3 vWorldPosition;\n          vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n            // Direction of refracted light.\n            vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n            // Compute rotation-independant scaling of the model matrix.\n            vec3 modelScale;\n            modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n            modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n            modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n            // The thickness is specified in local space.\n            return normalize( refractionVector ) * thickness * modelScale;\n          }\n          float applyIorToRoughness( const in float roughness, const in float ior ) {\n            // Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and\n            // an IOR of 1.5 results in the default amount of microfacet refraction.\n            return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n          }\n          vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n            float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );            \n            #ifdef USE_SAMPLER\n              #ifdef texture2DLodEXT\n                return texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod);\n              #else\n                return texture2D(transmissionSamplerMap, fragCoord.xy, framebufferLod);\n              #endif\n            #else\n              return texture2D(buffer, fragCoord.xy);\n            #endif\n          }\n          vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n            if ( isinf( attenuationDistance ) ) {\n              // Attenuation distance is +\u221e, i.e. the transmitted color is not attenuated at all.\n              return radiance;\n            } else {\n              // Compute light attenuation using Beer's law.\n              vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n              vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance ); // Beer's law\n              return transmittance * radiance;\n            }\n          }\n          vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n            const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n            const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n            const in vec3 attenuationColor, const in float attenuationDistance ) {\n            vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n            vec3 refractedRayExit = position + transmissionRay;\n            // Project refracted vector on the framebuffer, while mapping to normalized device coordinates.\n            vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n            vec2 refractionCoords = ndcPos.xy / ndcPos.w;\n            refractionCoords += 1.0;\n            refractionCoords /= 2.0;\n            // Sample framebuffer to get pixel the refracted ray hits.\n            vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n            vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n            // Get the specular component.\n            vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n            return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n          }\n        #endif\n"),n.fragmentShader=n.fragmentShader.replace("#include <transmission_fragment>",`  \n        // Improve the refraction to use the world pos\n        material.transmission = _transmission;\n        material.transmissionAlpha = 1.0;\n        material.thickness = thickness;\n        material.attenuationDistance = attenuationDistance;\n        material.attenuationColor = attenuationColor;\n        #ifdef USE_TRANSMISSIONMAP\n          material.transmission *= texture2D( transmissionMap, vUv ).r;\n        #endif\n        #ifdef USE_THICKNESSMAP\n          material.thickness *= texture2D( thicknessMap, vUv ).g;\n        #endif\n        \n        vec3 pos = vWorldPosition;\n        float runningSeed = 0.0;\n        vec3 v = normalize( cameraPosition - pos );\n        vec3 n = inverseTransformDirection( normal, viewMatrix );\n        vec3 transmission = vec3(0.0);\n        float transmissionR, transmissionB, transmissionG;\n        float randomCoords = rand(runningSeed++);\n        float thickness_smear = thickness * max(pow(roughnessFactor, 0.33), anisotropicBlur);\n        vec3 distortionNormal = vec3(0.0);\n        vec3 temporalOffset = vec3(time, -time, -time) * temporalDistortion;\n        if (distortion > 0.0) {\n          distortionNormal = distortion * vec3(snoiseFractal(vec3((pos * distortionScale + temporalOffset))), snoiseFractal(vec3(pos.zxy * distortionScale - temporalOffset)), snoiseFractal(vec3(pos.yxz * distortionScale + temporalOffset)));\n        }\n        for (float i = 0.0; i < ${e}.0; i ++) {\n          vec3 sampleNorm = normalize(n + roughnessFactor * roughnessFactor * 2.0 * normalize(vec3(rand(runningSeed++) - 0.5, rand(runningSeed++) - 0.5, rand(runningSeed++) - 0.5)) * pow(rand(runningSeed++), 0.33) + distortionNormal);\n          transmissionR = getIBLVolumeRefraction(\n            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness  + thickness_smear * (i + randomCoords) / float(${e}),\n            material.attenuationColor, material.attenuationDistance\n          ).r;\n          transmissionG = getIBLVolumeRefraction(\n            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior  * (1.0 + chromaticAberration * (i + randomCoords) / float(${e})) , material.thickness + thickness_smear * (i + randomCoords) / float(${e}),\n            material.attenuationColor, material.attenuationDistance\n          ).g;\n          transmissionB = getIBLVolumeRefraction(\n            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior * (1.0 + 2.0 * chromaticAberration * (i + randomCoords) / float(${e})), material.thickness + thickness_smear * (i + randomCoords) / float(${e}),\n            material.attenuationColor, material.attenuationDistance\n          ).b;\n          transmission.r += transmissionR;\n          transmission.g += transmissionG;\n          transmission.b += transmissionB;\n        }\n        transmission /= ${e}.0;\n        totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n`)},Object.keys(this.uniforms).forEach((e=>Object.defineProperty(this,e,{get:()=>this.uniforms[e].value,set:t=>this.uniforms[e].value=t})))}}const Dy=i.forwardRef((({buffer:e,transmissionSampler:t=!1,backside:n=!1,side:o=s.FrontSide,transmission:c=1,thickness:l=0,backsideThickness:u=0,backsideEnvMapIntensity:h=1,samples:d=10,resolution:A,backsideResolution:m,background:p,anisotropy:f,anisotropicBlur:g,...y},v)=>{(0,a.e)({MeshTransmissionMaterial:Sy});const x=i.useRef(null),[E]=i.useState((()=>new My)),w=ol(m||A),C=ol(A);let I,_,b,B;return(0,a.F)((e=>{x.current.time=e.clock.getElapsedTime(),x.current.buffer!==C.texture||t||(B=x.current.__r3f.parent,B&&(b=e.gl.toneMapping,I=e.scene.background,_=x.current.envMapIntensity,e.gl.toneMapping=s.NoToneMapping,p&&(e.scene.background=p),B.material=E,n&&(e.gl.setRenderTarget(w),e.gl.render(e.scene,e.camera),B.material=x.current,B.material.buffer=w.texture,B.material.thickness=u,B.material.side=s.BackSide,B.material.envMapIntensity=h),e.gl.setRenderTarget(C),e.gl.render(e.scene,e.camera),B.material=x.current,B.material.thickness=l,B.material.side=o,B.material.buffer=C.texture,B.material.envMapIntensity=_,e.scene.background=I,e.gl.setRenderTarget(null),e.gl.toneMapping=b))})),i.useImperativeHandle(v,(()=>x.current),[]),i.createElement("meshTransmissionMaterial",(0,r.Z)({args:[d,t],ref:x},y,{buffer:e||C.texture,_transmission:c,anisotropicBlur:null!==g&&void 0!==g?g:f,transmission:t?c:0,thickness:l,side:o}))})),Ty=i.forwardRef(((e,t)=>((0,a.e)({DiscardMaterialImpl:My}),i.createElement("discardMaterialImpl",(0,r.Z)({ref:t},e))))),Qy=dc>=154?"opaque_fragment":"output_fragment";class Py extends s.PointsMaterial{constructor(e){super(e),this.onBeforeCompile=(e,t)=>{const{isWebGL2:n}=t.capabilities;e.fragmentShader=e.fragmentShader.replace(`#include <${Qy}>`,`\n        ${n?`#include <${Qy}>`:`#extension GL_OES_standard_derivatives : enable\n#include <${Qy}>`}\n      vec2 cxy = 2.0 * gl_PointCoord - 1.0;\n      float r = dot(cxy, cxy);\n      float delta = fwidth(r);     \n      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\n      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );\n      #include <tonemapping_fragment>\n      #include <${dc>=154?"colorspace_fragment":"encodings_fragment"}>\n      `)}}}const zy=i.forwardRef(((e,t)=>{const[n]=i.useState((()=>new Py(null)));return i.createElement("primitive",(0,r.Z)({},e,{object:n,ref:t,attach:"material"}))})),Ry=({focus:e=0,size:t=25,samples:n=10}={})=>`\n#define PENUMBRA_FILTER_SIZE float(${t})\n#define RGB_NOISE_FUNCTION(uv) (randRGB(uv))\nvec3 randRGB(vec2 uv) {\n  return vec3(\n    fract(sin(dot(uv, vec2(12.75613, 38.12123))) * 13234.76575),\n    fract(sin(dot(uv, vec2(19.45531, 58.46547))) * 43678.23431),\n    fract(sin(dot(uv, vec2(23.67817, 78.23121))) * 93567.23423)\n  );\n}\n\nvec3 lowPassRandRGB(vec2 uv) {\n  // 3x3 convolution (average)\n  // can be implemented as separable with an extra buffer for a total of 6 samples instead of 9\n  vec3 result = vec3(0);\n  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, -1.0));\n  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0,  0.0));\n  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, +1.0));\n  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, -1.0));\n  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0,  0.0));\n  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, +1.0));\n  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, -1.0));\n  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0,  0.0));\n  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, +1.0));\n  result *= 0.111111111; // 1.0 / 9.0\n  return result;\n}\nvec3 highPassRandRGB(vec2 uv) {\n  // by subtracting the low-pass signal from the original signal, we're being left with the high-pass signal\n  // hp(x) = x - lp(x)\n  return RGB_NOISE_FUNCTION(uv) - lowPassRandRGB(uv) + 0.5;\n}\n\n\nvec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {\n  const float goldenAngle = 2.399963f; // radians\n  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));\n  float theta = float(sampleIndex) * goldenAngle + angle;\n  float sine = sin(theta);\n  float cosine = cos(theta);\n  return vec2(cosine, sine) * r;\n}\nfloat penumbraSize( const in float zReceiver, const in float zBlocker ) { // Parallel plane estimation\n  return (zReceiver - zBlocker) / zBlocker;\n}\nfloat findBlocker(sampler2D shadowMap, vec2 uv, float compare, float angle) {\n  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);\n  float blockerDepthSum = float(${e});\n  float blockers = 0.0;\n\n  int j = 0;\n  vec2 offset = vec2(0.);\n  float depth = 0.;\n\n  #pragma unroll_loop_start\n  for(int i = 0; i < ${n}; i ++) {\n    offset = (vogelDiskSample(j, ${n}, angle) * texelSize) * 2.0 * PENUMBRA_FILTER_SIZE;\n    depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset));\n    if (depth < compare) {\n      blockerDepthSum += depth;\n      blockers++;\n    }\n    j++;\n  }\n  #pragma unroll_loop_end\n\n  if (blockers > 0.0) {\n    return blockerDepthSum / blockers;\n  }\n  return -1.0;\n}\n\n        \nfloat vogelFilter(sampler2D shadowMap, vec2 uv, float zReceiver, float filterRadius, float angle) {\n  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);\n  float shadow = 0.0f;\n  int j = 0;\n  vec2 vogelSample = vec2(0.0);\n  vec2 offset = vec2(0.0);\n  #pragma unroll_loop_start\n  for (int i = 0; i < ${n}; i++) {\n    vogelSample = vogelDiskSample(j, ${n}, angle) * texelSize;\n    offset = vogelSample * (1.0 + filterRadius * float(${t}));\n    shadow += step( zReceiver, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );\n    j++;\n  }\n  #pragma unroll_loop_end\n  return shadow * 1.0 / ${n}.0;\n}\n\nfloat PCSS (sampler2D shadowMap, vec4 coords) {\n  vec2 uv = coords.xy;\n  float zReceiver = coords.z; // Assumed to be eye-space z in this code\n  float angle = highPassRandRGB(gl_FragCoord.xy).r * PI2;\n  float avgBlockerDepth = findBlocker(shadowMap, uv, zReceiver, angle);\n  if (avgBlockerDepth == -1.0) {\n    return 1.0;\n  }\n  float penumbraRatio = penumbraSize(zReceiver, avgBlockerDepth);\n  return vogelFilter(shadowMap, uv, zReceiver, 1.25 * penumbraRatio, angle);\n}`;function Fy(e,t,n){t.traverse((t=>{t.material&&(e.properties.remove(t.material),null==t.material.dispose||t.material.dispose())})),e.info.programs.length=0,e.compile(t,n)}function ky({focus:e=0,samples:t=10,size:n=25}){const r=(0,a.D)((e=>e.gl)),o=(0,a.D)((e=>e.scene)),c=(0,a.D)((e=>e.camera));return i.useEffect((()=>{const i=s.ShaderChunk.shadowmap_pars_fragment;return s.ShaderChunk.shadowmap_pars_fragment=s.ShaderChunk.shadowmap_pars_fragment.replace("#ifdef USE_SHADOWMAP","#ifdef USE_SHADOWMAP\n"+Ry({size:n,samples:t,focus:e})).replace("#if defined( SHADOWMAP_TYPE_PCF )","\nreturn PCSS(shadowMap, shadowCoord);\n#if defined( SHADOWMAP_TYPE_PCF )"),Fy(r,o,c),()=>{s.ShaderChunk.shadowmap_pars_fragment=i,Fy(r,o,c)}}),[e,n,t]),null}function Ly(e,t){const n=e+"Geometry";return i.forwardRef((({args:e,children:o,...s},a)=>{const c=i.useRef(null);return i.useImperativeHandle(a,(()=>c.current)),i.useLayoutEffect((()=>{null==t||t(c.current)})),i.createElement("mesh",(0,r.Z)({ref:c},s),i.createElement(n,{attach:"geometry",args:e}),o)}))}const Oy=Ly("box"),Uy=Ly("circle"),Ny=Ly("cone"),Vy=Ly("cylinder"),Gy=Ly("sphere"),jy=Ly("plane"),Hy=Ly("tube"),qy=Ly("torus"),Wy=Ly("torusKnot"),Yy=Ly("tetrahedron"),Xy=Ly("ring"),Zy=Ly("polyhedron"),Ky=Ly("icosahedron"),Jy=Ly("octahedron"),$y=Ly("dodecahedron"),ev=Ly("extrude"),tv=Ly("lathe"),nv=Ly("capsule"),rv=Ly("shape",(({geometry:e})=>{const t=e.attributes.position,n=(new s.Box3).setFromBufferAttribute(t),r=new s.Vector3;n.getSize(r);const i=[];let o=0,a=0,c=0,l=0;for(let s=0;s<t.count;s++)o=t.getX(s),a=t.getY(s),c=(o-n.min.x)/r.x,l=(a-n.min.y)/r.y,i.push(c,l);e.setAttribute("uv",new s.Float32BufferAttribute(i,2))})),iv=1e-5;const ov=i.forwardRef((function({args:[e=1,t=1,n=1]=[],radius:o=.05,steps:a=1,smoothness:c=4,bevelSegments:l=4,creaseAngle:u=.4,children:h,...d},A){const m=i.useMemo((()=>function(e,t,n){const r=new s.Shape,i=n-iv;return r.absarc(iv,iv,iv,-Math.PI/2,-Math.PI,!0),r.absarc(iv,t-2*i,iv,Math.PI,Math.PI/2,!0),r.absarc(e-2*i,t-2*i,iv,Math.PI/2,0,!0),r.absarc(e-2*i,iv,iv,0,-Math.PI/2,!0),r}(e,t,o)),[e,t,o]),p=i.useMemo((()=>({depth:n-2*o,bevelEnabled:!0,bevelSegments:2*l,steps:a,bevelSize:o-iv,bevelThickness:o,curveSegments:c})),[n,o,c]),f=i.useRef(null);return i.useLayoutEffect((()=>{f.current&&(f.current.center(),(0,Ma.LZ)(f.current,u))}),[m,p]),i.createElement("mesh",(0,r.Z)({ref:A},d),i.createElement("extrudeGeometry",{ref:f,args:[m,p]}),h)}));function sv(){const e=new s.BufferGeometry,t=new Float32Array([-1,-1,3,-1,-1,3]);return e.boundingSphere=new s.Sphere,e.boundingSphere.set(new s.Vector3,1/0),e.setAttribute("position",new s.BufferAttribute(t,2)),e}const av=i.forwardRef((function({children:e,...t},n){const o=i.useMemo(sv,[]);return i.createElement("mesh",(0,r.Z)({ref:n,geometry:o,frustumCulled:!1},t),e)})),cv=i.forwardRef((({children:e,width:t,height:n,depth:o,box3:a,precise:c=!0,...l},u)=>{const h=i.useRef(null),d=i.useRef(null),A=i.useRef(null);return i.useLayoutEffect((()=>{d.current.matrixWorld.identity();let e=a||(new s.Box3).setFromObject(A.current,c);const r=e.max.x-e.min.x,i=e.max.y-e.min.y,l=e.max.z-e.min.z;let u=Math.max(r,i,l);t&&(u=r),n&&(u=i),o&&(u=l),d.current.scale.setScalar(1/u)}),[t,n,o,a,c]),i.useImperativeHandle(u,(()=>h.current),[]),i.createElement("group",(0,r.Z)({ref:h},l),i.createElement("group",{ref:d},i.createElement("group",{ref:A},e)))}));var lv=function(e){return e[e.NONE=0]="NONE",e[e.START=1]="START",e[e.ACTIVE=2]="ACTIVE",e}(lv||{});const uv=e=>e&&e.isOrthographicCamera,hv=e=>e&&e.isBox3,dv=e=>1-Math.exp(-5*e)+.007*e,Av=i.createContext(null);function mv({children:e,maxDuration:t=1,margin:n=1.2,observe:r,fit:o,clip:c,interpolateFunc:l=dv,onFit:u}){const h=i.useRef(null),{camera:d,size:A,invalidate:m}=(0,a.D)(),p=(0,a.D)((e=>e.controls)),f=i.useRef(u);f.current=u;const g=i.useRef({camPos:new s.Vector3,camRot:new s.Quaternion,camZoom:1}),y=i.useRef({camPos:void 0,camRot:void 0,camZoom:void 0,camUp:void 0,target:void 0}),v=i.useRef(lv.NONE),x=i.useRef(0),[E]=i.useState((()=>new s.Box3)),w=i.useMemo((()=>{function e(){const e=E.getSize(new s.Vector3),t=E.getCenter(new s.Vector3),r=Math.max(e.x,e.y,e.z),i=uv(d)?4*r:r/(2*Math.atan(Math.PI*d.fov/360)),o=uv(d)?4*r:i/d.aspect,a=n*Math.max(i,o);return{box:E,size:e,center:t,distance:a}}return{getSize:e,refresh(e){if(hv(e))E.copy(e);else{const t=e||h.current;if(!t)return this;t.updateWorldMatrix(!0,!0),E.setFromObject(t)}if(E.isEmpty()){const e=d.position.length()||10;E.setFromCenterAndSize(new s.Vector3,new s.Vector3(e,e,e))}return g.current.camPos.copy(d.position),g.current.camRot.copy(d.quaternion),uv(d)&&(g.current.camZoom=d.zoom),y.current.camPos=void 0,y.current.camRot=void 0,y.current.camZoom=void 0,y.current.camUp=void 0,y.current.target=void 0,this},reset(){const{center:t,distance:n}=e(),r=d.position.clone().sub(t).normalize();y.current.camPos=t.clone().addScaledVector(r,n),y.current.target=t.clone();const i=(new s.Matrix4).lookAt(y.current.camPos,y.current.target,d.up);return y.current.camRot=(new s.Quaternion).setFromRotationMatrix(i),v.current=lv.START,x.current=0,this},moveTo(e){return y.current.camPos=Array.isArray(e)?new s.Vector3(...e):e.clone(),v.current=lv.START,x.current=0,this},lookAt({target:e,up:t}){y.current.target=Array.isArray(e)?new s.Vector3(...e):e.clone(),y.current.camUp=t?Array.isArray(t)?new s.Vector3(...t):t.clone():d.up.clone();const n=(new s.Matrix4).lookAt(y.current.camPos||d.position,y.current.target,y.current.camUp);return y.current.camRot=(new s.Quaternion).setFromRotationMatrix(n),v.current=lv.START,x.current=0,this},to({position:e,target:t}){return this.moveTo(e).lookAt({target:t})},fit(){if(!uv(d))return this.reset();let e=0,t=0;const r=[new s.Vector3(E.min.x,E.min.y,E.min.z),new s.Vector3(E.min.x,E.max.y,E.min.z),new s.Vector3(E.min.x,E.min.y,E.max.z),new s.Vector3(E.min.x,E.max.y,E.max.z),new s.Vector3(E.max.x,E.max.y,E.max.z),new s.Vector3(E.max.x,E.max.y,E.min.z),new s.Vector3(E.max.x,E.min.y,E.max.z),new s.Vector3(E.max.x,E.min.y,E.min.z)],i=y.current.camPos||d.position,o=y.current.target||(null==p?void 0:p.target),a=y.current.camUp||d.up,c=o?(new s.Matrix4).lookAt(i,o,a).setPosition(i).invert():d.matrixWorldInverse;for(const n of r)n.applyMatrix4(c),e=Math.max(e,Math.abs(n.y)),t=Math.max(t,Math.abs(n.x));e*=2,t*=2;const l=(d.top-d.bottom)/e,u=(d.right-d.left)/t;return y.current.camZoom=Math.min(l,u)/n,v.current=lv.START,x.current=0,f.current&&f.current(this.getSize()),this},clip(){const{distance:t}=e();return d.near=t/100,d.far=100*t,d.updateProjectionMatrix(),p&&(p.maxDistance=10*t,p.update()),m(),this}}}),[E,d,p,n,m]);i.useLayoutEffect((()=>{if(p){const e=()=>{if(p&&y.current.target&&v.current!==lv.NONE){const e=(new s.Vector3).setFromMatrixColumn(d.matrix,2),t=g.current.camPos.distanceTo(p.target),n=(y.current.camPos||g.current.camPos).distanceTo(y.current.target),r=(1-x.current)*t+x.current*n;p.target.copy(d.position).addScaledVector(e,-r),p.update()}v.current=lv.NONE};return p.addEventListener("start",e),()=>p.removeEventListener("start",e)}}),[p]);const C=i.useRef(0);return i.useLayoutEffect((()=>{(r||0===C.current++)&&(w.refresh(),o&&w.reset().fit(),c&&w.clip())}),[A,c,o,r,d,p]),(0,a.F)(((e,n)=>{if(v.current===lv.START)v.current=lv.ACTIVE,m();else if(v.current===lv.ACTIVE){if(x.current+=n/t,x.current>=1)y.current.camPos&&d.position.copy(y.current.camPos),y.current.camRot&&d.quaternion.copy(y.current.camRot),y.current.camUp&&d.up.copy(y.current.camUp),y.current.camZoom&&uv(d)&&(d.zoom=y.current.camZoom),d.updateMatrixWorld(),d.updateProjectionMatrix(),p&&y.current.target&&(p.target.copy(y.current.target),p.update()),v.current=lv.NONE;else{const e=l(x.current);y.current.camPos&&d.position.lerpVectors(g.current.camPos,y.current.camPos,e),y.current.camRot&&d.quaternion.slerpQuaternions(g.current.camRot,y.current.camRot,e),y.current.camUp&&d.up.set(0,1,0).applyQuaternion(d.quaternion),y.current.camZoom&&uv(d)&&(d.zoom=(1-e)*g.current.camZoom+e*y.current.camZoom),d.updateMatrixWorld(),d.updateProjectionMatrix()}m()}})),i.createElement("group",{ref:h},i.createElement(Av.Provider,{value:w},e))}function pv(){return i.useContext(Av)}var fv=Object.defineProperty,gv=(e,t,n)=>(((e,t,n)=>{t in e?fv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);class yv{constructor(e=Math){gv(this,"grad3",[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]]),gv(this,"grad4",[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]]),gv(this,"p",[]),gv(this,"perm",[]),gv(this,"simplex",[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]),gv(this,"dot",((e,t,n)=>e[0]*t+e[1]*n)),gv(this,"dot3",((e,t,n,r)=>e[0]*t+e[1]*n+e[2]*r)),gv(this,"dot4",((e,t,n,r,i)=>e[0]*t+e[1]*n+e[2]*r+e[3]*i)),gv(this,"noise",((e,t)=>{let n,r,i;const o=(e+t)*(.5*(Math.sqrt(3)-1)),s=Math.floor(e+o),a=Math.floor(t+o),c=(3-Math.sqrt(3))/6,l=(s+a)*c,u=e-(s-l),h=t-(a-l);let d=0,A=1;u>h&&(d=1,A=0);const m=u-d+c,p=h-A+c,f=u-1+2*c,g=h-1+2*c,y=255&s,v=255&a,x=this.perm[y+this.perm[v]]%12,E=this.perm[y+d+this.perm[v+A]]%12,w=this.perm[y+1+this.perm[v+1]]%12;let C=.5-u*u-h*h;C<0?n=0:(C*=C,n=C*C*this.dot(this.grad3[x],u,h));let I=.5-m*m-p*p;I<0?r=0:(I*=I,r=I*I*this.dot(this.grad3[E],m,p));let _=.5-f*f-g*g;return _<0?i=0:(_*=_,i=_*_*this.dot(this.grad3[w],f,g)),70*(n+r+i)})),gv(this,"noise3d",((e,t,n)=>{let r,i,o,s;const a=(e+t+n)*(1/3),c=Math.floor(e+a),l=Math.floor(t+a),u=Math.floor(n+a),h=1/6,d=(c+l+u)*h,A=e-(c-d),m=t-(l-d),p=n-(u-d);let f,g,y,v,x,E;A>=m?m>=p?(f=1,g=0,y=0,v=1,x=1,E=0):A>=p?(f=1,g=0,y=0,v=1,x=0,E=1):(f=0,g=0,y=1,v=1,x=0,E=1):m<p?(f=0,g=0,y=1,v=0,x=1,E=1):A<p?(f=0,g=1,y=0,v=0,x=1,E=1):(f=0,g=1,y=0,v=1,x=1,E=0);const w=A-f+h,C=m-g+h,I=p-y+h,_=A-v+2*h,b=m-x+2*h,B=p-E+2*h,M=A-1+.5,S=m-1+.5,D=p-1+.5,T=255&c,Q=255&l,P=255&u,z=this.perm[T+this.perm[Q+this.perm[P]]]%12,R=this.perm[T+f+this.perm[Q+g+this.perm[P+y]]]%12,F=this.perm[T+v+this.perm[Q+x+this.perm[P+E]]]%12,k=this.perm[T+1+this.perm[Q+1+this.perm[P+1]]]%12;let L=.6-A*A-m*m-p*p;L<0?r=0:(L*=L,r=L*L*this.dot3(this.grad3[z],A,m,p));let O=.6-w*w-C*C-I*I;O<0?i=0:(O*=O,i=O*O*this.dot3(this.grad3[R],w,C,I));let U=.6-_*_-b*b-B*B;U<0?o=0:(U*=U,o=U*U*this.dot3(this.grad3[F],_,b,B));let N=.6-M*M-S*S-D*D;return N<0?s=0:(N*=N,s=N*N*this.dot3(this.grad3[k],M,S,D)),32*(r+i+o+s)})),gv(this,"noise4d",((e,t,n,r)=>{const i=this.grad4,o=this.simplex,s=this.perm,a=(Math.sqrt(5)-1)/4,c=(5-Math.sqrt(5))/20;let l,u,h,d,A;const m=(e+t+n+r)*a,p=Math.floor(e+m),f=Math.floor(t+m),g=Math.floor(n+m),y=Math.floor(r+m),v=(p+f+g+y)*c,x=e-(p-v),E=t-(f-v),w=n-(g-v),C=r-(y-v),I=(x>E?32:0)+(x>w?16:0)+(E>w?8:0)+(x>C?4:0)+(E>C?2:0)+(w>C?1:0);let _,b,B,M,S,D,T,Q,P,z,R,F;_=o[I][0]>=3?1:0,b=o[I][1]>=3?1:0,B=o[I][2]>=3?1:0,M=o[I][3]>=3?1:0,S=o[I][0]>=2?1:0,D=o[I][1]>=2?1:0,T=o[I][2]>=2?1:0,Q=o[I][3]>=2?1:0,P=o[I][0]>=1?1:0,z=o[I][1]>=1?1:0,R=o[I][2]>=1?1:0,F=o[I][3]>=1?1:0;const k=x-_+c,L=E-b+c,O=w-B+c,U=C-M+c,N=x-S+2*c,V=E-D+2*c,G=w-T+2*c,j=C-Q+2*c,H=x-P+3*c,q=E-z+3*c,W=w-R+3*c,Y=C-F+3*c,X=x-1+4*c,Z=E-1+4*c,K=w-1+4*c,J=C-1+4*c,$=255&p,ee=255&f,te=255&g,ne=255&y,re=s[$+s[ee+s[te+s[ne]]]]%32,ie=s[$+_+s[ee+b+s[te+B+s[ne+M]]]]%32,oe=s[$+S+s[ee+D+s[te+T+s[ne+Q]]]]%32,se=s[$+P+s[ee+z+s[te+R+s[ne+F]]]]%32,ae=s[$+1+s[ee+1+s[te+1+s[ne+1]]]]%32;let ce=.6-x*x-E*E-w*w-C*C;ce<0?l=0:(ce*=ce,l=ce*ce*this.dot4(i[re],x,E,w,C));let le=.6-k*k-L*L-O*O-U*U;le<0?u=0:(le*=le,u=le*le*this.dot4(i[ie],k,L,O,U));let ue=.6-N*N-V*V-G*G-j*j;ue<0?h=0:(ue*=ue,h=ue*ue*this.dot4(i[oe],N,V,G,j));let he=.6-H*H-q*q-W*W-Y*Y;he<0?d=0:(he*=he,d=he*he*this.dot4(i[se],H,q,W,Y));let de=.6-X*X-Z*Z-K*K-J*J;return de<0?A=0:(de*=de,A=de*de*this.dot4(i[ae],X,Z,K,J)),27*(l+u+h+d+A)}));for(let t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());for(let t=0;t<512;t++)this.perm[t]=this.p[255&t]}}const vv=i.forwardRef((({intensity:e=1,decay:t,decayRate:n=.65,maxYaw:r=.1,maxPitch:o=.1,maxRoll:s=.1,yawFrequency:c=.1,pitchFrequency:l=.1,rollFrequency:u=.1},h)=>{const d=(0,a.D)((e=>e.camera)),A=(0,a.D)((e=>e.controls)),m=i.useRef(e),p=i.useRef(d.rotation.clone()),[f]=i.useState((()=>new yv)),[g]=i.useState((()=>new yv)),[y]=i.useState((()=>new yv)),v=()=>{(m.current<0||m.current>1)&&(m.current=m.current<0?0:1)};return i.useImperativeHandle(h,(()=>({getIntensity:()=>m.current,setIntensity:e=>{m.current=e,v()}})),[]),i.useEffect((()=>{if(A){const e=()=>{p.current=d.rotation.clone()};return A.addEventListener("change",e),e(),()=>{A.removeEventListener("change",e)}}}),[d,A]),(0,a.F)(((e,i)=>{const a=Math.pow(m.current,2),h=r*a*f.noise(e.clock.elapsedTime*c,1),A=o*a*g.noise(e.clock.elapsedTime*l,1),x=s*a*y.noise(e.clock.elapsedTime*u,1);d.rotation.set(p.current.x+A,p.current.y+h,p.current.z+x),t&&m.current>0&&(m.current-=n*i,v())})),null})),xv=i.forwardRef((({children:e,enabled:t=!0,speed:n=1,rotationIntensity:r=1,floatIntensity:o=1,floatingRange:c=[-.1,.1],autoInvalidate:l=!1,...u},h)=>{const d=i.useRef(null);i.useImperativeHandle(h,(()=>d.current),[]);const A=i.useRef(1e4*Math.random());return(0,a.F)((e=>{var i,a;if(!t||0===n)return;l&&e.invalidate();const u=A.current+e.clock.getElapsedTime();d.current.rotation.x=Math.cos(u/4*n)/8*r,d.current.rotation.y=Math.sin(u/4*n)/8*r,d.current.rotation.z=Math.sin(u/4*n)/20*r;let h=Math.sin(u/4*n)/10;h=s.MathUtils.mapLinear(h,-.1,.1,null!==(i=null==c?void 0:c[0])&&void 0!==i?i:-.1,null!==(a=null==c?void 0:c[1])&&void 0!==a?a:.1),d.current.position.y=h*o,d.current.updateMatrix()})),i.createElement("group",u,i.createElement("group",{ref:d,matrixAutoUpdate:!1},e))}));class Ev extends s.Mesh{constructor(e,t){var n,r;const i=(o=e)&&o.isCubeTexture;var o;const a=(null!=(r=i?null==(n=e.image[0])?void 0:n.width:e.image.width)?r:1024)/4,c=Math.floor(Math.log2(a)),l=Math.pow(2,c),u=[i?"#define ENVMAP_TYPE_CUBE":"","#define CUBEUV_TEXEL_WIDTH "+1/(3*Math.max(l,112)),"#define CUBEUV_TEXEL_HEIGHT "+1/(4*l),`#define CUBEUV_MAX_MIP ${c}.0`].join("\n")+`\n        #define ENVMAP_TYPE_CUBE_UV\n        varying vec3 vWorldPosition;\n        uniform float radius;\n        uniform float height;\n        uniform float angle;\n        #ifdef ENVMAP_TYPE_CUBE\n            uniform samplerCube map;\n        #else\n            uniform sampler2D map;\n        #endif\n        // From: https://www.shadertoy.com/view/4tsBD7\n        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) \n        {\n            float d = dot ( rd, n );\n            \n            if( d > 0.0 ) { return 1e6; }\n            \n            vec3  o = ro - c;\n            float t = - dot( n, o ) / d;\n            vec3  q = o + rd * t;\n            \n            return ( dot( q, q ) < r * r ) ? t : 1e6;\n        }\n        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm\n        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) \n        {\n            vec3 oc = ro - ce;\n            float b = dot( oc, rd );\n            float c = dot( oc, oc ) - ra * ra;\n            float h = b * b - c;\n            \n            if( h < 0.0 ) { return -1.0; }\n            \n            h = sqrt( h );\n            \n            return - b + h;\n        }\n        vec3 project() \n        {\n            vec3 p = normalize( vWorldPosition );\n            vec3 camPos = cameraPosition;\n            camPos.y -= height;\n            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );\n            if( intersection > 0.0 ) {\n                \n                vec3 h = vec3( 0.0, - height, 0.0 );\n                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );\n                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;\n            } else {\n                p = vec3( 0.0, 1.0, 0.0 );\n            }\n            return p;\n        }\n        #include <common>\n        #include <cube_uv_reflection_fragment>\n        void main() \n        {\n            vec3 projectedWorldPosition = project();\n            \n            #ifdef ENVMAP_TYPE_CUBE\n                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;\n            #else\n                vec3 direction = normalize( projectedWorldPosition );\n                vec2 uv = equirectUv( direction );\n                vec3 outcolor = texture2D( map, uv ).rgb;\n            #endif\n            gl_FragColor = vec4( outcolor, 1.0 );\n            #include <tonemapping_fragment>\n            #include <${parseInt(s.REVISION.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>\n        }\n        `,h={map:{value:e},height:{value:(null==t?void 0:t.height)||15},radius:{value:(null==t?void 0:t.radius)||100}};super(new s.IcosahedronGeometry(1,16),new s.ShaderMaterial({uniforms:h,fragmentShader:u,vertexShader:"\n        varying vec3 vWorldPosition;\n        void main() \n        {\n            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );\n            vWorldPosition = worldPosition.xyz;\n            \n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n        ",side:s.DoubleSide}))}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}class wv extends s.DataTextureLoader{constructor(e){super(e),this.type=s.HalfFloatType}parse(e){const t=function(e,t){switch(e){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(t||""))}},n=function(e,t,n){t=t||1024;let r=e.pos,i=-1,o=0,s="",a=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));for(;0>(i=a.indexOf("\n"))&&o<t&&r<e.byteLength;)s+=a,o+=a.length,r+=128,a+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));return-1<i&&(!1!==n&&(e.pos+=o+i+1),s+a.slice(0,i))},r=function(e,t,n,r){const i=e[t+3],o=Math.pow(2,i-128)/255;n[r+0]=e[t+0]*o,n[r+1]=e[t+1]*o,n[r+2]=e[t+2]*o,n[r+3]=1},i=function(e,t,n,r){const i=e[t+3],o=Math.pow(2,i-128)/255;n[r+0]=s.DataUtils.toHalfFloat(Math.min(e[t+0]*o,65504)),n[r+1]=s.DataUtils.toHalfFloat(Math.min(e[t+1]*o,65504)),n[r+2]=s.DataUtils.toHalfFloat(Math.min(e[t+2]*o,65504)),n[r+3]=s.DataUtils.toHalfFloat(1)},o=new Uint8Array(e);o.pos=0;const a=function(e){const r=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*FORMAT=(\S+)\s*$/,s=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,a={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let c,l;for((e.pos>=e.byteLength||!(c=n(e)))&&t(1,"no header found"),(l=c.match(/^#\?(\S+)/))||t(3,"bad initial token"),a.valid|=1,a.programtype=l[1],a.string+=c+"\n";c=n(e),!1!==c;)if(a.string+=c+"\n","#"!==c.charAt(0)){if((l=c.match(r))&&(a.gamma=parseFloat(l[1])),(l=c.match(i))&&(a.exposure=parseFloat(l[1])),(l=c.match(o))&&(a.valid|=2,a.format=l[1]),(l=c.match(s))&&(a.valid|=4,a.height=parseInt(l[1],10),a.width=parseInt(l[2],10)),2&a.valid&&4&a.valid)break}else a.comments+=c+"\n";return 2&a.valid||t(3,"missing format specifier"),4&a.valid||t(3,"missing image size specifier"),a}(o),c=a.width,l=a.height,u=function(e,n,r){const i=n;if(i<8||i>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);i!==(e[2]<<8|e[3])&&t(3,"wrong scanline width");const o=new Uint8Array(4*n*r);o.length||t(4,"unable to allocate buffer space");let s=0,a=0;const c=4*i,l=new Uint8Array(4),u=new Uint8Array(c);let h=r;for(;h>0&&a<e.byteLength;){a+4>e.byteLength&&t(1),l[0]=e[a++],l[1]=e[a++],l[2]=e[a++],l[3]=e[a++],2==l[0]&&2==l[1]&&(l[2]<<8|l[3])==i||t(3,"bad rgbe scanline format");let n,r=0;for(;r<c&&a<e.byteLength;){n=e[a++];const i=n>128;if(i&&(n-=128),(0===n||r+n>c)&&t(3,"bad scanline data"),i){const t=e[a++];for(let e=0;e<n;e++)u[r++]=t}else u.set(e.subarray(a,a+n),r),r+=n,a+=n}const d=i;for(let e=0;e<d;e++){let t=0;o[s]=u[e+t],t+=i,o[s+1]=u[e+t],t+=i,o[s+2]=u[e+t],t+=i,o[s+3]=u[e+t],s+=4}h--}return o}(o.subarray(o.pos),c,l);let h,d,A;switch(this.type){case s.FloatType:A=u.length/4;const e=new Float32Array(4*A);for(let n=0;n<A;n++)r(u,4*n,e,4*n);h=e,d=s.FloatType;break;case s.HalfFloatType:A=u.length/4;const t=new Uint16Array(4*A);for(let n=0;n<A;n++)i(u,4*n,t,4*n);h=t,d=s.HalfFloatType;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:c,height:l,data:h,header:a.string,gamma:a.gamma,exposure:a.exposure,type:d}}setDataType(e){return this.type=e,this}load(e,t,n,r){return super.load(e,(function(e,n){switch(e.type){case s.FloatType:case s.HalfFloatType:"colorSpace"in e?e.colorSpace="srgb-linear":e.encoding=3e3,e.minFilter=s.LinearFilter,e.magFilter=s.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,n)}),n,r)}}const Cv="colorSpace"in new s.Texture;class Iv extends s.DataTextureLoader{constructor(e){super(e),this.type=s.HalfFloatType}parse(e){const t=65536,n=14,r=65537,i=16384,o=Math.pow(2.7182818,2.2);const a={l:0,c:0,lc:0};function c(e,t,n,r,i){for(;n<e;)t=t<<8|V(r,i),n+=8;n-=e,a.l=t>>n&(1<<e)-1,a.c=t,a.lc=n}const l=new Array(59);function u(e,t,n,i,o,s,u){for(var h=n,d=0,A=0;o<=s;o++){if(h.value-n.value>i)return!1;c(6,d,A,e,h);var m=a.l;if(d=a.c,A=a.lc,u[o]=m,63==m){if(h.value-n.value>i)throw"Something wrong with hufUnpackEncTable";c(8,d,A,e,h);var p=a.l+6;if(d=a.c,A=a.lc,o+p>s+1)throw"Something wrong with hufUnpackEncTable";for(;p--;)u[o++]=0;o--}else if(m>=59){if(o+(p=m-59+2)>s+1)throw"Something wrong with hufUnpackEncTable";for(;p--;)u[o++]=0;o--}}!function(e){for(var t=0;t<=58;++t)l[t]=0;for(t=0;t<r;++t)l[e[t]]+=1;var n=0;for(t=58;t>0;--t){var i=n+l[t]>>1;l[t]=n,n=i}for(t=0;t<r;++t){var o=e[t];o>0&&(e[t]=o|l[o]++<<6)}}(u)}function h(e){return 63&e}function d(e){return e>>6}const A={c:0,lc:0};function m(e,t,n,r){e=e<<8|V(n,r),t+=8,A.c=e,A.lc=t}const p={c:0,lc:0};function f(e,t,n,r,i,o,s,a,c,l){if(e==t){r<8&&(m(n,r,i,s),n=A.c,r=A.lc);var u=n>>(r-=8);u=new Uint8Array([u])[0];if(c.value+u>l)return!1;for(var h=a[c.value-1];u-- >0;)a[c.value++]=h}else{if(!(c.value<l))return!1;a[c.value++]=e}p.c=n,p.lc=r}function g(e){return 65535&e}function y(e){var t=g(e);return t>32767?t-65536:t}const v={a:0,b:0};function x(e,t){var n=y(e),r=y(t),i=n+(1&r)+(r>>1),o=i,s=i-r;v.a=o,v.b=s}function E(e,t){var n=g(e),r=g(t),i=n-(r>>1)&65535,o=r+i-32768&65535;v.a=o,v.b=i}function w(e,t,n,r,i,o,s){for(var a,c=s<16384,l=n>i?i:n,u=1;u<=l;)u<<=1;for(a=u>>=1,u>>=1;u>=1;){for(var h,d,A,m,p=0,f=p+o*(i-a),g=o*u,y=o*a,w=r*u,C=r*a;p<=f;p+=y){for(var I=p,_=p+r*(n-a);I<=_;I+=C){var b=I+w,B=(M=I+g)+w;c?(x(e[I+t],e[M+t]),h=v.a,A=v.b,x(e[b+t],e[B+t]),d=v.a,m=v.b,x(h,d),e[I+t]=v.a,e[b+t]=v.b,x(A,m),e[M+t]=v.a,e[B+t]=v.b):(E(e[I+t],e[M+t]),h=v.a,A=v.b,E(e[b+t],e[B+t]),d=v.a,m=v.b,E(h,d),e[I+t]=v.a,e[b+t]=v.b,E(A,m),e[M+t]=v.a,e[B+t]=v.b)}if(n&u){var M=I+g;c?x(e[I+t],e[M+t]):E(e[I+t],e[M+t]),h=v.a,e[M+t]=v.b,e[I+t]=h}}if(i&u)for(I=p,_=p+r*(n-a);I<=_;I+=C){b=I+w;c?x(e[I+t],e[b+t]):E(e[I+t],e[b+t]),h=v.a,e[b+t]=v.b,e[I+t]=h}a=u,u>>=1}return p}function C(e,t,o,s,a,c){var l=o.value,g=N(t,o),y=N(t,o);o.value+=4;var v=N(t,o);if(o.value+=4,g<0||g>=r||y<0||y>=r)throw"Something wrong with HUF_ENCSIZE";var x=new Array(r),E=new Array(i);if(function(e){for(var t=0;t<i;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(E),u(e,0,o,s-(o.value-l),g,y,x),v>8*(s-(o.value-l)))throw"Something wrong with hufUncompress";!function(e,t,r,i){for(;t<=r;t++){var o=d(e[t]),s=h(e[t]);if(o>>s)throw"Invalid table entry";if(s>n){if((u=i[o>>s-n]).len)throw"Invalid table entry";if(u.lit++,u.p){var a=u.p;u.p=new Array(u.lit);for(var c=0;c<u.lit-1;++c)u.p[c]=a[c]}else u.p=new Array(1);u.p[u.lit-1]=t}else if(s){var l=0;for(c=1<<n-s;c>0;c--){var u;if((u=i[(o<<n-s)+l]).len||u.p)throw"Invalid table entry";u.len=s,u.lit=t,l++}}}}(x,g,y,E),function(e,t,r,i,o,s,a,c,l,u){for(var g=0,y=0,v=c,x=Math.trunc(o.value+(s+7)/8);o.value<x;)for(m(g,y,r,o),g=A.c,y=A.lc;y>=n;)if((I=t[g>>y-n&16383]).len)y-=I.len,f(I.lit,a,g,y,r,0,o,l,u,v),g=p.c,y=p.lc;else{if(!I.p)throw"hufDecode issues";var E;for(E=0;E<I.lit;E++){for(var w=h(e[I.p[E]]);y<w&&o.value<x;)m(g,y,r,o),g=A.c,y=A.lc;if(y>=w&&d(e[I.p[E]])==(g>>y-w&(1<<w)-1)){y-=w,f(I.p[E],a,g,y,r,0,o,l,u,v),g=p.c,y=p.lc;break}}if(E==I.lit)throw"hufDecode issues"}var C=8-s&7;for(g>>=C,y-=C;y>0;){var I;if(!(I=t[g<<n-y&16383]).len)throw"hufDecode issues";y-=I.len,f(I.lit,a,g,y,r,0,o,l,u,v),g=p.c,y=p.lc}}(x,E,e,0,o,v,y,c,a,{value:0})}function I(e){for(var t=1;t<e.length;t++){var n=e[t-1]+e[t]-128;e[t]=n}}function _(e,t){for(var n=0,r=Math.floor((e.length+1)/2),i=0,o=e.length-1;!(i>o)&&(t[i++]=e[n++],!(i>o));)t[i++]=e[r++]}function b(e){for(var t=e.byteLength,n=new Array,r=0,i=new DataView(e);t>0;){var o=i.getInt8(r++);if(o<0){t-=(a=-o)+1;for(var s=0;s<a;s++)n.push(i.getUint8(r++))}else{var a=o;t-=2;var c=i.getUint8(r++);for(s=0;s<a+1;s++)n.push(c)}}return n}function B(e,t,n){for(var r,i=1;i<64;)65280==(r=t[e.value])?i=64:r>>8==255?i+=255&r:(n[i]=r,i++),e.value++}function M(e,t){t[0]=W(e[0]),t[1]=W(e[1]),t[2]=W(e[5]),t[3]=W(e[6]),t[4]=W(e[14]),t[5]=W(e[15]),t[6]=W(e[27]),t[7]=W(e[28]),t[8]=W(e[2]),t[9]=W(e[4]),t[10]=W(e[7]),t[11]=W(e[13]),t[12]=W(e[16]),t[13]=W(e[26]),t[14]=W(e[29]),t[15]=W(e[42]),t[16]=W(e[3]),t[17]=W(e[8]),t[18]=W(e[12]),t[19]=W(e[17]),t[20]=W(e[25]),t[21]=W(e[30]),t[22]=W(e[41]),t[23]=W(e[43]),t[24]=W(e[9]),t[25]=W(e[11]),t[26]=W(e[18]),t[27]=W(e[24]),t[28]=W(e[31]),t[29]=W(e[40]),t[30]=W(e[44]),t[31]=W(e[53]),t[32]=W(e[10]),t[33]=W(e[19]),t[34]=W(e[23]),t[35]=W(e[32]),t[36]=W(e[39]),t[37]=W(e[45]),t[38]=W(e[52]),t[39]=W(e[54]),t[40]=W(e[20]),t[41]=W(e[22]),t[42]=W(e[33]),t[43]=W(e[38]),t[44]=W(e[46]),t[45]=W(e[51]),t[46]=W(e[55]),t[47]=W(e[60]),t[48]=W(e[21]),t[49]=W(e[34]),t[50]=W(e[37]),t[51]=W(e[47]),t[52]=W(e[50]),t[53]=W(e[56]),t[54]=W(e[59]),t[55]=W(e[61]),t[56]=W(e[35]),t[57]=W(e[36]),t[58]=W(e[48]),t[59]=W(e[49]),t[60]=W(e[57]),t[61]=W(e[58]),t[62]=W(e[62]),t[63]=W(e[63])}function S(e){const t=.5*Math.cos(.7853975),n=.5*Math.cos(3.14159/16),r=.5*Math.cos(3.14159/8),i=.5*Math.cos(3*3.14159/16),o=.5*Math.cos(.981746875),s=.5*Math.cos(3*3.14159/8),a=.5*Math.cos(1.374445625);for(var c=new Array(4),l=new Array(4),u=new Array(4),h=new Array(4),d=0;d<8;++d){var A=8*d;c[0]=r*e[A+2],c[1]=s*e[A+2],c[2]=r*e[A+6],c[3]=s*e[A+6],l[0]=n*e[A+1]+i*e[A+3]+o*e[A+5]+a*e[A+7],l[1]=i*e[A+1]-a*e[A+3]-n*e[A+5]-o*e[A+7],l[2]=o*e[A+1]-n*e[A+3]+a*e[A+5]+i*e[A+7],l[3]=a*e[A+1]-o*e[A+3]+i*e[A+5]-n*e[A+7],u[0]=t*(e[A+0]+e[A+4]),u[3]=t*(e[A+0]-e[A+4]),u[1]=c[0]+c[3],u[2]=c[1]-c[2],h[0]=u[0]+u[1],h[1]=u[3]+u[2],h[2]=u[3]-u[2],h[3]=u[0]-u[1],e[A+0]=h[0]+l[0],e[A+1]=h[1]+l[1],e[A+2]=h[2]+l[2],e[A+3]=h[3]+l[3],e[A+4]=h[3]-l[3],e[A+5]=h[2]-l[2],e[A+6]=h[1]-l[1],e[A+7]=h[0]-l[0]}for(var m=0;m<8;++m)c[0]=r*e[16+m],c[1]=s*e[16+m],c[2]=r*e[48+m],c[3]=s*e[48+m],l[0]=n*e[8+m]+i*e[24+m]+o*e[40+m]+a*e[56+m],l[1]=i*e[8+m]-a*e[24+m]-n*e[40+m]-o*e[56+m],l[2]=o*e[8+m]-n*e[24+m]+a*e[40+m]+i*e[56+m],l[3]=a*e[8+m]-o*e[24+m]+i*e[40+m]-n*e[56+m],u[0]=t*(e[m]+e[32+m]),u[3]=t*(e[m]-e[32+m]),u[1]=c[0]+c[3],u[2]=c[1]-c[2],h[0]=u[0]+u[1],h[1]=u[3]+u[2],h[2]=u[3]-u[2],h[3]=u[0]-u[1],e[0+m]=h[0]+l[0],e[8+m]=h[1]+l[1],e[16+m]=h[2]+l[2],e[24+m]=h[3]+l[3],e[32+m]=h[3]-l[3],e[40+m]=h[2]-l[2],e[48+m]=h[1]-l[1],e[56+m]=h[0]-l[0]}function D(e){for(var t=0;t<64;++t){var n=e[0][t],r=e[1][t],i=e[2][t];e[0][t]=n+1.5747*i,e[1][t]=n-.1873*r-.4682*i,e[2][t]=n+1.8556*r}}function T(e,t,n){for(var r=0;r<64;++r)t[n+r]=s.DataUtils.toHalfFloat(Q(e[r]))}function Q(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(o,Math.abs(e)-1)}function P(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function z(e){var t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),n=new Uint8Array(b(t)),r=new Uint8Array(n.length);return I(n),_(n,r),new DataView(r.buffer)}function R(e){var t=wd(e.array.slice(e.offset.value,e.offset.value+e.size)),n=new Uint8Array(t.length);return I(t),_(t,n),new DataView(n.buffer)}function F(e){for(var n=e.viewer,r={value:e.offset.value},i=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),o=new Uint8Array(8192),s=0,a=new Array(e.channels),c=0;c<e.channels;c++)a[c]={},a[c].start=s,a[c].end=a[c].start,a[c].nx=e.width,a[c].ny=e.lines,a[c].size=e.type,s+=a[c].nx*a[c].ny*a[c].size;var l=Y(n,r),u=Y(n,r);if(u>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(l<=u)for(c=0;c<u-l+1;c++)o[c+l]=G(n,r);var h=new Uint16Array(t),d=function(e,n){for(var r=0,i=0;i<t;++i)(0==i||e[i>>3]&1<<(7&i))&&(n[r++]=i);for(var o=r-1;r<t;)n[r++]=0;return o}(o,h),A=N(n,r);C(e.array,n,r,A,i,s);for(c=0;c<e.channels;++c)for(var m=a[c],p=0;p<a[c].size;++p)w(i,m.start+p,m.nx,m.size,m.ny,m.nx*m.size,d);!function(e,t,n){for(var r=0;r<n;++r)t[r]=e[t[r]]}(h,i,s);for(var f=0,g=new Uint8Array(i.buffer.byteLength),y=0;y<e.lines;y++)for(var v=0;v<e.channels;v++){var x=(m=a[v]).nx*m.size,E=new Uint8Array(i.buffer,2*m.end,2*x);g.set(E,f),f+=2*x,m.end+=x}return new DataView(g.buffer)}function k(e){var t=wd(e.array.slice(e.offset.value,e.offset.value+e.size));const n=e.lines*e.channels*e.width,r=1==e.type?new Uint16Array(n):new Uint32Array(n);let i=0,o=0;const s=new Array(4);for(let a=0;a<e.lines;a++)for(let n=0;n<e.channels;n++){let n=0;switch(e.type){case 1:s[0]=i,s[1]=s[0]+e.width,i=s[1]+e.width;for(let i=0;i<e.width;++i){n+=t[s[0]++]<<8|t[s[1]++],r[o]=n,o++}break;case 2:s[0]=i,s[1]=s[0]+e.width,s[2]=s[1]+e.width,i=s[2]+e.width;for(let i=0;i<e.width;++i){n+=t[s[0]++]<<24|t[s[1]++]<<16|t[s[2]++]<<8,r[o]=n,o++}}}return new DataView(r.buffer)}function L(e){var t=e.viewer,n={value:e.offset.value},r=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),i={version:j(t,n),unknownUncompressedSize:j(t,n),unknownCompressedSize:j(t,n),acCompressedSize:j(t,n),dcCompressedSize:j(t,n),rleCompressedSize:j(t,n),rleUncompressedSize:j(t,n),rleRawSize:j(t,n),totalAcUncompressedCount:j(t,n),totalDcUncompressedCount:j(t,n),acCompression:j(t,n)};if(i.version<2)throw"EXRLoader.parse: "+ee.compression+" version "+i.version+" is unsupported";for(var o=new Array,s=Y(t,n)-2;s>0;){var a=O(t.buffer,n),c=G(t,n),l=c>>2&3,u=new Int8Array([(c>>4)-1])[0],h=G(t,n);o.push({name:a,index:u,type:h,compression:l}),s-=a.length+3}for(var d=ee.channels,A=new Array(e.channels),m=0;m<e.channels;++m){var p=A[m]={},f=d[m];p.name=f.name,p.compression=0,p.decoded=!1,p.type=f.pixelType,p.pLinear=f.pLinear,p.width=e.width,p.height=e.lines}for(var g={idx:new Array(3)},y=0;y<e.channels;++y)for(p=A[y],m=0;m<o.length;++m){var v=o[m];p.name==v.name&&(p.compression=v.compression,v.index>=0&&(g.idx[v.index]=y),p.offset=y)}if(i.acCompressedSize>0)switch(i.acCompression){case 0:var x=new Uint16Array(i.totalAcUncompressedCount);C(e.array,t,n,i.acCompressedSize,x,i.totalAcUncompressedCount);break;case 1:var E=wd(e.array.slice(n.value,n.value+i.totalAcUncompressedCount));x=new Uint16Array(E.buffer);n.value+=i.totalAcUncompressedCount}if(i.dcCompressedSize>0){var w={array:e.array,offset:n,size:i.dcCompressedSize},I=new Uint16Array(R(w).buffer);n.value+=i.dcCompressedSize}if(i.rleRawSize>0){var _=b((E=wd(e.array.slice(n.value,n.value+i.rleCompressedSize))).buffer);n.value+=i.rleCompressedSize}var Q=0,P=new Array(A.length);for(m=0;m<P.length;++m)P[m]=new Array;for(var z=0;z<e.lines;++z)for(var F=0;F<A.length;++F)P[F].push(Q),Q+=A[F].width*e.type*2;!function(e,t,n,r,i,o){var s=new DataView(o.buffer),a=n[e.idx[0]].width,c=n[e.idx[0]].height,l=Math.floor(a/8),u=Math.ceil(a/8),h=Math.ceil(c/8),d=a-8*(u-1),A=c-8*(h-1),m={value:0},p=new Array(3),f=new Array(3),g=new Array(3),y=new Array(3),v=new Array(3);for(let B=0;B<3;++B)v[B]=t[e.idx[B]],p[B]=B<1?0:p[B-1]+u*h,f[B]=new Float32Array(64),g[B]=new Uint16Array(64),y[B]=new Uint16Array(64*u);for(let Q=0;Q<h;++Q){var x=8;Q==h-1&&(x=A);var E=8;for(let e=0;e<u;++e){e==u-1&&(E=d);for(let e=0;e<3;++e)g[e].fill(0),g[e][0]=i[p[e]++],B(m,r,g[e]),M(g[e],f[e]),S(f[e]);D(f);for(let t=0;t<3;++t)T(f[t],y[t],64*e)}let t=0;for(let r=0;r<3;++r){const i=n[e.idx[r]].type;for(let e=8*Q;e<8*Q+x;++e){t=v[r][e];for(let n=0;n<l;++n){const o=64*n+8*(7&e);s.setUint16(t+0*i,y[r][o+0],!0),s.setUint16(t+2*i,y[r][o+1],!0),s.setUint16(t+4*i,y[r][o+2],!0),s.setUint16(t+6*i,y[r][o+3],!0),s.setUint16(t+8*i,y[r][o+4],!0),s.setUint16(t+10*i,y[r][o+5],!0),s.setUint16(t+12*i,y[r][o+6],!0),s.setUint16(t+14*i,y[r][o+7],!0),t+=16*i}}if(l!=u)for(let e=8*Q;e<8*Q+x;++e){const t=v[r][e]+8*l*2*i,n=64*l+8*(7&e);for(let e=0;e<E;++e)s.setUint16(t+2*e*i,y[r][n+e],!0)}}}for(var w=new Uint16Array(a),C=(s=new DataView(o.buffer),0);C<3;++C){n[e.idx[C]].decoded=!0;var I=n[e.idx[C]].type;if(2==n[C].type)for(var _=0;_<c;++_){const e=v[C][_];for(var b=0;b<a;++b)w[b]=s.getUint16(e+2*b*I,!0);for(b=0;b<a;++b)s.setFloat32(e+2*b*I,W(w[b]),!0)}}}(g,P,A,x,I,r);for(m=0;m<A.length;++m){if(!(p=A[m]).decoded){if(2!==p.compression)throw"EXRLoader.parse: unsupported channel compression";var k=0,L=0;for(z=0;z<e.lines;++z){for(var U=P[m][k],N=0;N<p.width;++N){for(var V=0;V<2*p.type;++V)r[U++]=_[L+V*p.width*p.height];L++}k++}}}return new DataView(r.buffer)}function O(e,t){for(var n=new Uint8Array(e),r=0;0!=n[t.value+r];)r+=1;var i=(new TextDecoder).decode(n.slice(t.value,t.value+r));return t.value=t.value+r+1,i}function U(e,t){var n=e.getInt32(t.value,!0);return t.value=t.value+4,n}function N(e,t){var n=e.getUint32(t.value,!0);return t.value=t.value+4,n}function V(e,t){var n=e[t.value];return t.value=t.value+1,n}function G(e,t){var n=e.getUint8(t.value);return t.value=t.value+1,n}const j=function(e,t){let n;return n="getBigInt64"in DataView.prototype?Number(e.getBigInt64(t.value,!0)):e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,n};function H(e,t){var n=e.getFloat32(t.value,!0);return t.value+=4,n}function q(e,t){return s.DataUtils.toHalfFloat(H(e,t))}function W(e){var t=(31744&e)>>10,n=1023&e;return(e>>15?-1:1)*(t?31===t?n?NaN:1/0:Math.pow(2,t-15)*(1+n/1024):n/1024*6103515625e-14)}function Y(e,t){var n=e.getUint16(t.value,!0);return t.value+=2,n}function X(e,t){return W(Y(e,t))}function Z(e,t,n,r,i){return"string"===r||"stringvector"===r||"iccProfile"===r?function(e,t,n){var r=(new TextDecoder).decode(new Uint8Array(e).slice(t.value,t.value+n));return t.value=t.value+n,r}(t,n,i):"chlist"===r?function(e,t,n,r){for(var i=n.value,o=[];n.value<i+r-1;){var s=O(t,n),a=U(e,n),c=G(e,n);n.value+=3;var l=U(e,n),u=U(e,n);o.push({name:s,pixelType:a,pLinear:c,xSampling:l,ySampling:u})}return n.value+=1,o}(e,t,n,i):"chromaticities"===r?function(e,t){return{redX:H(e,t),redY:H(e,t),greenX:H(e,t),greenY:H(e,t),blueX:H(e,t),blueY:H(e,t),whiteX:H(e,t),whiteY:H(e,t)}}(e,n):"compression"===r?function(e,t){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][G(e,t)]}(e,n):"box2i"===r?function(e,t){return{xMin:N(e,t),yMin:N(e,t),xMax:N(e,t),yMax:N(e,t)}}(e,n):"lineOrder"===r?function(e,t){return["INCREASING_Y"][G(e,t)]}(e,n):"float"===r?H(e,n):"v2f"===r?function(e,t){return[H(e,t),H(e,t)]}(e,n):"v3f"===r?function(e,t){return[H(e,t),H(e,t),H(e,t)]}(e,n):"int"===r?U(e,n):"rational"===r?function(e,t){return[U(e,t),N(e,t)]}(e,n):"timecode"===r?function(e,t){return[N(e,t),N(e,t)]}(e,n):"preview"===r?(n.value+=i,"skipped"):void(n.value+=i)}const K=new DataView(e),J=new Uint8Array(e),$={value:0},ee=function(e,t,n){const r={};if(20000630!=e.getUint32(0,!0))throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";r.version=e.getUint8(4);const i=e.getUint8(5);r.spec={singleTile:!!(2&i),longName:!!(4&i),deepFormat:!!(8&i),multiPart:!!(16&i)},n.value=8;for(var o=!0;o;){var s=O(t,n);if(0==s)o=!1;else{var a=O(t,n),c=Z(e,t,n,a,N(e,n));void 0===c?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${a}'.`):r[s]=c}}if(0!=(-5&i))throw console.error("EXRHeader:",r),"THREE.EXRLoader: provided file is currently unsupported.";return r}(K,e,$),te=function(e,t,n,r,i){const o={size:0,viewer:t,array:n,offset:r,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[Cv?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":o.lines=1,o.uncompress=P;break;case"RLE_COMPRESSION":o.lines=1,o.uncompress=z;break;case"ZIPS_COMPRESSION":o.lines=1,o.uncompress=R;break;case"ZIP_COMPRESSION":o.lines=16,o.uncompress=R;break;case"PIZ_COMPRESSION":o.lines=32,o.uncompress=F;break;case"PXR24_COMPRESSION":o.lines=16,o.uncompress=k;break;case"DWAA_COMPRESSION":o.lines=32,o.uncompress=L;break;case"DWAB_COMPRESSION":o.lines=256,o.uncompress=L;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(o.scanlineBlockSize=o.lines,1==o.type)switch(i){case s.FloatType:o.getter=X,o.inputSize=2;break;case s.HalfFloatType:o.getter=Y,o.inputSize=2}else{if(2!=o.type)throw"EXRLoader.parse: unsupported pixelType "+o.type+" for "+e.compression+".";switch(i){case s.FloatType:o.getter=H,o.inputSize=4;break;case s.HalfFloatType:o.getter=q,o.inputSize=4}}o.blockCount=(e.dataWindow.yMax+1)/o.scanlineBlockSize;for(var a=0;a<o.blockCount;a++)j(t,r);o.outputChannels=3==o.channels?4:o.channels;const c=o.width*o.height*o.outputChannels;switch(i){case s.FloatType:o.byteArray=new Float32Array(c),o.channels<o.outputChannels&&o.byteArray.fill(1,0,c);break;case s.HalfFloatType:o.byteArray=new Uint16Array(c),o.channels<o.outputChannels&&o.byteArray.fill(15360,0,c);break;default:console.error("THREE.EXRLoader: unsupported type: ",i)}return o.bytesPerLine=o.width*o.inputSize*o.channels,4==o.outputChannels?o.format=s.RGBAFormat:o.format=s.RedFormat,Cv?o.colorSpace="srgb-linear":o.encoding=3e3,o}(ee,K,J,$,this.type),ne={value:0},re={R:0,G:1,B:2,A:3,Y:0};for(let s=0;s<te.height/te.scanlineBlockSize;s++){const e=N(K,$);te.size=N(K,$),te.lines=e+te.scanlineBlockSize>te.height?te.height-e:te.scanlineBlockSize;const t=te.size<te.lines*te.bytesPerLine?te.uncompress(te):P(te);$.value+=te.size;for(let n=0;n<te.scanlineBlockSize;n++){const e=n+s*te.scanlineBlockSize;if(e>=te.height)break;for(let r=0;r<te.channels;r++){const i=re[ee.channels[r].name];for(let o=0;o<te.width;o++){ne.value=(n*(te.channels*te.width)+r*te.width+o)*te.inputSize;const s=(te.height-1-e)*(te.width*te.outputChannels)+o*te.outputChannels+i;te.byteArray[s]=te.getter(t,ne)}}}}return{header:ee,width:te.width,height:te.height,data:te.byteArray,format:te.format,[Cv?"colorSpace":"encoding"]:te[Cv?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,n,r){return super.load(e,(function(e,n){Cv?e.colorSpace=n.colorSpace:e.encoding=n.encoding,e.minFilter=s.LinearFilter,e.magFilter=s.LinearFilter,e.generateMipmaps=!1,e.flipY=!1,t&&t(e,n)}),n,r)}}const _v=(e,t,n)=>{let r;switch(e){case s.UnsignedByteType:r=new Uint8ClampedArray(t*n*4);break;case s.HalfFloatType:r=new Uint16Array(t*n*4);break;case s.UnsignedIntType:r=new Uint32Array(t*n*4);break;case s.ByteType:r=new Int8Array(t*n*4);break;case s.ShortType:r=new Int16Array(t*n*4);break;case s.IntType:r=new Int32Array(t*n*4);break;case s.FloatType:r=new Float32Array(t*n*4);break;default:throw new Error("Unsupported data type")}return r};let bv;class Bv{constructor(e){var t,n,r,i,o,a,c,l,u,h,d,A,m,p,f,g;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(lm){throw this._renderer.setRenderTarget(null),lm}this._renderer.setRenderTarget(null)},this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const y={format:s.RGBAFormat,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:void 0!==(null===(t=e.renderTargetOptions)||void 0===t?void 0:t.anisotropy)?null===(n=e.renderTargetOptions)||void 0===n?void 0:n.anisotropy:1,generateMipmaps:void 0!==(null===(r=e.renderTargetOptions)||void 0===r?void 0:r.generateMipmaps)&&(null===(i=e.renderTargetOptions)||void 0===i?void 0:i.generateMipmaps),magFilter:void 0!==(null===(o=e.renderTargetOptions)||void 0===o?void 0:o.magFilter)?null===(a=e.renderTargetOptions)||void 0===a?void 0:a.magFilter:s.LinearFilter,minFilter:void 0!==(null===(c=e.renderTargetOptions)||void 0===c?void 0:c.minFilter)?null===(l=e.renderTargetOptions)||void 0===l?void 0:l.minFilter:s.LinearFilter,samples:void 0!==(null===(u=e.renderTargetOptions)||void 0===u?void 0:u.samples)?null===(h=e.renderTargetOptions)||void 0===h?void 0:h.samples:void 0,wrapS:void 0!==(null===(d=e.renderTargetOptions)||void 0===d?void 0:d.wrapS)?null===(A=e.renderTargetOptions)||void 0===A?void 0:A.wrapS:s.ClampToEdgeWrapping,wrapT:void 0!==(null===(m=e.renderTargetOptions)||void 0===m?void 0:m.wrapT)?null===(p=e.renderTargetOptions)||void 0===p?void 0:p.wrapT:s.ClampToEdgeWrapping};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=Bv.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new s.Scene,this._camera=new s.OrthographicCamera,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!((e,t,n,r)=>{if(void 0!==bv)return bv;const i=new s.WebGLRenderTarget(1,1,r);t.setRenderTarget(i);const o=new s.Mesh(new s.PlaneGeometry,new s.MeshBasicMaterial({color:16777215}));t.render(o,n),t.setRenderTarget(null);const a=_v(e,i.width,i.height);return t.readRenderTargetPixels(i,0,0,i.width,i.height,a),i.dispose(),o.geometry.dispose(),o.material.dispose(),bv=0!==a[0],bv})(this._type,this._renderer,this._camera,y)){let e;if(this._type===s.HalfFloatType)e=this._renderer.extensions.has("EXT_color_buffer_float")?s.FloatType:void 0;void 0!==e?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${s.FloatType}`),this._type=e):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new s.Mesh(new s.PlaneGeometry,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new s.WebGLRenderTarget(this.width,this.height,y),this._renderTarget.texture.mapping=void 0!==(null===(f=e.renderTargetOptions)||void 0===f?void 0:f.mapping)?null===(g=e.renderTargetOptions)||void 0===g?void 0:g.mapping:s.UVMapping}static instantiateRenderer(){const e=new s.WebGLRenderer;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=_v(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const t=new s.DataTexture(this.toArray(),this.width,this.height,s.RGBAFormat,this._type,(null===e||void 0===e?void 0:e.mapping)||s.UVMapping,(null===e||void 0===e?void 0:e.wrapS)||s.ClampToEdgeWrapping,(null===e||void 0===e?void 0:e.wrapT)||s.ClampToEdgeWrapping,(null===e||void 0===e?void 0:e.magFilter)||s.LinearFilter,(null===e||void 0===e?void 0:e.minFilter)||s.LinearFilter,(null===e||void 0===e?void 0:e.anisotropy)||1,s.LinearSRGBColorSpace);return t.generateMipmaps=void 0!==(null===e||void 0===e?void 0:e.generateMipmaps)&&(null===e||void 0===e?void 0:e.generateMipmaps),t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof s.ShaderMaterial&&Object.values(this.material.uniforms).forEach((e=>{e.value instanceof s.Texture&&e.value.dispose()})),Object.values(this.material).forEach((e=>{e instanceof s.Texture&&e.dispose()})),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}class Mv extends s.ShaderMaterial{constructor({gamma:e,offsetHdr:t,offsetSdr:n,gainMapMin:r,gainMapMax:i,maxDisplayBoost:o,hdrCapacityMin:a,hdrCapacityMax:c,sdr:l,gainMap:u}){super({name:"GainMapDecoderMaterial",vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"\n// min half float value\n#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )\n// max half float value\n#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )\n\nuniform sampler2D sdr;\nuniform sampler2D gainMap;\nuniform vec3 gamma;\nuniform vec3 offsetHdr;\nuniform vec3 offsetSdr;\nuniform vec3 gainMapMin;\nuniform vec3 gainMapMax;\nuniform float weightFactor;\n\nvarying vec2 vUv;\n\nvoid main() {\n  vec3 rgb = texture2D( sdr, vUv ).rgb;\n  vec3 recovery = texture2D( gainMap, vUv ).rgb;\n  vec3 logRecovery = pow( recovery, gamma );\n  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;\n  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;\n  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));\n  gl_FragColor = vec4( clampedHdrColor , 1.0 );\n}\n",uniforms:{sdr:{value:l},gainMap:{value:u},gamma:{value:new s.Vector3(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:(new s.Vector3).fromArray(t)},offsetSdr:{value:(new s.Vector3).fromArray(n)},gainMapMin:{value:(new s.Vector3).fromArray(r)},gainMapMax:{value:(new s.Vector3).fromArray(i)},weightFactor:{value:(Math.log2(o)-a)/(c-a)}},blending:s.NoBlending,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=o,this._hdrCapacityMin=a,this._hdrCapacityMax=c,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){const e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){const t=this.uniforms.gamma.value;t.x=1/e[0],t.y=1/e[1],t.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){const e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class Sv extends Error{}class Dv extends Error{}const Tv=(e,t,n)=>{var r;let i;const o=null===(r=e.attributes.getNamedItem(t))||void 0===r?void 0:r.nodeValue;if(o)i=o;else{const r=e.getElementsByTagName(t)[0];if(!r){if(n)return n;throw new Error(`Can't find ${t} in gainmap metadata`)}{const e=r.getElementsByTagName("rdf:li");if(3!==e.length)throw new Error(`Gainmap metadata contains an array of items for ${t} but its length is not 3`);i=Array.from(e).map((e=>e.innerHTML))}}return i};class Qv{constructor(e){this.options={debug:!(!e||void 0===e.debug)&&e.debug,extractFII:!e||void 0===e.extractFII||e.extractFII,extractNonFII:!e||void 0===e.extractNonFII||e.extractNonFII}}extract(e){return new Promise(((t,n)=>{const r=this.options.debug,i=new DataView(e.buffer);if(65496!==i.getUint16(0))return void n(new Error("Not a valid jpeg"));const o=i.byteLength;let s,a=2,c=0;for(;a<o;){if(++c>250)return void n(new Error(`Found no marker after ${c} loops \ud83d\ude35`));if(255!==i.getUint8(a))return void n(new Error(`Not a valid marker at offset 0x${a.toString(16)}, found: 0x${i.getUint8(a).toString(16)}`));if(s=i.getUint8(a+1),r&&console.log(`Marker: ${s.toString(16)}`),226===s){r&&console.log("Found APP2 marker (0xffe2)");const e=a+4;if(1297106432===i.getUint32(e)){const r=e+4;let o;if(18761===i.getUint16(r))o=!1;else{if(19789!==i.getUint16(r))return void n(new Error("No valid endianness marker found in TIFF header"));o=!0}if(42!==i.getUint16(r+2,!o))return void n(new Error("Not valid TIFF data! (no 0x002A marker)"));const s=i.getUint32(r+4,!o);if(s<8)return void n(new Error("Not valid TIFF data! (First offset less than 8)"));const a=r+s,c=i.getUint16(a,!o),l=a+2;let u=0;for(let e=l;e<l+12*c;e+=12)45057===i.getUint16(e,!o)&&(u=i.getUint32(e+8,!o));const h=a+2+12*c+4,d=[];for(let e=h;e<h+16*u;e+=16){const t={MPType:i.getUint32(e,!o),size:i.getUint32(e+4,!o),dataOffset:i.getUint32(e+8,!o),dependantImages:i.getUint32(e+12,!o),start:-1,end:-1,isFII:!1};t.dataOffset?(t.start=r+t.dataOffset,t.isFII=!1):(t.start=0,t.isFII=!0),t.end=t.start+t.size,d.push(t)}if(this.options.extractNonFII&&d.length){const e=new Blob([i]),n=[];for(const t of d){if(t.isFII&&!this.options.extractFII)continue;const r=e.slice(t.start,t.end+1,"image/jpeg");n.push(r)}t(n)}}}a+=2+i.getUint16(a+2)}}))}}const Pv=async e=>{const t=(e=>{var t,n;let r;r="undefined"!==typeof TextDecoder?(new TextDecoder).decode(e):e.toString();let i=r.indexOf("<x:xmpmeta");const o=new DOMParser;for(;-1!==i;){const e=r.indexOf("x:xmpmeta>",i);r.slice(i,e+10);const s=r.slice(i,e+10);try{const e=o.parseFromString(s,"text/xml").getElementsByTagName("rdf:Description")[0],r=Tv(e,"hdrgm:GainMapMin","0"),i=Tv(e,"hdrgm:GainMapMax"),a=Tv(e,"hdrgm:Gamma","1"),c=Tv(e,"hdrgm:OffsetSDR","0.015625"),l=Tv(e,"hdrgm:OffsetHDR","0.015625");let u=null===(t=e.attributes.getNamedItem("hdrgm:HDRCapacityMin"))||void 0===t?void 0:t.nodeValue;u||(u="0");const h=null===(n=e.attributes.getNamedItem("hdrgm:HDRCapacityMax"))||void 0===n?void 0:n.nodeValue;if(!h)throw new Error("Incomplete gainmap metadata");return{gainMapMin:Array.isArray(r)?r.map((e=>parseFloat(e))):[parseFloat(r),parseFloat(r),parseFloat(r)],gainMapMax:Array.isArray(i)?i.map((e=>parseFloat(e))):[parseFloat(i),parseFloat(i),parseFloat(i)],gamma:Array.isArray(a)?a.map((e=>parseFloat(e))):[parseFloat(a),parseFloat(a),parseFloat(a)],offsetSdr:Array.isArray(c)?c.map((e=>parseFloat(e))):[parseFloat(c),parseFloat(c),parseFloat(c)],offsetHdr:Array.isArray(l)?l.map((e=>parseFloat(e))):[parseFloat(l),parseFloat(l),parseFloat(l)],hdrCapacityMin:parseFloat(u),hdrCapacityMax:parseFloat(h)}}catch(lm){}i=r.indexOf("<x:xmpmeta",e)}})(e);if(!t)throw new Dv("Gain map XMP metadata not found");const n=new Qv({extractFII:!0,extractNonFII:!0}),r=await n.extract(e);if(2!==r.length)throw new Sv("Gain map recovery image not found");return{sdr:new Uint8Array(await r[0].arrayBuffer()),gainMap:new Uint8Array(await r[1].arrayBuffer()),metadata:t}},zv=e=>new Promise(((t,n)=>{const r=document.createElement("img");r.onload=()=>{t(r)},r.onerror=e=>{n(e)},r.src=URL.createObjectURL(e)}));class Rv extends s.Loader{constructor(e,t){super(t),e&&(this._renderer=e),this._internalLoadingManager=new s.LoadingManager}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const e=new Mv({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new s.Texture,sdr:new s.Texture});return new Bv({width:16,height:16,type:s.HalfFloatType,colorSpace:s.LinearSRGBColorSpace,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(e,t,n,r){const i=r?new Blob([r],{type:"image/jpeg"}):void 0,o=new Blob([n],{type:"image/jpeg"});let a,c,l=!1;if("undefined"===typeof createImageBitmap){const e=await Promise.all([i?zv(i):Promise.resolve(void 0),zv(o)]);c=e[0],a=e[1],l=!0}else{const e=await Promise.all([i?createImageBitmap(i,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(o,{imageOrientation:"flipY"})]);c=e[0],a=e[1]}const u=new s.Texture(c||new ImageData(2,2),s.UVMapping,s.ClampToEdgeWrapping,s.ClampToEdgeWrapping,s.LinearFilter,s.LinearMipMapLinearFilter,s.RGBAFormat,s.UnsignedByteType,1,s.LinearSRGBColorSpace);u.flipY=l,u.needsUpdate=!0;const h=new s.Texture(a,s.UVMapping,s.ClampToEdgeWrapping,s.ClampToEdgeWrapping,s.LinearFilter,s.LinearMipMapLinearFilter,s.RGBAFormat,s.UnsignedByteType,1,s.SRGBColorSpace);h.flipY=l,h.needsUpdate=!0,e.width=a.width,e.height=a.height,e.material.gainMap=u,e.material.sdr=h,e.material.gainMapMin=t.gainMapMin,e.material.gainMapMax=t.gainMapMax,e.material.offsetHdr=t.offsetHdr,e.material.offsetSdr=t.offsetSdr,e.material.gamma=t.gamma,e.material.hdrCapacityMin=t.hdrCapacityMin,e.material.hdrCapacityMax=t.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,t.hdrCapacityMax),e.material.needsUpdate=!0,e.render()}}class Fv extends Rv{load([e,t,n],r,i,o){const a=this.prepareQuadRenderer();let c,l,u;const h=async()=>{if(c&&l&&u){try{await this.render(a,u,c,l)}catch(i){return this.manager.itemError(e),this.manager.itemError(t),this.manager.itemError(n),"function"===typeof o&&o(i),void a.disposeOnDemandRenderer()}"function"===typeof r&&r(a),this.manager.itemEnd(e),this.manager.itemEnd(t),this.manager.itemEnd(n),a.disposeOnDemandRenderer()}};let d=!0,A=0,m=0,p=!0,f=0,g=0,y=!0,v=0,x=0;const E=()=>{if("function"===typeof i){i(new ProgressEvent("progress",{lengthComputable:d&&p&&y,loaded:m+g+x,total:A+f+v}))}};this.manager.itemStart(e),this.manager.itemStart(t),this.manager.itemStart(n);const w=new s.FileLoader(this._internalLoadingManager);w.setResponseType("arraybuffer"),w.setRequestHeader(this.requestHeader),w.setPath(this.path),w.setWithCredentials(this.withCredentials),w.load(e,(async e=>{if("string"===typeof e)throw new Error("Invalid sdr buffer");c=e,await h()}),(e=>{d=e.lengthComputable,m=e.loaded,A=e.total,E()}),(t=>{this.manager.itemError(e),"function"===typeof o&&o(t)}));const C=new s.FileLoader(this._internalLoadingManager);C.setResponseType("arraybuffer"),C.setRequestHeader(this.requestHeader),C.setPath(this.path),C.setWithCredentials(this.withCredentials),C.load(t,(async e=>{if("string"===typeof e)throw new Error("Invalid gainmap buffer");l=e,await h()}),(e=>{p=e.lengthComputable,g=e.loaded,f=e.total,E()}),(e=>{this.manager.itemError(t),"function"===typeof o&&o(e)}));const I=new s.FileLoader(this._internalLoadingManager);return I.setRequestHeader(this.requestHeader),I.setPath(this.path),I.setWithCredentials(this.withCredentials),I.load(n,(async e=>{if("string"!==typeof e)throw new Error("Invalid metadata string");u=JSON.parse(e),await h()}),(e=>{y=e.lengthComputable,x=e.loaded,v=e.total,E()}),(e=>{this.manager.itemError(n),"function"===typeof o&&o(e)})),a}}class kv extends Rv{load(e,t,n,r){const i=this.prepareQuadRenderer(),o=new s.FileLoader(this._internalLoadingManager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(this.withCredentials),this.manager.itemStart(e),o.load(e,(async n=>{if("string"===typeof n)throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const o=new Uint8Array(n);let s,a,c;try{const e=await Pv(o);s=e.sdr,a=e.gainMap,c=e.metadata}catch(lm){if(!(lm instanceof Dv||lm instanceof Sv))throw lm;console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),c={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},s=o}try{await this.render(i,c,s,a)}catch(l){return this.manager.itemError(e),"function"===typeof r&&r(l),void i.disposeOnDemandRenderer()}"function"===typeof t&&t(i),this.manager.itemEnd(e),i.disposeOnDemandRenderer()}),n,(t=>{this.manager.itemError(e),"function"===typeof r&&r(t)})),i}}const Lv={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},Ov="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",Uv=e=>Array.isArray(e),Nv=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function Vv({files:e=Nv,path:t="",preset:n,encoding:r,extensions:o}={}){let c=null,l=!1;n&&(Hv(n),e=Lv[n],t=Ov),l=Uv(e);const{extension:u,isCubemap:h}=qv(e);if(c=Wv(u),!c)throw new Error("useEnvironment: Unrecognized file extension: "+e);const d=(0,a.D)((e=>e.gl));(0,i.useLayoutEffect)((()=>{"webp"!==u&&"jpg"!==u&&"jpeg"!==u||d.domElement.addEventListener("webglcontextlost",(function(){a.H.clear(c,l?[e]:e)}),{once:!0})}),[e,d.domElement]);const A=(0,a.H)(c,l?[e]:e,(e=>{"webp"!==u&&"jpg"!==u&&"jpeg"!==u||e.setRenderer(d),null==e.setPath||e.setPath(t),o&&o(e)}));let m=l?A[0]:A;var p;"jpg"!==u&&"jpeg"!==u&&"webp"!==u||(m=null==(p=m.renderTarget)?void 0:p.texture);return m.mapping=h?s.CubeReflectionMapping:s.EquirectangularReflectionMapping,"colorSpace"in m?m.colorSpace=(null!==r&&void 0!==r?r:h)?"srgb":"srgb-linear":m.encoding=(null!==r&&void 0!==r?r:h)?Og:Lg,m}const Gv={files:Nv,path:"",preset:void 0,extensions:void 0};Vv.preload=e=>{const t={...Gv,...e};let{files:n,path:r=""}=t;const{preset:i,extensions:o}=t;i&&(Hv(i),n=Lv[i],r=Ov);const{extension:s}=qv(n);if("webp"===s||"jpg"===s||"jpeg"===s)throw new Error("useEnvironment: Preloading gainmaps is not supported");const c=Wv(s);if(!c)throw new Error("useEnvironment: Unrecognized file extension: "+n);a.H.preload(c,Uv(n)?[n]:n,(e=>{null==e.setPath||e.setPath(r),o&&o(e)}))};const jv={files:Nv,preset:void 0};function Hv(e){if(!(e in Lv))throw new Error("Preset must be one of: "+Object.keys(Lv).join(", "))}function qv(e){var t;const n=Uv(e)&&6===e.length,r=Uv(e)&&3===e.length&&e.some((e=>e.endsWith("json"))),i=Uv(e)?e[0]:e;return{extension:n?"cube":r?"webp":i.startsWith("data:application/exr")?"exr":i.startsWith("data:application/hdr")?"hdr":i.startsWith("data:image/jpeg")?"jpg":null==(t=i.split(".").pop())||null==(t=t.split("?"))||null==(t=t.shift())?void 0:t.toLowerCase(),isCubemap:n,isGainmap:r}}function Wv(e){return"cube"===e?s.CubeTextureLoader:"hdr"===e?wv:"exr"===e?Iv:"jpg"===e||"jpeg"===e?kv:"webp"===e?Fv:null}Vv.clear=e=>{const t={...jv,...e};let{files:n}=t;const{preset:r}=t;r&&(Hv(r),n=Lv[r]);const{extension:i}=qv(n),o=Wv(i);if(!o)throw new Error("useEnvironment: Unrecognized file extension: "+n);a.H.clear(o,Uv(n)?[n]:n)};const Yv=e=>{return(t=e).current&&t.current.isScene?e.current:e;var t};function Xv(e,t,n,r,i={}){var o,s,c,l,u;i={backgroundBlurriness:null!==(o=i.blur)&&void 0!==o?o:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...i};const h=Yv(t||n),d=h.background,A=h.environment,m={backgroundBlurriness:h.backgroundBlurriness,backgroundIntensity:h.backgroundIntensity,backgroundRotation:null!==(s=null==(c=h.backgroundRotation)||null==c.clone?void 0:c.clone())&&void 0!==s?s:[0,0,0],environmentIntensity:h.environmentIntensity,environmentRotation:null!==(l=null==(u=h.environmentRotation)||null==u.clone?void 0:u.clone())&&void 0!==l?l:[0,0,0]};return"only"!==e&&(h.environment=r),e&&(h.background=r),(0,a.k)(h,i),()=>{"only"!==e&&(h.environment=A),e&&(h.background=d),(0,a.k)(h,m)}}function Zv({scene:e,background:t=!1,map:n,...r}){const o=(0,a.D)((e=>e.scene));return i.useLayoutEffect((()=>{if(n)return Xv(t,e,o,n,r)})),null}function Kv({background:e=!1,scene:t,blur:n,backgroundBlurriness:r,backgroundIntensity:o,backgroundRotation:s,environmentIntensity:c,environmentRotation:l,...u}){const h=Vv(u),d=(0,a.D)((e=>e.scene));return i.useLayoutEffect((()=>Xv(e,t,d,h,{blur:n,backgroundBlurriness:r,backgroundIntensity:o,backgroundRotation:s,environmentIntensity:c,environmentRotation:l}))),null}function Jv({children:e,near:t=1,far:n=1e3,resolution:r=256,frames:o=1,map:c,background:l=!1,blur:u,backgroundBlurriness:h,backgroundIntensity:d,backgroundRotation:A,environmentIntensity:m,environmentRotation:p,scene:f,files:g,path:y,preset:v,extensions:x}){const E=(0,a.D)((e=>e.gl)),w=(0,a.D)((e=>e.scene)),C=i.useRef(null),[I]=i.useState((()=>new s.Scene)),_=i.useMemo((()=>{const e=new s.WebGLCubeRenderTarget(r);return e.texture.type=s.HalfFloatType,e}),[r]);i.useLayoutEffect((()=>(1===o&&C.current.update(E,I),Xv(l,f,w,_.texture,{blur:u,backgroundBlurriness:h,backgroundIntensity:d,backgroundRotation:A,environmentIntensity:m,environmentRotation:p}))),[e,I,_.texture,f,w,l,o,E]);let b=1;return(0,a.F)((()=>{(o===1/0||b<o)&&(C.current.update(E,I),b++)})),i.createElement(i.Fragment,null,(0,a.h)(i.createElement(i.Fragment,null,e,i.createElement("cubeCamera",{ref:C,args:[t,n,_]}),g||v?i.createElement(Kv,{background:!0,files:g,preset:v,path:y,extensions:x}):c?i.createElement(Zv,{background:!0,map:c,extensions:x}):null),I))}function $v(e){var t,n,o,s;const c=Vv(e),l=e.map||c;i.useMemo((()=>(0,a.e)({GroundProjectedEnvImpl:Ev})),[]);const u=i.useMemo((()=>[l]),[l]),h=null==(t=e.ground)?void 0:t.height,d=null==(n=e.ground)?void 0:n.radius,A=null!==(o=null==(s=e.ground)?void 0:s.scale)&&void 0!==o?o:1e3;return i.createElement(i.Fragment,null,i.createElement(Zv,(0,r.Z)({},e,{map:l})),i.createElement("groundProjectedEnvImpl",{args:u,scale:A,height:h,radius:d}))}function ex(e){return e.ground?i.createElement($v,e):e.map?i.createElement(Zv,e):e.children?i.createElement(Jv,e):i.createElement(Kv,e)}const tx={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:"\n      varying vec2 vUv;\n\n      void main() {\n\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n      }\n  ",fragmentShader:"\n    uniform sampler2D tDiffuse;\n    uniform float h;\n\n    varying vec2 vUv;\n\n    void main() {\n\n    \tvec4 sum = vec4( 0.0 );\n\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\n\n    \tgl_FragColor = sum;\n\n    }\n  "},nx={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:"\n    varying vec2 vUv;\n\n    void main() {\n\n      vUv = uv;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n    }\n  ",fragmentShader:"\n\n  uniform sampler2D tDiffuse;\n  uniform float v;\n\n  varying vec2 vUv;\n\n  void main() {\n\n    vec4 sum = vec4( 0.0 );\n\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\n\n    gl_FragColor = sum;\n\n  }\n  "},rx=i.forwardRef((({scale:e=10,frames:t=1/0,opacity:n=1,width:o=1,height:c=1,blur:l=1,near:u=0,far:h=10,resolution:d=512,smooth:A=!0,color:m="#000000",depthWrite:p=!1,renderOrder:f,...g},y)=>{const v=i.useRef(null),x=(0,a.D)((e=>e.scene)),E=(0,a.D)((e=>e.gl)),w=i.useRef(null);o*=Array.isArray(e)?e[0]:e||1,c*=Array.isArray(e)?e[1]:e||1;const[C,I,_,b,B,M,S]=i.useMemo((()=>{const e=new s.WebGLRenderTarget(d,d),t=new s.WebGLRenderTarget(d,d);t.texture.generateMipmaps=e.texture.generateMipmaps=!1;const n=new s.PlaneGeometry(o,c).rotateX(Math.PI/2),r=new s.Mesh(n),i=new s.MeshDepthMaterial;i.depthTest=i.depthWrite=!1,i.onBeforeCompile=e=>{e.uniforms={...e.uniforms,ucolor:{value:new s.Color(m)}},e.fragmentShader=e.fragmentShader.replace("void main() {","uniform vec3 ucolor;\n           void main() {\n          "),e.fragmentShader=e.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};const a=new s.ShaderMaterial(tx),l=new s.ShaderMaterial(nx);return l.depthTest=a.depthTest=!1,[e,n,i,r,a,l,t]}),[d,o,c,e,m]),D=e=>{b.visible=!0,b.material=B,B.uniforms.tDiffuse.value=C.texture,B.uniforms.h.value=1*e/256,E.setRenderTarget(S),E.render(b,w.current),b.material=M,M.uniforms.tDiffuse.value=S.texture,M.uniforms.v.value=1*e/256,E.setRenderTarget(C),E.render(b,w.current),b.visible=!1};let T,Q,P=0;return(0,a.F)((()=>{w.current&&(t===1/0||P<t)&&(P++,T=x.background,Q=x.overrideMaterial,v.current.visible=!1,x.background=null,x.overrideMaterial=_,E.setRenderTarget(C),E.render(x,w.current),D(l),A&&D(.4*l),E.setRenderTarget(null),v.current.visible=!0,x.overrideMaterial=Q,x.background=T)})),i.useImperativeHandle(y,(()=>v.current),[]),i.createElement("group",(0,r.Z)({"rotation-x":Math.PI/2},g,{ref:v}),i.createElement("mesh",{renderOrder:f,geometry:I,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},i.createElement("meshBasicMaterial",{transparent:!0,map:C.texture,opacity:n,depthWrite:p})),i.createElement("orthographicCamera",{ref:w,args:[-o/2,o/2,c/2,-c/2,u,h]}))}));const ix=i.createContext(null),ox=cc({color:new s.Color,blend:2,alphaTest:.75,opacity:0,map:null},"varying vec2 vUv;\n   void main() {\n     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);\n     vUv = uv;\n   }",`varying vec2 vUv;\n   uniform sampler2D map;\n   uniform vec3 color;\n   uniform float opacity;\n   uniform float alphaTest;\n   uniform float blend;\n   void main() {\n     vec4 sampledDiffuseColor = texture2D(map, vUv);\n     gl_FragColor = vec4(color * sampledDiffuseColor.r * blend, max(0.0, (1.0 - (sampledDiffuseColor.r + sampledDiffuseColor.g + sampledDiffuseColor.b) / alphaTest)) * opacity);\n     #include <tonemapping_fragment>\n     #include <${dc>=154?"colorspace_fragment":"encodings_fragment"}>\n   }`),sx=i.forwardRef((({children:e,temporal:t,frames:n=40,limit:r=1/0,blend:o=20,scale:s=10,opacity:c=1,alphaTest:l=.75,color:u="black",colorBlend:h=2,resolution:d=1024,toneMapped:A=!0,...m},p)=>{(0,a.e)({SoftShadowMaterial:ox});const f=(0,a.D)((e=>e.gl)),g=(0,a.D)((e=>e.scene)),y=(0,a.D)((e=>e.camera)),v=(0,a.D)((e=>e.invalidate)),x=i.useRef(null),E=i.useRef(null),[w]=i.useState((()=>new cx(f,g,d)));i.useLayoutEffect((()=>{w.configure(x.current)}),[]);const C=i.useMemo((()=>({lights:new Map,temporal:!!t,frames:Math.max(2,n),blend:Math.max(2,n===1/0?o:n),count:0,getMesh:()=>x.current,reset:()=>{w.clear();const e=x.current.material;e.opacity=0,e.alphaTest=0,C.count=0},update:(e=1)=>{const t=x.current.material;C.temporal?(t.opacity=Math.min(c,t.opacity+c/C.blend),t.alphaTest=Math.min(l,t.alphaTest+l/C.blend)):(t.opacity=c,t.alphaTest=l),E.current.visible=!0,w.prepare();for(let n=0;n<e;n++)C.lights.forEach((e=>e.update())),w.update(y,C.blend);E.current.visible=!1,w.finish()}})),[w,y,g,t,n,o,c,l]);return i.useLayoutEffect((()=>{C.reset(),C.temporal||C.frames===1/0||C.update(C.blend)})),i.useImperativeHandle(p,(()=>C),[C]),(0,a.F)((()=>{(C.temporal||C.frames===1/0)&&C.count<C.frames&&C.count<r&&(v(),C.update(),C.count++)})),i.createElement("group",m,i.createElement("group",{traverse:()=>null,ref:E},i.createElement(ix.Provider,{value:C},e)),i.createElement("mesh",{receiveShadow:!0,ref:x,scale:s,rotation:[-Math.PI/2,0,0]},i.createElement("planeGeometry",null),i.createElement("softShadowMaterial",{transparent:!0,depthWrite:!1,toneMapped:A,color:u,blend:h,map:w.progressiveLightMap2.texture})))})),ax=i.forwardRef((({castShadow:e=!0,bias:t=.001,mapSize:n=512,size:o=5,near:a=.5,far:c=500,frames:l=1,position:u=[0,0,0],radius:h=1,amount:d=8,intensity:A=(dc>=155?Math.PI:1),ambient:m=.5,...p},f)=>{const g=i.useRef(null),y=new s.Vector3(...u).length(),v=i.useContext(ix),x=i.useCallback((()=>{let e;if(g.current)for(let t=0;t<g.current.children.length;t++)if(e=g.current.children[t],Math.random()>m)e.position.set(u[0]+s.MathUtils.randFloatSpread(h),u[1]+s.MathUtils.randFloatSpread(h),u[2]+s.MathUtils.randFloatSpread(h));else{let t=Math.acos(2*Math.random()-1)-Math.PI/2,n=2*Math.PI*Math.random();e.position.set(Math.cos(t)*Math.cos(n)*y,Math.abs(Math.cos(t)*Math.sin(n)*y),Math.sin(t)*y)}}),[h,m,y,...u]),E=i.useMemo((()=>({update:x})),[x]);return i.useImperativeHandle(f,(()=>E),[E]),i.useLayoutEffect((()=>{var e;const t=g.current;return v&&(null==(e=v.lights)||e.set(t.uuid,E)),()=>{var e;null==v||null==(e=v.lights)||e.delete(t.uuid)}}),[v,E]),i.createElement("group",(0,r.Z)({ref:g},p),Array.from({length:d},((r,s)=>i.createElement("directionalLight",{key:s,castShadow:e,"shadow-bias":t,"shadow-mapSize":[n,n],intensity:A/d},i.createElement("orthographicCamera",{attach:"shadow-camera",args:[-o,o,o,-o,a,c]})))))}));class cx{constructor(e,t,n=1024){this.renderer=e,this.res=n,this.scene=t,this.buffer1Active=!1,this.lights=[],this.meshes=[],this.object=null,this.clearColor=new s.Color,this.clearAlpha=0;const r={type:s.HalfFloatType,magFilter:s.NearestFilter,minFilter:s.NearestFilter};this.progressiveLightMap1=new s.WebGLRenderTarget(this.res,this.res,r),this.progressiveLightMap2=new s.WebGLRenderTarget(this.res,this.res,r),this.discardMat=new My,this.targetMat=new s.MeshLambertMaterial({fog:!1}),this.previousShadowMap={value:this.progressiveLightMap1.texture},this.averagingWindow={value:100},this.targetMat.onBeforeCompile=e=>{e.vertexShader="varying vec2 vUv;\n"+e.vertexShader.slice(0,-1)+"vUv = uv; gl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }";const t=e.fragmentShader.indexOf("void main() {");e.fragmentShader="varying vec2 vUv;\n"+e.fragmentShader.slice(0,t)+"uniform sampler2D previousShadowMap;\n\tuniform float averagingWindow;\n"+e.fragmentShader.slice(t-1,-1)+"\nvec3 texelOld = texture2D(previousShadowMap, vUv).rgb;\n        gl_FragColor.rgb = mix(texelOld, gl_FragColor.rgb, 1.0/ averagingWindow);\n      }",e.uniforms.previousShadowMap=this.previousShadowMap,e.uniforms.averagingWindow=this.averagingWindow}}clear(){this.renderer.getClearColor(this.clearColor),this.clearAlpha=this.renderer.getClearAlpha(),this.renderer.setClearColor("black",1),this.renderer.setRenderTarget(this.progressiveLightMap1),this.renderer.clear(),this.renderer.setRenderTarget(this.progressiveLightMap2),this.renderer.clear(),this.renderer.setRenderTarget(null),this.renderer.setClearColor(this.clearColor,this.clearAlpha),this.lights=[],this.meshes=[],this.scene.traverse((e=>{!function(e){return!!e.geometry}(e)?function(e){return e.isLight}(e)&&this.lights.push({object:e,intensity:e.intensity}):this.meshes.push({object:e,material:e.material})}))}prepare(){this.lights.forEach((e=>e.object.intensity=0)),this.meshes.forEach((e=>e.object.material=this.discardMat))}finish(){this.lights.forEach((e=>e.object.intensity=e.intensity)),this.meshes.forEach((e=>e.object.material=e.material))}configure(e){this.object=e}update(e,t=100){if(!this.object)return;this.averagingWindow.value=t,this.object.material=this.targetMat;const n=this.buffer1Active?this.progressiveLightMap1:this.progressiveLightMap2,r=this.buffer1Active?this.progressiveLightMap2:this.progressiveLightMap1,i=this.scene.background;this.scene.background=null,this.renderer.setRenderTarget(n),this.previousShadowMap.value=r.texture,this.buffer1Active=!this.buffer1Active,this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.scene.background=i}}const lx={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};function ux({radius:e,adjustCamera:t}){const n=pv();return i.useEffect((()=>{t&&n.refresh().clip().fit()}),[e,t]),null}function hx({children:e,center:t,adjustCamera:n=!0,intensity:o=.5,shadows:s="contact",environment:a="city",preset:c="rembrandt",...l}){var u,h,d,A,m,p,f,g;const y="string"===typeof c?lx[c]:c,[{radius:v,height:x},E]=i.useState({radius:0,width:0,height:0,depth:0}),w=null!==(u=null==s?void 0:s.bias)&&void 0!==u?u:-1e-4,C=null!==(h=null==s?void 0:s.normalBias)&&void 0!==h?h:0,I=null!==(d=null==s?void 0:s.size)&&void 0!==d?d:1024,_=null!==(A=null==s?void 0:s.offset)&&void 0!==A?A:0,b="contact"===s||"contact"===(null==s?void 0:s.type),B="accumulative"===s||"accumulative"===(null==s?void 0:s.type),M={..."object"===typeof s?s:{}},S=a?"string"===typeof a?{preset:a}:a:null,D=i.useCallback((e=>{const{width:n,height:r,depth:i,boundingSphere:o}=e;E({radius:o.radius,width:n,height:r,depth:i}),null!=t&&t.onCentered&&t.onCentered(e)}),[]);return i.createElement(i.Fragment,null,i.createElement("ambientLight",{intensity:o/3}),i.createElement("spotLight",{penumbra:1,position:[y.main[0]*v,y.main[1]*v,y.main[2]*v],intensity:2*o,castShadow:!!s,"shadow-bias":w,"shadow-normalBias":C,"shadow-mapSize":I}),i.createElement("pointLight",{position:[y.fill[0]*v,y.fill[1]*v,y.fill[2]*v],intensity:o}),i.createElement(mv,(0,r.Z)({fit:!!n,clip:!!n,margin:Number(n),observe:!0},l),i.createElement(ux,{radius:v,adjustCamera:n}),i.createElement(Tg,(0,r.Z)({},t,{position:[0,_/2,0],onCentered:D}),e)),i.createElement("group",{position:[0,-x/2-_/2,0]},b&&i.createElement(rx,(0,r.Z)({scale:4*v,far:v,blur:2},M)),B&&i.createElement(sx,(0,r.Z)({temporal:!0,frames:100,alphaTest:.9,toneMapped:!0,scale:4*v},M),i.createElement(ax,{amount:null!==(m=M.amount)&&void 0!==m?m:8,radius:null!==(p=M.radius)&&void 0!==p?p:v,ambient:null!==(f=M.ambient)&&void 0!==f?f:.5,intensity:null!==(g=M.intensity)&&void 0!==g?g:1,position:[y.main[0]*v,y.main[1]*v,y.main[2]*v],size:4*v,bias:-w,mapSize:I}))),a&&i.createElement(ex,S))}const dx=e=>0===e?0:Math.pow(2,10*e-10);function Ax({children:e,floor:t=.25,segments:n=20,receiveShadow:r,...o}){const s=i.useRef(null);return i.useLayoutEffect((()=>{let e=0;const r=n/n/2,i=s.current.attributes.position;for(let o=0;o<n+1;o++)for(let s=0;s<n+1;s++)i.setXYZ(e++,o/n-r+(0===o?-t:0),s/n-r,dx(o/n));i.needsUpdate=!0,s.current.computeVertexNormals()}),[n,t]),i.createElement("group",o,i.createElement("mesh",{receiveShadow:r,rotation:[-Math.PI/2,0,Math.PI/2]},i.createElement("planeGeometry",{ref:s,args:[1,1,n,n]}),e))}const mx=i.forwardRef((({fog:e=!1,renderOrder:t,depthWrite:n=!1,colorStop:o=0,color:a="black",opacity:c=.5,...l},u)=>{const h=i.useMemo((()=>{const e=document.createElement("canvas");e.width=128,e.height=128;const t=e.getContext("2d"),n=t.createRadialGradient(e.width/2,e.height/2,0,e.width/2,e.height/2,e.width/2);return n.addColorStop(o,new s.Color(a).getStyle()),n.addColorStop(1,"rgba(0,0,0,0)"),t.fillStyle=n,t.fillRect(0,0,e.width,e.height),e}),[a,o]);return i.createElement("mesh",(0,r.Z)({renderOrder:t,ref:u,"rotation-x":-Math.PI/2},l),i.createElement("planeGeometry",null),i.createElement("meshBasicMaterial",{transparent:!0,opacity:c,fog:e,depthWrite:n,side:s.DoubleSide},i.createElement("canvasTexture",{attach:"map",args:[h]})))}));function px(e=s.FrontSide){const t={value:new s.Matrix4};return Object.assign(new s.MeshNormalMaterial({side:e}),{viewMatrix:t,onBeforeCompile:e=>{e.uniforms.viewMatrix=t,e.fragmentShader="vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n           return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n         }\n"+e.fragmentShader.replace("#include <normal_fragment_maps>","#include <normal_fragment_maps>\n           normal = inverseTransformDirection( normal, viewMatrix );\n")}})}const fx=cc({causticsTexture:null,causticsTextureB:null,color:new s.Color,lightProjMatrix:new s.Matrix4,lightViewMatrix:new s.Matrix4},"varying vec3 vWorldPosition;\n   void main() {\n     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);\n     vec4 worldPosition = modelMatrix * vec4(position, 1.);\n     vWorldPosition = worldPosition.xyz;\n   }",`varying vec3 vWorldPosition;\n  uniform vec3 color;\n  uniform sampler2D causticsTexture;\n  uniform sampler2D causticsTextureB;\n  uniform mat4 lightProjMatrix;\n  uniform mat4 lightViewMatrix;\n   void main() {\n    // Apply caustics\n    vec4 lightSpacePos = lightProjMatrix * lightViewMatrix * vec4(vWorldPosition, 1.0);\n    lightSpacePos.xyz /= lightSpacePos.w;\n    lightSpacePos.xyz = lightSpacePos.xyz * 0.5 + 0.5;\n    vec3 front = texture2D(causticsTexture, lightSpacePos.xy).rgb;\n    vec3 back = texture2D(causticsTextureB, lightSpacePos.xy).rgb;\n    gl_FragColor = vec4((front + back) * color, 1.0);\n    #include <tonemapping_fragment>\n    #include <${dc>=154?"colorspace_fragment":"encodings_fragment"}>\n   }`),gx=cc({cameraMatrixWorld:new s.Matrix4,cameraProjectionMatrixInv:new s.Matrix4,normalTexture:null,depthTexture:null,lightDir:new s.Vector3(0,1,0),lightPlaneNormal:new s.Vector3(0,1,0),lightPlaneConstant:0,near:.1,far:100,modelMatrix:new s.Matrix4,worldRadius:1/40,ior:1.1,bounces:0,resolution:1024,size:10,intensity:.5},"\n  varying vec2 vUv;\n  void main() {\n      vUv = uv;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  }","\n  uniform mat4 cameraMatrixWorld;\n  uniform mat4 cameraProjectionMatrixInv;\n  uniform vec3 lightDir;\n  uniform vec3 lightPlaneNormal;\n  uniform float lightPlaneConstant;\n  uniform float near;\n  uniform float far;\n  uniform float time;\n  uniform float worldRadius;\n  uniform float resolution;\n  uniform float size;\n  uniform float intensity;\n  uniform float ior;\n  precision highp isampler2D;\n  precision highp usampler2D;\n  uniform sampler2D normalTexture;\n  uniform sampler2D depthTexture;\n  uniform float bounces;\n  varying vec2 vUv;\n  vec3 WorldPosFromDepth(float depth, vec2 coord) {\n    float z = depth * 2.0 - 1.0;\n    vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);\n    vec4 viewSpacePosition = cameraProjectionMatrixInv * clipSpacePosition;\n    // Perspective division\n    viewSpacePosition /= viewSpacePosition.w;\n    vec4 worldSpacePosition = cameraMatrixWorld * viewSpacePosition;\n    return worldSpacePosition.xyz;\n  }\n  float sdPlane( vec3 p, vec3 n, float h ) {\n    // n must be normalized\n    return dot(p,n) + h;\n  }\n  float planeIntersect( vec3 ro, vec3 rd, vec4 p ) {\n    return -(dot(ro,p.xyz)+p.w)/dot(rd,p.xyz);\n  }\n  vec3 totalInternalReflection(vec3 ro, vec3 rd, vec3 pos, vec3 normal, float ior, out vec3 rayOrigin, out vec3 rayDirection) {\n    rayOrigin = ro;\n    rayDirection = rd;\n    rayDirection = refract(rayDirection, normal, 1.0 / ior);\n    rayOrigin = pos + rayDirection * 0.1;\n    return rayDirection;\n  }\n  void main() {\n    // Each sample consists of random offset in the x and y direction\n    float caustic = 0.0;\n    float causticTexelSize = (1.0 / resolution) * size * 2.0;\n    float texelsNeeded = worldRadius / causticTexelSize;\n    float sampleRadius = texelsNeeded / resolution;\n    float sum = 0.0;\n    if (texture2D(depthTexture, vUv).x == 1.0) {\n      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n      return;\n    }\n    vec2 offset1 = vec2(-0.5, -0.5);//vec2(rand() - 0.5, rand() - 0.5);\n    vec2 offset2 = vec2(-0.5, 0.5);//vec2(rand() - 0.5, rand() - 0.5);\n    vec2 offset3 = vec2(0.5, 0.5);//vec2(rand() - 0.5, rand() - 0.5);\n    vec2 offset4 = vec2(0.5, -0.5);//vec2(rand() - 0.5, rand() - 0.5);\n    vec2 uv1 = vUv + offset1 * sampleRadius;\n    vec2 uv2 = vUv + offset2 * sampleRadius;\n    vec2 uv3 = vUv + offset3 * sampleRadius;\n    vec2 uv4 = vUv + offset4 * sampleRadius;\n    vec3 normal1 = texture2D(normalTexture, uv1, -10.0).rgb * 2.0 - 1.0;\n    vec3 normal2 = texture2D(normalTexture, uv2, -10.0).rgb * 2.0 - 1.0;\n    vec3 normal3 = texture2D(normalTexture, uv3, -10.0).rgb * 2.0 - 1.0;\n    vec3 normal4 = texture2D(normalTexture, uv4, -10.0).rgb * 2.0 - 1.0;\n    float depth1 = texture2D(depthTexture, uv1, -10.0).x;\n    float depth2 = texture2D(depthTexture, uv2, -10.0).x;\n    float depth3 = texture2D(depthTexture, uv3, -10.0).x;\n    float depth4 = texture2D(depthTexture, uv4, -10.0).x;\n    // Sanity check the depths\n    if (depth1 == 1.0 || depth2 == 1.0 || depth3 == 1.0 || depth4 == 1.0) {\n      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n      return;\n    }\n    vec3 pos1 = WorldPosFromDepth(depth1, uv1);\n    vec3 pos2 = WorldPosFromDepth(depth2, uv2);\n    vec3 pos3 = WorldPosFromDepth(depth3, uv3);\n    vec3 pos4 = WorldPosFromDepth(depth4, uv4);\n    vec3 originPos1 = WorldPosFromDepth(0.0, uv1);\n    vec3 originPos2 = WorldPosFromDepth(0.0, uv2);\n    vec3 originPos3 = WorldPosFromDepth(0.0, uv3);\n    vec3 originPos4 = WorldPosFromDepth(0.0, uv4);\n    vec3 endPos1, endPos2, endPos3, endPos4;\n    vec3 endDir1, endDir2, endDir3, endDir4;\n    totalInternalReflection(originPos1, lightDir, pos1, normal1, ior, endPos1, endDir1);\n    totalInternalReflection(originPos2, lightDir, pos2, normal2, ior, endPos2, endDir2);\n    totalInternalReflection(originPos3, lightDir, pos3, normal3, ior, endPos3, endDir3);\n    totalInternalReflection(originPos4, lightDir, pos4, normal4, ior, endPos4, endDir4);\n    float lightPosArea = length(cross(originPos2 - originPos1, originPos3 - originPos1)) + length(cross(originPos3 - originPos1, originPos4 - originPos1));\n    float t1 = planeIntersect(endPos1, endDir1, vec4(lightPlaneNormal, lightPlaneConstant));\n    float t2 = planeIntersect(endPos2, endDir2, vec4(lightPlaneNormal, lightPlaneConstant));\n    float t3 = planeIntersect(endPos3, endDir3, vec4(lightPlaneNormal, lightPlaneConstant));\n    float t4 = planeIntersect(endPos4, endDir4, vec4(lightPlaneNormal, lightPlaneConstant));\n    vec3 finalPos1 = endPos1 + endDir1 * t1;\n    vec3 finalPos2 = endPos2 + endDir2 * t2;\n    vec3 finalPos3 = endPos3 + endDir3 * t3;\n    vec3 finalPos4 = endPos4 + endDir4 * t4;\n    float finalArea = length(cross(finalPos2 - finalPos1, finalPos3 - finalPos1)) + length(cross(finalPos3 - finalPos1, finalPos4 - finalPos1));\n    caustic += intensity * (lightPosArea / finalArea);\n    // Calculate the area of the triangle in light spaces\n    gl_FragColor = vec4(vec3(max(caustic, 0.0)), 1.0);\n  }"),yx={depth:!0,minFilter:s.LinearFilter,magFilter:s.LinearFilter,type:s.UnsignedByteType},vx={minFilter:s.LinearMipmapLinearFilter,magFilter:s.LinearFilter,type:s.FloatType,generateMipmaps:!0},xx=i.forwardRef((({debug:e,children:t,frames:n=1,ior:o=1.1,color:c="white",causticsOnly:l=!1,backside:u=!1,backsideIOR:h=1.1,worldRadius:d=.3125,intensity:A=.05,resolution:m=2024,lightSource:p=[5,5,5],...f},g)=>{(0,a.e)({CausticsProjectionMaterial:fx});const y=i.useRef(null),v=i.useRef(null),x=i.useRef(null),E=i.useRef(null),w=(0,a.D)((e=>e.gl)),C=KA(e&&v,s.CameraHelper),I=ol(m,m,yx),_=ol(m,m,yx),b=ol(m,m,vx),B=ol(m,m,vx),[M]=i.useState((()=>px())),[S]=i.useState((()=>px(s.BackSide))),[D]=i.useState((()=>new gx)),[T]=i.useState((()=>new Ga(D)));i.useLayoutEffect((()=>{y.current.updateWorldMatrix(!1,!0)}));let Q=0;const P=new s.Vector3,z=new s.Frustum,R=new s.Matrix4,F=new s.Plane,k=new s.Vector3,L=new s.Vector3,O=new s.Box3,U=new s.Vector3,N=[],V=[],G=[],j=[],H=new s.Vector3;for(let r=0;r<8;r++)N.push(new s.Vector3),V.push(new s.Vector3),G.push(new s.Vector3),j.push(new s.Vector3);return(0,a.F)((()=>{if(n===1/0||Q++<n){var t,r;Array.isArray(p)?k.fromArray(p).normalize():k.copy(y.current.worldToLocal(p.current.getWorldPosition(P)).normalize()),L.copy(k).multiplyScalar(-1),null==(t=x.current.parent)||t.matrixWorld.identity(),O.setFromObject(x.current,!0),N[0].set(O.min.x,O.min.y,O.min.z),N[1].set(O.min.x,O.min.y,O.max.z),N[2].set(O.min.x,O.max.y,O.min.z),N[3].set(O.min.x,O.max.y,O.max.z),N[4].set(O.max.x,O.min.y,O.min.z),N[5].set(O.max.x,O.min.y,O.max.z),N[6].set(O.max.x,O.max.y,O.min.z),N[7].set(O.max.x,O.max.y,O.max.z);for(let e=0;e<8;e++)V[e].copy(N[e]);O.getCenter(U),N.map((e=>e.sub(U)));const n=F.set(L,0);N.map(((e,t)=>n.projectPoint(e,G[t])));const i=G.reduce(((e,t)=>e.add(t)),P.set(0,0,0)).divideScalar(G.length),s=G.map((e=>e.distanceTo(i))).reduce(((e,t)=>Math.max(e,t))),a=N.map((e=>e.dot(k))).reduce(((e,t)=>Math.max(e,t)));v.current.position.copy(H.copy(k).multiplyScalar(a).add(U)),v.current.lookAt(x.current.localToWorld(U));const c=R.lookAt(v.current.position,U,P.set(0,1,0));v.current.left=-s,v.current.right=s,v.current.top=s,v.current.bottom=-s;const f=P.set(0,s,0).applyMatrix4(c),g=(v.current.position.y+f.y)/k.y;v.current.near=.1,v.current.far=g,v.current.updateProjectionMatrix(),v.current.updateMatrixWorld();const Q=V.map(((e,t)=>e.add(j[t].copy(k).multiplyScalar(-e.y/k.y)))),q=Q.reduce(((e,t)=>e.add(t)),P.set(0,0,0)).divideScalar(Q.length),W=2*Q.map((e=>Math.hypot(e.x-q.x,e.z-q.z))).reduce(((e,t)=>Math.max(e,t)));E.current.scale.setScalar(W),E.current.position.copy(q),e&&(null==(r=C.current)||r.update()),S.viewMatrix.value=M.viewMatrix.value=v.current.matrixWorldInverse;const Y=z.setFromProjectionMatrix(R.multiplyMatrices(v.current.projectionMatrix,v.current.matrixWorldInverse)).planes[4];D.cameraMatrixWorld=v.current.matrixWorld,D.cameraProjectionMatrixInv=v.current.projectionMatrixInverse,D.lightDir=L,D.lightPlaneNormal=Y.normal,D.lightPlaneConstant=Y.constant,D.near=v.current.near,D.far=v.current.far,D.resolution=m,D.size=s,D.intensity=A,D.worldRadius=d,x.current.visible=!0,w.setRenderTarget(I),w.clear(),x.current.overrideMaterial=M,w.render(x.current,v.current),w.setRenderTarget(_),w.clear(),u&&(x.current.overrideMaterial=S,w.render(x.current,v.current)),x.current.overrideMaterial=null,D.ior=o,E.current.material.lightProjMatrix=v.current.projectionMatrix,E.current.material.lightViewMatrix=v.current.matrixWorldInverse,D.normalTexture=I.texture,D.depthTexture=I.depthTexture,w.setRenderTarget(b),w.clear(),T.render(w),D.ior=h,D.normalTexture=_.texture,D.depthTexture=_.depthTexture,w.setRenderTarget(B),w.clear(),u&&T.render(w),w.setRenderTarget(null),l&&(x.current.visible=!1)}})),i.useImperativeHandle(g,(()=>y.current),[]),i.createElement("group",(0,r.Z)({ref:y},f),i.createElement("scene",{ref:x},i.createElement("orthographicCamera",{ref:v,up:[0,1,0]}),t),i.createElement("mesh",{renderOrder:2,ref:E,"rotation-x":-Math.PI/2},i.createElement("planeGeometry",null),i.createElement("causticsProjectionMaterial",{transparent:!0,color:c,causticsTexture:b.texture,causticsTextureB:B.texture,blending:s.CustomBlending,blendSrc:s.OneFactor,blendDst:s.SrcAlphaFactor,depthWrite:!1}),e&&i.createElement(yc,null,i.createElement("lineBasicMaterial",{color:"#ffff00",toneMapped:!1}))))})),Ex=i.forwardRef((({mixBlur:e=0,mixStrength:t=.5,resolution:n=256,blur:o=[0,0],args:c=[1,1],minDepthThreshold:l=.9,maxDepthThreshold:u=1,depthScale:h=0,depthToBlurRatioBias:d=.25,mirror:A=0,children:m,debug:p=0,distortion:f=1,mixContrast:g=1,distortionMap:y,...v},x)=>{(0,a.e)({MeshReflectorMaterial:yy}),i.useEffect((()=>{console.warn("Reflector has been deprecated and will be removed next major. Replace it with <MeshReflectorMaterial />!")}),[]);const E=(0,a.D)((({gl:e})=>e)),w=(0,a.D)((({camera:e})=>e)),C=(0,a.D)((({scene:e})=>e)),I=(o=Array.isArray(o)?o:[o,o])[0]+o[1]>0,_=i.useRef(null);i.useImperativeHandle(x,(()=>_.current),[]);const[b]=i.useState((()=>new s.Plane)),[B]=i.useState((()=>new s.Vector3)),[M]=i.useState((()=>new s.Vector3)),[S]=i.useState((()=>new s.Vector3)),[D]=i.useState((()=>new s.Matrix4)),[T]=i.useState((()=>new s.Vector3(0,0,-1))),[Q]=i.useState((()=>new s.Vector4)),[P]=i.useState((()=>new s.Vector3)),[z]=i.useState((()=>new s.Vector3)),[R]=i.useState((()=>new s.Vector4)),[F]=i.useState((()=>new s.Matrix4)),[k]=i.useState((()=>new s.PerspectiveCamera)),L=i.useCallback((()=>{if(M.setFromMatrixPosition(_.current.matrixWorld),S.setFromMatrixPosition(w.matrixWorld),D.extractRotation(_.current.matrixWorld),B.set(0,0,1),B.applyMatrix4(D),P.subVectors(M,S),P.dot(B)>0)return;P.reflect(B).negate(),P.add(M),D.extractRotation(w.matrixWorld),T.set(0,0,-1),T.applyMatrix4(D),T.add(S),z.subVectors(M,T),z.reflect(B).negate(),z.add(M),k.position.copy(P),k.up.set(0,1,0),k.up.applyMatrix4(D),k.up.reflect(B),k.lookAt(z),k.far=w.far,k.updateMatrixWorld(),k.projectionMatrix.copy(w.projectionMatrix),F.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),F.multiply(k.projectionMatrix),F.multiply(k.matrixWorldInverse),F.multiply(_.current.matrixWorld),b.setFromNormalAndCoplanarPoint(B,M),b.applyMatrix4(k.matrixWorldInverse),Q.set(b.normal.x,b.normal.y,b.normal.z,b.constant);const e=k.projectionMatrix;R.x=(Math.sign(Q.x)+e.elements[8])/e.elements[0],R.y=(Math.sign(Q.y)+e.elements[9])/e.elements[5],R.z=-1,R.w=(1+e.elements[10])/e.elements[14],Q.multiplyScalar(2/Q.dot(R)),e.elements[2]=Q.x,e.elements[6]=Q.y,e.elements[10]=Q.z+1,e.elements[14]=Q.w}),[]),[O,U,N,V]=i.useMemo((()=>{const r={type:s.HalfFloatType,minFilter:s.LinearFilter,magFilter:s.LinearFilter},i=new s.WebGLRenderTarget(n,n,r);i.depthBuffer=!0,i.depthTexture=new s.DepthTexture(n,n),i.depthTexture.format=s.DepthFormat,i.depthTexture.type=s.UnsignedShortType;const a=new s.WebGLRenderTarget(n,n,r);return[i,a,new gy({gl:E,resolution:n,width:o[0],height:o[1],minDepthThreshold:l,maxDepthThreshold:u,depthScale:h,depthToBlurRatioBias:d}),{mirror:A,textureMatrix:F,mixBlur:e,tDiffuse:i.texture,tDepth:i.depthTexture,tDiffuseBlur:a.texture,hasBlur:I,mixStrength:t,minDepthThreshold:l,maxDepthThreshold:u,depthScale:h,depthToBlurRatioBias:d,transparent:!0,debug:p,distortion:f,distortionMap:y,mixContrast:g,"defines-USE_BLUR":I?"":void 0,"defines-USE_DEPTH":h>0?"":void 0,"defines-USE_DISTORTION":y?"":void 0}]}),[E,o,F,n,A,I,e,t,l,u,h,d,p,f,y,g]);return(0,a.F)((()=>{if(null==_||!_.current)return;_.current.visible=!1;const e=E.xr.enabled,t=E.shadowMap.autoUpdate;L(),E.xr.enabled=!1,E.shadowMap.autoUpdate=!1,E.setRenderTarget(O),E.state.buffers.depth.setMask(!0),E.autoClear||E.clear(),E.render(C,k),I&&N.render(E,O,U),E.xr.enabled=e,E.shadowMap.autoUpdate=t,_.current.visible=!0,E.setRenderTarget(null)})),i.createElement("mesh",(0,r.Z)({ref:_},v),i.createElement("planeGeometry",{args:c}),m?m("meshReflectorMaterial",V):i.createElement("meshReflectorMaterial",V))}));class wx extends s.ShaderMaterial{constructor(){super({uniforms:{depth:{value:null},opacity:{value:1},attenuation:{value:2.5},anglePower:{value:12},spotPosition:{value:new s.Vector3(0,0,0)},lightColor:{value:new s.Color("white")},cameraNear:{value:0},cameraFar:{value:1},resolution:{value:new s.Vector2(0,0)}},transparent:!0,depthWrite:!1,vertexShader:"\n        varying vec3 vNormal;\n        varying float vViewZ;\n        varying float vIntensity;\n        uniform vec3 spotPosition;\n        uniform float attenuation;\n\n        #include <common>\n        #include <logdepthbuf_pars_vertex>\n\n        void main() {\n          // compute intensity\n          vNormal = normalize(normalMatrix * normal);\n          vec4 worldPosition = modelMatrix * vec4(position, 1);\n          vec4 viewPosition = viewMatrix * worldPosition;\n          vViewZ = viewPosition.z;\n\n          vIntensity = 1.0 - saturate(distance(worldPosition.xyz, spotPosition) / attenuation);\n\n          gl_Position = projectionMatrix * viewPosition;\n\n          #include <logdepthbuf_vertex>\n        }\n      ",fragmentShader:`\n        varying vec3 vNormal;\n        varying float vViewZ;\n        varying float vIntensity;\n\n        uniform vec3 lightColor;\n        uniform float anglePower;\n        uniform sampler2D depth;\n        uniform vec2 resolution;\n        uniform float cameraNear;\n        uniform float cameraFar;\n        uniform float opacity;\n\n        #include <packing>\n        #include <logdepthbuf_pars_fragment>\n\n        float readDepth(sampler2D depthSampler, vec2 uv) {\n          float fragCoordZ = texture(depthSampler, uv).r;\n\n          // https://github.com/mrdoob/three.js/issues/23072\n          #ifdef USE_LOGDEPTHBUF\n            float viewZ = 1.0 - exp2(fragCoordZ * log(cameraFar + 1.0) / log(2.0));\n          #else\n            float viewZ = perspectiveDepthToViewZ(fragCoordZ, cameraNear, cameraFar);\n          #endif\n\n          return viewZ;\n        }\n\n        void main() {\n          #include <logdepthbuf_fragment>\n\n          vec3 normal = vec3(vNormal.x, vNormal.y, abs(vNormal.z));\n          float angleIntensity = pow(dot(normal, vec3(0, 0, 1)), anglePower);\n          float intensity = vIntensity * angleIntensity;\n\n          // fades when z is close to sampled depth, meaning the cone is intersecting existing geometry\n          bool isSoft = resolution[0] > 0.0 && resolution[1] > 0.0;\n          if (isSoft) {\n            vec2 uv = gl_FragCoord.xy / resolution;\n            intensity *= smoothstep(0.0, 1.0, vViewZ - readDepth(depth, uv));\n          }\n\n          gl_FragColor = vec4(lightColor, intensity * opacity);\n\n          #include <tonemapping_fragment>\n          #include <${dc>=154?"colorspace_fragment":"encodings_fragment"}>\n        }\n      `})}}var Cx="#define GLSLIFY 1\nvarying vec2 vUv;uniform sampler2D uShadowMap;uniform float uTime;void main(){vec3 color=texture2D(uShadowMap,vUv).xyz;gl_FragColor=vec4(color,1.);}";const Ix=e=>null==e?void 0:e.isSpotLight;function _x({opacity:e=1,radiusTop:t,radiusBottom:n,depthBuffer:r,color:o="white",distance:c=5,angle:l=.15,attenuation:u=5,anglePower:h=5}){const d=i.useRef(null),A=(0,a.D)((e=>e.size)),m=(0,a.D)((e=>e.camera)),p=(0,a.D)((e=>e.viewport.dpr)),[f]=i.useState((()=>new wx)),[g]=i.useState((()=>new s.Vector3));t=void 0===t?.1:t,n=void 0===n?7*l:n,(0,a.F)((()=>{f.uniforms.spotPosition.value.copy(d.current.getWorldPosition(g)),d.current.lookAt(d.current.parent.target.getWorldPosition(g))}));const y=i.useMemo((()=>{const e=new s.CylinderGeometry(t,n,c,128,64,!0);return e.applyMatrix4((new s.Matrix4).makeTranslation(0,-c/2,0)),e.applyMatrix4((new s.Matrix4).makeRotationX(-Math.PI/2)),e}),[c,t,n]);return i.createElement(i.Fragment,null,i.createElement("mesh",{ref:d,geometry:y,raycast:()=>null},i.createElement("primitive",{object:f,attach:"material","uniforms-opacity-value":e,"uniforms-lightColor-value":o,"uniforms-attenuation-value":u,"uniforms-anglePower-value":h,"uniforms-depth-value":r,"uniforms-cameraNear-value":m.near,"uniforms-cameraFar-value":m.far,"uniforms-resolution-value":r?[A.width*p,A.height*p]:[0,0]})))}function bx(e,t,n,r,o){const[[c,l]]=i.useState((()=>[new s.Vector3,new s.Vector3]));i.useLayoutEffect((()=>{if(!Ix(e.current))throw new Error("SpotlightShadow must be a child of a SpotLight");e.current.shadow.mapSize.set(n,r),e.current.shadow.needsUpdate=!0}),[e,n,r]),(0,a.F)((()=>{if(!e.current)return;const n=e.current.position,r=e.current.target.position;l.copy(r).sub(n);var i=l.length();l.normalize().multiplyScalar(i*o),c.copy(n).add(l),t.current.position.copy(c),t.current.lookAt(e.current.target.position)}))}function Bx({distance:e=.4,alphaTest:t=.5,map:n,shader:r=Cx,width:o=512,height:c=512,scale:l=1,children:u,...h}){const d=i.useRef(null),A=h.spotlightRef,m=h.debug;bx(A,d,o,c,e);const p=i.useMemo((()=>new s.WebGLRenderTarget(o,c,{format:s.RGBAFormat,stencilBuffer:!1})),[o,c]),f=i.useRef({uShadowMap:{value:n},uTime:{value:0}});i.useEffect((()=>{f.current.uShadowMap.value=n}),[n]);const g=i.useMemo((()=>new Ga(new s.ShaderMaterial({uniforms:f.current,vertexShader:"\n          varying vec2 vUv;\n\n          void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n          }\n          ",fragmentShader:r}))),[r]);return i.useEffect((()=>()=>{g.material.dispose(),g.dispose()}),[g]),i.useEffect((()=>()=>p.dispose()),[p]),(0,a.F)((({gl:e},t)=>{f.current.uTime.value+=t,e.setRenderTarget(p),g.render(e),e.setRenderTarget(null)})),i.createElement(i.Fragment,null,i.createElement("mesh",{ref:d,scale:l,castShadow:!0},i.createElement("planeGeometry",null),i.createElement("meshBasicMaterial",{transparent:!0,side:s.DoubleSide,alphaTest:t,alphaMap:p.texture,"alphaMap-wrapS":s.RepeatWrapping,"alphaMap-wrapT":s.RepeatWrapping,opacity:m?1:0},u)))}function Mx({distance:e=.4,alphaTest:t=.5,map:n,width:r=512,height:o=512,scale:a,children:c,...l}){const u=i.useRef(null),h=l.spotlightRef,d=l.debug;return bx(h,u,r,o,e),i.createElement(i.Fragment,null,i.createElement("mesh",{ref:u,scale:a,castShadow:!0},i.createElement("planeGeometry",null),i.createElement("meshBasicMaterial",{transparent:!0,side:s.DoubleSide,alphaTest:t,alphaMap:n,"alphaMap-wrapS":s.RepeatWrapping,"alphaMap-wrapT":s.RepeatWrapping,opacity:d?1:0},c)))}function Sx(e){return e.shader?i.createElement(Bx,e):i.createElement(Mx,e)}const Dx=i.forwardRef((({opacity:e=1,radiusTop:t,radiusBottom:n,depthBuffer:o,color:s="white",distance:a=5,angle:c=.15,attenuation:l=5,anglePower:u=5,volumetric:h=!0,debug:d=!1,children:A,...m},p)=>{const f=i.useRef(null);return i.useImperativeHandle(p,(()=>f.current),[]),i.createElement("group",null,d&&f.current&&i.createElement("spotLightHelper",{args:[f.current]}),i.createElement("spotLight",(0,r.Z)({ref:f,angle:c,color:s,distance:a,castShadow:!0},m),h&&i.createElement(_x,{debug:d,opacity:e,radiusTop:t,radiusBottom:n,depthBuffer:o,color:s,distance:a,angle:c,attenuation:l,anglePower:u})),A&&i.cloneElement(A,{spotlightRef:f,debug:d}))})),Tx=i.forwardRef((({args:e,map:t,toneMapped:n=!1,color:o="white",form:c="rect",intensity:l=1,scale:u=1,target:h,children:d,...A},m)=>{const p=i.useRef(null);return i.useImperativeHandle(m,(()=>p.current),[]),i.useLayoutEffect((()=>{d||A.material||((0,a.k)(p.current.material,{color:o}),p.current.material.color.multiplyScalar(l))}),[o,l,d,A.material]),i.useLayoutEffect((()=>{h&&p.current.lookAt(Array.isArray(h)?new s.Vector3(...h):h)}),[h]),u=Array.isArray(u)&&2===u.length?[u[0],u[1],1]:u,i.createElement("mesh",(0,r.Z)({ref:p,scale:u},A),"circle"===c?i.createElement("ringGeometry",{args:[0,1,64]}):"ring"===c?i.createElement("ringGeometry",{args:[.5,1,64]}):"rect"===c?i.createElement("planeGeometry",null):i.createElement(c,{args:e}),d||(A.material?null:i.createElement("meshBasicMaterial",{toneMapped:n,map:t,side:s.DoubleSide})))}));var Qx=Object.defineProperty,Px=(e,t,n)=>(((e,t,n)=>{t in e?Qx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);const zx={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new s.Vector3},up:{value:new s.Vector3(0,1,0)}},vertexShader:"\n      uniform vec3 sunPosition;\n      uniform float rayleigh;\n      uniform float turbidity;\n      uniform float mieCoefficient;\n      uniform vec3 up;\n\n      varying vec3 vWorldPosition;\n      varying vec3 vSunDirection;\n      varying float vSunfade;\n      varying vec3 vBetaR;\n      varying vec3 vBetaM;\n      varying float vSunE;\n\n      // constants for atmospheric scattering\n      const float e = 2.71828182845904523536028747135266249775724709369995957;\n      const float pi = 3.141592653589793238462643383279502884197169;\n\n      // wavelength of used primaries, according to preetham\n      const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );\n      // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:\n      // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))\n      const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );\n\n      // mie stuff\n      // K coefficient for the primaries\n      const float v = 4.0;\n      const vec3 K = vec3( 0.686, 0.678, 0.666 );\n      // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K\n      const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );\n\n      // earth shadow hack\n      // cutoffAngle = pi / 1.95;\n      const float cutoffAngle = 1.6110731556870734;\n      const float steepness = 1.5;\n      const float EE = 1000.0;\n\n      float sunIntensity( float zenithAngleCos ) {\n        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );\n        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );\n      }\n\n      vec3 totalMie( float T ) {\n        float c = ( 0.2 * T ) * 10E-18;\n        return 0.434 * c * MieConst;\n      }\n\n      void main() {\n\n        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n        vWorldPosition = worldPosition.xyz;\n\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        gl_Position.z = gl_Position.w; // set z to camera.far\n\n        vSunDirection = normalize( sunPosition );\n\n        vSunE = sunIntensity( dot( vSunDirection, up ) );\n\n        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );\n\n        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );\n\n      // extinction (absorbtion + out scattering)\n      // rayleigh coefficients\n        vBetaR = totalRayleigh * rayleighCoefficient;\n\n      // mie coefficients\n        vBetaM = totalMie( turbidity ) * mieCoefficient;\n\n      }\n    ",fragmentShader:`\n      varying vec3 vWorldPosition;\n      varying vec3 vSunDirection;\n      varying float vSunfade;\n      varying vec3 vBetaR;\n      varying vec3 vBetaM;\n      varying float vSunE;\n\n      uniform float mieDirectionalG;\n      uniform vec3 up;\n\n      const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );\n\n      // constants for atmospheric scattering\n      const float pi = 3.141592653589793238462643383279502884197169;\n\n      const float n = 1.0003; // refractive index of air\n      const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)\n\n      // optical length at zenith for molecules\n      const float rayleighZenithLength = 8.4E3;\n      const float mieZenithLength = 1.25E3;\n      // 66 arc seconds -> degrees, and the cosine of that\n      const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;\n\n      // 3.0 / ( 16.0 * pi )\n      const float THREE_OVER_SIXTEENPI = 0.05968310365946075;\n      // 1.0 / ( 4.0 * pi )\n      const float ONE_OVER_FOURPI = 0.07957747154594767;\n\n      float rayleighPhase( float cosTheta ) {\n        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );\n      }\n\n      float hgPhase( float cosTheta, float g ) {\n        float g2 = pow( g, 2.0 );\n        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );\n        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );\n      }\n\n      void main() {\n\n        vec3 direction = normalize( vWorldPosition - cameraPos );\n\n      // optical length\n      // cutoff angle at 90 to avoid singularity in next formula.\n        float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );\n        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );\n        float sR = rayleighZenithLength * inverse;\n        float sM = mieZenithLength * inverse;\n\n      // combined extinction factor\n        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );\n\n      // in scattering\n        float cosTheta = dot( direction, vSunDirection );\n\n        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );\n        vec3 betaRTheta = vBetaR * rPhase;\n\n        float mPhase = hgPhase( cosTheta, mieDirectionalG );\n        vec3 betaMTheta = vBetaM * mPhase;\n\n        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );\n        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );\n\n      // nightsky\n        float theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]\n        float phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]\n        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );\n        vec3 L0 = vec3( 0.1 ) * Fex;\n\n      // composition + solar disc\n        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );\n        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;\n\n        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );\n\n        vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );\n\n        gl_FragColor = vec4( retColor, 1.0 );\n\n      #include <tonemapping_fragment>\n      #include <${Ks.i>=154?"colorspace_fragment":"encodings_fragment"}>\n\n      }\n    `},Rx=new s.ShaderMaterial({name:"SkyShader",fragmentShader:zx.fragmentShader,vertexShader:zx.vertexShader,uniforms:s.UniformsUtils.clone(zx.uniforms),side:s.BackSide,depthWrite:!1});class Fx extends s.Mesh{constructor(){super(new s.BoxGeometry(1,1,1),Rx)}}function kx(e,t,n=new s.Vector3){const r=Math.PI*(e-.5),i=2*Math.PI*(t-.5);return n.x=Math.cos(i),n.y=Math.sin(r),n.z=Math.sin(i),n}Px(Fx,"SkyShader",zx),Px(Fx,"material",Rx);const Lx=i.forwardRef((({inclination:e=.6,azimuth:t=.1,distance:n=1e3,mieCoefficient:o=.005,mieDirectionalG:a=.8,rayleigh:c=.5,turbidity:l=10,sunPosition:u=kx(e,t),...h},d)=>{const A=i.useMemo((()=>(new s.Vector3).setScalar(n)),[n]),[m]=i.useState((()=>new Fx));return i.createElement("primitive",(0,r.Z)({object:m,ref:d,"material-uniforms-mieCoefficient-value":o,"material-uniforms-mieDirectionalG-value":a,"material-uniforms-rayleigh-value":c,"material-uniforms-sunPosition-value":u,"material-uniforms-turbidity-value":l,scale:A},h))}));class Ox extends s.ShaderMaterial{constructor(){super({uniforms:{time:{value:0},fade:{value:1}},vertexShader:"\n      uniform float time;\n      attribute float size;\n      varying vec3 vColor;\n      void main() {\n        vColor = color;\n        vec4 mvPosition = modelViewMatrix * vec4(position, 0.5);\n        gl_PointSize = size * (30.0 / -mvPosition.z) * (3.0 + sin(time + 100.0));\n        gl_Position = projectionMatrix * mvPosition;\n      }",fragmentShader:`\n      uniform sampler2D pointTexture;\n      uniform float fade;\n      varying vec3 vColor;\n      void main() {\n        float opacity = 1.0;\n        if (fade == 1.0) {\n          float d = distance(gl_PointCoord, vec2(0.5, 0.5));\n          opacity = 1.0 / (1.0 + exp(16.0 * (d - 0.25)));\n        }\n        gl_FragColor = vec4(vColor, opacity);\n\n        #include <tonemapping_fragment>\n\t      #include <${dc>=154?"colorspace_fragment":"encodings_fragment"}>\n      }`})}}const Ux=e=>(new s.Vector3).setFromSpherical(new s.Spherical(e,Math.acos(1-2*Math.random()),2*Math.random()*Math.PI)),Nx=i.forwardRef((({radius:e=100,depth:t=50,count:n=5e3,saturation:r=0,factor:o=4,fade:c=!1,speed:l=1},u)=>{const h=i.useRef(),[d,A,m]=i.useMemo((()=>{const i=[],a=[],c=Array.from({length:n},(()=>(.5+.5*Math.random())*o)),l=new s.Color;let u=e+t;const h=t/n;for(let e=0;e<n;e++)u-=h*Math.random(),i.push(...Ux(u).toArray()),l.setHSL(e/n,r,.9),a.push(l.r,l.g,l.b);return[new Float32Array(i),new Float32Array(a),new Float32Array(c)]}),[n,t,o,e,r]);(0,a.F)((e=>h.current&&(h.current.uniforms.time.value=e.clock.getElapsedTime()*l)));const[p]=i.useState((()=>new Ox));return i.createElement("points",{ref:u},i.createElement("bufferGeometry",null,i.createElement("bufferAttribute",{attach:"attributes-position",args:[d,3]}),i.createElement("bufferAttribute",{attach:"attributes-color",args:[A,3]}),i.createElement("bufferAttribute",{attach:"attributes-size",args:[m,1]})),i.createElement("primitive",{ref:h,object:p,attach:"material",blending:s.AdditiveBlending,"uniforms-fade-value":c,depthWrite:!1,transparent:!0,vertexColors:!0}))}));var Vx={randomUUID:"undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let Gx;const jx=new Uint8Array(16);function Hx(){if(!Gx&&(Gx="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Gx))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Gx(jx)}const qx=[];for(let JC=0;JC<256;++JC)qx.push((JC+256).toString(16).slice(1));function Wx(e,t=0){return qx[e[t+0]]+qx[e[t+1]]+qx[e[t+2]]+qx[e[t+3]]+"-"+qx[e[t+4]]+qx[e[t+5]]+"-"+qx[e[t+6]]+qx[e[t+7]]+"-"+qx[e[t+8]]+qx[e[t+9]]+"-"+qx[e[t+10]]+qx[e[t+11]]+qx[e[t+12]]+qx[e[t+13]]+qx[e[t+14]]+qx[e[t+15]]}var Yx=function(e,t,n){if(Vx.randomUUID&&!t&&!e)return Vx.randomUUID();const r=(e=e||{}).random||(e.rng||Hx)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return Wx(r)};const Xx=new s.Matrix4,Zx=new s.Vector3,Kx=new s.Quaternion,Jx=new s.Vector3,$x=new s.Quaternion,eE=new s.Vector3,tE=i.createContext(null),nE=i.forwardRef((({children:e,material:t=s.MeshLambertMaterial,texture:n="https://rawcdn.githack.com/pmndrs/drei-assets/9225a9f1fbd449d9411125c2f419b843d0308c9f/cloud.png",range:o,limit:c=200,frustumCulled:l,...u},h)=>{var d,A;const m=i.useMemo((()=>class extends t{constructor(){super();const e=parseInt(s.REVISION.replace(/\D+/g,""))>=154?"opaque_fragment":"output_fragment";this.onBeforeCompile=t=>{t.vertexShader="attribute float cloudOpacity;\n               varying float vOpacity;\n              "+t.vertexShader.replace("#include <fog_vertex>","#include <fog_vertex>\n                 vOpacity = cloudOpacity;\n                "),t.fragmentShader="varying float vOpacity;\n              "+t.fragmentShader.replace(`#include <${e}>`,`#include <${e}>\n                 gl_FragColor = vec4(outgoingLight, diffuseColor.a * vOpacity);\n                `)}}}),[t]);(0,a.e)({CloudMaterial:m});const p=i.useRef(null),f=i.useRef([]),g=i.useMemo((()=>new Float32Array(Array.from({length:c},(()=>1)))),[c]),y=i.useMemo((()=>new Float32Array(Array.from({length:c},(()=>[1,1,1])).flat())),[c]),v=uc(n);let x,E=0,w=0;const C=new s.Quaternion,I=new s.Vector3(0,0,1),_=new s.Vector3;(0,a.F)(((e,t)=>{for(E=e.clock.getElapsedTime(),Xx.copy(p.current.matrixWorld).invert(),e.camera.matrixWorld.decompose(Jx,$x,eE),w=0;w<f.current.length;w++)x=f.current[w],x.ref.current.matrixWorld.decompose(Zx,Kx,eE),Zx.add(_.copy(x.position).applyQuaternion(Kx).multiply(eE)),Kx.copy($x).multiply(C.setFromAxisAngle(I,x.rotation+=t*x.rotationFactor)),eE.multiplyScalar(x.volume+(1+Math.sin(E*x.density*x.speed))/2*x.growth),x.matrix.compose(Zx,Kx,eE).premultiply(Xx),x.dist=Zx.distanceTo(Jx);for(f.current.sort(((e,t)=>t.dist-e.dist)),w=0;w<f.current.length;w++)x=f.current[w],g[w]=x.opacity*(x.dist<x.fade-1?x.dist/x.fade:1),p.current.setMatrixAt(w,x.matrix),p.current.setColorAt(w,x.color);p.current.geometry.attributes.cloudOpacity.needsUpdate=!0,p.current.instanceMatrix.needsUpdate=!0,p.current.instanceColor&&(p.current.instanceColor.needsUpdate=!0)})),i.useLayoutEffect((()=>{const e=Math.min(c,void 0!==o?o:c,f.current.length);p.current.count=e,kg(p.current.instanceMatrix,{offset:0,count:16*e}),p.current.instanceColor&&kg(p.current.instanceColor,{offset:0,count:3*e}),kg(p.current.geometry.attributes.cloudOpacity,{offset:0,count:e})}));let b=[null!==(d=v.image.width)&&void 0!==d?d:1,null!==(A=v.image.height)&&void 0!==A?A:1];const B=Math.max(b[0],b[1]);return b=[b[0]/B,b[1]/B],i.createElement("group",(0,r.Z)({ref:h},u),i.createElement(tE.Provider,{value:f},e,i.createElement("instancedMesh",{matrixAutoUpdate:!1,ref:p,args:[null,null,c],frustumCulled:l},i.createElement("instancedBufferAttribute",{usage:s.DynamicDrawUsage,attach:"instanceColor",args:[y,3]}),i.createElement("planeGeometry",{args:[...b]},i.createElement("instancedBufferAttribute",{usage:s.DynamicDrawUsage,attach:"attributes-cloudOpacity",args:[g,1]})),i.createElement("cloudMaterial",{key:t.name,map:v,transparent:!0,depthWrite:!1}))))})),rE=i.forwardRef((({opacity:e=1,speed:t=0,bounds:n=[5,1,1],segments:o=20,color:c="#ffffff",fade:l=10,volume:u=6,smallestVolume:h=.25,distribute:d=null,growth:A=4,concentrate:m="inside",seed:p=Math.random(),...f},g)=>{function y(){const e=1e4*Math.sin(p++);return e-Math.floor(e)}const v=i.useContext(tE),x=i.useRef(null),[E]=i.useState((()=>Yx())),w=i.useMemo((()=>[...new Array(o)].map(((e,t)=>({segments:o,bounds:new s.Vector3(1,1,1),position:new s.Vector3,uuid:E,index:t,ref:x,dist:0,matrix:new s.Matrix4,color:new s.Color,rotation:t*(Math.PI/o)})))),[o,E]);return i.useLayoutEffect((()=>{w.forEach(((r,i)=>{(0,a.k)(r,{volume:u,color:c,speed:t,growth:A,opacity:e,fade:l,bounds:n,density:Math.max(.5,y()),rotationFactor:Math.max(.2,.5*y())*t});const s=null==d?void 0:d(r,i);var p;(s||o>1)&&r.position.copy(r.bounds).multiply(null!==(p=null==s?void 0:s.point)&&void 0!==p?p:{x:2*y()-1,y:2*y()-1,z:2*y()-1});const f=Math.abs(r.position.x),g=Math.abs(r.position.y),v=Math.abs(r.position.z),x=Math.max(f,g,v);r.length=1,f===x&&(r.length-=f/r.bounds.x),g===x&&(r.length-=g/r.bounds.y),v===x&&(r.length-=v/r.bounds.z),r.volume=(void 0!==(null==s?void 0:s.volume)?s.volume:Math.max(Math.max(0,h),"random"===m?y():"inside"===m?r.length:1-r.length))*u}))}),[m,n,l,c,e,A,u,p,o,t]),i.useLayoutEffect((()=>{const e=w;return v.current=[...v.current,...e],()=>{v.current=v.current.filter((e=>e.uuid!==E))}}),[w]),i.useImperativeHandle(g,(()=>x.current),[]),i.createElement("group",(0,r.Z)({ref:x},f))})),iE=i.forwardRef(((e,t)=>i.useContext(tE)?i.createElement(rE,(0,r.Z)({ref:t},e)):i.createElement(nE,null,i.createElement(rE,(0,r.Z)({ref:t},e))))),oE=cc({time:0,pixelRatio:1}," uniform float pixelRatio;\n    uniform float time;\n    attribute float size;  \n    attribute float speed;  \n    attribute float opacity;\n    attribute vec3 noise;\n    attribute vec3 color;\n    varying vec3 vColor;\n    varying float vOpacity;\n    void main() {\n      vec4 modelPosition = modelMatrix * vec4(position, 1.0);\n      modelPosition.y += sin(time * speed + modelPosition.x * noise.x * 100.0) * 0.2;\n      modelPosition.z += cos(time * speed + modelPosition.x * noise.y * 100.0) * 0.2;\n      modelPosition.x += cos(time * speed + modelPosition.x * noise.z * 100.0) * 0.2;\n      vec4 viewPosition = viewMatrix * modelPosition;\n      vec4 projectionPostion = projectionMatrix * viewPosition;\n      gl_Position = projectionPostion;\n      gl_PointSize = size * 25. * pixelRatio;\n      gl_PointSize *= (1.0 / - viewPosition.z);\n      vColor = color;\n      vOpacity = opacity;\n    }",` varying vec3 vColor;\n    varying float vOpacity;\n    void main() {\n      float distanceToCenter = distance(gl_PointCoord, vec2(0.5));\n      float strength = 0.05 / distanceToCenter - 0.1;\n      gl_FragColor = vec4(vColor, strength * vOpacity);\n      #include <tonemapping_fragment>\n      #include <${dc>=154?"colorspace_fragment":"encodings_fragment"}>\n    }`),sE=e=>e&&e.constructor===Float32Array,aE=e=>e instanceof s.Vector2||e instanceof s.Vector3||e instanceof s.Vector4,cE=e=>Array.isArray(e)?e:aE(e)?e.toArray():[e,e,e];function lE(e,t,n){return i.useMemo((()=>{if(void 0!==t){if(sE(t))return t;if(t instanceof s.Color){const n=Array.from({length:3*e},(()=>(e=>[e.r,e.g,e.b])(t))).flat();return Float32Array.from(n)}if(aE(t)||Array.isArray(t)){const n=Array.from({length:3*e},(()=>cE(t))).flat();return Float32Array.from(n)}return Float32Array.from({length:e},(()=>t))}return Float32Array.from({length:e},n)}),[t])}const uE=i.forwardRef((({noise:e=1,count:t=100,speed:n=1,opacity:o=1,scale:c=1,size:l,color:u,children:h,...d},A)=>{i.useMemo((()=>(0,a.e)({SparklesImplMaterial:oE})),[]);const m=i.useRef(null),p=(0,a.D)((e=>e.viewport.dpr)),f=cE(c),g=i.useMemo((()=>Float32Array.from(Array.from({length:t},(()=>f.map(s.MathUtils.randFloatSpread))).flat())),[t,...f]),y=lE(t,l,Math.random),v=lE(t,o),x=lE(t,n),E=lE(3*t,e),w=lE(void 0===u?3*t:t,sE(u)?u:new s.Color(u),(()=>1));return(0,a.F)((e=>{m.current&&m.current.material&&(m.current.material.time=e.clock.elapsedTime)})),i.useImperativeHandle(A,(()=>m.current),[]),i.createElement("points",(0,r.Z)({key:`particle-${t}-${JSON.stringify(c)}`},d,{ref:m}),i.createElement("bufferGeometry",null,i.createElement("bufferAttribute",{attach:"attributes-position",args:[g,3]}),i.createElement("bufferAttribute",{attach:"attributes-size",args:[y,1]}),i.createElement("bufferAttribute",{attach:"attributes-opacity",args:[v,1]}),i.createElement("bufferAttribute",{attach:"attributes-speed",args:[x,1]}),i.createElement("bufferAttribute",{attach:"attributes-color",args:[w,3]}),i.createElement("bufferAttribute",{attach:"attributes-noise",args:[E,3]})),h||i.createElement("sparklesImplMaterial",{transparent:!0,pixelRatio:p,depthWrite:!1}))}));const hE="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/matcaps.json",dE="https://rawcdn.githack.com/emmelleppi/matcaps/9b36ccaaf0a24881a39062d05566c9e92be4aa0d";function AE(e=0,t=1024,n){const r=(0,_a.Rq)((()=>fetch(hE).then((e=>e.json()))),["matcapList"]),o=r[0],s=i.useMemo((()=>Object.keys(r).length),[]),a=`${i.useMemo((()=>"string"===typeof e?e:"number"===typeof e?r[e]:null),[e])||o}${function(e){switch(e){case 64:return"-64px";case 128:return"-128px";case 256:return"-256px";case 512:return"-512px";default:return""}}(t)}.png`,c=`${dE}/${t}/${a}`;return[uc(c,n),c,s]}const mE=({children:e,id:t,format:n,onLoad:r})=>{const o=AE(t,n,r);return i.createElement(i.Fragment,null,null==e?void 0:e(o))},pE="https://rawcdn.githack.com/pmndrs/drei-assets/7a3104997e1576f83472829815b00880d88b32fb",fE="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/normals/normals.json";function gE(e=0,t={},n){const{repeat:r=[1,1],anisotropy:o=1,offset:a=[0,0]}=t,c=(0,_a.Rq)((()=>fetch(fE).then((e=>e.json()))),["normalsList"]),l=i.useMemo((()=>Object.keys(c).length),[]),u=c[0],h=c[e]||u,d=`${pE}/normals/${h}`,A=uc(d,n);return i.useLayoutEffect((()=>{A&&(A.wrapS=A.wrapT=s.RepeatWrapping,A.repeat=new s.Vector2(r[0],r[1]),A.offset=new s.Vector2(a[0],a[1]),A.anisotropy=o)}),[A,o,r,a]),[A,d,l]}const yE=({children:e,id:t,onLoad:n,...r})=>{const o=gE(t,r,n);return i.createElement(i.Fragment,null,null==e?void 0:e(o))},vE={uniforms:{strokeOpacity:1,fillOpacity:.25,fillMix:0,thickness:.05,colorBackfaces:!1,dashInvert:!0,dash:!1,dashRepeats:4,dashLength:.5,squeeze:!1,squeezeMin:.2,squeezeMax:1,stroke:new s.Color("#ff0000"),backfaceStroke:new s.Color("#0000ff"),fill:new s.Color("#00ff00")},vertex:"\n\t  attribute vec3 barycentric;\n\t\n\t\tvarying vec3 v_edges_Barycentric;\n\t\tvarying vec3 v_edges_Position;\n\n\t\tvoid initWireframe() {\n\t\t\tv_edges_Barycentric = barycentric;\n\t\t\tv_edges_Position = position.xyz;\n\t\t}\n\t  ",fragment:"\n\t\t#ifndef PI\n\t  \t#define PI 3.1415926535897932384626433832795\n\t\t#endif\n  \n\t  varying vec3 v_edges_Barycentric;\n\t  varying vec3 v_edges_Position;\n  \n\t  uniform float strokeOpacity;\n\t  uniform float fillOpacity;\n\t  uniform float fillMix;\n\t  uniform float thickness;\n\t  uniform bool colorBackfaces;\n  \n\t  // Dash\n\t  uniform bool dashInvert;\n\t  uniform bool dash;\n\t  uniform bool dashOnly;\n\t  uniform float dashRepeats;\n\t  uniform float dashLength;\n  \n\t  // Squeeze\n\t  uniform bool squeeze;\n\t  uniform float squeezeMin;\n\t  uniform float squeezeMax;\n  \n\t  // Colors\n\t  uniform vec3 stroke;\n\t  uniform vec3 backfaceStroke;\n\t  uniform vec3 fill;\n  \n\t  // This is like\n\t  float wireframe_aastep(float threshold, float dist) {\n\t\t  float afwidth = fwidth(dist) * 0.5;\n\t\t  return smoothstep(threshold - afwidth, threshold + afwidth, dist);\n\t  }\n  \n\t  float wireframe_map(float value, float min1, float max1, float min2, float max2) {\n\t\t  return min2 + (value - min1) * (max2 - min2) / (max1 - min1);\n\t  }\n  \n\t  float getWireframe() {\n\t\t\tvec3 barycentric = v_edges_Barycentric;\n\t\t\n\t\t\t// Distance from center of each triangle to its edges.\n\t\t\tfloat d = min(min(barycentric.x, barycentric.y), barycentric.z);\n\n\t\t\t// for dashed rendering, we can use this to get the 0 .. 1 value of the line length\n\t\t\tfloat positionAlong = max(barycentric.x, barycentric.y);\n\t\t\tif (barycentric.y < barycentric.x && barycentric.y < barycentric.z) {\n\t\t\t\tpositionAlong = 1.0 - positionAlong;\n\t\t\t}\n\n\t\t\t// the thickness of the stroke\n\t\t\tfloat computedThickness = wireframe_map(thickness, 0.0, 1.0, 0.0, 0.34);\n\n\t\t\t// if we want to shrink the thickness toward the center of the line segment\n\t\t\tif (squeeze) {\n\t\t\t\tcomputedThickness *= mix(squeezeMin, squeezeMax, (1.0 - sin(positionAlong * PI)));\n\t\t\t}\n\n\t\t\t// Create dash pattern\n\t\t\tif (dash) {\n\t\t\t\t// here we offset the stroke position depending on whether it\n\t\t\t\t// should overlap or not\n\t\t\t\tfloat offset = 1.0 / dashRepeats * dashLength / 2.0;\n\t\t\t\tif (!dashInvert) {\n\t\t\t\t\toffset += 1.0 / dashRepeats / 2.0;\n\t\t\t\t}\n\n\t\t\t\t// if we should animate the dash or not\n\t\t\t\t// if (dashAnimate) {\n\t\t\t\t// \toffset += time * 0.22;\n\t\t\t\t// }\n\n\t\t\t\t// create the repeating dash pattern\n\t\t\t\tfloat pattern = fract((positionAlong + offset) * dashRepeats);\n\t\t\t\tcomputedThickness *= 1.0 - wireframe_aastep(dashLength, pattern);\n\t\t\t}\n\n\t\t\t// compute the anti-aliased stroke edge  \n\t\t\tfloat edge = 1.0 - wireframe_aastep(computedThickness, d);\n\n\t\t\treturn edge;\n\t  }\n\t  "},xE=cc(vE.uniforms,vE.vertex+"\n  \tvoid main() {\n\t\tinitWireframe();\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\t}\n  ",vE.fragment+"\n  void main () {\n\t\t// Compute color\n\n\t\tfloat edge = getWireframe();\n\t\tvec4 colorStroke = vec4(stroke, edge);\n\n\t\t#ifdef FLIP_SIDED\n\t\t\tcolorStroke.rgb = backfaceStroke;\n\t\t#endif\n    \n\t\tvec4 colorFill = vec4(fill, fillOpacity);\n\t\tvec4 outColor = mix(colorFill, colorStroke, edge * strokeOpacity);\n\n\t\tgl_FragColor = outColor;\n\t}\n  ");function EE(e){return void 0!==(null==e?void 0:e.current)}function wE(e){return"WireframeGeometry"===e.type}function CE(e){const t=null!=(n=e)&&n.current?e.current:e;var n;if(function(e){return!(null==e||!e.isBufferGeometry)}(t))return t;{if(wE(t))throw new Error("Wireframe: WireframeGeometry is not supported.");const e=t.parent;if(function(e){return!(null==e||!e.geometry)}(e)){if(wE(e.geometry))throw new Error("Wireframe: WireframeGeometry is not supported.");return e.geometry}}}function IE(e,t){if(e.index){console.warn("Wireframe: Requires non-indexed geometry, converting to non-indexed geometry.");const t=e.toNonIndexed();e.copy(t),e.setIndex(null)}const n=function(e,t){const n=e.getAttribute("position").count,r=[];for(let i=0;i<n;i++){const e=t?1:0;i%2===0?r.push(0,0,1,0,1,0,1,0,e):r.push(0,1,0,0,0,1,1,0,e)}return new s.BufferAttribute(Float32Array.from(r),3)}(e,t);e.setAttribute("barycentric",n)}function _E({geometry:e,simplify:t=!1,...n}){(0,a.e)({MeshWireframeMaterial:xE});const[o,c]=i.useState(null);i.useLayoutEffect((()=>{const n=CE(e);if(!n)throw new Error("Wireframe: geometry prop must be a BufferGeometry or a ref to a BufferGeometry.");IE(n,t),EE(e)&&c(n)}),[t,e]);const l=EE(e)?o:e;return i.createElement(i.Fragment,null,l&&i.createElement("mesh",{geometry:l},i.createElement("meshWireframeMaterial",(0,r.Z)({attach:"material",transparent:!0,side:s.DoubleSide,polygonOffset:!0,polygonOffsetFactor:-4},n,{extensions:{derivatives:!0,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1}}))))}function bE({simplify:e=!1,...t}){const n=i.useRef(null),r=i.useMemo((()=>function(){const e={};for(const t in vE.uniforms)e[t]={value:vE.uniforms[t]};return e}()),[vE.uniforms]);return function(e,t){i.useEffect((()=>{var n;e.fillOpacity.value=null!==(n=t.fillOpacity)&&void 0!==n?n:e.fillOpacity.value}),[t.fillOpacity]),i.useEffect((()=>{var n;e.fillMix.value=null!==(n=t.fillMix)&&void 0!==n?n:e.fillMix.value}),[t.fillMix]),i.useEffect((()=>{var n;e.strokeOpacity.value=null!==(n=t.strokeOpacity)&&void 0!==n?n:e.strokeOpacity.value}),[t.strokeOpacity]),i.useEffect((()=>{var n;e.thickness.value=null!==(n=t.thickness)&&void 0!==n?n:e.thickness.value}),[t.thickness]),i.useEffect((()=>{e.colorBackfaces.value=!!t.colorBackfaces}),[t.colorBackfaces]),i.useEffect((()=>{e.dash.value=!!t.dash}),[t.dash]),i.useEffect((()=>{e.dashInvert.value=!!t.dashInvert}),[t.dashInvert]),i.useEffect((()=>{var n;e.dashRepeats.value=null!==(n=t.dashRepeats)&&void 0!==n?n:e.dashRepeats.value}),[t.dashRepeats]),i.useEffect((()=>{var n;e.dashLength.value=null!==(n=t.dashLength)&&void 0!==n?n:e.dashLength.value}),[t.dashLength]),i.useEffect((()=>{e.squeeze.value=!!t.squeeze}),[t.squeeze]),i.useEffect((()=>{var n;e.squeezeMin.value=null!==(n=t.squeezeMin)&&void 0!==n?n:e.squeezeMin.value}),[t.squeezeMin]),i.useEffect((()=>{var n;e.squeezeMax.value=null!==(n=t.squeezeMax)&&void 0!==n?n:e.squeezeMax.value}),[t.squeezeMax]),i.useEffect((()=>{e.stroke.value=t.stroke?new s.Color(t.stroke):e.stroke.value}),[t.stroke]),i.useEffect((()=>{e.fill.value=t.fill?new s.Color(t.fill):e.fill.value}),[t.fill]),i.useEffect((()=>{e.backfaceStroke.value=t.backfaceStroke?new s.Color(t.backfaceStroke):e.backfaceStroke.value}),[t.backfaceStroke])}(r,t),i.useLayoutEffect((()=>{const t=CE(n);if(!t)throw new Error("Wireframe: Must be a child of a Mesh, Line or Points object or specify a geometry prop.");const r=t.clone();return IE(t,e),()=>{t.copy(r),r.dispose()}}),[e]),i.useLayoutEffect((()=>{const e=n.current.parent,t=e.material.clone();return function(e,t){e.onBeforeCompile=e=>{e.uniforms={...e.uniforms,...t},e.vertexShader=e.vertexShader.replace("void main() {",`\n\t\t  ${vE.vertex}\n\t\t  void main() {\n\t\t\tinitWireframe();\n\t\t`),e.fragmentShader=e.fragmentShader.replace("void main() {",`\n\t\t  ${vE.fragment}\n\t\t  void main() {\n\t\t`),e.fragmentShader=e.fragmentShader.replace("#include <color_fragment>","\n\t\t  #include <color_fragment>\n\t\t\t  float edge = getWireframe();\n\t\t  vec4 colorStroke = vec4(stroke, edge);\n\t\t  #ifdef FLIP_SIDED\n\t\t\tcolorStroke.rgb = backfaceStroke;\n\t\t  #endif\n\t\t  vec4 colorFill = vec4(mix(diffuseColor.rgb, fill, fillMix), mix(diffuseColor.a, fillOpacity, fillMix));\n\t\t  vec4 outColor = mix(colorFill, colorStroke, edge * strokeOpacity);\n\n\t\t  diffuseColor.rgb = outColor.rgb;\n\t\t  diffuseColor.a *= outColor.a;\n\t\t")},e.side=s.DoubleSide,e.transparent=!0}(e.material,r),()=>{e.material.dispose(),e.material=t}}),[]),i.createElement("object3D",{ref:n})}function BE({geometry:e,...t}){return e?i.createElement(_E,(0,r.Z)({geometry:e},t)):i.createElement(bE,t)}function ME({opacity:e,alphaMap:t}){const n=i.useRef(null),r=i.useRef(null),o=i.useRef({value:1}),c=i.useRef({value:null}),l=i.useRef({value:!1});return i.useLayoutEffect((()=>{n.current.onBeforeCompile=r.current.onBeforeCompile=e=>{const t=e.fragmentShader.indexOf("void main");let n,r="",i=t;for(;"\n"!==n&&i<t+100;)n=e.fragmentShader.charAt(i),r+=n,i++;r=r.trim(),e.vertexShader=e.vertexShader.replace("void main() {","\n        varying vec2 custom_vUv;\n\n        void main() {\n          custom_vUv = uv;\n          \n        "),e.fragmentShader=e.fragmentShader.replace(r,"\n          uniform float uShadowOpacity;\n          uniform sampler2D uAlphaMap;\n          uniform bool uHasAlphaMap;\n\n          varying vec2 custom_vUv;\n  \n          float bayerDither2x2( vec2 v ) {\n            return mod( 3.0 * v.y + 2.0 * v.x, 4.0 );\n          }\n    \n          float bayerDither4x4( vec2 v ) {\n            vec2 P1 = mod( v, 2.0 );\n            vec2 P2 = mod( floor( 0.5  * v ), 2.0 );\n            return 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );\n          }\n  \n          void main() {\n            float alpha = \n              uHasAlphaMap ? \n                uShadowOpacity * texture2D(uAlphaMap, custom_vUv).x\n              : uShadowOpacity;\n\n            if( ( bayerDither4x4( floor( mod( gl_FragCoord.xy, 4.0 ) ) ) ) / 16.0 >= alpha ) discard;\n            \n          "),e.uniforms.uShadowOpacity=o.current,e.uniforms.uAlphaMap=c.current,e.uniforms.uHasAlphaMap=l.current}}),[]),(0,a.F)((()=>{var r;const i=null==(r=n.current.__r3f)?void 0:r.parent;if(i){const n=i.material;n&&(o.current.value=null!==e&&void 0!==e?e:n.opacity,!1===t?(c.current.value=null,l.current.value=!1):(c.current.value=t||n.alphaMap,l.current.value=!!c.current.value))}})),i.createElement(i.Fragment,null,i.createElement("meshDepthMaterial",{ref:n,attach:"customDepthMaterial",depthPacking:s.RGBADepthPacking}),i.createElement("meshDistanceMaterial",{ref:r,attach:"customDistanceMaterial"}))}const SE=new s.Matrix4,DE=new s.Ray,TE=new s.Sphere,QE=new s.Vector3;class PE extends s.Group{constructor(){super(),this.size=0,this.color=new s.Color("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return null==(e=this.instance.current)?void 0:e.geometry}raycast(e,t){var n,r;const i=this.instance.current;if(!i||!i.geometry)return;const o=i.userData.instances.indexOf(this.instanceKey);if(-1===o||o>i.geometry.drawRange.count)return;const a=null!==(n=null==(r=e.params.Points)?void 0:r.threshold)&&void 0!==n?n:1;if(TE.set(this.getWorldPosition(QE),a),!1===e.ray.intersectsSphere(TE))return;SE.copy(i.matrixWorld).invert(),DE.copy(e.ray).applyMatrix4(SE);const c=a/((this.scale.x+this.scale.y+this.scale.z)/3),l=c*c,u=DE.distanceSqToPoint(this.position);if(u<l){const n=new s.Vector3;DE.closestPointToPoint(this.position,n),n.applyMatrix4(this.matrixWorld);const r=e.ray.origin.distanceTo(n);if(r<e.near||r>e.far)return;t.push({distance:r,distanceToRay:Math.sqrt(u),point:n,index:o,face:null,object:this})}}}let zE,RE;const FE=i.createContext(null),kE=new s.Matrix4,LE=new s.Vector3,OE=i.forwardRef((({children:e,range:t,limit:n=1e3,...o},c)=>{const l=i.useRef(null);i.useImperativeHandle(c,(()=>l.current),[]);const[u,h]=i.useState([]),[[d,A,m]]=i.useState((()=>[new Float32Array(3*n),Float32Array.from({length:3*n},(()=>1)),Float32Array.from({length:n},(()=>1))]));i.useEffect((()=>{l.current.geometry.attributes.position.needsUpdate=!0})),(0,a.F)((()=>{for(l.current.updateMatrix(),l.current.updateMatrixWorld(),kE.copy(l.current.matrixWorld).invert(),l.current.geometry.drawRange.count=Math.min(n,void 0!==t?t:n,u.length),zE=0;zE<u.length;zE++)RE=u[zE].current,RE.getWorldPosition(LE).applyMatrix4(kE),LE.toArray(d,3*zE),l.current.geometry.attributes.position.needsUpdate=!0,RE.matrixWorldNeedsUpdate=!0,RE.color.toArray(A,3*zE),l.current.geometry.attributes.color.needsUpdate=!0,m.set([RE.size],zE),l.current.geometry.attributes.size.needsUpdate=!0}));const p=i.useMemo((()=>({getParent:()=>l,subscribe:e=>(h((t=>[...t,e])),()=>h((t=>t.filter((t=>t.current!==e.current)))))})),[]);return i.createElement("points",(0,r.Z)({userData:{instances:u},matrixAutoUpdate:!1,ref:l,raycast:()=>null},o),i.createElement("bufferGeometry",null,i.createElement("bufferAttribute",{attach:"attributes-position",count:d.length/3,array:d,itemSize:3,usage:s.DynamicDrawUsage}),i.createElement("bufferAttribute",{attach:"attributes-color",count:A.length/3,array:A,itemSize:3,usage:s.DynamicDrawUsage}),i.createElement("bufferAttribute",{attach:"attributes-size",count:m.length,array:m,itemSize:1,usage:s.DynamicDrawUsage})),i.createElement(FE.Provider,{value:p},e))})),UE=i.forwardRef((({children:e,...t},n)=>{i.useMemo((()=>(0,a.e)({PositionPoint:PE})),[]);const o=i.useRef(null);i.useImperativeHandle(n,(()=>o.current),[]);const{subscribe:s,getParent:c}=i.useContext(FE);return i.useLayoutEffect((()=>s(o)),[]),i.createElement("positionPoint",(0,r.Z)({instance:c(),instanceKey:o,ref:o},t),e)})),NE=i.forwardRef((({children:e,positions:t,colors:n,sizes:o,stride:c=3,...l},u)=>{const h=i.useRef(null);return i.useImperativeHandle(u,(()=>h.current),[]),(0,a.F)((()=>{const e=h.current.geometry.attributes;e.position.needsUpdate=!0,n&&(e.color.needsUpdate=!0),o&&(e.size.needsUpdate=!0)})),i.createElement("points",(0,r.Z)({ref:h},l),i.createElement("bufferGeometry",null,i.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/c,array:t,itemSize:c,usage:s.DynamicDrawUsage}),n&&i.createElement("bufferAttribute",{attach:"attributes-color",count:n.length/c,array:n,itemSize:3,usage:s.DynamicDrawUsage}),o&&i.createElement("bufferAttribute",{attach:"attributes-size",count:o.length/c,array:o,itemSize:1,usage:s.DynamicDrawUsage})),e)})),VE=i.forwardRef(((e,t)=>e.positions instanceof Float32Array?i.createElement(NE,(0,r.Z)({},e,{ref:t})):i.createElement(OE,(0,r.Z)({},e,{ref:t})))),GE=i.createContext(null),jE=i.forwardRef(((e,t)=>{i.useMemo((()=>(0,a.e)({SegmentObject:HE})),[]);const{limit:n=1e3,lineWidth:o=1,children:c,...l}=e,[u,h]=i.useState([]),[d]=i.useState((()=>new ga)),[A]=i.useState((()=>new Zs)),[m]=i.useState((()=>new Xs)),[p]=i.useState((()=>new s.Vector2(512,512))),[f]=i.useState((()=>Array(6*n).fill(0))),[g]=i.useState((()=>Array(6*n).fill(0))),y=i.useMemo((()=>({subscribe:e=>(h((t=>[...t,e])),()=>h((t=>t.filter((t=>t.current!==e.current)))))})),[]);return(0,a.F)((()=>{for(let t=0;t<n;t++){var e;const n=null==(e=u[t])?void 0:e.current;n&&(f[6*t+0]=n.start.x,f[6*t+1]=n.start.y,f[6*t+2]=n.start.z,f[6*t+3]=n.end.x,f[6*t+4]=n.end.y,f[6*t+5]=n.end.z,g[6*t+0]=n.color.r,g[6*t+1]=n.color.g,g[6*t+2]=n.color.b,g[6*t+3]=n.color.r,g[6*t+4]=n.color.g,g[6*t+5]=n.color.b)}m.setColors(g),m.setPositions(f),d.computeLineDistances()})),i.createElement("primitive",{object:d,ref:t},i.createElement("primitive",{object:m,attach:"geometry"}),i.createElement("primitive",(0,r.Z)({object:A,attach:"material",vertexColors:!0,resolution:p,linewidth:o},l)),i.createElement(GE.Provider,{value:y},c))}));class HE{constructor(){this.color=new s.Color("white"),this.start=new s.Vector3(0,0,0),this.end=new s.Vector3(0,0,0)}}const qE=e=>e instanceof s.Vector3?e:new s.Vector3(..."number"===typeof e?[e,e,e]:e),WE=i.forwardRef((({color:e,start:t,end:n},r)=>{const o=i.useContext(GE);if(!o)throw"Segment must used inside Segments component.";const s=i.useRef(null);return i.useImperativeHandle(r,(()=>s.current),[]),i.useLayoutEffect((()=>o.subscribe(s)),[]),i.createElement("segmentObject",{ref:s,color:e,start:qE(t),end:qE(n)})})),YE=i.forwardRef((({children:e,hysteresis:t=0,distances:n,...o},s)=>{const c=i.useRef(null);return i.useImperativeHandle(s,(()=>c.current),[]),i.useLayoutEffect((()=>{const{current:e}=c;e.levels.length=0,e.children.forEach(((r,i)=>e.levels.push({object:r,hysteresis:t,distance:n[i]})))})),(0,a.F)((e=>{var t;return null==(t=c.current)?void 0:t.update(e.camera)})),i.createElement("lOD",(0,r.Z)({ref:c},o),e)}));function XE({all:e,scene:t,camera:n}){const r=(0,a.D)((({gl:e})=>e)),o=(0,a.D)((({camera:e})=>e)),c=(0,a.D)((({scene:e})=>e));return i.useLayoutEffect((()=>{const i=[];e&&(t||c).traverse((e=>{!1===e.visible&&(i.push(e),e.visible=!0)})),r.compile(t||c,n||o);const a=new s.WebGLCubeRenderTarget(128);new s.CubeCamera(.01,1e5,a).update(r,t||c),a.dispose(),i.forEach((e=>e.visible=!1))}),[]),null}function ZE(){const e=(0,a.D)((e=>e.gl));return(0,i.useEffect)((()=>(e.shadowMap.autoUpdate=!1,e.shadowMap.needsUpdate=!0,()=>{e.shadowMap.autoUpdate=e.shadowMap.needsUpdate=!0})),[e.shadowMap]),null}const KE=new s.Matrix4,JE=new s.Ray,$E=new s.Sphere,ew=new s.Vector3;function tw(e,t){const n=this.geometry,r=this.material,i=this.matrixWorld;void 0!==r&&(null===n.boundingSphere&&n.computeBoundingSphere(),$E.copy(n.boundingSphere),$E.applyMatrix4(i),!1!==e.ray.intersectsSphere($E)&&(KE.copy(i).invert(),JE.copy(e.ray).applyMatrix4(KE),null!==n.boundingBox&&null===JE.intersectBox(n.boundingBox,ew)||t.push({distance:ew.distanceTo(e.ray.origin),point:ew.clone(),object:this})))}function nw({pixelated:e}){const t=(0,a.D)((e=>e.gl)),n=(0,a.D)((e=>e.internal.active)),r=(0,a.D)((e=>e.performance.current)),o=(0,a.D)((e=>e.viewport.initialDpr)),s=(0,a.D)((e=>e.setDpr));return i.useEffect((()=>{const r=t.domElement;return()=>{n&&s(o),e&&r&&(r.style.imageRendering="auto")}}),[]),i.useEffect((()=>{s(r*o),e&&t.domElement&&(t.domElement.style.imageRendering=1===r?"auto":"pixelated")}),[r]),null}function rw(){const e=(0,a.D)((e=>e.get)),t=(0,a.D)((e=>e.setEvents)),n=(0,a.D)((e=>e.performance.current));return i.useEffect((()=>{const n=e().events.enabled;return()=>t({enabled:n})}),[]),i.useEffect((()=>t({enabled:1===n})),[n]),null}const iw=(0,i.createContext)(null);function ow({iterations:e=10,ms:t=250,threshold:n=.75,step:r=.1,factor:o=.5,flipflops:s=1/0,bounds:c=(e=>e>100?[60,100]:[40,60]),onIncline:l,onDecline:u,onChange:h,onFallback:d,children:A}){const m=Math.pow(10,0),[p,f]=(0,i.useState)((()=>({fps:0,index:0,factor:o,flipped:0,refreshrate:0,fallback:!1,frames:[],averages:[],subscriptions:new Map,subscribe:e=>{const t=Symbol();return p.subscriptions.set(t,e.current),()=>{p.subscriptions.delete(t)}}})));let g=0;return(0,a.F)((()=>{const{frames:i,averages:o}=p;if(!p.fallback&&o.length<e){i.push(performance.now());const a=i[i.length-1]-i[0];if(a>=t){if(p.fps=Math.round(i.length/a*1e3*m)/m,p.refreshrate=Math.max(p.refreshrate,p.fps),o[p.index++%e]=p.fps,o.length===e){const[t,i]=c(p.refreshrate),a=o.filter((e=>e>=i)),A=o.filter((e=>e<t));a.length>e*n&&(p.factor=Math.min(1,p.factor+r),p.flipped++,l&&l(p),p.subscriptions.forEach((e=>e.onIncline&&e.onIncline(p)))),A.length>e*n&&(p.factor=Math.max(0,p.factor-r),p.flipped++,u&&u(p),p.subscriptions.forEach((e=>e.onDecline&&e.onDecline(p)))),g!==p.factor&&(g=p.factor,h&&h(p),p.subscriptions.forEach((e=>e.onChange&&e.onChange(p)))),p.flipped>s&&!p.fallback&&(p.fallback=!0,d&&d(p),p.subscriptions.forEach((e=>e.onFallback&&e.onFallback(p)))),p.averages=[]}p.frames=[]}}})),i.createElement(iw.Provider,{value:p},A)}function sw({onIncline:e,onDecline:t,onChange:n,onFallback:r}){const o=(0,i.useContext)(iw),s=(0,i.useRef)({onIncline:e,onDecline:t,onChange:n,onFallback:r});(0,i.useLayoutEffect)((()=>{s.current.onIncline=e,s.current.onDecline=t,s.current.onChange=n,s.current.onFallback=r}),[e,t,n,r]),(0,i.useLayoutEffect)((()=>o.subscribe(s)),[o])}const aw=i.forwardRef((({children:e,compute:t,width:n,height:o,samples:c=8,renderPriority:l=0,eventPriority:u=0,frames:h=1/0,stencilBuffer:d=!1,depthBuffer:A=!0,generateMipmaps:m=!1,...p},f)=>{const{size:g,viewport:y}=(0,a.D)(),v=ol((n||g.width)*y.dpr,(o||g.height)*y.dpr,{samples:c,stencilBuffer:d,depthBuffer:A,generateMipmaps:m}),[x]=i.useState((()=>new s.Scene)),E=i.useCallback(((e,t,n)=>{var r,i;let o=null==(r=v.texture)?void 0:r.__r3f.parent;for(;o&&!(o instanceof s.Object3D);)o=o.__r3f.parent;if(!o)return!1;n.raycaster.camera||n.events.compute(e,n,null==(i=n.previousRoot)?void 0:i.getState());const[a]=n.raycaster.intersectObject(o);if(!a)return!1;const c=a.uv;if(!c)return!1;t.raycaster.setFromCamera(t.pointer.set(2*c.x-1,2*c.y-1),t.camera)}),[]);return i.useImperativeHandle(f,(()=>v.texture),[v]),i.createElement(i.Fragment,null,(0,a.h)(i.createElement(cw,{renderPriority:l,frames:h,fbo:v},e,i.createElement("group",{onPointerOver:()=>null})),x,{events:{compute:t||E,priority:u}}),i.createElement("primitive",(0,r.Z)({object:v.texture},p)))}));function cw({frames:e,renderPriority:t,children:n,fbo:r}){let o,s,c,l,u=0;return(0,a.F)((t=>{(e===1/0||u<e)&&(o=t.gl.autoClear,s=t.gl.xr.enabled,c=t.gl.getRenderTarget(),l=t.gl.xr.isPresenting,t.gl.autoClear=!0,t.gl.xr.enabled=!1,t.gl.xr.isPresenting=!1,t.gl.setRenderTarget(r),t.gl.render(t.scene,t.camera),t.gl.setRenderTarget(c),t.gl.autoClear=o,t.gl.xr.enabled=s,t.gl.xr.isPresenting=l,u++)}),t),i.createElement(i.Fragment,null,n)}const lw=i.forwardRef((({children:e,compute:t,renderPriority:n=-1,eventPriority:o=0,frames:c=1/0,stencilBuffer:l=!1,depthBuffer:u=!0,generateMipmaps:h=!1,resolution:d=896,near:A=.1,far:m=1e3,flip:p=!1,position:f,rotation:g,scale:y,quaternion:v,matrix:x,matrixAutoUpdate:E,...w},C)=>{const{size:I,viewport:_}=(0,a.D)(),b=i.useRef(null),B=i.useMemo((()=>{const e=new s.WebGLCubeRenderTarget(Math.max((d||I.width)*_.dpr,(d||I.height)*_.dpr),{stencilBuffer:l,depthBuffer:u,generateMipmaps:h});return e.texture.isRenderTargetTexture=!p,e.texture.flipY=!0,e.texture.type=s.HalfFloatType,e}),[d,p]);i.useEffect((()=>()=>B.dispose()),[B]);const[M]=i.useState((()=>new s.Scene));return i.useImperativeHandle(C,(()=>({scene:M,fbo:B,camera:b.current})),[B]),i.createElement(i.Fragment,null,(0,a.h)(i.createElement(uw,{renderPriority:n,frames:c,camera:b},e,i.createElement("group",{onPointerOver:()=>null})),M,{events:{compute:t,priority:o}}),i.createElement("primitive",(0,r.Z)({object:B.texture},w)),i.createElement("cubeCamera",{ref:b,args:[A,m,B],position:f,rotation:g,scale:y,quaternion:v,matrix:x,matrixAutoUpdate:E}))}));function uw({frames:e,renderPriority:t,children:n,camera:r}){let o=0;return(0,a.F)((t=>{(e===1/0||o<e)&&(r.current.update(t.gl,t.scene),o++)}),t),i.createElement(i.Fragment,null,n)}const hw=i.forwardRef((({id:e=1,colorWrite:t=!1,depthWrite:n=!1,...o},a)=>{const c=i.useRef(null),l=i.useMemo((()=>({colorWrite:t,depthWrite:n,stencilWrite:!0,stencilRef:e,stencilFunc:s.AlwaysStencilFunc,stencilFail:s.ReplaceStencilOp,stencilZFail:s.ReplaceStencilOp,stencilZPass:s.ReplaceStencilOp})),[e,t,n]);return i.useLayoutEffect((()=>{Object.assign(c.current.material,l)})),i.useImperativeHandle(a,(()=>c.current),[]),i.createElement("mesh",(0,r.Z)({ref:c,renderOrder:-e},o))}));function dw(e,t=!1){return{stencilWrite:!0,stencilRef:e,stencilFunc:t?s.NotEqualStencilFunc:s.EqualStencilFunc,stencilFail:s.KeepStencilOp,stencilZFail:s.KeepStencilOp,stencilZPass:s.KeepStencilOp}}function Aw({renderPriority:e=1,zoom:t=0,segments:n=64,children:o,resolution:c=896,...l}){const u=i.useRef(null),h=i.useRef(null),{width:d,height:A}=(0,a.D)((e=>e.size)),[m]=i.useState((()=>new s.OrthographicCamera));i.useLayoutEffect((()=>{m.position.set(0,0,100),m.zoom=100,m.left=d/-2,m.right=d/2,m.top=A/2,m.bottom=A/-2,m.updateProjectionMatrix()}),[d,A]);const p=Math.sqrt(d*d+A*A)/100*(.5+t/2),f=new s.Vector3,g=new s.Sphere(new s.Vector3,p),y=new s.Matrix3,v=i.useCallback(((e,t,n)=>{t.pointer.set(e.offsetX/t.size.width*2-1,-e.offsetY/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,m),t.raycaster.ray.intersectSphere(g,f)&&(f.normalize(),y.getNormalMatrix(h.current.camera.matrixWorld),h.current.camera.getWorldPosition(t.raycaster.ray.origin),t.raycaster.ray.direction.set(0,0,1).reflect(f),t.raycaster.ray.direction.x*=-1,t.raycaster.ray.direction.applyNormalMatrix(y).multiplyScalar(-1))}),[]);return(0,a.F)((t=>{e&&t.gl.render(u.current,m)}),e),i.createElement(i.Fragment,null,i.createElement("mesh",(0,r.Z)({ref:u},l,{scale:p}),i.createElement("sphereGeometry",{args:[1,n,n]}),i.createElement("meshBasicMaterial",null,i.createElement(lw,{compute:v,attach:"envMap",flip:!0,resolution:c,ref:h},o,i.createElement(mw,{api:h})))))}function mw({api:e}){const t=new s.Vector3,n=new s.Quaternion,r=new s.Vector3,i=new s.Euler(0,Math.PI,0);return(0,a.F)((o=>{o.camera.matrixWorld.decompose(t,n,r),e.current.camera.position.copy(t),e.current.camera.quaternion.setFromEuler(i).premultiply(n)})),null}const pw=cc({blur:0,map:null,sdf:null,blend:0,size:0,resolution:new s.Vector2},"varying vec2 vUv;\n   void main() {\n     gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n     vUv = uv;\n   }",`uniform sampler2D sdf;\n   uniform sampler2D map;\n   uniform float blur;\n   uniform float size;\n   uniform float time;\n   uniform vec2 resolution;\n   varying vec2 vUv;\n   #include <packing>\n   void main() {\n     vec2 uv = gl_FragCoord.xy / resolution.xy;\n     vec4 t = texture2D(map, uv);\n     float k = blur;\n     float d = texture2D(sdf, vUv).r/size;\n     float alpha = 1.0 - smoothstep(0.0, 1.0, clamp(d/k + 1.0, 0.0, 1.0));\n     gl_FragColor = vec4(t.rgb, blur == 0.0 ? t.a : t.a * alpha);\n     #include <tonemapping_fragment>\n     #include <${dc>=154?"colorspace_fragment":"encodings_fragment"}>\n   }`),fw=i.forwardRef((({children:e,events:t,blur:n=0,eventPriority:o=0,renderPriority:c=0,worldUnits:l=!1,resolution:u=512,...h},d)=>{(0,a.e)({PortalMaterialImpl:pw});const A=i.useRef(null),{scene:m,gl:p,size:f,viewport:g,setEvents:y}=(0,a.D)(),v=ol(u,u),[x,E]=i.useState(0);(0,a.F)((()=>{const e=A.current.blend>0?Math.max(1,c):0;x!==e&&E(e)})),i.useEffect((()=>{void 0!==t&&y({enabled:!t})}),[t]);const[w,C]=i.useState(!0),I=yg(C);i.useLayoutEffect((()=>{var e;I.current=null==(e=A.current)?void 0:e.__r3f.parent}),[]),i.useLayoutEffect((()=>{if(I.current&&n&&null===A.current.sdf){const e=new s.Mesh(I.current.geometry,new s.MeshBasicMaterial),t=(new s.Box3).setFromBufferAttribute(e.geometry.attributes.position),n=new s.OrthographicCamera(t.min.x*(1+2/u),t.max.x*(1+2/u),t.max.y*(1+2/u),t.min.y*(1+2/u),.1,1e3);n.position.set(0,0,1),n.lookAt(0,0,0),p.setRenderTarget(v),p.render(e,n);const r=yw(u,u,p)(v.texture),i=new Float32Array(u*u);p.readRenderTargetPixels(r,0,0,u,u,i);let o=1/0;for(let s=0;s<i.length;s++)i[s]<o&&(o=i[s]);o=-o,A.current.size=o,A.current.sdf=r.texture,p.setRenderTarget(null)}}),[u,n]),i.useImperativeHandle(d,(()=>A.current));const _=i.useCallback(((e,t,n)=>{var r;if(!I.current)return!1;if(t.pointer.set(e.offsetX/t.size.width*2-1,-e.offsetY/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera),0===(null==(r=A.current)?void 0:r.blend)){const[e]=t.raycaster.intersectObject(I.current);if(!e)return t.raycaster.camera=void 0,!1}}),[]);return i.createElement("portalMaterialImpl",(0,r.Z)({ref:A,blur:n,blend:0,resolution:[f.width*g.dpr,f.height*g.dpr],attach:"material"},h),i.createElement(aw,{attach:"map",frames:w?1/0:0,eventPriority:o,renderPriority:c,compute:_},e,i.createElement(gw,{events:t,rootScene:m,priority:x,material:A,worldUnits:l})))}));function gw({events:e,rootScene:t,material:n,priority:r,worldUnits:o}){const c=(0,a.D)((e=>e.scene)),l=(0,a.D)((e=>e.setEvents)),u=ol(),h=ol();i.useLayoutEffect((()=>{c.matrixAutoUpdate=!1}),[]),i.useEffect((()=>{void 0!==e&&l({enabled:e})}),[e]);const[d,A]=i.useMemo((()=>{const e={value:0};return[new Ga(new s.ShaderMaterial({uniforms:{a:{value:u.texture},b:{value:h.texture},blend:e},vertexShader:"\n          varying vec2 vUv;\n          void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n          }",fragmentShader:`\n          uniform sampler2D a;\n          uniform sampler2D b;\n          uniform float blend;\n          varying vec2 vUv;\n          #include <packing>\n          void main() {\n            vec4 ta = texture2D(a, vUv);\n            vec4 tb = texture2D(b, vUv);\n            gl_FragColor = mix(tb, ta, blend);\n            #include <tonemapping_fragment>\n            #include <${dc>=154?"colorspace_fragment":"encodings_fragment"}>\n          }`})),e]}),[]);return(0,a.F)((e=>{var i;let s=null==n||null==(i=n.current)?void 0:i.__r3f.parent;if(s){var a,l,m,p;if(o)c.matrixWorld.identity();else r&&1===(null==(a=n.current)?void 0:a.blend)&&s.updateWorldMatrix(!0,!1),c.matrixWorld.copy(s.matrixWorld);if(r)(null==(l=n.current)?void 0:l.blend)>0&&(null==(m=n.current)?void 0:m.blend)<1?(A.value=n.current.blend,e.gl.setRenderTarget(u),e.gl.render(c,e.camera),e.gl.setRenderTarget(h),e.gl.render(t,e.camera),e.gl.setRenderTarget(null),d.render(e.gl)):1===(null==(p=n.current)?void 0:p.blend)&&e.gl.render(c,e.camera)}}),r),i.createElement(i.Fragment,null)}const yw=(e,t,n)=>{let r=new s.WebGLRenderTarget(e,t,{minFilter:s.LinearMipmapLinearFilter,magFilter:s.LinearFilter,type:s.FloatType,format:s.RedFormat,generateMipmaps:!0}),i=new s.WebGLRenderTarget(e,t,{minFilter:s.NearestFilter,magFilter:s.NearestFilter}),o=new s.WebGLRenderTarget(e,t,{minFilter:s.NearestFilter,magFilter:s.NearestFilter}),a=new s.WebGLRenderTarget(e,t,{minFilter:s.NearestFilter,magFilter:s.NearestFilter}),c=new s.WebGLRenderTarget(e,t,{minFilter:s.NearestFilter,magFilter:s.NearestFilter}),l=new s.WebGLRenderTarget(e,t,{minFilter:s.NearestFilter,magFilter:s.NearestFilter,type:s.FloatType,format:s.RedFormat}),u=new s.WebGLRenderTarget(e,t,{minFilter:s.NearestFilter,magFilter:s.NearestFilter,type:s.FloatType,format:s.RedFormat});const h=new Ga(new s.ShaderMaterial({uniforms:{tex:{value:null}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n          vUv = uv;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"\n        uniform sampler2D tex;\n        varying vec2 vUv;\n        #include <packing>\n        void main() {\n          gl_FragColor = pack2HalfToRGBA(vUv * (round(texture2D(tex, vUv).x)));\n        }"})),d=new Ga(new s.ShaderMaterial({uniforms:{tex:{value:null}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n          vUv = uv;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"\n        uniform sampler2D tex;\n        varying vec2 vUv;\n        #include <packing>\n        void main() {\n          gl_FragColor = pack2HalfToRGBA(vUv * (1.0 - round(texture2D(tex, vUv).x)));\n        }"})),A=new Ga(new s.ShaderMaterial({uniforms:{tex:{value:null},offset:{value:0},level:{value:0},maxSteps:{value:0}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n          vUv = uv;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:`\n        varying vec2 vUv;\n        uniform sampler2D tex;\n        uniform float offset;\n        uniform float level;\n        uniform float maxSteps;\n        #include <packing>\n        void main() {\n          float closestDist = 9999999.9;\n          vec2 closestPos = vec2(0.0);\n          for (float x = -1.0; x <= 1.0; x += 1.0) {\n            for (float y = -1.0; y <= 1.0; y += 1.0) {\n              vec2 voffset = vUv;\n              voffset += vec2(x, y) * vec2(${1/e}, ${1/t}) * offset;\n              vec2 pos = unpackRGBATo2Half(texture2D(tex, voffset));\n              float dist = distance(pos.xy, vUv);\n              if(pos.x != 0.0 && pos.y != 0.0 && dist < closestDist) {\n                closestDist = dist;\n                closestPos = pos;\n              }\n            }\n          }\n          gl_FragColor = pack2HalfToRGBA(closestPos);\n        }`})),m=new Ga(new s.ShaderMaterial({uniforms:{tex:{value:null},size:{value:new s.Vector2(e,t)}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n          vUv = uv;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"\n        varying vec2 vUv;\n        uniform sampler2D tex;\n        uniform vec2 size;\n        #include <packing>\n        void main() {\n          gl_FragColor = vec4(distance(size * unpackRGBATo2Half(texture2D(tex, vUv)), size * vUv), 0.0, 0.0, 0.0);\n        }"})),p=new Ga(new s.ShaderMaterial({uniforms:{inside:{value:u.texture},outside:{value:l.texture},tex:{value:null}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n          vUv = uv;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"\n        varying vec2 vUv;\n        uniform sampler2D inside;\n        uniform sampler2D outside;\n        uniform sampler2D tex;\n        #include <packing>\n        void main() {\n          float i = texture2D(inside, vUv).x;\n          float o =texture2D(outside, vUv).x;\n          if (texture2D(tex, vUv).x == 0.0) {\n            gl_FragColor = vec4(o, 0.0, 0.0, 0.0);\n          } else {\n            gl_FragColor = vec4(-i, 0.0, 0.0, 0.0);\n          }\n        }"}));return f=>{let g=r;f.minFilter=s.NearestFilter,f.magFilter=s.NearestFilter,h.material.uniforms.tex.value=f,n.setRenderTarget(i),h.render(n);const y=Math.ceil(Math.log(Math.max(e,t))/Math.log(2));let v=i,x=null;for(let e=0;e<y;e++){const t=Math.pow(2,y-e-1);x=v===i?a:i,A.material.uniforms.level.value=e,A.material.uniforms.maxSteps.value=y,A.material.uniforms.offset.value=t,A.material.uniforms.tex.value=v.texture,n.setRenderTarget(x),A.render(n),v=x}n.setRenderTarget(l),m.material.uniforms.tex.value=x.texture,m.render(n),d.material.uniforms.tex.value=f,n.setRenderTarget(o),d.render(n),v=o;for(let e=0;e<y;e++){const t=Math.pow(2,y-e-1);x=v===o?c:o,A.material.uniforms.level.value=e,A.material.uniforms.maxSteps.value=y,A.material.uniforms.offset.value=t,A.material.uniforms.tex.value=v.texture,n.setRenderTarget(x),A.render(n),v=x}return n.setRenderTarget(u),m.material.uniforms.tex.value=x.texture,m.render(n),n.setRenderTarget(g),p.material.uniforms.tex.value=f,p.render(n),n.setRenderTarget(null),g}},vw=e=>{let t;const n=new Set,r=(e,r)=>{const i="function"===typeof e?e(t):e;if(!Object.is(i,t)){const e=t;t=(null!=r?r:"object"!==typeof i||null===i)?i:Object.assign({},t,i),n.forEach((n=>n(t,e)))}},i=()=>t,o={setState:r,getState:i,getInitialState:()=>s,subscribe:e=>(n.add(e),()=>n.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},s=t=e(r,i,o);return o},xw=e=>e?vw(e):vw;var Ew=n(28306);const{useDebugValue:ww}=i,{useSyncExternalStoreWithSelector:Cw}=Ew;let Iw=!1;const _w=e=>e;const bw=e=>{"function"!==typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t="function"===typeof e?xw(e):e,n=(e,n)=>function(e,t=_w,n){n&&!Iw&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Iw=!0);const r=Cw(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return ww(r),r}(t,e,n);return Object.assign(n,t),n},Bw=e=>e?bw(e):bw;var Mw,Sw;const Dw="undefined"!==typeof window&&(null!=(Mw=window.document)&&Mw.createElement||"ReactNative"===(null==(Sw=window.navigator)?void 0:Sw.product))?i.useLayoutEffect:i.useEffect;const Tw=e=>e&&e.isOrthographicCamera,Qw=new s.Color,Pw=function(){const e=Bw((e=>({current:new Array,version:0,set:e})));return{In:({children:t})=>{const n=e((e=>e.set)),r=e((e=>e.version));return Dw((()=>{n((e=>({version:e.version+1})))}),[]),Dw((()=>(n((({current:e})=>({current:[...e,t]}))),()=>n((({current:e})=>({current:e.filter((e=>e!==t))}))))),[t,r]),null},Out:()=>{const t=e((e=>e.current));return i.createElement(i.Fragment,null,t)}}}();function zw(e){return"top"in e}function Rw(e,t){const{right:n,top:r,left:i,bottom:o,width:s,height:a}=t,c=t.bottom<0||r>e.height||n<0||t.left>e.width;if(zw(e)){const t=e.top+e.height-o;return{position:{width:s,height:a,left:i-e.left,top:r,bottom:t,right:n},isOffscreen:c}}return{position:{width:s,height:a,top:r,left:i,bottom:e.height-o,right:n},isOffscreen:c}}function Fw(e,{left:t,bottom:n,width:r,height:i}){let o;const s=r/i;return Tw(e.camera)?e.camera.left===r/-2&&e.camera.right===r/2&&e.camera.top===i/2&&e.camera.bottom===i/-2||(Object.assign(e.camera,{left:r/-2,right:r/2,top:i/2,bottom:i/-2}),e.camera.updateProjectionMatrix()):e.camera.aspect!==s&&(e.camera.aspect=s,e.camera.updateProjectionMatrix()),o=e.gl.autoClear,e.gl.autoClear=!1,e.gl.setViewport(t,n,r,i),e.gl.setScissor(t,n,r,i),e.gl.setScissorTest(!0),o}function kw(e,t){e.gl.setScissorTest(!1),e.gl.autoClear=t}function Lw(e){e.gl.getClearColor(Qw),e.gl.setClearColor(Qw,e.gl.getClearAlpha()),e.gl.clear(!0,!0)}function Ow({visible:e=!0,canvasSize:t,scene:n,index:r,children:o,frames:s,rect:c,track:l}){const u=(0,a.D)(),[h,d]=i.useState(!1);let A=0;return(0,a.F)((r=>{var i;(s===1/0||A<=s)&&(l&&(c.current=null==(i=l.current)?void 0:i.getBoundingClientRect()),A++);if(c.current){const{position:i,isOffscreen:s}=Rw(t,c.current);if(h!==s&&d(s),e&&!h&&c.current){const e=Fw(r,i);r.gl.render(o?r.scene:n,r.camera),kw(r,e)}}}),r),i.useLayoutEffect((()=>{const n=c.current;if(n&&(!e||!h)){const{position:e}=Rw(t,n),r=Fw(u,e);Lw(u),kw(u,r)}}),[e,h]),i.useEffect((()=>{if(!l)return;const e=c.current,n=u.get().events.connected;return u.setEvents({connected:l.current}),()=>{if(e){const{position:n}=Rw(t,e),r=Fw(u,n);Lw(u),kw(u,r)}u.setEvents({connected:n})}}),[l]),i.useEffect((()=>{zw(t)||console.warn("Detected @react-three/fiber canvas size does not include position information. <View /> may not work as expected. Upgrade to @react-three/fiber ^8.1.0 for support.\n See https://github.com/pmndrs/drei/issues/944")}),[]),i.createElement(i.Fragment,null,o,i.createElement("group",{onPointerOver:()=>null}))}const Uw=i.forwardRef((({track:e,visible:t=!0,index:n=1,id:o,style:c,className:l,frames:u=1/0,children:h,...d},A)=>{var m,p,f,g;const y=i.useRef(null),{size:v,scene:x}=(0,a.D)(),[E]=i.useState((()=>new s.Scene)),[w,C]=i.useReducer((()=>!0),!1),I=i.useCallback(((t,n)=>{if(y.current&&e&&e.current&&t.target===e.current){const{width:e,height:r,left:i,top:o}=y.current,s=t.clientX-i,a=t.clientY-o;n.pointer.set(s/e*2-1,-a/r*2+1),n.raycaster.setFromCamera(n.pointer,n.camera)}}),[y,e]);return i.useEffect((()=>{var t;e&&(y.current=null==(t=e.current)?void 0:t.getBoundingClientRect()),C()}),[e]),i.createElement("group",(0,r.Z)({ref:A},d),w&&(0,a.h)(i.createElement(Ow,{visible:t,canvasSize:v,frames:u,scene:x,track:e,rect:y,index:n},h),E,{events:{compute:I,priority:n},size:{width:null==(m=y.current)?void 0:m.width,height:null==(p=y.current)?void 0:p.height,top:null==(f=y.current)?void 0:f.top,left:null==(g=y.current)?void 0:g.left}}))})),Nw=i.forwardRef((({as:e="div",id:t,visible:n,className:o,style:s,index:a=1,track:c,frames:l=1/0,children:u,...h},d)=>{const A=i.useId(),m=i.useRef(null);return i.useImperativeHandle(d,(()=>m.current)),i.createElement(i.Fragment,null,i.createElement(e,(0,r.Z)({ref:m,id:t,className:o,style:s},h)),i.createElement(Pw.In,null,i.createElement(Uw,{visible:n,key:A,track:m,frames:l,index:a},u)))})),Vw=i.forwardRef(((e,t)=>i.useContext(a.g)?i.createElement(Uw,(0,r.Z)({ref:t},e)):i.createElement(Nw,(0,r.Z)({ref:t},e))));Vw.Port=()=>i.createElement(Pw.Out,null);const Gw=i.createContext(null),jw=new s.Vector3,Hw=new s.Vector3,qw=new s.Vector3(0,1,0),Ww=new s.Matrix4,Yw=({direction:e,axis:t})=>{const{translation:n,translationLimits:r,annotations:o,annotationsClass:c,depthTest:l,scale:u,lineWidth:h,fixed:d,axisColors:A,hoveredColor:m,opacity:p,onDragStart:f,onDrag:g,onDragEnd:v,userData:x}=i.useContext(Gw),E=(0,a.D)((e=>e.controls)),w=i.useRef(null),C=i.useRef(null),I=i.useRef(null),_=i.useRef(0),[b,B]=i.useState(!1),M=i.useCallback((r=>{o&&(w.current.innerText=`${n.current[t].toFixed(2)}`,w.current.style.display="block"),r.stopPropagation();const i=(new s.Matrix4).extractRotation(C.current.matrixWorld),a=r.point.clone(),c=(new s.Vector3).setFromMatrixPosition(C.current.matrixWorld),l=e.clone().applyMatrix4(i).normalize();I.current={clickPoint:a,dir:l},_.current=n.current[t],f({component:"Arrow",axis:t,origin:c,directions:[l]}),E&&(E.enabled=!1),r.target.setPointerCapture(r.pointerId)}),[o,e,E,f,n,t]),S=i.useCallback((e=>{if(e.stopPropagation(),b||B(!0),I.current){const{clickPoint:i,dir:s}=I.current,[a,c]=(null==r?void 0:r[t])||[void 0,void 0];let l=((e,t,n,r)=>{const i=t.dot(t),o=t.dot(e)-t.dot(n),s=t.dot(r);return 0===s?-o/i:(jw.copy(r).multiplyScalar(i/s).sub(t),Hw.copy(r).multiplyScalar(o/s).add(n).sub(e),-jw.dot(Hw)/jw.dot(jw))})(i,s,e.ray.origin,e.ray.direction);void 0!==a&&(l=Math.max(l,a-_.current)),void 0!==c&&(l=Math.min(l,c-_.current)),n.current[t]=_.current+l,o&&(w.current.innerText=`${n.current[t].toFixed(2)}`),Ww.makeTranslation(s.x*l,s.y*l,s.z*l),g(Ww)}}),[o,g,b,n,r,t]),D=i.useCallback((e=>{o&&(w.current.style.display="none"),e.stopPropagation(),I.current=null,v(),E&&(E.enabled=!0),e.target.releasePointerCapture(e.pointerId)}),[o,E,v]),T=i.useCallback((e=>{e.stopPropagation(),B(!1)}),[]),{cylinderLength:Q,coneWidth:P,coneLength:z,matrixL:R}=i.useMemo((()=>{const t=d?h/u*1.6:u/20,n=d?.2:u/5,r=d?1-n:u-n,i=(new s.Quaternion).setFromUnitVectors(qw,e.clone().normalize());return{cylinderLength:r,coneWidth:t,coneLength:n,matrixL:(new s.Matrix4).makeRotationFromQuaternion(i)}}),[e,u,h,d]),F=b?m:A[t];return i.createElement("group",{ref:C},i.createElement("group",{matrix:R,matrixAutoUpdate:!1,onPointerDown:M,onPointerMove:S,onPointerUp:D,onPointerOut:T},o&&i.createElement(y,{position:[0,-z,0]},i.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:c,ref:w})),i.createElement("mesh",{visible:!1,position:[0,(Q+z)/2,0],userData:x},i.createElement("cylinderGeometry",{args:[1.4*P,1.4*P,Q+z,8,1]})),i.createElement(ya,{transparent:!0,raycast:()=>null,depthTest:l,points:[0,0,0,0,Q,0],lineWidth:h,side:s.DoubleSide,color:F,opacity:p,polygonOffset:!0,renderOrder:1,polygonOffsetFactor:-10,fog:!1}),i.createElement("mesh",{raycast:()=>null,position:[0,Q+z/2,0],renderOrder:500},i.createElement("coneGeometry",{args:[P,z,24,1]}),i.createElement("meshBasicMaterial",{transparent:!0,depthTest:l,color:F,opacity:p,polygonOffset:!0,polygonOffsetFactor:-10,fog:!1}))))},Xw=new s.Vector3,Zw=new s.Vector3,Kw=e=>180*e/Math.PI,Jw=e=>{let t=((e,t)=>{let n=Math.floor(e/t);return n=n<0?n+1:n,e-n*t})(e,2*Math.PI);return Math.abs(t)<1e-6?0:(t<0&&(t+=2*Math.PI),t)},$w=new s.Matrix4,eC=new s.Vector3,tC=new s.Ray,nC=new s.Vector3,rC=({dir1:e,dir2:t,axis:n})=>{const{rotationLimits:r,annotations:o,annotationsClass:c,depthTest:l,scale:u,lineWidth:h,fixed:d,axisColors:A,hoveredColor:m,opacity:p,onDragStart:f,onDrag:g,onDragEnd:v,userData:x}=i.useContext(Gw),E=(0,a.D)((e=>e.controls)),w=i.useRef(null),C=i.useRef(null),I=i.useRef(0),_=i.useRef(0),b=i.useRef(null),[B,M]=i.useState(!1),S=i.useCallback((e=>{o&&(w.current.innerText=`${Kw(_.current).toFixed(0)}\xba`,w.current.style.display="block"),e.stopPropagation();const t=e.point.clone(),r=(new s.Vector3).setFromMatrixPosition(C.current.matrixWorld),i=(new s.Vector3).setFromMatrixColumn(C.current.matrixWorld,0).normalize(),a=(new s.Vector3).setFromMatrixColumn(C.current.matrixWorld,1).normalize(),c=(new s.Vector3).setFromMatrixColumn(C.current.matrixWorld,2).normalize(),l=(new s.Plane).setFromNormalAndCoplanarPoint(c,r);b.current={clickPoint:t,origin:r,e1:i,e2:a,normal:c,plane:l},f({component:"Rotator",axis:n,origin:r,directions:[i,a,c]}),E&&(E.enabled=!1),e.target.setPointerCapture(e.pointerId)}),[o,E,f,n]),D=i.useCallback((e=>{if(e.stopPropagation(),B||M(!0),b.current){const{clickPoint:t,origin:i,e1:a,e2:c,normal:l,plane:u}=b.current,[h,d]=(null==r?void 0:r[n])||[void 0,void 0];tC.copy(e.ray),tC.intersectPlane(u,nC),tC.direction.negate(),tC.intersectPlane(u,nC);let A=((e,t,n,r,i)=>{Xw.copy(e).sub(n),Zw.copy(t).sub(n);const o=r.dot(r),s=i.dot(i),a=Xw.dot(r)/o,c=Xw.dot(i)/s,l=Zw.dot(r)/o,u=Zw.dot(i)/s,h=Math.atan2(c,a);return Math.atan2(u,l)-h})(t,nC,i,a,c),m=Kw(A);e.shiftKey&&(m=10*Math.round(m/10),A=(e=>e*Math.PI/180)(m)),void 0!==h&&void 0!==d&&d-h<2*Math.PI?(A=Jw(A),A=A>Math.PI?A-2*Math.PI:A,A=s.MathUtils.clamp(A,h-I.current,d-I.current),_.current=I.current+A):(_.current=Jw(I.current+A),_.current=_.current>Math.PI?_.current-2*Math.PI:_.current),o&&(m=Kw(_.current),w.current.innerText=`${m.toFixed(0)}\xba`),$w.makeRotationAxis(l,A),eC.copy(i).applyMatrix4($w).sub(i).negate(),$w.setPosition(eC),g($w)}}),[o,g,B,r,n]),T=i.useCallback((e=>{o&&(w.current.style.display="none"),e.stopPropagation(),I.current=_.current,b.current=null,v(),E&&(E.enabled=!0),e.target.releasePointerCapture(e.pointerId)}),[o,E,v]),Q=i.useCallback((e=>{e.stopPropagation(),M(!1)}),[]),P=i.useMemo((()=>{const n=e.clone().normalize(),r=t.clone().normalize();return(new s.Matrix4).makeBasis(n,r,n.clone().cross(r))}),[e,t]),z=d?.65:.65*u,R=i.useMemo((()=>{const e=[];for(let t=0;t<=32;t++){const n=t*(Math.PI/2)/32;e.push(new s.Vector3(Math.cos(n)*z,Math.sin(n)*z,0))}return e}),[z]);return i.createElement("group",{ref:C,onPointerDown:S,onPointerMove:D,onPointerUp:T,onPointerOut:Q,matrix:P,matrixAutoUpdate:!1},o&&i.createElement(y,{position:[z,z,0]},i.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:c,ref:w})),i.createElement(ya,{points:R,lineWidth:4*h,visible:!1,userData:x}),i.createElement(ya,{transparent:!0,raycast:()=>null,depthTest:l,points:R,lineWidth:h,side:s.DoubleSide,color:B?m:A[n],opacity:p,polygonOffset:!0,polygonOffsetFactor:-10,fog:!1}))},iC=new s.Ray,oC=new s.Vector3,sC=new s.Matrix4,aC=({dir1:e,dir2:t,axis:n})=>{const{translation:r,translationLimits:o,annotations:c,annotationsClass:l,depthTest:u,scale:h,lineWidth:d,fixed:A,axisColors:m,hoveredColor:p,opacity:f,onDragStart:g,onDrag:v,onDragEnd:x,userData:E}=i.useContext(Gw),w=(0,a.D)((e=>e.controls)),C=i.useRef(null),I=i.useRef(null),_=i.useRef(null),b=i.useRef(0),B=i.useRef(0),[M,S]=i.useState(!1),D=i.useCallback((e=>{c&&(C.current.innerText=`${r.current[(n+1)%3].toFixed(2)}, ${r.current[(n+2)%3].toFixed(2)}`,C.current.style.display="block"),e.stopPropagation();const t=e.point.clone(),i=(new s.Vector3).setFromMatrixPosition(I.current.matrixWorld),o=(new s.Vector3).setFromMatrixColumn(I.current.matrixWorld,0).normalize(),a=(new s.Vector3).setFromMatrixColumn(I.current.matrixWorld,1).normalize(),l=(new s.Vector3).setFromMatrixColumn(I.current.matrixWorld,2).normalize(),u=(new s.Plane).setFromNormalAndCoplanarPoint(l,i);_.current={clickPoint:t,e1:o,e2:a,plane:u},b.current=r.current[(n+1)%3],B.current=r.current[(n+2)%3],g({component:"Slider",axis:n,origin:i,directions:[o,a,l]}),w&&(w.enabled=!1),e.target.setPointerCapture(e.pointerId)}),[c,w,g,n]),T=i.useCallback((e=>{if(e.stopPropagation(),M||S(!0),_.current){const{clickPoint:t,e1:i,e2:s,plane:a}=_.current,[l,u]=(null==o?void 0:o[(n+1)%3])||[void 0,void 0],[h,d]=(null==o?void 0:o[(n+2)%3])||[void 0,void 0];iC.copy(e.ray),iC.intersectPlane(a,oC),iC.direction.negate(),iC.intersectPlane(a,oC),oC.sub(t);let[A,m]=((e,t,n)=>{const r=Math.abs(e.x)>=Math.abs(e.y)&&Math.abs(e.x)>=Math.abs(e.z)?0:Math.abs(e.y)>=Math.abs(e.x)&&Math.abs(e.y)>=Math.abs(e.z)?1:2,i=[0,1,2].sort(((e,n)=>Math.abs(t.getComponent(n))-Math.abs(t.getComponent(e)))),o=r===i[0]?i[1]:i[0],s=e.getComponent(r),a=e.getComponent(o),c=t.getComponent(r),l=t.getComponent(o),u=n.getComponent(r),h=(n.getComponent(o)-u*(a/s))/(l-c*(a/s));return[(u-h*c)/s,h]})(i,s,oC);void 0!==l&&(A=Math.max(A,l-b.current)),void 0!==u&&(A=Math.min(A,u-b.current)),void 0!==h&&(m=Math.max(m,h-B.current)),void 0!==d&&(m=Math.min(m,d-B.current)),r.current[(n+1)%3]=b.current+A,r.current[(n+2)%3]=B.current+m,c&&(C.current.innerText=`${r.current[(n+1)%3].toFixed(2)}, ${r.current[(n+2)%3].toFixed(2)}`),sC.makeTranslation(A*i.x+m*s.x,A*i.y+m*s.y,A*i.z+m*s.z),v(sC)}}),[c,v,M,r,o,n]),Q=i.useCallback((e=>{c&&(C.current.style.display="none"),e.stopPropagation(),_.current=null,x(),w&&(w.enabled=!0),e.target.releasePointerCapture(e.pointerId)}),[c,w,x]),P=i.useCallback((e=>{e.stopPropagation(),S(!1)}),[]),z=i.useMemo((()=>{const n=e.clone().normalize(),r=t.clone().normalize();return(new s.Matrix4).makeBasis(n,r,n.clone().cross(r))}),[e,t]),R=A?1/7:h/7,F=A?.225:.225*h,k=M?p:m[n],L=i.useMemo((()=>[new s.Vector3(0,0,0),new s.Vector3(0,F,0),new s.Vector3(F,F,0),new s.Vector3(F,0,0),new s.Vector3(0,0,0)]),[F]);return i.createElement("group",{ref:I,matrix:z,matrixAutoUpdate:!1},c&&i.createElement(y,{position:[0,0,0]},i.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:l,ref:C})),i.createElement("group",{position:[1.7*R,1.7*R,0]},i.createElement("mesh",{visible:!0,onPointerDown:D,onPointerMove:T,onPointerUp:Q,onPointerOut:P,scale:F,userData:E},i.createElement("planeGeometry",null),i.createElement("meshBasicMaterial",{transparent:!0,depthTest:u,color:k,polygonOffset:!0,polygonOffsetFactor:-10,side:s.DoubleSide,fog:!1})),i.createElement(ya,{position:[-F/2,-F/2,0],transparent:!0,depthTest:u,points:L,lineWidth:d,color:k,opacity:f,polygonOffset:!0,polygonOffsetFactor:-10,userData:E,fog:!1})))},cC=new s.Vector3,lC=new s.Vector3,uC=new s.Vector3(0,1,0),hC=new s.Vector3,dC=new s.Matrix4,AC=({direction:e,axis:t})=>{const{scaleLimits:n,annotations:r,annotationsClass:o,depthTest:c,scale:l,lineWidth:u,fixed:h,axisColors:d,hoveredColor:A,opacity:m,onDragStart:p,onDrag:f,onDragEnd:g,userData:v}=i.useContext(Gw),x=(0,a.D)((e=>e.size)),E=(0,a.D)((e=>e.controls)),w=i.useRef(null),C=i.useRef(null),I=i.useRef(null),_=i.useRef(1),b=i.useRef(1),B=i.useRef(null),[M,S]=i.useState(!1),D=h?1.2:1.2*l,T=i.useCallback((n=>{r&&(w.current.innerText=`${b.current.toFixed(2)}`,w.current.style.display="block"),n.stopPropagation();const i=(new s.Matrix4).extractRotation(C.current.matrixWorld),o=n.point.clone(),a=(new s.Vector3).setFromMatrixPosition(C.current.matrixWorld),c=e.clone().applyMatrix4(i).normalize(),u=C.current.matrixWorld.clone(),d=u.clone().invert(),A=h?1/js(C.current.getWorldPosition(cC),l,n.camera,x):1;B.current={clickPoint:o,dir:c,mPLG:u,mPLGInv:d,offsetMultiplier:A},p({component:"Sphere",axis:t,origin:a,directions:[c]}),E&&(E.enabled=!1),n.target.setPointerCapture(n.pointerId)}),[r,E,e,p,t,h,l,x]),Q=i.useCallback((e=>{if(e.stopPropagation(),M||S(!0),B.current){const{clickPoint:i,dir:o,mPLG:s,mPLGInv:a,offsetMultiplier:c}=B.current,[u,d]=(null==n?void 0:n[t])||[1e-5,void 0],A=((e,t,n,r)=>{const i=t.dot(t),o=t.dot(e)-t.dot(n),s=t.dot(r);return 0===s?-o/i:(cC.copy(r).multiplyScalar(i/s).sub(t),lC.copy(r).multiplyScalar(o/s).add(n).sub(e),-cC.dot(lC)/cC.dot(cC))})(i,o,e.ray.origin,e.ray.direction),m=A*c,p=h?m:m/l;let g=Math.pow(2,.2*p);e.shiftKey&&(g=Math.round(10*g)/10),g=Math.max(g,u/_.current),void 0!==d&&(g=Math.min(g,d/_.current)),b.current=_.current*g,I.current.position.set(0,D+m,0),r&&(w.current.innerText=`${b.current.toFixed(2)}`),hC.set(1,1,1),hC.setComponent(t,g),dC.makeScale(hC.x,hC.y,hC.z).premultiply(s).multiply(a),f(dC)}}),[r,D,f,M,n,t]),P=i.useCallback((e=>{r&&(w.current.style.display="none"),e.stopPropagation(),_.current=b.current,B.current=null,I.current.position.set(0,D,0),g(),E&&(E.enabled=!0),e.target.releasePointerCapture(e.pointerId)}),[r,E,g,D]),z=i.useCallback((e=>{e.stopPropagation(),S(!1)}),[]),{radius:R,matrixL:F}=i.useMemo((()=>{const t=h?u/l*1.8:l/22.5,n=(new s.Quaternion).setFromUnitVectors(uC,e.clone().normalize());return{radius:t,matrixL:(new s.Matrix4).makeRotationFromQuaternion(n)}}),[e,l,u,h]),k=M?A:d[t];return i.createElement("group",{ref:C},i.createElement("group",{matrix:F,matrixAutoUpdate:!1,onPointerDown:T,onPointerMove:Q,onPointerUp:P,onPointerOut:z},r&&i.createElement(y,{position:[0,D/2,0]},i.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:o,ref:w})),i.createElement("mesh",{ref:I,position:[0,D,0],renderOrder:500,userData:v},i.createElement("sphereGeometry",{args:[R,12,12]}),i.createElement("meshBasicMaterial",{transparent:!0,depthTest:c,color:k,opacity:m,polygonOffset:!0,polygonOffsetFactor:-10}))))},mC=new s.Matrix4,pC=new s.Matrix4,fC=new s.Matrix4,gC=new s.Matrix4,yC=new s.Matrix4,vC=new s.Matrix4,xC=new s.Matrix4,EC=new s.Matrix4,wC=new s.Matrix4,CC=new s.Box3,IC=new s.Box3,_C=new s.Vector3,bC=new s.Vector3,BC=new s.Vector3,MC=new s.Vector3,SC=new s.Vector3,DC=new s.Vector3(1,0,0),TC=new s.Vector3(0,1,0),QC=new s.Vector3(0,0,1),PC=i.forwardRef((({enabled:e=!0,matrix:t,onDragStart:n,onDrag:o,onDragEnd:c,autoTransform:l=!0,anchor:u,disableAxes:h=!1,disableSliders:d=!1,disableRotations:A=!1,disableScaling:m=!1,activeAxes:p=[!0,!0,!0],offset:f=[0,0,0],rotation:g=[0,0,0],scale:y=1,lineWidth:v=4,fixed:x=!1,translationLimits:E,rotationLimits:w,scaleLimits:C,depthTest:I=!0,axisColors:_=["#ff2060","#20df80","#2080ff"],hoveredColor:b="#ffff40",annotations:B=!1,annotationsClass:M,opacity:S=1,visible:D=!0,userData:T,children:Q,...P},z)=>{const R=(0,a.D)((e=>e.invalidate)),F=i.useRef(null),k=i.useRef(null),L=i.useRef(null),O=i.useRef(null),U=i.useRef([0,0,0]),N=i.useRef(new s.Vector3(1,1,1)),V=i.useRef(new s.Vector3(1,1,1));i.useLayoutEffect((()=>{u&&(O.current.updateWorldMatrix(!0,!0),gC.copy(O.current.matrixWorld).invert(),CC.makeEmpty(),O.current.traverse((e=>{e.geometry&&(e.geometry.boundingBox||e.geometry.computeBoundingBox(),vC.copy(e.matrixWorld).premultiply(gC),IC.copy(e.geometry.boundingBox),IC.applyMatrix4(vC),CC.union(IC))})),_C.copy(CC.max).add(CC.min).multiplyScalar(.5),bC.copy(CC.max).sub(CC.min).multiplyScalar(.5),BC.copy(bC).multiply(new s.Vector3(...u)).add(_C),MC.set(...f).add(BC),L.current.position.copy(MC),R())}));const G=i.useMemo((()=>({onDragStart:e=>{mC.copy(k.current.matrix),pC.copy(k.current.matrixWorld),n&&n(e),R()},onDrag:e=>{fC.copy(F.current.matrixWorld),gC.copy(fC).invert(),yC.copy(pC).premultiply(e),vC.copy(yC).premultiply(gC),xC.copy(mC).invert(),EC.copy(vC).multiply(xC),l&&k.current.matrix.copy(vC),o&&o(vC,EC,yC,e),R()},onDragEnd:()=>{c&&c(),R()},translation:U,translationLimits:E,rotationLimits:w,axisColors:_,hoveredColor:b,opacity:S,scale:y,lineWidth:v,fixed:x,depthTest:I,userData:T,annotations:B,annotationsClass:M})),[n,o,c,U,E,w,C,I,y,v,x,..._,b,S,T,l,B,M]),j=new s.Vector3;return(0,a.F)((e=>{if(x){const t=js(L.current.getWorldPosition(j),y,e.camera,e.size);N.current.setScalar(t)}t&&t instanceof s.Matrix4&&(k.current.matrix=t),k.current.updateWorldMatrix(!0,!0),wC.makeRotationFromEuler(L.current.rotation).setPosition(L.current.position).premultiply(k.current.matrixWorld),V.current.setFromMatrixScale(wC),SC.copy(N.current).divide(V.current),(Math.abs(L.current.scale.x-SC.x)>1e-4||Math.abs(L.current.scale.y-SC.y)>1e-4||Math.abs(L.current.scale.z-SC.z)>1e-4)&&(L.current.scale.copy(SC),e.invalidate())})),i.useImperativeHandle(z,(()=>k.current),[]),i.createElement(Gw.Provider,{value:G},i.createElement("group",{ref:F},i.createElement("group",(0,r.Z)({ref:k,matrix:t,matrixAutoUpdate:!1},P),i.createElement("group",{visible:D,ref:L,position:f,rotation:g},e&&i.createElement(i.Fragment,null,!h&&p[0]&&i.createElement(Yw,{axis:0,direction:DC}),!h&&p[1]&&i.createElement(Yw,{axis:1,direction:TC}),!h&&p[2]&&i.createElement(Yw,{axis:2,direction:QC}),!d&&p[0]&&p[1]&&i.createElement(aC,{axis:2,dir1:DC,dir2:TC}),!d&&p[0]&&p[2]&&i.createElement(aC,{axis:1,dir1:QC,dir2:DC}),!d&&p[2]&&p[1]&&i.createElement(aC,{axis:0,dir1:TC,dir2:QC}),!A&&p[0]&&p[1]&&i.createElement(rC,{axis:2,dir1:DC,dir2:TC}),!A&&p[0]&&p[2]&&i.createElement(rC,{axis:1,dir1:QC,dir2:DC}),!A&&p[2]&&p[1]&&i.createElement(rC,{axis:0,dir1:TC,dir2:QC}),!m&&p[0]&&i.createElement(AC,{axis:0,direction:DC}),!m&&p[1]&&i.createElement(AC,{axis:1,direction:TC}),!m&&p[2]&&i.createElement(AC,{axis:2,direction:QC}))),i.createElement("group",{ref:O},Q))))})),zC=new s.Vector3(0,0,-1),RC=function(){const e=new s.Vector3,t=new s.Vector3,n=new s.Vector3,r=new s.Vector3,i=new s.Vector3;return function(o,s,a,c){return e.copy(o),t.copy(s),n.copy(a),r.copy(t).sub(e),i.copy(n).sub(e),c.crossVectors(i,r).normalize()}}();const FC=i.forwardRef((({points:e=OC.SAMPLE_FACELANDMARKER_RESULT.faceLandmarks[0],face:t,facialTransformationMatrix:n,faceBlendshapes:r,offset:o,offsetScalar:c=80,width:l,height:u,depth:h=1,verticalTri:d=[159,386,152],origin:A,eyes:m=!0,eyesAsOrigin:p=!1,debug:f=!1,children:g,...y},v)=>{var x;t&&(e=t.keypoints,console.warn("Facemesh `face` prop is deprecated: use `points` instead"));const E=i.useRef(null),w=i.useRef(null),C=i.useRef(null),I=i.useRef(null),_=i.useRef(null),b=i.useRef(null),B=i.useRef(null),[M]=i.useState((()=>new s.Vector3)),[S]=i.useState((()=>new s.Object3D)),[D]=i.useState((()=>new s.Quaternion)),[T]=i.useState((()=>new s.Vector3)),{invalidate:Q}=(0,a.D)();i.useEffect((()=>{var e;null==(e=_.current)||e.geometry.setIndex(OC.TRIANGULATION)}),[]);const[P]=i.useState((()=>new s.Vector3));i.useEffect((()=>{var t,i;const s=null==(t=_.current)?void 0:t.geometry;if(!s)return;var a,g;(s.setFromPoints(e),s.setDrawRange(0,OC.TRIANGULATION.length),n)?(S.matrix.fromArray(n.data),S.matrix.decompose(S.position,S.quaternion,S.scale),S.rotation.y*=-1,S.rotation.z*=-1,D.setFromEuler(S.rotation),o?(S.position.y*=-1,S.position.z*=-1,null==(a=E.current)||a.position.copy(S.position.divideScalar(c))):null==(g=E.current)||g.position.set(0,0,0)):(RC(e[d[0]],e[d[1]],e[d[2]],M),D.setFromUnitVectors(zC,M));const y=D.clone().invert();if(s.computeBoundingBox(),f&&Q(),s.center(),s.applyQuaternion(y),null==(i=I.current)||i.setRotationFromQuaternion(D),m)if(r){if(b.current&&B.current&&C.current)if(p){const e=b.current._computeSphere(s),t=B.current._computeSphere(s),n=function(e,t){return e.clone().add(t).multiplyScalar(.5)}(e.center,t.center);A=n.negate(),b.current._update(s,r,e),B.current._update(s,r,t)}else b.current._update(s,r),B.current._update(s,r)}else console.warn("Facemesh `eyes` option only works if `faceBlendshapes` is provided: skipping.");if(C.current){if(void 0!==A)if("number"===typeof A){const e=s.getAttribute("position");T.set(-e.getX(A),-e.getY(A),-e.getZ(A))}else A.isVector3&&T.copy(A);else T.setScalar(0);C.current.position.copy(T)}if(w.current){let e=1;(l||u||h)&&(s.boundingBox.getSize(P),l&&(e=l/P.x),u&&(e=u/P.y),h&&(e=h/P.z)),w.current.scale.setScalar(1!==e?e:1)}s.computeVertexNormals(),s.attributes.position.needsUpdate=!0}),[e,n,r,S,o,c,l,u,h,d,A,m,f,Q,M,D,P,T]);const z=i.useMemo((()=>({outerRef:I,meshRef:_,eyeRightRef:b,eyeLeftRef:B})),[]);i.useImperativeHandle(v,(()=>z),[z]);const[R]=i.useState((()=>new s.Vector3)),F=null==(x=_.current)?void 0:x.geometry.boundingBox,k=(null==F?void 0:F.getSize(R).z)||1;return i.createElement("group",y,i.createElement("group",{ref:E},i.createElement("group",{ref:I},i.createElement("group",{ref:w},f?i.createElement(i.Fragment,null,i.createElement("axesHelper",{args:[k]}),i.createElement(ya,{points:[[0,0,0],[0,0,-k]],color:65535})):null,i.createElement("group",{ref:C},m&&r&&i.createElement("group",{name:"eyes"},i.createElement(LC,{side:"left",ref:b,debug:f}),i.createElement(LC,{side:"right",ref:B,debug:f})),i.createElement("mesh",{ref:_,name:"face"},g,f?i.createElement(i.Fragment,null,F&&i.createElement("box3Helper",{args:[F]})):null))))))})),kC={contourLandmarks:{right:[33,133,159,145,153],left:[263,362,386,374,380]},blendshapes:{right:[14,16,18,12],left:[13,15,17,11]},color:{right:"red",left:"#00ff00"},fov:{horizontal:100,vertical:90}},LC=i.forwardRef((({side:e,debug:t=!0},n)=>{const r=i.useRef(null),o=i.useRef(null),[a]=i.useState((()=>new s.Sphere)),c=i.useCallback((t=>{const n=t.getAttribute("position"),r=kC.contourLandmarks[e].map((e=>new s.Vector3(n.getX(e),n.getY(e),n.getZ(e))));return a.center.set(0,0,0),r.forEach((e=>a.center.add(e))),a.center.divideScalar(r.length),a.radius=r[0].sub(r[1]).length()/2,a}),[a,e]),[l]=i.useState((()=>new s.Euler)),u=i.useCallback(((t,n,i)=>{var a;r.current&&(null!==(a=i)&&void 0!==a||(i=c(t)),r.current.position.copy(i.center),r.current.scale.setScalar(i.radius));if(n&&o.current){const t=kC.blendshapes[e],r=n.categories[t[0]].score,i=n.categories[t[1]].score,a=n.categories[t[2]].score,c=n.categories[t[3]].score,u=.5*(kC.fov.horizontal*s.MathUtils.DEG2RAD)*(c-a),h=.5*(kC.fov.vertical*s.MathUtils.DEG2RAD)*(r-i)*("left"===e?1:-1);l.set(u,h,0),o.current.setRotationFromEuler(l)}}),[c,e,l]),h=i.useMemo((()=>({eyeMeshRef:r,irisDirRef:o,_computeSphere:c,_update:u})),[c,u]);i.useImperativeHandle(n,(()=>h),[h]);const d=kC.color[e];return i.createElement("group",null,i.createElement("group",{ref:r},t&&i.createElement("axesHelper",null),i.createElement("group",{ref:o},i.createElement(i.Fragment,null,t&&i.createElement(ya,{points:[[0,0,0],[0,0,-2]],lineWidth:1,color:d})))))})),OC={TRIANGULATION:[127,34,139,11,0,37,232,231,120,72,37,39,128,121,47,232,121,128,104,69,67,175,171,148,157,154,155,118,50,101,73,39,40,9,151,108,48,115,131,194,204,211,74,40,185,80,42,183,40,92,186,230,229,118,202,212,214,83,18,17,76,61,146,160,29,30,56,157,173,106,204,194,135,214,192,203,165,98,21,71,68,51,45,4,144,24,23,77,146,91,205,50,187,201,200,18,91,106,182,90,91,181,85,84,17,206,203,36,148,171,140,92,40,39,193,189,244,159,158,28,247,246,161,236,3,196,54,68,104,193,168,8,117,228,31,189,193,55,98,97,99,126,47,100,166,79,218,155,154,26,209,49,131,135,136,150,47,126,217,223,52,53,45,51,134,211,170,140,67,69,108,43,106,91,230,119,120,226,130,247,63,53,52,238,20,242,46,70,156,78,62,96,46,53,63,143,34,227,173,155,133,123,117,111,44,125,19,236,134,51,216,206,205,154,153,22,39,37,167,200,201,208,36,142,100,57,212,202,20,60,99,28,158,157,35,226,113,160,159,27,204,202,210,113,225,46,43,202,204,62,76,77,137,123,116,41,38,72,203,129,142,64,98,240,49,102,64,41,73,74,212,216,207,42,74,184,169,170,211,170,149,176,105,66,69,122,6,168,123,147,187,96,77,90,65,55,107,89,90,180,101,100,120,63,105,104,93,137,227,15,86,85,129,102,49,14,87,86,55,8,9,100,47,121,145,23,22,88,89,179,6,122,196,88,95,96,138,172,136,215,58,172,115,48,219,42,80,81,195,3,51,43,146,61,171,175,199,81,82,38,53,46,225,144,163,110,246,33,7,52,65,66,229,228,117,34,127,234,107,108,69,109,108,151,48,64,235,62,78,191,129,209,126,111,35,143,163,161,246,117,123,50,222,65,52,19,125,141,221,55,65,3,195,197,25,7,33,220,237,44,70,71,139,122,193,245,247,130,33,71,21,162,153,158,159,170,169,150,188,174,196,216,186,92,144,160,161,2,97,167,141,125,241,164,167,37,72,38,12,145,159,160,38,82,13,63,68,71,226,35,111,158,153,154,101,50,205,206,92,165,209,198,217,165,167,97,220,115,218,133,112,243,239,238,241,214,135,169,190,173,133,171,208,32,125,44,237,86,87,178,85,86,179,84,85,180,83,84,181,201,83,182,137,93,132,76,62,183,61,76,184,57,61,185,212,57,186,214,207,187,34,143,156,79,239,237,123,137,177,44,1,4,201,194,32,64,102,129,213,215,138,59,166,219,242,99,97,2,94,141,75,59,235,24,110,228,25,130,226,23,24,229,22,23,230,26,22,231,112,26,232,189,190,243,221,56,190,28,56,221,27,28,222,29,27,223,30,29,224,247,30,225,238,79,20,166,59,75,60,75,240,147,177,215,20,79,166,187,147,213,112,233,244,233,128,245,128,114,188,114,217,174,131,115,220,217,198,236,198,131,134,177,132,58,143,35,124,110,163,7,228,110,25,356,389,368,11,302,267,452,350,349,302,303,269,357,343,277,452,453,357,333,332,297,175,152,377,384,398,382,347,348,330,303,304,270,9,336,337,278,279,360,418,262,431,304,408,409,310,415,407,270,409,410,450,348,347,422,430,434,313,314,17,306,307,375,387,388,260,286,414,398,335,406,418,364,367,416,423,358,327,251,284,298,281,5,4,373,374,253,307,320,321,425,427,411,421,313,18,321,405,406,320,404,405,315,16,17,426,425,266,377,400,369,322,391,269,417,465,464,386,257,258,466,260,388,456,399,419,284,332,333,417,285,8,346,340,261,413,441,285,327,460,328,355,371,329,392,439,438,382,341,256,429,420,360,364,394,379,277,343,437,443,444,283,275,440,363,431,262,369,297,338,337,273,375,321,450,451,349,446,342,467,293,334,282,458,461,462,276,353,383,308,324,325,276,300,293,372,345,447,382,398,362,352,345,340,274,1,19,456,248,281,436,427,425,381,256,252,269,391,393,200,199,428,266,330,329,287,273,422,250,462,328,258,286,384,265,353,342,387,259,257,424,431,430,342,353,276,273,335,424,292,325,307,366,447,345,271,303,302,423,266,371,294,455,460,279,278,294,271,272,304,432,434,427,272,407,408,394,430,431,395,369,400,334,333,299,351,417,168,352,280,411,325,319,320,295,296,336,319,403,404,330,348,349,293,298,333,323,454,447,15,16,315,358,429,279,14,15,316,285,336,9,329,349,350,374,380,252,318,402,403,6,197,419,318,319,325,367,364,365,435,367,397,344,438,439,272,271,311,195,5,281,273,287,291,396,428,199,311,271,268,283,444,445,373,254,339,263,466,249,282,334,296,449,347,346,264,447,454,336,296,299,338,10,151,278,439,455,292,407,415,358,371,355,340,345,372,390,249,466,346,347,280,442,443,282,19,94,370,441,442,295,248,419,197,263,255,359,440,275,274,300,383,368,351,412,465,263,467,466,301,368,389,380,374,386,395,378,379,412,351,419,436,426,322,373,390,388,2,164,393,370,462,461,164,0,267,302,11,12,374,373,387,268,12,13,293,300,301,446,261,340,385,384,381,330,266,425,426,423,391,429,355,437,391,327,326,440,457,438,341,382,362,459,457,461,434,430,394,414,463,362,396,369,262,354,461,457,316,403,402,315,404,403,314,405,404,313,406,405,421,418,406,366,401,361,306,408,407,291,409,408,287,410,409,432,436,410,434,416,411,264,368,383,309,438,457,352,376,401,274,275,4,421,428,262,294,327,358,433,416,367,289,455,439,462,370,326,2,326,370,305,460,455,254,449,448,255,261,446,253,450,449,252,451,450,256,452,451,341,453,452,413,464,463,441,413,414,258,442,441,257,443,442,259,444,443,260,445,444,467,342,445,459,458,250,289,392,290,290,328,460,376,433,435,250,290,392,411,416,433,341,463,464,453,464,465,357,465,412,343,412,399,360,363,440,437,399,456,420,456,363,401,435,288,372,383,353,339,255,249,448,261,255,133,243,190,133,155,112,33,246,247,33,130,25,398,384,286,362,398,414,362,463,341,263,359,467,263,249,255,466,467,260,75,60,166,238,239,79,162,127,139,72,11,37,121,232,120,73,72,39,114,128,47,233,232,128,103,104,67,152,175,148,173,157,155,119,118,101,74,73,40,107,9,108,49,48,131,32,194,211,184,74,185,191,80,183,185,40,186,119,230,118,210,202,214,84,83,17,77,76,146,161,160,30,190,56,173,182,106,194,138,135,192,129,203,98,54,21,68,5,51,4,145,144,23,90,77,91,207,205,187,83,201,18,181,91,182,180,90,181,16,85,17,205,206,36,176,148,140,165,92,39,245,193,244,27,159,28,30,247,161,174,236,196,103,54,104,55,193,8,111,117,31,221,189,55,240,98,99,142,126,100,219,166,218,112,155,26,198,209,131,169,135,150,114,47,217,224,223,53,220,45,134,32,211,140,109,67,108,146,43,91,231,230,120,113,226,247,105,63,52,241,238,242,124,46,156,95,78,96,70,46,63,116,143,227,116,123,111,1,44,19,3,236,51,207,216,205,26,154,22,165,39,167,199,200,208,101,36,100,43,57,202,242,20,99,56,28,157,124,35,113,29,160,27,211,204,210,124,113,46,106,43,204,96,62,77,227,137,116,73,41,72,36,203,142,235,64,240,48,49,64,42,41,74,214,212,207,183,42,184,210,169,211,140,170,176,104,105,69,193,122,168,50,123,187,89,96,90,66,65,107,179,89,180,119,101,120,68,63,104,234,93,227,16,15,85,209,129,49,15,14,86,107,55,9,120,100,121,153,145,22,178,88,179,197,6,196,89,88,96,135,138,136,138,215,172,218,115,219,41,42,81,5,195,51,57,43,61,208,171,199,41,81,38,224,53,225,24,144,110,105,52,66,118,229,117,227,34,234,66,107,69,10,109,151,219,48,235,183,62,191,142,129,126,116,111,143,7,163,246,118,117,50,223,222,52,94,19,141,222,221,65,196,3,197,45,220,44,156,70,139,188,122,245,139,71,162,145,153,159,149,170,150,122,188,196,206,216,92,163,144,161,164,2,167,242,141,241,0,164,37,11,72,12,144,145,160,12,38,13,70,63,71,31,226,111,157,158,154,36,101,205,203,206,165,126,209,217,98,165,97,237,220,218,237,239,241,210,214,169,140,171,32,241,125,237,179,86,178,180,85,179,181,84,180,182,83,181,194,201,182,177,137,132,184,76,183,185,61,184,186,57,185,216,212,186,192,214,187,139,34,156,218,79,237,147,123,177,45,44,4,208,201,32,98,64,129,192,213,138,235,59,219,141,242,97,97,2,141,240,75,235,229,24,228,31,25,226,230,23,229,231,22,230,232,26,231,233,112,232,244,189,243,189,221,190,222,28,221,223,27,222,224,29,223,225,30,224,113,247,225,99,60,240,213,147,215,60,20,166,192,187,213,243,112,244,244,233,245,245,128,188,188,114,174,134,131,220,174,217,236,236,198,134,215,177,58,156,143,124,25,110,7,31,228,25,264,356,368,0,11,267,451,452,349,267,302,269,350,357,277,350,452,357,299,333,297,396,175,377,381,384,382,280,347,330,269,303,270,151,9,337,344,278,360,424,418,431,270,304,409,272,310,407,322,270,410,449,450,347,432,422,434,18,313,17,291,306,375,259,387,260,424,335,418,434,364,416,391,423,327,301,251,298,275,281,4,254,373,253,375,307,321,280,425,411,200,421,18,335,321,406,321,320,405,314,315,17,423,426,266,396,377,369,270,322,269,413,417,464,385,386,258,248,456,419,298,284,333,168,417,8,448,346,261,417,413,285,326,327,328,277,355,329,309,392,438,381,382,256,279,429,360,365,364,379,355,277,437,282,443,283,281,275,363,395,431,369,299,297,337,335,273,321,348,450,349,359,446,467,283,293,282,250,458,462,300,276,383,292,308,325,283,276,293,264,372,447,346,352,340,354,274,19,363,456,281,426,436,425,380,381,252,267,269,393,421,200,428,371,266,329,432,287,422,290,250,328,385,258,384,446,265,342,386,387,257,422,424,430,445,342,276,422,273,424,306,292,307,352,366,345,268,271,302,358,423,371,327,294,460,331,279,294,303,271,304,436,432,427,304,272,408,395,394,431,378,395,400,296,334,299,6,351,168,376,352,411,307,325,320,285,295,336,320,319,404,329,330,349,334,293,333,366,323,447,316,15,315,331,358,279,317,14,316,8,285,9,277,329,350,253,374,252,319,318,403,351,6,419,324,318,325,397,367,365,288,435,397,278,344,439,310,272,311,248,195,281,375,273,291,175,396,199,312,311,268,276,283,445,390,373,339,295,282,296,448,449,346,356,264,454,337,336,299,337,338,151,294,278,455,308,292,415,429,358,355,265,340,372,388,390,466,352,346,280,295,442,282,354,19,370,285,441,295,195,248,197,457,440,274,301,300,368,417,351,465,251,301,389,385,380,386,394,395,379,399,412,419,410,436,322,387,373,388,326,2,393,354,370,461,393,164,267,268,302,12,386,374,387,312,268,13,298,293,301,265,446,340,380,385,381,280,330,425,322,426,391,420,429,437,393,391,326,344,440,438,458,459,461,364,434,394,428,396,262,274,354,457,317,316,402,316,315,403,315,314,404,314,313,405,313,421,406,323,366,361,292,306,407,306,291,408,291,287,409,287,432,410,427,434,411,372,264,383,459,309,457,366,352,401,1,274,4,418,421,262,331,294,358,435,433,367,392,289,439,328,462,326,94,2,370,289,305,455,339,254,448,359,255,446,254,253,449,253,252,450,252,256,451,256,341,452,414,413,463,286,441,414,286,258,441,258,257,442,257,259,443,259,260,444,260,467,445,309,459,250,305,289,290,305,290,460,401,376,435,309,250,392,376,411,433,453,341,464,357,453,465,343,357,412,437,343,399,344,360,440,420,437,456,360,420,363,361,401,288,265,372,353,390,339,249,339,448,255],SAMPLE_FACE:{keypoints:[{x:356.2804412841797,y:295.1960563659668,z:-23.786449432373047,name:"lips"},{x:354.8859405517578,y:264.69520568847656,z:-36.718435287475586},{x:355.2180862426758,y:275.3360366821289,z:-21.183712482452393},{x:347.349853515625,y:242.4400234222412,z:-25.093655586242676},{x:354.40135955810547,y:256.67933464050293,z:-38.23572635650635},{x:353.7689971923828,y:247.54886627197266,z:-34.5475435256958},{x:352.1288299560547,y:227.34312057495117,z:-13.095386028289795},{x:303.5013198852539,y:234.67002868652344,z:12.500141859054565,name:"rightEye"},{x:351.09378814697266,y:211.87547206878662,z:-6.413471698760986},{x:350.7115936279297,y:202.1251630783081,z:-6.413471698760986},{x:348.33667755126953,y:168.7741756439209,z:6.483500003814697,name:"faceOval"},{x:356.4806365966797,y:299.2995357513428,z:-23.144519329071045},{x:356.5511703491211,y:302.66146659851074,z:-21.020312309265137},{x:356.6239547729492,y:304.1536331176758,z:-18.137459754943848,name:"lips"},{x:356.5807342529297,y:305.1840591430664,z:-18.767719268798828,name:"lips"},{x:356.8241500854492,y:308.25711250305176,z:-20.16829490661621},{x:357.113037109375,y:312.26277351379395,z:-22.10575819015503},{x:357.34962463378906,y:317.1123218536377,z:-21.837315559387207,name:"lips"},{x:357.6658630371094,y:325.51036834716797,z:-16.27002477645874},{x:355.0201416015625,y:269.36279296875,z:-33.73054027557373},{x:348.5237503051758,y:270.33411026000977,z:-24.93025302886963},{x:279.97331619262695,y:213.24176788330078,z:47.759642601013184,name:"faceOval"},{x:322.66529083251953,y:238.5027265548706,z:5.535193085670471},{x:316.0983657836914,y:239.94489669799805,z:5.777376294136047},{x:309.9431610107422,y:240.24518966674805,z:7.510589361190796},{x:301.31994247436523,y:237.86138534545898,z:13.118728399276733},{x:328.14266204833984,y:235.80496788024902,z:6.646900177001953},{x:313.7326431274414,y:222.11161136627197,z:3.9887237548828125},{x:320.45196533203125,y:221.87729358673096,z:4.601476192474365},{x:307.35679626464844,y:223.63793849945068,z:5.932023525238037},{x:303.0031204223633,y:226.3743782043457,z:8.479321002960205},{x:296.80023193359375,y:242.94299125671387,z:15.931552648544312},{x:332.2352981567383,y:340.77341079711914,z:-10.165848731994629},{x:301.38587951660156,y:233.46447944641113,z:14.764405488967896,name:"rightEye"},{x:279.0147018432617,y:244.37155723571777,z:45.77549457550049},{x:289.60548400878906,y:239.1807460784912,z:23.191204071044922},{x:320.32257080078125,y:267.1292781829834,z:-4.954537749290466},{x:347.64583587646484,y:294.4955062866211,z:-23.062820434570312,name:"lips"},{x:349.28138732910156,y:303.1095886230469,z:-20.238323211669922},{x:338.9453125,y:298.19186210632324,z:-19.456336498260498,name:"lips"},{x:333.36788177490234,y:302.6706790924072,z:-14.776077270507812,name:"lips"},{x:342.89188385009766,y:304.3561363220215,z:-17.752301692962646},{x:337.7375030517578,y:306.0098361968994,z:-13.410515785217285},{x:325.6159210205078,y:316.22995376586914,z:-6.681914925575256},{x:349.0104675292969,y:264.9818515777588,z:-36.274919509887695},{x:347.7138900756836,y:257.5664806365967,z:-37.67549514770508},{x:291.79357528686523,y:218.88171672821045,z:11.578094959259033,name:"rightEyebrow"},{x:332.2689437866211,y:247.56946563720703,z:-3.3730539679527283},{x:332.0074462890625,y:267.1201229095459,z:-19.969879388809204},{x:331.27952575683594,y:263.6967658996582,z:-17.47218608856201},{x:301.04373931884766,y:269.56552505493164,z:3.61815482378006},{x:347.4863815307617,y:249.0706443786621,z:-32.633421421051025},{x:307.26118087768555,y:208.2646894454956,z:1.1591226607561111,name:"rightEyebrow"},{x:297.91919708251953,y:212.22604751586914,z:5.914516448974609,name:"rightEyebrow"},{x:285.1651382446289,y:197.98450469970703,z:36.391637325286865,name:"faceOval"},{x:337.04097747802734,y:211.25229835510254,z:-4.548954665660858},{x:326.5912628173828,y:223.16698551177979,z:6.670243740081787},{x:320.05664825439453,y:309.5834255218506,z:-4.055835008621216},{x:289.6866226196289,y:314.617395401001,z:53.875489234924316,name:"faceOval"},{x:337.4256896972656,y:270.8755302429199,z:-17.67060160636902},{x:343.69922637939453,y:273.0000400543213,z:-18.756048679351807},{x:327.4242401123047,y:309.22399520874023,z:-4.703601002693176,name:"lips"},{x:330.37220001220703,y:308.3323001861572,z:-6.442649960517883},{x:293.87027740478516,y:207.7961826324463,z:9.821539521217346,name:"rightEyebrow"},{x:332.11437225341797,y:271.22812271118164,z:-16.64351224899292},{x:320.1197814941406,y:207.40366458892822,z:-2.48164564371109,name:"rightEyebrow"},{x:318.59575271606445,y:201.07443809509277,z:-3.110446035861969,name:"rightEyebrow"},{x:310.72303771972656,y:175.75075149536133,z:13.328815698623657,name:"faceOval"},{x:289.67578887939453,y:202.29835510253906,z:21.370456218719482},{x:315.30879974365234,y:187.35260009765625,z:5.0304025411605835},{x:287.8936767578125,y:216.54793739318848,z:17.81065821647644,name:"rightEyebrow"},{x:283.9391899108887,y:215.01142501831055,z:32.04984903335571},{x:348.35330963134766,y:299.4155788421631,z:-22.47924566268921},{x:341.1790466308594,y:301.8221855163574,z:-18.977805376052856},{x:335.69713592529297,y:304.4266891479492,z:-14.682706594467163},{x:339.4615173339844,y:272.3654365539551,z:-16.38674020767212},{x:328.99600982666016,y:308.86685371398926,z:-5.616893768310547},{x:332.00313568115234,y:309.1875743865967,z:-10.335084199905396},{x:331.0068130493164,y:307.9274368286133,z:-6.681914925575256,name:"lips"},{x:341.13792419433594,y:266.4876937866211,z:-26.56425952911377},{x:339.02950286865234,y:305.6663703918457,z:-12.33674168586731,name:"lips"},{x:344.22935485839844,y:304.9452781677246,z:-15.161235332489014,name:"lips"},{x:350.1844024658203,y:304.374303817749,z:-17.5305438041687,name:"lips"},{x:348.52630615234375,y:325.9562301635742,z:-16.164982318878174},{x:348.6581802368164,y:317.1624183654785,z:-21.510512828826904,name:"lips"},{x:348.9766311645508,y:312.1923065185547,z:-21.708929538726807},{x:349.2427444458008,y:308.0660820007324,z:-19.643079042434692},{x:349.67491149902344,y:305.42747497558594,z:-18.16080331802368,name:"lips"},{x:337.95589447021484,y:306.6535949707031,z:-12.803598642349243,name:"lips"},{x:337.06878662109375,y:307.63169288635254,z:-14.274203777313232},{x:335.77449798583984,y:309.8449516296387,z:-15.698124170303345},{x:334.6099090576172,y:312.7997016906738,z:-14.764405488967896,name:"lips"},{x:327.2330856323242,y:293.80866050720215,z:-11.864047050476074},{x:280.97679138183594,y:279.79928970336914,z:68.90834331512451,name:"faceOval"},{x:355.13843536376953,y:271.7875671386719,z:-25.350427627563477},{x:334.7235870361328,y:307.4656391143799,z:-9.302158951759338,name:"lips"},{x:333.5293960571289,y:307.89782524108887,z:-10.200862884521484},{x:346.29688262939453,y:276.4256286621094,z:-19.748122692108154},{x:335.16246795654297,y:276.22097969055176,z:-12.313398122787476},{x:345.09132385253906,y:274.7082996368408,z:-19.304605722427368},{x:325.4267883300781,y:252.95130729675293,z:-1.6661019623279572},{x:315.347843170166,y:259.05200958251953,z:-.25604281574487686},{x:330.44933319091797,y:267.7570152282715,z:-14.017432928085327},{x:294.96768951416016,y:185.26001930236816,z:23.903164863586426,name:"faceOval"},{x:299.63531494140625,y:192.7913761138916,z:12.640198469161987},{x:304.5452117919922,y:202.4142837524414,z:3.244667649269104,name:"rightEyebrow"},{x:331.6915512084961,y:320.0467872619629,z:-10.632705688476562},{x:334.5911407470703,y:201.27566814422607,z:-6.133356094360352,name:"rightEyebrow"},{x:331.4815902709961,y:185.44180870056152,z:.6627205014228821},{x:328.05816650390625,y:170.8385467529297,z:7.358860373497009,name:"faceOval"},{x:304.49764251708984,y:239.76297855377197,z:10.387605428695679},{x:290.6382179260254,y:248.85257720947266,z:19.03616428375244},{x:331.5682601928711,y:233.20727348327637,z:7.837390303611755},{x:295.5115509033203,y:228.9834451675415,z:14.41426157951355},{x:336.94332122802734,y:241.8259334564209,z:-5.27842104434967},{x:336.2792205810547,y:262.7049922943115,z:-26.12074375152588},{x:284.4102478027344,y:255.3262710571289,z:25.467140674591064},{x:295.1420593261719,y:253.02655220031738,z:12.430112361907959},{x:303.5196113586426,y:254.20703887939453,z:6.139191389083862},{x:315.73450088500977,y:251.64799690246582,z:3.3788898587226868},{x:324.69661712646484,y:247.56494522094727,z:2.3328344523906708},{x:331.57970428466797,y:243.02241325378418,z:1.1423448473215103},{x:345.6210708618164,y:229.9976634979248,z:-10.825285911560059},{x:286.26644134521484,y:270.37991523742676,z:21.708929538726807},{x:290.2525520324707,y:228.4921360015869,z:17.71728754043579},{x:351.65367126464844,y:269.3400764465332,z:-33.450424671173096},{x:333.1378936767578,y:253.88388633728027,z:-7.230473756790161},{x:277.8318977355957,y:246.95331573486328,z:68.20805549621582,name:"faceOval"},{x:336.6680908203125,y:238.10003757476807,z:.7688578963279724},{x:329.95800018310547,y:269.18323516845703,z:-7.207130789756775},{x:299.17491912841797,y:234.13324356079102,z:15.95489501953125},{x:335.61729431152344,y:258.71752738952637,z:-23.016133308410645},{x:284.1079330444336,y:297.0343494415283,z:63.25934886932373,name:"faceOval"},{x:331.44542694091797,y:230.6892442703247,z:9.92658257484436,name:"rightEye"},{x:341.41536712646484,y:253.01264762878418,z:-29.038610458374023},{x:303.5472869873047,y:327.5896739959717,z:16.725212335586548},{x:304.7756576538086,y:337.4389457702637,z:27.38126277923584,name:"faceOval"},{x:280.80501556396484,y:275.32050132751465,z:45.0752067565918},{x:295.43582916259766,y:318.4501647949219,z:26.2608003616333},{x:281.4303207397461,y:228.7355661392212,z:40.94350814819336},{x:331.2549591064453,y:349.4216537475586,z:-7.376367449760437},{x:352.4247741699219,y:271.7330074310303,z:-24.953596591949463},{x:327.5672912597656,y:260.41900634765625,z:-5.456410646438599},{x:284.5432472229004,y:241.7647933959961,z:29.668869972229004},{x:310,y:235.66174507141113,z:8.502663969993591,name:"rightEye"},{x:315.7071113586426,y:235.7572603225708,z:6.938687562942505,name:"rightEye"},{x:330.41088104248047,y:311.04143142700195,z:-9.325502514839172,name:"lips"},{x:288.5377502441406,y:285.31983375549316,z:21.837315559387207},{x:344.55039978027344,y:359.4300842285156,z:-6.705257892608643,name:"faceOval"},{x:323.41880798339844,y:351.67362213134766,z:7.802375555038452,name:"faceOval"},{x:314.64088439941406,y:346.11894607543945,z:16.36339783668518,name:"faceOval"},{x:349.4945526123047,y:184.8434829711914,z:-.21847527474164963},{x:359.24694061279297,y:359.8348903656006,z:-8.403456211090088,name:"faceOval"},{x:321.26182556152344,y:234.64492321014404,z:6.90950870513916,name:"rightEye"},{x:326.318359375,y:232.90250301361084,z:8.029969334602356,name:"rightEye"},{x:329.6211624145508,y:231.6195774078369,z:9.722331762313843,name:"rightEye"},{x:285.9398078918457,y:228.2351303100586,z:24.650139808654785},{x:325.79288482666016,y:227.88007736206055,z:7.469738721847534,name:"rightEye"},{x:320.1699447631836,y:227.5934886932373,z:6.168370842933655,name:"rightEye"},{x:314.85408782958984,y:227.85282611846924,z:6.2675780057907104,name:"rightEye"},{x:309.3084907531738,y:229.1516876220703,z:7.7031683921813965,name:"rightEye"},{x:305.5621337890625,y:230.92366218566895,z:9.722331762313843,name:"rightEye"},{x:277.8681945800781,y:228.5354232788086,z:59.71122741699219,name:"faceOval"},{x:306.1444664001465,y:235.1954698562622,z:10.603528022766113,name:"rightEye"},{x:355.4478454589844,y:281.96210861206055,z:-20.565123558044434},{x:333.02661895751953,y:288.0105400085449,z:-14.72939133644104},{x:337.15728759765625,y:269.2059516906738,z:-19.8414945602417},{x:345.9898376464844,y:283.5453128814697,z:-20.4834246635437},{x:351.48963928222656,y:219.98916149139404,z:-7.0378947257995605},{x:312.39574432373047,y:336.50628089904785,z:8.671900033950806},{x:321.32152557373047,y:343.1755256652832,z:.9067271649837494},{x:343.78379821777344,y:353.2975959777832,z:-14.355905055999756},{x:296.8791389465332,y:327.91497230529785,z:41.01353645324707,name:"faceOval"},{x:329.6939468383789,y:229.27897453308105,z:8.934508562088013,name:"rightEye"},{x:341.6905212402344,y:241.4073657989502,z:-14.589333534240723},{x:359.03079986572266,y:353.48859786987305,z:-15.803166627883911},{x:333.1861877441406,y:356.43213272094727,z:-1.0234417766332626,name:"faceOval"},{x:283.97483825683594,y:291.4318656921387,z:41.94725513458252},{x:343.33770751953125,y:305.830135345459,z:-15.756480693817139,name:"lips"},{x:342.40283966064453,y:307.7453899383545,z:-17.4021577835083},{x:341.53621673583984,y:311.0595703125,z:-19.047834873199463},{x:340.9107208251953,y:315.4837703704834,z:-18.5576331615448,name:"lips"},{x:339.1478729248047,y:323.42233657836914,z:-14.367576837539673},{x:333.3201599121094,y:307.4406337738037,z:-9.617288708686829},{x:331.2411117553711,y:306.9811820983887,z:-9.669809937477112},{x:329.23255920410156,y:306.0508346557617,z:-9.582273960113525,name:"lips"},{x:322.4586486816406,y:301.33323669433594,z:-7.720675468444824},{x:297.1712112426758,y:286.9552803039551,z:8.240055441856384},{x:341.3060760498047,y:235.4432201385498,z:-7.504753470420837},{x:336.9318389892578,y:224.3451976776123,z:5.829898118972778},{x:332.65323638916016,y:226.70403957366943,z:8.105834126472473},{x:334.67357635498047,y:306.4397621154785,z:-8.981193900108337,name:"lips"},{x:297.4601936340332,y:306.29210472106934,z:15.476365089416504},{x:342.9119110107422,y:222.37077713012695,z:-2.754466235637665},{x:335.4629898071289,y:332.20250129699707,z:-11.823196411132812},{x:353.2412338256836,y:240.56339263916016,z:-27.147831916809082},{x:346.3080596923828,y:236.41446590423584,z:-18.452589511871338},{x:352.6475143432617,y:234.1420555114746,z:-19.748122692108154},{x:337.3209762573242,y:253.39937210083008,z:-16.024924516677856},{x:358.6122131347656,y:344.90861892700195,z:-18.592647314071655},{x:358.1117248535156,y:334.64990615844727,z:-17.49552845954895},{x:346.4450454711914,y:335.0321102142334,z:-16.32838249206543},{x:319.17640686035156,y:320.2833938598633,z:-3.276764452457428},{x:325.2540588378906,y:276.2369728088379,z:-6.460157036781311},{x:326.7214584350586,y:327.3939514160156,z:-7.417217493057251},{x:310.7190132141113,y:277.2265148162842,z:-3.5452082753181458},{x:319.78355407714844,y:284.8238182067871,z:-6.4543211460113525},{x:305.773983001709,y:290.83580017089844,z:.06907138042151928},{x:344.4001770019531,y:344.85408782958984,z:-16.946970224380493},{x:333.1879425048828,y:258.74256134033203,z:-11.90489649772644},{x:313.80598068237305,y:327.08919525146484,z:2.2277912497520447},{x:322.9637908935547,y:334.6819496154785,z:-3.3643004298210144},{x:313.4055519104004,y:311.2166690826416,z:-1.1175429821014404},{x:291.0865783691406,y:298.2831001281738,z:22.467575073242188},{x:305.6580924987793,y:313.3707904815674,z:5.561453700065613},{x:288.23760986328125,y:305.9941864013672,z:36.765122413635254},{x:315.10692596435547,y:296.26991271972656,z:-4.604393839836121},{x:337.50518798828125,y:247.5944423675537,z:-10.597691535949707},{x:338.8450622558594,y:265.47778129577637,z:-27.778091430664062},{x:334.25254821777344,y:269.0671920776367,z:-20.938611030578613},{x:341.64512634277344,y:259.6387195587158,z:-32.189905643463135},{x:331.44081115722656,y:219.0976095199585,z:4.207563698291779},{x:320.56339263916016,y:216.49658203125,z:2.930997312068939},{x:311.21912002563477,y:216.57853603363037,z:2.9674705862998962},{x:303.46256256103516,y:218.54614734649658,z:5.357203483581543},{x:297.99999237060547,y:222.505202293396,z:9.325502514839172},{x:294.93839263916016,y:236.39654159545898,z:18.534289598464966},{x:278.87489318847656,y:259.7095584869385,z:45.68212032318115},{x:300.3782653808594,y:245.38593292236328,z:12.278382778167725},{x:307.06348419189453,y:246.36857986450195,z:8.164191246032715},{x:315.5229187011719,y:245.3949737548828,z:5.503097176551819},{x:323.71395111083984,y:242.75178909301758,z:4.6335723996162415},{x:330.2785873413086,y:239.34658527374268,z:4.937030673027039},{x:334.6982192993164,y:236.0460376739502,z:4.823233783245087},{x:279.3412208557129,y:263.5196113586426,z:70.91583728790283,name:"faceOval"},{x:334.65972900390625,y:271.6648578643799,z:-17.775644063949585},{x:342.05677032470703,y:246.99846267700195,z:-20.84523916244507},{x:344.0357971191406,y:264.5701503753662,z:-32.936880588531494},{x:348.25531005859375,y:268.6645030975342,z:-30.695960521697998},{x:344.12227630615234,y:266.34212493896484,z:-29.808926582336426},{x:337.12318420410156,y:274.2556858062744,z:-15.768152475357056},{x:349.49047088623047,y:269.071683883667,z:-32.51670837402344},{x:350.1683044433594,y:271.4691352844238,z:-24.93025302886963},{x:333.9634704589844,y:230.56639194488525,z:8.89949381351471},{x:338.2147979736328,y:231.4807891845703,z:4.6715047955513},{x:340.4712677001953,y:231.74463272094727,z:-.34996166825294495},{x:303.28975677490234,y:232.24980354309082,z:11.916568279266357,name:"rightEye"},{x:299.4649124145508,y:229.53842639923096,z:12.325069904327393},{x:359.09618377685547,y:241.77349090576172,z:-24.650139808654785},{x:399.46216583251953,y:229.89503860473633,z:15.919880867004395,name:"leftEye"},{x:361.38919830322266,y:269.6129894256592,z:-24.510080814361572},{x:416.9973373413086,y:206.0895538330078,z:53.26857566833496,name:"faceOval"},{x:381.32179260253906,y:235.5476474761963,z:7.6214683055877686},{x:387.8068542480469,y:236.25958442687988,z:8.345099091529846},{x:393.95751953125,y:235.8660364151001,z:10.475142002105713},{x:401.84600830078125,y:232.77019500732422,z:16.760226488113403},{x:375.70568084716797,y:233.48456382751465,z:8.234220147132874},{x:388.17752838134766,y:218.94717693328857,z:6.810300946235657},{x:381.64928436279297,y:219.2656660079956,z:6.711093783378601},{x:394.4760513305664,y:219.66821193695068,z:9.173773527145386},{x:398.8843536376953,y:221.8837022781372,z:12.03328251838684},{x:406.5454864501953,y:237.12156772613525,z:19.7131085395813},{x:383.87447357177734,y:337.6932907104492,z:-8.631049990653992},{x:401.2682342529297,y:228.5916566848755,z:18.359217643737793,name:"leftEye"},{x:422.0449447631836,y:236.73934936523438,z:51.16771221160889},{x:412.69153594970703,y:232.80198097229004,z:27.52131938934326},{x:387.3497772216797,y:263.298397064209,z:-2.8609684109687805},{x:364.5124053955078,y:293.39221000671387,z:-22.397546768188477,name:"lips"},{x:363.62987518310547,y:302.1291446685791,z:-19.643079042434692},{x:373.2334518432617,y:295.8647060394287,z:-18.125789165496826,name:"lips"},{x:378.83365631103516,y:299.5177745819092,z:-13.153743743896484,name:"lips"},{x:369.91477966308594,y:302.5704002380371,z:-16.65518283843994},{x:374.9167251586914,y:303.5416603088379,z:-11.963253021240234},{x:387.58888244628906,y:312.2716999053955,z:-4.680258631706238},{x:360.6635284423828,y:264.31986808776855,z:-35.94811677932739},{x:361.04564666748047,y:256.8225860595703,z:-37.278664112091064},{x:408.3855438232422,y:213.52088928222656,z:15.756480693817139,name:"leftEyebrow"},{x:373.2946014404297,y:245.38101196289062,z:-1.9316278398036957},{x:376.83860778808594,y:264.3721103668213,z:-18.510947227478027},{x:376.9546127319336,y:261.0010528564453,z:-15.989909172058105},{x:406.1498260498047,y:263.5030174255371,z:7.072908878326416},{x:360.07205963134766,y:248.3631706237793,z:-32.16656446456909},{x:393.11119079589844,y:205.10473251342773,z:3.7786373496055603,name:"leftEyebrow"},{x:402.12791442871094,y:207.89000988006592,z:9.383859634399414,name:"leftEyebrow"},{x:410.8693313598633,y:191.6182279586792,z:41.27030849456787,name:"faceOval"},{x:364.9509811401367,y:210.40483474731445,z:-3.758212625980377},{x:375.94444274902344,y:221.1331844329834,z:8.368442058563232},{x:392.1904754638672,y:305.0360298156738,z:-1.752179116010666},{x:419.50225830078125,y:307.25592613220215,z:58.96425247192383,name:"faceOval"},{x:372.0027160644531,y:268.7212657928467,z:-16.631840467453003},{x:366.1614227294922,y:271.6237449645996,z:-18.219159841537476},{x:385.00938415527344,y:305.3863334655762,z:-2.567722797393799},{x:381.99771881103516,y:304.9723720550537,z:-4.575215280056},{x:405.078125,y:203.21216583251953,z:13.713973760604858,name:"leftEyebrow"},{x:377.13207244873047,y:268.4710121154785,z:-15.266278982162476},{x:380.9713363647461,y:205.36980628967285,z:-.7250899076461792,name:"leftEyebrow"},{x:381.7788314819336,y:198.9268398284912,z:-1.184653863310814,name:"leftEyebrow"},{x:385.5204772949219,y:172.1484375,z:16.04826807975769,name:"faceOval"},{x:407.94189453125,y:196.76236152648926,z:25.723915100097656},{x:383.03890228271484,y:184.5157527923584,z:7.393874526023865},{x:411.61781311035156,y:210.79241752624512,z:22.315845489501953,name:"leftEyebrow"},{x:414.30870056152344,y:208.4643030166626,z:37.021894454956055},{x:364.28722381591797,y:298.35777282714844,z:-21.86065673828125},{x:371.3682556152344,y:299.78848457336426,z:-17.834001779556274},{x:376.88201904296875,y:301.6696071624756,z:-13.153743743896484},{x:370.2193832397461,y:270.49095153808594,z:-15.569736957550049},{x:383.5081100463867,y:305.2726364135742,z:-3.673594295978546},{x:380.73760986328125,y:305.96869468688965,z:-8.660228252410889},{x:381.2334442138672,y:304.63574409484863,z:-4.820316135883331,name:"lips"},{x:368.1698989868164,y:264.8884963989258,z:-25.653886795043945},{x:373.5087203979492,y:303.4233856201172,z:-10.95950722694397,name:"lips"},{x:368.4544372558594,y:303.29601287841797,z:-14.169161319732666,name:"lips"},{x:362.76554107666016,y:303.5735607147217,z:-16.911956071853638,name:"lips"},{x:366.60980224609375,y:324.8870658874512,z:-15.616422891616821},{x:365.7067108154297,y:315.95678329467773,z:-20.903596878051758,name:"lips"},{x:365.0083923339844,y:311.2232208251953,z:-21.066999435424805},{x:364.1508102416992,y:307.0583438873291,z:-18.907777070999146},{x:363.37512969970703,y:304.5721435546875,z:-17.42550015449524,name:"lips"},{x:374.580078125,y:304.3059539794922,z:-11.40302300453186,name:"lips"},{x:375.55362701416016,y:305.0998020172119,z:-12.861957550048828},{x:377.2437286376953,y:307.1674346923828,z:-14.215847253799438},{x:378.68587493896484,y:309.9015712738037,z:-13.223772048950195,name:"lips"},{x:383.8992691040039,y:290.29629707336426,z:-9.97326910495758},{x:423.3871841430664,y:271.91688537597656,z:74.37058925628662,name:"faceOval"},{x:377.68043518066406,y:304.62209701538086,z:-7.603961229324341,name:"lips"},{x:379.00428771972656,y:304.9314594268799,z:-8.57852816581726},{x:364.00279998779297,y:275.2813911437988,z:-19.25792098045349},{x:374.68231201171875,y:273.82555961608887,z:-11.28047227859497},{x:365.0354766845703,y:273.4548568725586,z:-18.791062831878662},{x:380.61901092529297,y:249.8848056793213,z:.15501167625188828},{x:391.14158630371094,y:254.7934627532959,z:2.0906515419483185},{x:378.1761169433594,y:264.9612236022949,z:-12.605184316635132},{x:400.9540557861328,y:179.99592304229736,z:27.82477855682373,name:"faceOval"},{x:398.0038833618164,y:188.50656509399414,z:16.094952821731567},{x:394.8717498779297,y:199.0359592437744,z:6.226727366447449,name:"leftEyebrow"},{x:382.10926055908203,y:316.83926582336426,z:-8.946179747581482},{x:366.51588439941406,y:200.32583713531494,z:-5.24632453918457,name:"leftEyebrow"},{x:367.4893569946289,y:183.87210845947266,z:1.9039081037044525},{x:368.6243438720703,y:168.8127565383911,z:8.736093044281006,name:"faceOval"},{x:398.96175384521484,y:234.9675178527832,z:13.713973760604858},{x:412.9645538330078,y:242.23042488098145,z:23.272905349731445},{x:372.05257415771484,y:231.41919136047363,z:9.226294755935669},{x:406.0722351074219,y:223.58965873718262,z:18.370890617370605},{x:368.27442169189453,y:240.2039337158203,z:-4.166713654994965},{x:372.3575210571289,y:260.66442489624023,z:-24.976940155029297},{x:419.2244338989258,y:247.9079246520996,z:30.299127101898193},{x:409.43885803222656,y:246.60913467407227,z:16.398411989212036},{x:401.69139862060547,y:248.76328468322754,z:9.395531415939331},{x:389.7608184814453,y:247.56915092468262,z:5.841569304466248},{x:380.5461883544922,y:244.55984115600586,z:4.263003468513489},{x:373.25817108154297,y:240.80214500427246,z:2.5356262922286987},{x:358.77086639404297,y:229.35615062713623,z:-10.387605428695679},{x:419.5793914794922,y:262.8478717803955,z:26.5175724029541},{x:410.8808898925781,y:222.51372814178467,z:22.199130058288574},{x:358.45714569091797,y:268.91467094421387,z:-33.17030906677246},{x:373.4129333496094,y:251.6385841369629,z:-5.771540403366089},{x:422.5408172607422,y:239.23919677734375,z:74.04378890991211,name:"faceOval"},{x:367.8171920776367,y:236.58040523529053,z:1.820748895406723},{x:378.51959228515625,y:266.2532329559326,z:-5.74819803237915},{x:403.3472442626953,y:229.05112266540527,z:19.689764976501465},{x:372.34840393066406,y:256.6451168060303,z:-21.872329711914062},{x:422.54566192626953,y:289.1587829589844,z:68.67491245269775,name:"faceOval"},{x:371.9297409057617,y:228.90116214752197,z:11.432201862335205,name:"leftEye"},{x:366.21360778808594,y:251.6158962249756,z:-28.19826364517212},{x:409.1571807861328,y:321.3156223297119,z:20.2266526222229},{x:408.52943420410156,y:331.44238471984863,z:31.09278917312622,name:"faceOval"},{x:424.2788314819336,y:267.1992301940918,z:50.467424392700195},{x:415.60352325439453,y:311.6528606414795,z:30.579242706298828},{x:418.12793731689453,y:221.59927368164062,z:46.26569747924805},{x:385.68286895751953,y:346.0184955596924,z:-5.70151150226593},{x:357.82936096191406,y:271.3758373260498,z:-24.836881160736084},{x:379.588623046875,y:257.5071716308594,z:-3.755294680595398},{x:417.4592590332031,y:234.71948146820068,z:34.5475435256958},{x:393.4684371948242,y:231.58967971801758,z:11.408859491348267,name:"leftEye"},{x:387.8864288330078,y:232.14245796203613,z:9.51808214187622,name:"leftEye"},{x:382.4981689453125,y:307.5654888153076,z:-7.522260546684265,name:"lips"},{x:419.00169372558594,y:277.8332805633545,z:26.424202919006348},{x:373.62953186035156,y:357.6375102996826,z:-5.75986921787262,name:"faceOval"},{x:392.8708267211914,y:347.72446632385254,z:10.154176950454712,name:"faceOval"},{x:400.3953552246094,y:341.0005187988281,z:19.39797878265381,name:"faceOval"},{x:382.25440979003906,y:231.66935920715332,z:8.998700976371765,name:"leftEye"},{x:377.14550018310547,y:230.4228687286377,z:9.804032444953918,name:"leftEye"},{x:373.8358688354492,y:229.64950561523438,z:11.292144060134888,name:"leftEye"},{x:414.5794677734375,y:221.67891025543213,z:29.412097930908203},{x:377.00672149658203,y:225.66201210021973,z:9.360517263412476,name:"leftEye"},{x:382.29530334472656,y:224.8431158065796,z:8.32175612449646,name:"leftEye"},{x:387.5133514404297,y:224.49507236480713,z:8.917000889778137,name:"leftEye"},{x:393.15906524658203,y:225.24795055389404,z:10.737749338150024,name:"leftEye"},{x:397.05554962158203,y:226.55359268188477,z:13.002015352249146,name:"leftEye"},{x:420.5299377441406,y:221.014666557312,z:65.40690422058105,name:"faceOval"},{x:397.06920623779297,y:230.6661558151245,z:13.807345628738403,name:"leftEye"},{x:377.94647216796875,y:285.1647090911865,z:-13.305472135543823},{x:372.1118927001953,y:267.1267318725586,z:-18.83774757385254},{x:364.9968719482422,y:282.24411964416504,z:-19.818150997161865},{x:401.973876953125,y:331.20131492614746,z:11.566424369812012},{x:394.3083190917969,y:338.86693954467773,z:3.142542541027069},{x:373.9820861816406,y:351.4504623413086,z:-13.50388765335083},{x:414.3888854980469,y:321.24735832214355,z:45.51872253417969,name:"faceOval"},{x:373.44234466552734,y:227.33163356781006,z:10.626870393753052,name:"leftEye"},{x:364.0731430053711,y:240.31539916992188,z:-13.807345628738403},{x:384.2658233642578,y:353.3793067932129,z:.7385850697755814,name:"faceOval"},{x:423.20526123046875,y:283.5176181793213,z:47.152724266052246},{x:369.42798614501953,y:304.0898895263672,z:-14.647691249847412,name:"lips"},{x:370.63812255859375,y:305.90051651000977,z:-16.211668252944946},{x:371.91192626953125,y:309.0167713165283,z:-17.84567356109619},{x:373.0583953857422,y:313.3545398712158,z:-17.378815412521362,name:"lips"},{x:375.39905548095703,y:321.09289169311523,z:-13.118728399276733},{x:379.2567825317383,y:304.3582534790039,z:-7.924926280975342},{x:381.18797302246094,y:303.7031364440918,z:-7.843226194381714},{x:383.0918502807617,y:302.4884605407715,z:-7.6506465673446655,name:"lips"},{x:389.09461975097656,y:297.1475315093994,z:-5.5497825145721436},{x:411.6408920288086,y:280.24898529052734,z:12.02161192893982},{x:363.3110809326172,y:234.27620887756348,z:-6.775286793708801},{x:366.0474395751953,y:223.29872131347656,z:6.827808618545532},{x:370.34427642822266,y:225.1457118988037,z:9.558931589126587},{x:377.5371551513672,y:303.60079765319824,z:-7.358860373497009,name:"lips"},{x:412.9557800292969,y:299.53579902648926,z:19.39797878265381},{x:360.0810241699219,y:221.72012329101562,z:-2.153385728597641},{x:379.82784271240234,y:329.47723388671875,z:-10.48097848892212},{x:359.08477783203125,y:235.7911491394043,z:-18.079102039337158},{x:369.6688461303711,y:251.5407943725586,z:-14.962821006774902},{x:369.5555114746094,y:333.5307312011719,z:-15.67478060722351},{x:394.0193176269531,y:315.6973171234131,z:-.9920747578144073},{x:383.78997802734375,y:272.7268695831299,z:-4.689012169837952},{x:387.67765045166016,y:323.6722755432129,z:-5.640236139297485},{x:397.8769302368164,y:272.1331214904785,z:-.9395531564950943},{x:389.87476348876953,y:280.5630111694336,z:-4.29218202829361},{x:403.83888244628906,y:285.1167869567871,z:3.0229100584983826},{x:372.5467300415039,y:343.1070327758789,z:-16.153310537338257},{x:374.1112518310547,y:256.3721466064453,z:-10.574349164962769},{x:399.73785400390625,y:321.77515983581543,z:4.849494695663452},{x:392.03365325927734,y:330.56447982788086,z:-1.3407598435878754},{x:398.59134674072266,y:305.93902587890625,z:1.517290621995926},{x:417.95997619628906,y:290.9716987609863,z:26.89105987548828},{x:406.04541778564453,y:307.35154151916504,z:8.666064143180847},{x:420.75328826904297,y:298.40752601623535,z:41.78385257720947},{x:395.4522705078125,y:291.4153575897217,z:-2.1752697229385376},{x:368.6452102661133,y:245.8882999420166,z:-9.453888535499573},{x:370.34900665283203,y:263.56690406799316,z:-26.75100326538086},{x:374.98477935791016,y:266.6126346588135,z:-19.77146625518799},{x:366.99840545654297,y:258.12140464782715,z:-31.372904777526855},{x:371.00616455078125,y:217.63479709625244,z:5.60522198677063},{x:381.30577087402344,y:214.14087295532227,z:4.983716309070587},{x:390.1496124267578,y:213.38221549987793,z:5.593550801277161},{x:397.7696990966797,y:214.3659782409668,z:8.57852816581726},{x:403.1652069091797,y:217.65509605407715,z:13.013685941696167},{x:407.3551940917969,y:230.72525024414062,z:22.444231510162354},{x:424.0876770019531,y:251.7839241027832,z:51.16771221160889},{x:403.50196838378906,y:239.88757610321045,z:15.803166627883911},{x:397.31719970703125,y:241.49806022644043,z:11.233787536621094},{x:388.99425506591797,y:241.4366912841797,z:7.948269248008728},{x:380.7804489135742,y:239.78078842163086,z:6.600214838981628},{x:374.01336669921875,y:237.11946487426758,z:6.349278092384338},{x:369.39125061035156,y:234.35351371765137,z:5.987462401390076},{x:422.9730987548828,y:255.76455116271973,z:76.61150932312012,name:"faceOval"},{x:374.73915100097656,y:269.24214363098145,z:-16.608498096466064},{x:364.61681365966797,y:245.71088790893555,z:-20.02823829650879},{x:365.3834533691406,y:263.34174156188965,z:-32.32996463775635},{x:361.58252716064453,y:267.8273677825928,z:-30.345816612243652},{x:365.37208557128906,y:265.0249671936035,z:-29.178667068481445},{x:372.72605895996094,y:272.05135345458984,z:-14.834434986114502},{x:360.48614501953125,y:268.34827423095703,z:-32.189905643463135},{x:359.9516296386719,y:270.8049201965332,z:-24.650139808654785},{x:369.5049285888672,y:229.01945114135742,z:10.107489824295044},{x:365.5447769165039,y:230.24096488952637,z:5.593550801277161},{x:363.50669860839844,y:230.6208372116089,z:.43622106313705444},{x:399.3529510498047,y:227.65677452087402,z:15.35965085029602,name:"leftEye"},{x:402.5693130493164,y:224.60190296173096,z:15.931552648544312}],box:{xMin:277.8318977355957,yMin:168.7741756439209,xMax:424.2788314819336,yMax:359.8348903656006,width:146.4469337463379,height:191.0607147216797}},SAMPLE_FACELANDMARKER_RESULT:{faceLandmarks:[[{x:.5760777592658997,y:.8639070391654968,z:-.030997956171631813},{x:.572094738483429,y:.7886289358139038,z:-.07189624011516571},{x:.5723551511764526,y:.8075382709503174,z:-.03578168898820877},{x:.5548420548439026,y:.7188365459442139,z:-.057787876576185226},{x:.5706077814102173,y:.7674974799156189,z:-.07740399986505508},{x:.5681378245353699,y:.7387768030166626,z:-.07356284558773041},{x:.5621535181999207,y:.6681165099143982,z:-.04189874976873398},{x:.46613582968711853,y:.6679812073707581,z:.011289681307971478},{x:.5579932928085327,y:.6174106597900391,z:-.03502821549773216},{x:.5563451647758484,y:.5905600190162659,z:-.03928658738732338},{x:.5487832427024841,y:.4900572597980499,z:-.029898937791585922},{x:.5765544176101685,y:.8692144751548767,z:-.02831427752971649},{x:.5771114230155945,y:.873644232749939,z:-.02345779910683632},{x:.5771905779838562,y:.877016007900238,z:-.016658689826726913},{x:.5778058767318726,y:.8770116567611694,z:-.014505492523312569},{x:.5783766508102417,y:.8835000991821289,z:-.015996402129530907},{x:.5792440176010132,y:.8913810849189758,z:-.01924579218029976},{x:.5796768069267273,y:.8996334671974182,z:-.018261712044477463},{x:.5817288160324097,y:.9255813956260681,z:-.007126849144697189},{x:.5726592540740967,y:.7992473244667053,z:-.0643521398305893},{x:.5579419136047363,y:.7996989488601685,z:-.04566684365272522},{x:.4216199815273285,y:.5958762764930725,z:.06776496022939682},{x:.5052269697189331,y:.6796539425849915,z:-.0010737782577052712},{x:.49243026971817017,y:.6838865876197815,z:-.0005227324436418712},{x:.4796970784664154,y:.6856290102005005,z:.002684245817363262},{x:.4618356227874756,y:.6764569878578186,z:.013439622707664967},{x:.5160380601882935,y:.6737282276153564,z:-17607348127057776e-21},{x:.48070961236953735,y:.6255870461463928,z:-.008339674212038517},{x:.49719780683517456,y:.6256808042526245,z:-.008027955889701843},{x:.46674346923828125,y:.6317623853683472,z:-.004460199736058712},{x:.4582492709159851,y:.641118049621582,z:.0011905613355338573},{x:.45408669114112854,y:.6911458969116211,z:.020514748990535736},{x:.535312294960022,y:.9619986414909363,z:.012499462813138962},{x:.4608460068702698,y:.6628725528717041,z:.01517564244568348},{x:.4206731915473938,y:.6828458309173584,z:.07848648726940155},{x:.4390624463558197,y:.6796106696128845,z:.03283142298460007},{x:.5029968619346619,y:.7701570391654968,z:-.009734481573104858},{x:.5595027208328247,y:.8607323169708252,z:-.030043255537748337},{x:.5621269941329956,y:.8738374710083008,z:-.021709579974412918},{x:.5451499819755554,y:.865527331829071,z:-.022014077752828598},{x:.5351184010505676,y:.8705098032951355,z:-.011602800339460373},{x:.5495014190673828,y:.8744956254959106,z:-.016490943729877472},{x:.5395170450210571,y:.8759440779685974,z:-.007333362940698862},{x:.5183624029159546,y:.8959754705429077,z:.010520773939788342},{x:.5604349374771118,y:.7895449995994568,z:-.07082037627696991},{x:.557381272315979,y:.7687489986419678,z:-.07590588927268982},{x:.4432901442050934,y:.6308897733688354,z:.0027153254486620426},{x:.5258325338363647,y:.7151225805282593,z:-.014676518738269806},{x:.5271827578544617,y:.7833116054534912,z:-.037643320858478546},{x:.5257382988929749,y:.7717816233634949,z:-.03401920944452286},{x:.46516409516334534,y:.7705106735229492,z:.0065747760236263275},{x:.5558893084526062,y:.7420997619628906,z:-.0694495290517807},{x:.4720408320426941,y:.6066038608551025,z:-.021204356104135513},{x:.45432573556900024,y:.6158540844917297,z:-.011054684408009052},{x:.4305151402950287,y:.5608053803443909,z:.0396830290555954},{x:.5310865640640259,y:.6157484650611877,z:-.03081176057457924},{x:.5114666223526001,y:.6329749226570129,z:-.00335998204536736},{x:.506435751914978,y:.8786543607711792,z:.012980876490473747},{x:.4480472207069397,y:.8640613555908203,z:.12569651007652283},{x:.5372058153152466,y:.7942581176757812,z:-.03168361634016037},{x:.5488379597663879,y:.8001630306243896,z:-.03280917927622795},{x:.5213388204574585,y:.8794381618499756,z:.011892606504261494},{x:.5242055654525757,y:.8789222240447998,z:.008370225317776203},{x:.4477175176143646,y:.6039950251579285,z:-.0050799972377717495},{x:.526964008808136,y:.7916748523712158,z:-.02968614175915718},{x:.4971255660057068,y:.6050706505775452,z:-.028175678104162216},{x:.4938119053840637,y:.5882453918457031,z:-.03210941329598427},{x:.4757143557071686,y:.5094879865646362,z:-.01300730835646391},{x:.43947282433509827,y:.5816648006439209,z:.01415177434682846},{x:.485664039850235,y:.5477864146232605,z:-.023685332387685776},{x:.43635931611061096,y:.6226438283920288,z:.013606148771941662},{x:.42910251021385193,y:.6102726459503174,z:.03926564007997513},{x:.5605402588844299,y:.8680099248886108,z:-.027318159118294716},{x:.5474816560745239,y:.8702861070632935,z:-.019686367362737656},{x:.5373021364212036,y:.8728838562965393,z:-.010484928265213966},{x:.540735125541687,y:.7979167103767395,z:-.029073253273963928},{x:.5228585004806519,y:.87913578748703,z:.009915109723806381},{x:.530497670173645,y:.8815253973007202,z:.0020524784922599792},{x:.5259912610054016,y:.8790552616119385,z:.007895970717072487},{x:.5433906316757202,y:.7882310748100281,z:-.05121905356645584},{x:.541388213634491,y:.8777219653129578,z:-.00466804439201951},{x:.5515822172164917,y:.8767023086547852,z:-.010475946590304375},{x:.5637003779411316,y:.877059817314148,z:-.015273625031113625},{x:.5640299320220947,y:.9263423085212708,z:-.00658724969252944},{x:.5642300248146057,y:.8993074893951416,z:-.017653480172157288},{x:.5637336373329163,y:.8910360932350159,z:-.01852807030081749},{x:.5637134313583374,y:.8837276697158813,z:-.01482592523097992},{x:.564205527305603,y:.8768964409828186,z:-.01331155002117157},{x:.5419867634773254,y:.8778373599052429,z:-.0037720394320786},{x:.5404468774795532,y:.880696177482605,z:-.005610354244709015},{x:.5392338633537292,y:.8845721483230591,z:-.007352025713771582},{x:.538469672203064,y:.8891173601150513,z:-.005154991988092661},{x:.5189250111579895,y:.8452741503715515,z:-.009755070321261883},{x:.4258975088596344,y:.7662280797958374,z:.1387351155281067},{x:.5725725293159485,y:.8041572570800781,z:-.04583907872438431},{x:.5342061519622803,y:.8785833120346069,z:.002659974154084921},{x:.5324031114578247,y:.8804071545600891,z:.0017832003068178892},{x:.5538818836212158,y:.8078407645225525,z:-.03254539892077446},{x:.5325431823730469,y:.8026832938194275,z:-.019140373915433884},{x:.5514076948165894,y:.8043903112411499,z:-.03313535451889038},{x:.5131856203079224,y:.7284771800041199,z:-.009399853646755219},{x:.49331504106521606,y:.7443980574607849,z:-.005225230939686298},{x:.5239617824554443,y:.7807451486587524,z:-.025881027802824974},{x:.4473606050014496,y:.5315827131271362,z:.011164786294102669},{x:.45718759298324585,y:.5604941248893738,z:-.005943301599472761},{x:.4670005738735199,y:.5909327268600464,z:-.019681761041283607},{x:.5311570167541504,y:.9076261520385742,z:.00389476353302598},{x:.5249923467636108,y:.5893563628196716,z:-.037981919944286346},{x:.5166932344436646,y:.5429551005363464,z:-.03319704160094261},{x:.5085030198097229,y:.49676206707954407,z:-.02691275253891945},{x:.4687720239162445,y:.6834565997123718,z:.008113506250083447},{x:.4426414966583252,y:.7069531679153442,z:.028577271848917007},{x:.5230373740196228,y:.6675713658332825,z:.001773772411979735},{x:.4481240212917328,y:.6527872085571289,z:.012414850294589996},{x:.5339856743812561,y:.7012367844581604,z:-.020220188423991203},{x:.5347223281860352,y:.7761190533638,z:-.05141595005989075},{x:.4315067231655121,y:.7211957573890686,z:.04381405934691429},{x:.45203351974487305,y:.7206180095672607,z:.017288070172071457},{x:.46892452239990234,y:.7265436053276062,z:.005602988880127668},{x:.49314674735069275,y:.7202282547950745,z:-.0006408205372281373},{x:.5104925632476807,y:.7091827392578125,z:-.00362918758764863},{x:.5232142210006714,y:.698553740978241,z:-.00787867046892643},{x:.5497883558273315,y:.6743605136871338,z:-.036349106580019},{x:.43658503890037537,y:.7627100348472595,z:.042555369436740875},{x:.4397648870944977,y:.6528646349906921,z:.017956094816327095},{x:.5653332471847534,y:.7992802858352661,z:-.06365057826042175},{x:.5285563468933105,y:.736810564994812,z:-.018836988136172295},{x:.4180678725242615,y:.6792560815811157,z:.12284679710865021},{x:.5328429937362671,y:.6865872144699097,z:-.010484723374247551},{x:.5230283141136169,y:.7809416055679321,z:-.011922398582100868},{x:.4551771283149719,y:.6650775074958801,z:.01774493046104908},{x:.5337203741073608,y:.7618928551673889,z:-.04697106033563614},{x:.43463975191116333,y:.8133478164672852,z:.1354849934577942},{x:.5225707292556763,y:.6605283617973328,z:.004980515688657761},{x:.5441933870315552,y:.7497199773788452,z:-.06091512367129326},{x:.4774007797241211,y:.9159183502197266,z:.059622734785079956},{x:.48068761825561523,y:.9364941716194153,z:.08404944837093353},{x:.4268292486667633,y:.7657528519630432,z:.09051097184419632},{x:.46051913499832153,y:.8880485892295837,z:.0738474428653717},{x:.4243420660495758,y:.6434382200241089,z:.06230505183339119},{x:.5342157483100891,y:.9835634231567383,z:.021662971004843712},{x:.5668109655380249,y:.8042187094688416,z:-.044937074184417725},{x:.5176341533660889,y:.7530587315559387,z:-.012967454269528389},{x:.430206298828125,y:.6835605502128601,z:.04612284153699875},{x:.4794231951236725,y:.6732114553451538,z:.003970044665038586},{x:.49073347449302673,y:.6722435355186462,z:.0008692514384165406},{x:.5294116139411926,y:.884677529335022,z:.004413890186697245},{x:.4430122375488281,y:.80235356092453,z:.04987282305955887},{x:.5603825449943542,y:1.0092442035675049,z:.026417359709739685},{x:.5186598300933838,y:.9828659892082214,z:.0513598807156086},{x:.5010536909103394,y:.9640932679176331,z:.06591596454381943},{x:.5524769425392151,y:.539441704750061,z:-.035816047340631485},{x:.5879997611045837,y:1.0091472864151,z:.02285068854689598},{x:.5016193985939026,y:.6684437990188599,z:.00028415941051207483},{x:.511952817440033,y:.6642197370529175,z:.0021144719794392586},{x:.5194343328475952,y:.6623469591140747,z:.004674181342124939},{x:.4321230351924896,y:.6496355533599854,z:.03124697133898735},{x:.508686363697052,y:.6479565501213074,z:-.00044765998609364033},{x:.4963986277580261,y:.6431032419204712,z:-.0032507688738405704},{x:.4845542013645172,y:.6430778503417969,z:-.002903624437749386},{x:.4733612537384033,y:.647506833076477,z:.00023347247042693198},{x:.4668654501438141,y:.653346598148346,z:.004762572236359119},{x:.41815051436424255,y:.633708119392395,z:.09809435904026031},{x:.47159942984580994,y:.6711485385894775,z:.007849935442209244},{x:.5734396576881409,y:.8256140351295471,z:-.03155219927430153},{x:.5306524038314819,y:.8337990641593933,z:-.018351426348090172},{x:.5371729135513306,y:.7910830974578857,z:-.037286680191755295},{x:.5549534559249878,y:.8275275826454163,z:-.030664825811982155},{x:.5597432255744934,y:.6418541669845581,z:-.03318847343325615},{x:.4958484172821045,y:.9429569244384766,z:.048340678215026855},{x:.5140507817268372,y:.9634028077125549,z:.03589847311377525},{x:.5587693452835083,y:.9951097369194031,z:.00908728688955307},{x:.46411189436912537,y:.9051855206489563,z:.10601935535669327},{x:.5181609392166138,y:.6554316878318787,z:.002546071307733655},{x:.5436590909957886,y:.7085841298103333,z:-.03844436630606651},{x:.5872187614440918,y:.9960382580757141,z:.0063423276878893375},{x:.5379653573036194,y:.9989125728607178,z:.03636329993605614},{x:.4350326955318451,y:.8088565468788147,z:.09147704392671585},{x:.5523084998130798,y:.8773422837257385,z:-.009068487212061882},{x:.5510149598121643,y:.8816931843757629,z:-.011043853126466274},{x:.5503793954849243,y:.88776695728302,z:-.01348799467086792},{x:.5501549243927002,y:.8954370617866516,z:-.012142189778387547},{x:.546072781085968,y:.9192524552345276,z:-.003157563041895628},{x:.5314661860466003,y:.8771666884422302,z:.0005075141089037061},{x:.5293324589729309,y:.8762547969818115,z:.00039177737198770046},{x:.5275698900222778,y:.8750609755516052,z:47732755774632096e-21},{x:.5104271173477173,y:.8607332110404968,z:.0012934643309563398},{x:.45938700437545776,y:.8134918212890625,z:.023569690063595772},{x:.5418947339057922,y:.6864100694656372,z:-.027333909645676613},{x:.531914234161377,y:.6456130743026733,z:-.005434140563011169},{x:.523697018623352,y:.647885262966156,z:-.0002466466394253075},{x:.5338191390037537,y:.8783687353134155,z:.002268768846988678},{x:.46226605772972107,y:.8610277771949768,z:.04718952998518944},{x:.5434442758560181,y:.6456181406974792,z:-.02327350154519081},{x:.5399754643440247,y:.940219521522522,z:.005075343884527683},{x:.5661457777023315,y:.71457839012146,z:-.06242101639509201},{x:.5523148775100708,y:.6974870562553406,z:-.04863070324063301},{x:.5639959573745728,y:.6923378109931946,z:-.05180761218070984},{x:.5367592573165894,y:.7423217296600342,z:-.03623027727007866},{x:.5853689908981323,y:.9752064943313599,z:-.002361974213272333},{x:.5835235118865967,y:.9493685960769653,z:-.003941743168979883},{x:.5615018606185913,y:.949194610118866,z:-.0015953965485095978},{x:.5068561434745789,y:.9048219323158264,z:.01862684078514576},{x:.5134067535400391,y:.7971825003623962,z:-.008485661819577217},{x:.5223897099494934,y:.925589919090271,z:.01249657291918993},{x:.48500555753707886,y:.7959478497505188,z:-.0032065745908766985},{x:.5037734508514404,y:.8184596300125122,z:-.004932103678584099},{x:.4766361117362976,y:.828806459903717,z:.01027688942849636},{x:.5589827299118042,y:.974656343460083,z:.0009666886180639267},{x:.5294582843780518,y:.7541216611862183,z:-.025603046640753746},{x:.4973002076148987,y:.9208990931510925,z:.031931452453136444},{x:.5163551568984985,y:.9432790875434875,z:.024321340024471283},{x:.49399662017822266,y:.8814862370491028,z:.018687399104237556},{x:.44948166608810425,y:.836137592792511,z:.05702034756541252},{x:.47898444533348083,y:.8836610913276672,z:.03150695189833641},{x:.4454479217529297,y:.8499438166618347,z:.08868525922298431},{x:.49572959542274475,y:.8452823758125305,z:.0036111653316766024},{x:.5362502336502075,y:.7222585678100586,z:-.027912352234125137},{x:.5393770337104797,y:.7850722074508667,z:-.05415399745106697},{x:.531399667263031,y:.7898418307304382,z:-.03883346915245056},{x:.5451627373695374,y:.7717036604881287,z:-.06480253487825394},{x:.5206395983695984,y:.6287745833396912,z:-.010521138086915016},{x:.4974782466888428,y:.6191938519477844,z:-.014098240062594414},{x:.4774145185947418,y:.6193130612373352,z:-.013643337413668633},{x:.4616098403930664,y:.6259890198707581,z:-.008448202162981033},{x:.4516478478908539,y:.6368461847305298,z:9050309745362028e-20},{x:.4485096037387848,y:.6719120740890503,z:.022984720766544342},{x:.42177659273147583,y:.7240667343139648,z:.08511673659086227},{x:.4616215229034424,y:.6988231539726257,z:.014238474890589714},{x:.4755798876285553,y:.7034608721733093,z:.00625590980052948},{x:.4924992024898529,y:.7005885243415833,z:.0009391739731654525},{x:.5082254409790039,y:.693384051322937,z:-.0009464038303121924},{x:.5203112959861755,y:.6849707961082458,z:-.0022114769089967012},{x:.52867591381073,y:.6779075860977173,z:-.002962538506835699},{x:.4213953912258148,y:.7219811677932739,z:.1350894570350647},{x:.5320829749107361,y:.794858992099762,z:-.03181503340601921},{x:.5452795028686523,y:.7286570072174072,z:-.04771539941430092},{x:.5496407747268677,y:.7866933345794678,z:-.06452003121376038},{x:.557040274143219,y:.7962084412574768,z:-.05837344378232956},{x:.549176812171936,y:.7895247936248779,z:-.057761140167713165},{x:.5362890362739563,y:.8005836606025696,z:-.026903774589300156},{x:.560200035572052,y:.7983731031417847,z:-.06172555685043335},{x:.5616944432258606,y:.8022753596305847,z:-.045200999826192856},{x:.5273328423500061,y:.6611284017562866,z:.0029021520167589188},{x:.534850537776947,y:.6660012006759644,z:-.005215510260313749},{x:.5394860506057739,y:.6701375246047974,z:-.014931917190551758},{x:.4634307324886322,y:.658291757106781,z:.009295716881752014},{x:.4538393020629883,y:.6519932150840759,z:.00930330716073513},{x:.5776031613349915,y:.7159298658370972,z:-.057365912944078445},{x:.6504855155944824,y:.6461779475212097,z:.014184834435582161},{x:.5860154032707214,y:.7962266206741333,z:-.04522843658924103},{x:.6842049360275269,y:.5631637573242188,z:.07207967340946198},{x:.6152560710906982,y:.6674962639808655,z:.0007529259892180562},{x:.6280948519706726,y:.6684326529502869,z:.0016892586136236787},{x:.6408625245094299,y:.6663892269134521,z:.005331226624548435},{x:.6557814478874207,y:.6534678936004639,z:.01646413467824459},{x:.6035663485527039,y:.6639701724052429,z:.0013799630105495453},{x:.6329053044319153,y:.608010470867157,z:-.006195899099111557},{x:.6167260408401489,y:.6117533445358276,z:-.006319951266050339},{x:.6471013426780701,y:.6112449765205383,z:-.0017843559617176652},{x:.6560901999473572,y:.6185776591300964,z:.004047257360070944},{x:.6666946411132812,y:.6651176810264587,z:.023647578433156013},{x:.6311345100402832,y:.9495396018028259,z:.014004078693687916},{x:.6544655561447144,y:.6397901773452759,z:.01809609681367874},{x:.6965808868408203,y:.6482675075531006,z:.08304904401302338},{x:.679817259311676,y:.650188148021698,z:.03632688894867897},{x:.6336516737937927,y:.7541458010673523,z:-.007742783520370722},{x:.5921701192855835,y:.8567668199539185,z:-.029399123042821884},{x:.591663658618927,y:.870215654373169,z:-.02103729173541069},{x:.6068367958068848,y:.8584195375442505,z:-.020668085664510727},{x:.6176617741584778,y:.860965371131897,z:-.009790095500648022},{x:.6040634512901306,y:.8686612844467163,z:-.015289564616978168},{x:.6143736839294434,y:.8671170473098755,z:-.005712216719985008},{x:.6373105049133301,y:.8815656900405884,z:.012672550976276398},{x:.5832505822181702,y:.7866312861442566,z:-.07051534950733185},{x:.5836675763130188,y:.7658692598342896,z:-.07566110789775848},{x:.6709531545639038,y:.604898989200592,z:.005951565690338612},{x:.6029891967773438,y:.705652117729187,z:-.013388276100158691},{x:.6131622195243835,y:.7728396058082581,z:-.036248479038476944},{x:.6123163104057312,y:.7612020373344421,z:-.03264721855521202},{x:.6696187853813171,y:.744706928730011,z:.009673702530562878},{x:.5803102254867554,y:.7385968565940857,z:-.0689152330160141},{x:.6404349207878113,y:.5877999663352966,z:-.01929756999015808},{x:.6588467955589294,y:.5929454565048218,z:-.008487257175147533},{x:.6720337867736816,y:.530631422996521,z:.043437421321868896},{x:.584305465221405,y:.6099005341529846,z:-.030301367864012718},{x:.6034283638000488,y:.6217452883720398,z:-.001970183802768588},{x:.6460927724838257,y:.8608663082122803,z:.015541625209152699},{x:.6957815289497375,y:.8326103091239929,z:.13015234470367432},{x:.6043362617492676,y:.7861682772636414,z:-.030476901680231094},{x:.594293475151062,y:.7942103147506714,z:-.032218821346759796},{x:.6324057579040527,y:.8665139675140381,z:.014255806803703308},{x:.6296147704124451,y:.8667733669281006,z:.010388285852968693},{x:.663644552230835,y:.5798642635345459,z:-.0022301070857793093},{x:.6140630841255188,y:.7809288501739502,z:-.02835679054260254},{x:.615908145904541,y:.5921698212623596,z:-.026804860681295395},{x:.617181122303009,y:.5748661756515503,z:-.03060605563223362},{x:.6222207546234131,y:.49137672781944275,z:-.011151673272252083},{x:.6669357419013977,y:.5541607141494751,z:.017466170713305473},{x:.6182981729507446,y:.5320425629615784,z:-.021793590858578682},{x:.6760554313659668,y:.595052182674408,z:.017115700989961624},{x:.6801463961601257,y:.5800720453262329,z:.043127160519361496},{x:.5922210812568665,y:.8644017577171326,z:-.02662893570959568},{x:.6054555177688599,y:.8637874722480774,z:-.018363753333687782},{x:.6161889433860779,y:.8641164898872375,z:-.008808949030935764},{x:.6017249822616577,y:.7901403307914734,z:-.028126630932092667},{x:.631446123123169,y:.8664817810058594,z:.012112865224480629},{x:.6249198913574219,y:.8716511130332947,z:.003882825840264559},{x:.6281915903091431,y:.867301881313324,z:.009891441091895103},{x:.5986843109130859,y:.7813931703567505,z:-.050227612257003784},{x:.6126407384872437,y:.869275689125061,z:-.0031255714129656553},{x:.6027271151542664,y:.8711842894554138,z:-.009324162267148495},{x:.59088134765625,y:.8742044568061829,z:-.014608660712838173},{x:.5984604358673096,y:.9216185212135315,z:-.005981989670544863},{x:.5950398445129395,y:.8964707255363464,z:-.01703473925590515},{x:.5941568613052368,y:.8882410526275635,z:-.017784785479307175},{x:.5928806662559509,y:.8803883194923401,z:-.014153128489851952},{x:.5909661054611206,y:.8748103976249695,z:-.012609979137778282},{x:.6128016710281372,y:.8702545762062073,z:-.0022550546564161777},{x:.6150846481323242,y:.8726804256439209,z:-.00414019962772727},{x:.6173093914985657,y:.8770190477371216,z:-.005970994010567665},{x:.619335412979126,y:.8814800977706909,z:-.0036864024586975574},{x:.6292637586593628,y:.8314558267593384,z:-.007714875973761082},{x:.702275276184082,y:.7320667505264282,z:.1433621346950531},{x:.6204835176467896,y:.8689177632331848,z:.0044869170524179935},{x:.6223508715629578,y:.8704851269721985,z:.00352082890458405},{x:.590448260307312,y:.8029727935791016,z:-.03200828656554222},{x:.6097423434257507,y:.7933741211891174,z:-.018042555078864098},{x:.59229576587677,y:.7993767261505127,z:-.032564569264650345},{x:.6171364188194275,y:.7153720259666443,z:-.007672437466681004},{x:.6389747858047485,y:.726390540599823,z:-.002999067772179842},{x:.6151940226554871,y:.769412100315094,z:-.024427521973848343},{x:.6526776552200317,y:.505868136882782,z:.01412637997418642},{x:.6475822329521179,y:.5375454425811768,z:-.0033899128902703524},{x:.6433356404304504,y:.5714520215988159,z:-.017428796738386154},{x:.626949667930603,y:.8962116837501526,z:.005602736957371235},{x:.5868416428565979,y:.5829002261161804,z:-.03727729618549347},{x:.5877229571342468,y:.5345035791397095,z:-.032396964728832245},{x:.5887066125869751,y:.48655083775520325,z:-.025856535881757736},{x:.6507197618484497,y:.6612282991409302,z:.011114613153040409},{x:.6803066730499268,y:.677992045879364,z:.032125361263751984},{x:.5963194370269775,y:.6598632335662842,z:.002976928371936083},{x:.667536199092865,y:.6274255514144897,z:.015618261881172657},{x:.5930740833282471,y:.6940041780471802,z:-.019217798486351967},{x:.6053346395492554,y:.7676517963409424,z:-.050308309495449066},{x:.6934473514556885,y:.6884298920631409,z:.04794462397694588},{x:.6738007664680481,y:.6934011578559875,z:.020697161555290222},{x:.6588084697723389,y:.7033141851425171,z:.008462334051728249},{x:.6346072554588318,y:.7029502391815186,z:.001542167621664703},{x:.6157816648483276,y:.6966525912284851,z:-.002009218093007803},{x:.6015574336051941,y:.688928484916687,z:-.006588225718587637},{x:.5746836066246033,y:.6711069345474243,z:-.03597589209675789},{x:.6947521567344666,y:.7309479117393494,z:.046707939356565475},{x:.6759101152420044,y:.6249120831489563,z:.021654341369867325},{x:.5794773101806641,y:.7971615195274353,z:-.06339326500892639},{x:.6041849851608276,y:.727514922618866,z:-.017512541264295578},{x:.6968844532966614,y:.6440950036048889,z:.12727996706962585},{x:.5910853147506714,y:.679325520992279,z:-.009497715160250664},{x:.6157375574111938,y:.7695677280426025,z:-.010624290443956852},{x:.6606494784355164,y:.6410489678382874,z:.0208158977329731},{x:.6040687561035156,y:.7531470656394958,z:-.045887019485235214},{x:.7012156248092651,y:.780247151851654,z:.14028730988502502},{x:.595149576663971,y:.6527782678604126,z:.006308757700026035},{x:.5925500392913818,y:.7436665892601013,z:-.060151755809783936},{x:.6780198812484741,y:.8905693888664246,z:.0626060739159584},{x:.676746666431427,y:.9113880395889282,z:.08726003766059875},{x:.7030686140060425,y:.7312687635421753,z:.09529774636030197},{x:.688987135887146,y:.8588417172431946,z:.07752864807844162},{x:.6883691549301147,y:.6109960675239563,z:.06669612973928452},{x:.6358906030654907,y:.9702065587043762,z:.023120900616049767},{x:.5781539678573608,y:.8023634552955627,z:-.044763918966054916},{x:.6170316934585571,y:.7408350706100464,z:-.011375460773706436},{x:.688542366027832,y:.6516284346580505,z:.050206027925014496},{x:.6385149359703064,y:.6540714502334595,z:.006462941411882639},{x:.6279382109642029,y:.6563615798950195,z:.003062846139073372},{x:.6268895268440247,y:.8736732006072998,z:.00627936702221632},{x:.6944946050643921,y:.7709181308746338,z:.053824134171009064},{x:.614617109298706,y:1.0022112131118774,z:.02719894051551819},{x:.6493719220161438,y:.9665167927742004,z:.053563784807920456},{x:.6624587178230286,y:.943530797958374,z:.068605437874794},{x:.6162528991699219,y:.6558693051338196,z:.002187855076044798},{x:.6058168411254883,y:.654328465461731,z:.0036193584091961384},{x:.5987918972969055,y:.6536934971809387,z:.006134530063718557},{x:.6831037402153015,y:.6195642948150635,z:.03511790186166763},{x:.6062582731246948,y:.6356398463249207,z:.001280312892049551},{x:.6174948811531067,y:.62776118516922,z:-.0013642468256875873},{x:.6297246217727661,y:.6253792643547058,z:-.0007034156005829573},{x:.6407091617584229,y:.627578616142273,z:.0028144705574959517},{x:.6479622721672058,y:.6322650909423828,z:.00750273372977972},{x:.6915091276168823,y:.5990704298019409,z:.10270945727825165},{x:.6457163095474243,y:.6504453420639038,z:.010696077719330788},{x:.6164222955703735,y:.8231936097145081,z:-.016772059723734856},{x:.6042401194572449,y:.7830976843833923,z:-.03630910441279411},{x:.5922216773033142,y:.8228387236595154,z:-.029992375522851944},{x:.6646111011505127,y:.92097008228302,z:.050967294722795486},{x:.651232898235321,y:.9460107088088989,z:.038000158965587616},{x:.6140977144241333,y:.9882472157478333,z:.009882091544568539},{x:.6870781183242798,y:.8768675327301025,z:.10980932414531708},{x:.5986856818199158,y:.6456438899040222,z:.003999010659754276},{x:.585981547832489,y:.7034481763839722,z:-.0377722829580307},{x:.6342031359672546,y:.9867448806762695,z:.03786521404981613},{x:.7013950943946838,y:.776049017906189,z:.09598205983638763},{x:.6030206680297852,y:.8719133138656616,z:-.007931148633360863},{x:.6050592064857483,y:.8767156004905701,z:-.009791925549507141},{x:.6073468923568726,y:.8831382393836975,z:-.012361008673906326},{x:.6087977290153503,y:.890143632888794,z:-.01098148338496685},{x:.6147705316543579,y:.9110084772109985,z:-.0018823575228452682},{x:.622577965259552,y:.8670604825019836,z:.002609190298244357},{x:.6241236329078674,y:.8651344180107117,z:.0025534380692988634},{x:.6257084608078003,y:.8638408184051514,z:.0023300074972212315},{x:.639931321144104,y:.8449671268463135,z:.0038123116828501225},{x:.6810906529426575,y:.7856625318527222,z:.02717764675617218},{x:.583532452583313,y:.6811994910240173,z:-.026588857173919678},{x:.5855660438537598,y:.6393819451332092,z:-.004512844607234001},{x:.5932201743125916,y:.6398029327392578,z:.0008020466193556786},{x:.6200879812240601,y:.8683351874351501,z:.00417016725987196},{x:.6842559576034546,y:.8330534100532532,z:.050836317241191864},{x:.5754412412643433,y:.6418221592903137,z:-.022838059812784195},{x:.6232790350914001,y:.9295297265052795,z:.006339520215988159},{x:.5764067769050598,y:.694546639919281,z:-.04825803264975548},{x:.59778892993927,y:.7343927621841431,z:-.035004377365112305},{x:.6042810678482056,y:.9441440105438232,z:-.0010970570147037506},{x:.6496372222900391,y:.8869078159332275,z:.021036235615611076},{x:.6274012327194214,y:.7830310463905334,z:-.006658440921455622},{x:.637792706489563,y:.9104999899864197,z:.014290250837802887},{x:.6549934148788452,y:.7748609185218811,z:-.0006672973395325243},{x:.6404005289077759,y:.801220715045929,z:-.0026642554439604282},{x:.6671456694602966,y:.8045546412467957,z:.013180811889469624},{x:.6107483506202698,y:.9680658578872681,z:.001778992242179811},{x:.6060343980789185,y:.744587242603302,z:-.024382334202528},{x:.6602751612663269,y:.8998945355415344,z:.0344940721988678},{x:.6463775038719177,y:.9262562394142151,z:.02617623284459114},{x:.6579852104187012,y:.8602304458618164,z:.021586716175079346},{x:.6926165223121643,y:.8053340315818787,z:.061075080186128616},{x:.6724731922149658,y:.8594399690628052,z:.03457934781908989},{x:.6975721716880798,y:.8183245062828064,z:.09300774335861206},{x:.6512877941131592,y:.8258221745491028,z:.006324059329926968},{x:.594887375831604,y:.7148372530937195,z:-.026898479089140892},{x:.6017440557479858,y:.7773507833480835,z:-.05312420800328255},{x:.6096571683883667,y:.7806998491287231,z:-.037646256387233734},{x:.5952993035316467,y:.7654367685317993,z:-.06398405134677887},{x:.5950021147727966,y:.6201304793357849,z:-.009297547861933708},{x:.6165438890457153,y:.6052900552749634,z:-.012455573305487633},{x:.6362661719322205,y:.6015968918800354,z:-.011649220250546932},{x:.6522727608680725,y:.6046400666236877,z:-.005903332494199276},{x:.6625409722328186,y:.6128141283988953,z:.0030042496509850025},{x:.6688099503517151,y:.6457712054252625,z:.026322703808546066},{x:.7013440728187561,y:.6893666386604309,z:.08984331786632538},{x:.6608623266220093,y:.6749406456947327,z:.0172116681933403},{x:.6482325196266174,y:.6823726296424866,z:.008881398476660252},{x:.6313265562057495,y:.6842025518417358,z:.0031308617908507586},{x:.6147016286849976,y:.6809731721878052,z:.0007630771724507213},{x:.6018834114074707,y:.6755372285842896,z:-.0008834321051836014},{x:.5925027132034302,y:.670681357383728,z:-.001968748401850462},{x:.700127363204956,y:.6871103644371033,z:.13980500400066376},{x:.6095665693283081,y:.7853189706802368,z:-.03074747882783413},{x:.5880423784255981,y:.7229287028312683,z:-.04691500961780548},{x:.5930182337760925,y:.7811514139175415,z:-.06398335844278336},{x:.5867722034454346,y:.7922660112380981,z:-.05794971063733101},{x:.5933279991149902,y:.7842848896980286,z:-.05714067071676254},{x:.6063535809516907,y:.7920218706130981,z:-.02590685710310936},{x:.5839452743530273,y:.794978141784668,z:-.0615212507545948},{x:.5828126072883606,y:.8000800013542175,z:-.0449722595512867},{x:.5909603834152222,y:.6541213393211365,z:.003991890233010054},{x:.5852181911468506,y:.6602938771247864,z:-.004428438376635313},{x:.5825737714767456,y:.6651063561439514,z:-.014345290139317513},{x:.6517343521118164,y:.6362385153770447,z:.012151890434324741},{x:.6615052819252014,y:.6281577944755554,z:.0123682152479887},{x:.4856873154640198,y:.6568945646286011,z:.000720038078725338},{x:.49988406896591187,y:.6547410488128662,z:.0006949726957827806},{x:.48438939452171326,y:.6392973065376282,z:.000705525919329375},{x:.47143134474754333,y:.6589511632919312,z:.0006980331381782889},{x:.48704618215560913,y:.6752797961235046,z:.0006921177846379578},{x:.6243702173233032,y:.640461802482605,z:-6592126737814397e-20},{x:.6390967965126038,y:.6385173797607422,z:-.00016105435497593135},{x:.6230536699295044,y:.6224825382232666,z:-.00016136496560648084},{x:.6095397472381592,y:.641917884349823,z:-.0001803556369850412},{x:.6250996589660645,y:.6586247682571411,z:-.0001785515050869435}]],faceBlendshapes:[{categories:[{index:0,score:5187174338061595e-21,categoryName:"_neutral",displayName:""},{index:1,score:.24521504342556,categoryName:"browDownLeft",displayName:""},{index:2,score:.1987743377685547,categoryName:"browDownRight",displayName:""},{index:3,score:.013400448486208916,categoryName:"browInnerUp",displayName:""},{index:4,score:.012361560948193073,categoryName:"browOuterUpLeft",displayName:""},{index:5,score:.019305096939206123,categoryName:"browOuterUpRight",displayName:""},{index:6,score:28426356948330067e-21,categoryName:"cheekPuff",displayName:""},{index:7,score:3.4500112633395474e-7,categoryName:"cheekSquintLeft",displayName:""},{index:8,score:4.83789051486383e-7,categoryName:"cheekSquintRight",displayName:""},{index:9,score:.07650448381900787,categoryName:"eyeBlinkLeft",displayName:""},{index:10,score:.05070012807846069,categoryName:"eyeBlinkRight",displayName:""},{index:11,score:.13978900015354156,categoryName:"eyeLookDownLeft",displayName:""},{index:12,score:.14198613166809082,categoryName:"eyeLookDownRight",displayName:""},{index:13,score:.2177766114473343,categoryName:"eyeLookInLeft",displayName:""},{index:14,score:.014739357866346836,categoryName:"eyeLookInRight",displayName:""},{index:15,score:.02361512929201126,categoryName:"eyeLookOutLeft",displayName:""},{index:16,score:.19679604470729828,categoryName:"eyeLookOutRight",displayName:""},{index:17,score:.04874616861343384,categoryName:"eyeLookUpLeft",displayName:""},{index:18,score:.049392376095056534,categoryName:"eyeLookUpRight",displayName:""},{index:19,score:.34944331645965576,categoryName:"eyeSquintLeft",displayName:""},{index:20,score:.2939716875553131,categoryName:"eyeSquintRight",displayName:""},{index:21,score:.005955042317509651,categoryName:"eyeWideLeft",displayName:""},{index:22,score:.006776117719709873,categoryName:"eyeWideRight",displayName:""},{index:23,score:16942436559475027e-21,categoryName:"jawForward",displayName:""},{index:24,score:.0045165494084358215,categoryName:"jawLeft",displayName:""},{index:25,score:.07803940027952194,categoryName:"jawOpen",displayName:""},{index:26,score:2090057751047425e-20,categoryName:"jawRight",displayName:""},{index:27,score:.06032035872340202,categoryName:"mouthClose",displayName:""},{index:28,score:.00228882092051208,categoryName:"mouthDimpleLeft",displayName:""},{index:29,score:.00781762320548296,categoryName:"mouthDimpleRight",displayName:""},{index:30,score:.0017093931091949344,categoryName:"mouthFrownLeft",displayName:""},{index:31,score:.0019319106359034777,categoryName:"mouthFrownRight",displayName:""},{index:32,score:8485237776767462e-20,categoryName:"mouthFunnel",displayName:""},{index:33,score:.0009051355300471187,categoryName:"mouthLeft",displayName:""},{index:34,score:.0003630454302765429,categoryName:"mouthLowerDownLeft",displayName:""},{index:35,score:.00017601238505449146,categoryName:"mouthLowerDownRight",displayName:""},{index:36,score:.12865161895751953,categoryName:"mouthPressLeft",displayName:""},{index:37,score:.20137207210063934,categoryName:"mouthPressRight",displayName:""},{index:38,score:.0022203284315764904,categoryName:"mouthPucker",displayName:""},{index:39,score:.0009096377179957926,categoryName:"mouthRight",displayName:""},{index:40,score:.34189721941947937,categoryName:"mouthRollLower",displayName:""},{index:41,score:.11409689486026764,categoryName:"mouthRollUpper",displayName:""},{index:42,score:.17172536253929138,categoryName:"mouthShrugLower",displayName:""},{index:43,score:.004038424696773291,categoryName:"mouthShrugUpper",displayName:""},{index:44,score:.00023205230536404997,categoryName:"mouthSmileLeft",displayName:""},{index:45,score:.00019313619122840464,categoryName:"mouthSmileRight",displayName:""},{index:46,score:.0018571305554360151,categoryName:"mouthStretchLeft",displayName:""},{index:47,score:.0023813238367438316,categoryName:"mouthStretchRight",displayName:""},{index:48,score:24323100660694763e-21,categoryName:"mouthUpperUpLeft",displayName:""},{index:49,score:3161552012898028e-20,categoryName:"mouthUpperUpRight",displayName:""},{index:50,score:1.08198406678639e-7,categoryName:"noseSneerLeft",displayName:""},{index:51,score:12652527630052646e-22,categoryName:"noseSneerRight",displayName:""}],headIndex:-1,headName:""}],facialTransformationMatrixes:[{rows:4,columns:4,data:[.9947517514228821,.10230544209480286,.0013679931871592999,0,-.10230997204780579,.9947447776794434,.003816320328041911,0,-.000970348424743861,-.0039362297393381596,.9999914169311523,0,2.8888821601867676,-7.808934211730957,-30.52109146118164,1]}]}},UC=(0,i.createContext)({}),NC={basePath:"https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.8/wasm",options:{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task",delegate:"GPU"},runningMode:"VIDEO",outputFaceBlendshapes:!0,outputFacialTransformationMatrixes:!0}};function VC({basePath:e=NC.basePath,options:t=NC.options,children:r}){const o=JSON.stringify(t),s=(0,_a.Rq)((async()=>{const{FilesetResolver:r,FaceLandmarker:i}=await n.e(7875).then(n.bind(n,17875)),o=await r.forVisionTasks(e);return i.createFromOptions(o,t)}),[e,o]);return(0,i.useEffect)((()=>()=>{null==s||s.close(),(0,_a.ZH)([e,o])}),[s,e,o]),i.createElement(UC.Provider,{value:s},r)}function GC(){return(0,i.useContext)(UC)}function jC(e,t){return e.clone().add(t).multiplyScalar(.5)}function HC(e,t,n){const r=e.localToWorld(t);return n.worldToLocal(r)}const qC=(0,i.createContext)({}),WC=(0,i.forwardRef)((({camera:e,autostart:t=!0,webcam:n=!0,webcamVideoTextureSrc:o,manualUpdate:c=!1,manualDetect:l=!1,onVideoFrame:u,smoothTime:h=.25,offset:d=!0,offsetScalar:A=80,eyes:m=!1,eyesAsOrigin:p=!0,depth:f=.15,debug:g=!1,facemesh:y,makeDefault:v},x)=>{var E,w;const C=(0,a.D)((e=>e.scene)),I=(0,a.D)((e=>e.camera)),_=(0,a.D)((e=>e.set)),b=(0,a.D)((e=>e.get)),B=e||I,M=(0,i.useRef)(null),S=(0,i.useRef)(null),[D]=(0,i.useState)((()=>new s.Object3D)),[T]=(0,i.useState)((()=>new s.Vector3)),[Q]=(0,i.useState)((()=>new s.Vector3)),[P]=(0,i.useState)((()=>new s.Vector3)),[z]=(0,i.useState)((()=>new s.Vector3)),R=(0,i.useCallback)((()=>{D.parent=B.parent;const e=S.current;if(e){const{outerRef:t,eyeRightRef:n,eyeLeftRef:r}=e;if(n.current&&r.current){const{irisDirRef:e}=n.current,{irisDirRef:i}=r.current;e.current&&i.current&&t.current&&(T.copy(HC(e.current,new s.Vector3(0,0,0),t.current)),Q.copy(HC(i.current,new s.Vector3(0,0,0),t.current)),D.position.copy(HC(t.current,jC(T,Q),B.parent||C)),P.copy(HC(e.current,new s.Vector3(0,0,1),t.current)),z.copy(HC(i.current,new s.Vector3(0,0,1),t.current)),D.lookAt(t.current.localToWorld(jC(P,z))))}else t.current&&(D.position.copy(HC(t.current,new s.Vector3(0,0,0),B.parent||C)),D.lookAt(t.current.localToWorld(new s.Vector3(0,0,1))))}return D}),[B,Q,z,T,P,C,D]),[F]=(0,i.useState)((()=>new s.Object3D)),k=(0,i.useCallback)((function(e,t){if(B){var n;if(null!==(n=t)&&void 0!==n||(t=R()),h>0){const n=1e-9;Sn.damp3(F.position,t.position,h,e,void 0,void 0,n),Sn.dampE(F.rotation,t.rotation,h,e,void 0,void 0,n)}else F.position.copy(t.position),F.rotation.copy(t.rotation);B.position.copy(F.position),B.rotation.copy(F.rotation)}}),[B,R,h,F.position,F.rotation]),[L,O]=(0,i.useState)(),U=GC(),N=(0,i.useCallback)(((e,t)=>{const n=null==U?void 0:U.detectForVideo(e,t);O(n)}),[U]);(0,a.F)(((e,t)=>{c||k(t)}));const V=(0,i.useMemo)((()=>Object.assign(Object.create(s.EventDispatcher.prototype),{detect:N,computeTarget:R,update:k,facemeshApiRef:S,webcamApiRef:M,play:()=>{var e;null==(e=M.current)||null==(e=e.videoTextureApiRef.current)||e.texture.source.data.play()},pause:()=>{var e;null==(e=M.current)||null==(e=e.videoTextureApiRef.current)||e.texture.source.data.pause()}})),[N,R,k]);(0,i.useImperativeHandle)(x,(()=>V),[V]),(0,i.useEffect)((()=>{const e=e=>{l||N(e.texture.source.data,e.time),u&&u(e)};return V.addEventListener("videoFrame",e),()=>{V.removeEventListener("videoFrame",e)}}),[V,N,U,l,u]),(0,i.useEffect)((()=>{if(v){const e=b().controls;return _({controls:V}),()=>_({controls:e})}}),[v,V,b,_]);const G=null==L?void 0:L.faceLandmarks[0],j=null==L||null==(E=L.facialTransformationMatrixes)?void 0:E[0],H=null==L||null==(w=L.faceBlendshapes)?void 0:w[0];return i.createElement(qC.Provider,{value:V},n&&i.createElement(i.Suspense,{fallback:null},i.createElement(XC,{ref:M,autostart:t,videoTextureSrc:o})),i.createElement(FC,(0,r.Z)({ref:S},y,{points:G,depth:f,facialTransformationMatrix:j,faceBlendshapes:H,eyes:m,eyesAsOrigin:p,offset:d,offsetScalar:A,debug:g,"rotation-z":Math.PI,visible:g}),i.createElement("meshBasicMaterial",{side:s.DoubleSide})))})),YC=()=>(0,i.useContext)(qC),XC=(0,i.forwardRef)((({videoTextureSrc:e,autostart:t=!0},n)=>{const r=(0,i.useRef)(null),o=YC(),s=(0,_a.Rq)((async()=>e?Promise.resolve(null):await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user"}})),[e]);(0,i.useEffect)((()=>(o.dispatchEvent({type:"stream",stream:s}),()=>{null==s||s.getTracks().forEach((e=>e.stop())),(0,_a.ZH)([e])})),[s,o,e]);const a=(0,i.useMemo)((()=>({videoTextureApiRef:r})),[]);return(0,i.useImperativeHandle)(n,(()=>a),[a]),i.createElement(i.Suspense,{fallback:null},i.createElement(ZC,{ref:r,src:e||s,start:t}))})),ZC=(0,i.forwardRef)((({src:e,start:t},n)=>{const r=HA(e,{start:t}),o=r.source.data,s=YC(),a=(0,i.useCallback)((e=>{s.dispatchEvent({type:"videoFrame",texture:r,time:e})}),[r,s]);KC(o,a);const c=(0,i.useMemo)((()=>({texture:r})),[r]);return(0,i.useImperativeHandle)(n,(()=>c),[c]),i.createElement(i.Fragment,null)})),KC=(e,t)=>{(0,i.useEffect)((()=>{if(!e||!e.requestVideoFrameCallback)return;let n;return e.requestVideoFrameCallback((function r(...i){t(...i),n=e.requestVideoFrameCallback(r)})),()=>e.cancelVideoFrameCallback(n)}),[e,t])}},15595:function(e,t,n){"use strict";var r=n(94311);function i(){}function o(){}o.resetWarningCache=i,e.exports=function(){function e(e,t,n,i,o,s){if(s!==r){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:i};return n.PropTypes=n,n}},31803:function(e,t,n){e.exports=n(15595)()},94311:function(e){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},18729:function(e){e.exports=function(){var e=function(){function t(e){return i.appendChild(e.dom),e}function n(e){for(var t=0;t<i.children.length;t++)i.children[t].style.display=t===e?"block":"none";r=e}var r=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",(function(e){e.preventDefault(),n(++r%i.children.length)}),!1);var o=(performance||Date).now(),s=o,a=0,c=t(new e.Panel("FPS","#0ff","#002")),l=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=t(new e.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:i,addPanel:t,showPanel:n,begin:function(){o=(performance||Date).now()},end:function(){a++;var e=(performance||Date).now();if(l.update(e-o,200),e>s+1e3&&(c.update(1e3*a/(e-s),100),s=e,a=0,u)){var t=performance.memory;u.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){o=this.end()},domElement:i,setMode:n}};return e.Panel=function(e,t,n){var r=1/0,i=0,o=Math.round,s=o(window.devicePixelRatio||1),a=80*s,c=48*s,l=3*s,u=2*s,h=3*s,d=15*s,A=74*s,m=30*s,p=document.createElement("canvas");p.width=a,p.height=c,p.style.cssText="width:80px;height:48px";var f=p.getContext("2d");return f.font="bold "+9*s+"px Helvetica,Arial,sans-serif",f.textBaseline="top",f.fillStyle=n,f.fillRect(0,0,a,c),f.fillStyle=t,f.fillText(e,l,u),f.fillRect(h,d,A,m),f.fillStyle=n,f.globalAlpha=.9,f.fillRect(h,d,A,m),{dom:p,update:function(c,g){r=Math.min(r,c),i=Math.max(i,c),f.fillStyle=n,f.globalAlpha=1,f.fillRect(0,0,a,d),f.fillStyle=t,f.fillText(o(c)+" "+e+" ("+o(r)+"-"+o(i)+")",l,u),f.drawImage(p,h+s,d,A-s,m,h,d,A-s,m),f.fillRect(h+A-s,d,s,m),f.fillStyle=n,f.globalAlpha=.9,f.fillRect(h+A-s,d,s,o((1-c/g)*m))}}},e}()},4096:function(e,t,n){"use strict";n.d(t,{B$:function(){return d},MW:function(){return i}});var r=n(21247);const i=/\bvoid\s+main\s*\(\s*\)\s*{/g;function o(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,(function(e,t){let n=r.ShaderChunk[t];return n?o(n):e}))}const s=[];for(let g=0;g<256;g++)s[g]=(g<16?"0":"")+g.toString(16);const a=Object.assign||function(){let e=arguments[0];for(let t=1,n=arguments.length;t<n;t++){let n=arguments[t];if(n)for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},c=Date.now(),l=new WeakMap,u=new Map;let h=1e10;function d(e,t){const n=function(e){const t=JSON.stringify(e,m);let n=f.get(t);null==n&&f.set(t,n=++p);return n}(t);let i=l.get(e);if(i||l.set(e,i=Object.create(null)),i[n])return new i[n];const g=`_onBeforeCompile${n}`,y=function(r,i){e.onBeforeCompile.call(this,r,i);const s=this.customProgramCacheKey()+"|"+r.vertexShader+"|"+r.fragmentShader;let l=u[s];if(!l){const e=function(e,{vertexShader:t,fragmentShader:n},r,i){let{vertexDefs:s,vertexMainIntro:a,vertexMainOutro:c,vertexTransform:l,fragmentDefs:u,fragmentMainIntro:h,fragmentMainOutro:d,fragmentColorTransform:m,customRewriter:p,timeUniform:f}=r;s=s||"",a=a||"",c=c||"",u=u||"",h=h||"",d=d||"",(l||p)&&(t=o(t));(m||p)&&(n=o(n=n.replace(/^[ \t]*#include <((?:tonemapping|encodings|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n")));if(p){let e=p({vertexShader:t,fragmentShader:n});t=e.vertexShader,n=e.fragmentShader}if(m){let e=[];n=n.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,(t=>(e.push(t),""))),d=`${m}\n${e.join("\n")}\n${d}`}if(f){const e=`\nuniform float ${f};\n`;s=e+s,u=e+u}l&&(s=`${s}\nvoid troikaVertexTransform${i}(inout vec3 position, inout vec3 normal, inout vec2 uv) {\n  ${l}\n}\n`,a=`\ntroika_position_${i} = vec3(position);\ntroika_normal_${i} = vec3(normal);\ntroika_uv_${i} = vec2(uv);\ntroikaVertexTransform${i}(troika_position_${i}, troika_normal_${i}, troika_uv_${i});\n${a}\n`,t=(t=`vec3 troika_position_${i};\nvec3 troika_normal_${i};\nvec2 troika_uv_${i};\n${t}\n`).replace(/\b(position|normal|uv)\b/g,((e,t,n,r)=>/\battribute\s+vec[23]\s+$/.test(r.substr(0,n))?t:`troika_${t}_${i}`)),e.map&&e.map.channel>0||(t=t.replace(/\bMAP_UV\b/g,`troika_uv_${i}`)));return t=A(t,i,s,a,c),n=A(n,i,u,h,d),{vertexShader:t,fragmentShader:n}}(this,r,t,n);l=u[s]=e}r.vertexShader=l.vertexShader,r.fragmentShader=l.fragmentShader,a(r.uniforms,this.uniforms),t.timeUniform&&(r.uniforms[t.timeUniform]={get value(){return Date.now()-c}}),this[g]&&this[g](r)},v=function(){return x(t.chained?e:e.clone())},x=function(r){const i=Object.create(r,E);return Object.defineProperty(i,"baseMaterial",{value:e}),Object.defineProperty(i,"id",{value:h++}),i.uuid=function(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(s[255&e]+s[e>>8&255]+s[e>>16&255]+s[e>>24&255]+"-"+s[255&t]+s[t>>8&255]+"-"+s[t>>16&15|64]+s[t>>24&255]+"-"+s[63&n|128]+s[n>>8&255]+"-"+s[n>>16&255]+s[n>>24&255]+s[255&r]+s[r>>8&255]+s[r>>16&255]+s[r>>24&255]).toUpperCase()}(),i.uniforms=a({},r.uniforms,t.uniforms),i.defines=a({},r.defines,t.defines),i.defines[`TROIKA_DERIVED_MATERIAL_${n}`]="",i.extensions=a({},r.extensions,t.extensions),i._listeners=void 0,i},E={constructor:{value:v},isDerivedMaterial:{value:!0},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return e.customProgramCacheKey()+"|"+n}},onBeforeCompile:{get:()=>y,set(e){this[g]=e}},copy:{writable:!0,configurable:!0,value:function(t){return e.copy.call(this,t),e.isShaderMaterial||e.isDerivedMaterial||(a(this.extensions,t.extensions),a(this.defines,t.defines),a(this.uniforms,r.UniformsUtils.clone(t.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const t=new e.constructor;return x(t).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let n=this._depthMaterial;return n||(n=this._depthMaterial=d(e.isDerivedMaterial?e.getDepthMaterial():new r.MeshDepthMaterial({depthPacking:r.RGBADepthPacking}),t),n.defines.IS_DEPTH_MATERIAL="",n.uniforms=this.uniforms),n}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let n=this._distanceMaterial;return n||(n=this._distanceMaterial=d(e.isDerivedMaterial?e.getDistanceMaterial():new r.MeshDistanceMaterial,t),n.defines.IS_DISTANCE_MATERIAL="",n.uniforms=this.uniforms),n}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:t,_distanceMaterial:n}=this;t&&t.dispose(),n&&n.dispose(),e.dispose.call(this)}}};return i[n]=v,new v}function A(e,t,n,r,o){return(r||o||n)&&(e=e.replace(i,`\n${n}\nvoid troikaOrigMain${t}() {`),e+=`\nvoid main() {\n  ${r}\n  troikaOrigMain${t}();\n  ${o}\n}`),e}function m(e,t){return"uniforms"===e?void 0:"function"===typeof t?t.toString():t}let p=0;const f=new Map;r.DoubleSide;r.Mesh},38265:function(e,t,n){"use strict";n.d(t,{Ae:function(){return d},Ch:function(){return h}});n(68571);function r(){var e=Object.create(null);function t(r,i){var o=r.id,s=r.name,a=r.dependencies;void 0===a&&(a=[]);var c=r.init;void 0===c&&(c=function(){});var l=r.getTransferables;if(void 0===l&&(l=null),!e[o])try{a=a.map((function(n){return n&&n.isWorkerModule&&(t(n,(function(e){if(e instanceof Error)throw e})),n=e[n.id].value),n})),c=n("<"+s+">.init",c),l&&(l=n("<"+s+">.getTransferables",l));var u=null;"function"===typeof c?u=c.apply(void 0,a):console.error("worker module init function failed to rehydrate"),e[o]={id:o,value:u,getTransferables:l},i(u)}catch(h){h&&h.noLog||console.error(h),i(h)}}function n(e,t){var n=void 0;self.troikaDefine=function(e){return n=e};var r=URL.createObjectURL(new Blob(["/** "+e.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+t+"\n)"],{type:"application/javascript"}));try{importScripts(r)}catch(i){console.error(i)}return URL.revokeObjectURL(r),delete self.troikaDefine,n}self.addEventListener("message",(function(n){var r=n.data,i=r.messageId,o=r.action,s=r.data;try{"registerModule"===o&&t(s,(function(e){e instanceof Error?postMessage({messageId:i,success:!1,error:e.message}):postMessage({messageId:i,success:!0,result:{isCallable:"function"===typeof e}})})),"callModule"===o&&function(t,n){var r,i=t.id,o=t.args;e[i]&&"function"===typeof e[i].value||n(new Error("Worker module "+i+": not found or its 'init' did not return a function"));try{var s=(r=e[i]).value.apply(r,o);s&&"function"===typeof s.then?s.then(a,(function(e){return n(e instanceof Error?e:new Error(""+e))})):a(s)}catch(c){n(c)}function a(t){try{var r=e[i].getTransferables&&e[i].getTransferables(t);r&&Array.isArray(r)&&r.length||(r=void 0),n(t,r)}catch(c){console.error(c),n(c)}}}(s,(function(e,t){e instanceof Error?postMessage({messageId:i,success:!1,error:e.message}):postMessage({messageId:i,success:!0,result:e},t||void 0)}))}catch(a){postMessage({messageId:i,success:!1,error:a.stack})}}))}var i=function(){var e=!1;if("undefined"!==typeof window&&"undefined"!==typeof window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),e=!0}catch(t){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+t.message+"]")}return i=function(){return e},e},o=0,s=0,a=!1,c=Object.create(null),l=Object.create(null),u=Object.create(null);function h(e){if((!e||"function"!==typeof e.init)&&!a)throw new Error("requires `options.init` function");var t=e.dependencies,n=e.init,r=e.getTransferables,s=e.workerId;if(!i())return function(e){var t=function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return t._getInitResult().then((function(t){if("function"===typeof t)return t.apply(void 0,e);throw new Error("Worker module function was called but `init` did not return a callable function")}))};return t._getInitResult=function(){var n=e.dependencies,r=e.init;n=Array.isArray(n)?n.map((function(e){return e&&e._getInitResult?e._getInitResult():e})):[];var i=Promise.all(n).then((function(e){return r.apply(null,e)}));return t._getInitResult=function(){return i},i},t}(e);null==s&&(s="#default");var c="workerModule"+ ++o,u=e.name||c,d=null;function p(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(!d){d=m(s,"registerModule",p.workerModuleData);var n=function(){d=null,l[s].delete(n)};(l[s]||(l[s]=new Set)).add(n)}return d.then((function(t){if(t.isCallable)return m(s,"callModule",{id:c,args:e});throw new Error("Worker module function was called but `init` did not return a callable function")}))}return t=t&&t.map((function(e){return"function"!==typeof e||e.workerModuleData||(a=!0,e=h({workerId:s,name:"<"+u+"> function dependency: "+e.name,init:"function(){return (\n"+A(e)+"\n)}"}),a=!1),e&&e.workerModuleData&&(e=e.workerModuleData),e})),p.workerModuleData={isWorkerModule:!0,id:c,name:u,dependencies:t,init:A(n),getTransferables:r&&A(r)},p}function d(e){l[e]&&l[e].forEach((function(e){e()})),c[e]&&(c[e].terminate(),delete c[e])}function A(e){var t=e.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function m(e,t,n){return new Promise((function(i,o){var a=++s;u[a]=function(e){e.success?i(e.result):o(new Error("Error in worker "+t+" call: "+e.error))},function(e){var t=c[e];if(!t){var n=A(r);(t=c[e]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+e.replace(/\*/g,"")+" **/\n\n;("+n+")()"],{type:"application/javascript"})))).onmessage=function(e){var t=e.data,n=t.messageId,r=u[n];if(!r)throw new Error("WorkerModule response with empty or unknown messageId");delete u[n],r(t)}}return t}(e).postMessage({messageId:a,action:t,data:n})}))}},46482:function(e,t,n){"use strict";var r=n(2265);var i="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},o=r.useState,s=r.useEffect,a=r.useLayoutEffect,c=r.useDebugValue;function l(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!i(e,n)}catch(r){return!0}}var u="undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),r=o({inst:{value:n,getSnapshot:t}}),i=r[0].inst,u=r[1];return a((function(){i.value=n,i.getSnapshot=t,l(i)&&u({inst:i})}),[e,n,t]),s((function(){return l(i)&&u({inst:i}),e((function(){l(i)&&u({inst:i})}))}),[e]),c(n),n};t.useSyncExternalStore=void 0!==r.useSyncExternalStore?r.useSyncExternalStore:u},58846:function(e,t,n){"use strict";var r=n(2265),i=n(97508);var o="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},s=i.useSyncExternalStore,a=r.useRef,c=r.useEffect,l=r.useMemo,u=r.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,n,r,i){var h=a(null);if(null===h.current){var d={hasValue:!1,value:null};h.current=d}else d=h.current;h=l((function(){function e(e){if(!c){if(c=!0,s=e,e=r(e),void 0!==i&&d.hasValue){var t=d.value;if(i(t,e))return a=t}return a=e}if(t=a,o(s,e))return t;var n=r(e);return void 0!==i&&i(t,n)?t:(s=e,a=n)}var s,a,c=!1,l=void 0===n?null:n;return[function(){return e(t())},null===l?void 0:function(){return e(l())}]}),[t,n,r,i]);var A=s(e,h[0],h[1]);return c((function(){d.hasValue=!0,d.value=A}),[A]),u(A),A}},97508:function(e,t,n){"use strict";e.exports=n(46482)},28306:function(e,t,n){"use strict";e.exports=n(58846)},54731:function(e,t){"use strict";t.Z=function(){return function(e){var t={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},n={},r={};n.L=1,r[1]="L",Object.keys(t).forEach((function(e,t){n[e]=1<<t+1,r[n[e]]=e})),Object.freeze(n);var i=n.LRI|n.RLI|n.FSI,o=n.L|n.R|n.AL,s=n.B|n.S|n.WS|n.ON|n.FSI|n.LRI|n.RLI|n.PDI,a=n.BN|n.RLE|n.LRE|n.RLO|n.LRO|n.PDF,c=n.S|n.WS|n.B|i|n.PDI|a,l=null;function u(e){return function(){if(!l){l=new Map;var e=function(e){if(t.hasOwnProperty(e)){var r=0;t[e].split(",").forEach((function(t){var i=t.split("+"),o=i[0],s=i[1];o=parseInt(o,36),s=s?parseInt(s,36):0,l.set(r+=o,n[e]);for(var a=0;a<s;a++)l.set(++r,n[e])}))}};for(var r in t)e(r)}}(),l.get(e.codePointAt(0))||n.L}var h,d,A,m={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function p(e,t){var n,r=0,i=new Map,o=t&&new Map;return e.split(",").forEach((function e(s){if(-1!==s.indexOf("+"))for(var a=+s;a--;)e(n);else{n=s;var c=s.split(">"),l=c[0],u=c[1];l=String.fromCodePoint(r+=parseInt(l,36)),u=String.fromCodePoint(r+=parseInt(u,36)),i.set(l,u),t&&o.set(u,l)}})),{map:i,reverseMap:o}}function f(){if(!h){var e=p(m.pairs,!0),t=e.map,n=e.reverseMap;h=t,d=n,A=p(m.canonical,!1).map}}function g(e){return f(),h.get(e)||null}function y(e){return f(),d.get(e)||null}function v(e){return f(),A.get(e)||null}var x=n.L,E=n.R,w=n.EN,C=n.ES,I=n.ET,_=n.AN,b=n.CS,B=n.B,M=n.S,S=n.ON,D=n.BN,T=n.NSM,Q=n.AL,P=n.LRO,z=n.RLO,R=n.LRE,F=n.RLE,k=n.PDF,L=n.LRI,O=n.RLI,U=n.FSI,N=n.PDI;var V,G="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1";function j(e){return function(){if(!V){var e=p(G,!0),t=e.map;e.reverseMap.forEach((function(e,n){t.set(n,e)})),V=t}}(),V.get(e)||null}function H(e,t,n,r){var i=e.length;n=Math.max(0,null==n?0:+n),r=Math.min(i-1,null==r?i-1:+r);var o=[];return t.paragraphs.forEach((function(i){var s=Math.max(n,i.start),a=Math.min(r,i.end);if(s<a){for(var l=t.levels.slice(s,a+1),h=a;h>=s&&u(e[h])&c;h--)l[h]=i.level;for(var d=i.level,A=1/0,m=0;m<l.length;m++){var p=l[m];p>d&&(d=p),p<A&&(A=1|p)}for(var f=d;f>=A;f--)for(var g=0;g<l.length;g++)if(l[g]>=f){for(var y=g;g+1<l.length&&l[g+1]>=f;)g++;g>y&&o.push([y+s,g+s])}}})),o}function q(e,t,n,r){for(var i=H(e,t,n,r),o=[],s=0;s<e.length;s++)o[s]=s;return i.forEach((function(e){for(var t=e[0],n=e[1],r=o.slice(t,n+1),i=r.length;i--;)o[n-i]=r[i]})),o}return e.closingToOpeningBracket=y,e.getBidiCharType=u,e.getBidiCharTypeName=function(e){return r[u(e)]},e.getCanonicalBracket=v,e.getEmbeddingLevels=function(e,t){for(var n=new Uint32Array(e.length),r=0;r<e.length;r++)n[r]=u(e[r]);var l=new Map;function h(e,t){var r=n[e];n[e]=t,l.set(r,l.get(r)-1),r&s&&l.set(s,l.get(s)-1),l.set(t,(l.get(t)||0)+1),t&s&&l.set(s,(l.get(s)||0)+1)}for(var d=new Uint8Array(e.length),A=new Map,m=[],p=null,f=0;f<e.length;f++)p||m.push(p={start:f,end:e.length-1,level:"rtl"===t?1:"ltr"===t?0:Nt(f,!1)}),n[f]&B&&(p.end=f,p=null);for(var V=F|R|z|P|i|N|k|B,G=function(e){return e+(1&e?1:2)},j=function(e){return e+(1&e?2:1)},H=0;H<m.length;H++){var q=[{_level:(p=m[H]).level,_override:0,_isolate:0}],W=void 0,Y=0,X=0,Z=0;l.clear();for(var K=p.start;K<=p.end;K++){var J=n[K];if(W=q[q.length-1],l.set(J,(l.get(J)||0)+1),J&s&&l.set(s,(l.get(s)||0)+1),J&V)if(J&(F|R)){d[K]=W._level;var $=(J===F?j:G)(W._level);$<=125&&!Y&&!X?q.push({_level:$,_override:0,_isolate:0}):Y||X++}else if(J&(z|P)){d[K]=W._level;var ee=(J===z?j:G)(W._level);ee<=125&&!Y&&!X?q.push({_level:ee,_override:J&z?E:x,_isolate:0}):Y||X++}else if(J&i){J&U&&(J=1===Nt(K+1,!0)?O:L),d[K]=W._level,W._override&&h(K,W._override);var te=(J===O?j:G)(W._level);te<=125&&0===Y&&0===X?(Z++,q.push({_level:te,_override:0,_isolate:1,_isolInitIndex:K})):Y++}else if(J&N){if(Y>0)Y--;else if(Z>0){for(X=0;!q[q.length-1]._isolate;)q.pop();var ne=q[q.length-1]._isolInitIndex;null!=ne&&(A.set(ne,K),A.set(K,ne)),q.pop(),Z--}W=q[q.length-1],d[K]=W._level,W._override&&h(K,W._override)}else J&k?(0===Y&&(X>0?X--:!W._isolate&&q.length>1&&(q.pop(),W=q[q.length-1])),d[K]=W._level):J&B&&(d[K]=p.level);else d[K]=W._level,W._override&&J!==D&&h(K,W._override)}for(var re=[],ie=null,oe=p.start;oe<=p.end;oe++){var se=n[oe];if(!(se&a)){var ae=d[oe],ce=se&i,le=se===N;ie&&ae===ie._level?(ie._end=oe,ie._endsWithIsolInit=ce):re.push(ie={_start:oe,_end:oe,_level:ae,_startsWithPDI:le,_endsWithIsolInit:ce})}}for(var ue=[],he=0;he<re.length;he++){var de=re[he];if(!de._startsWithPDI||de._startsWithPDI&&!A.has(de._start)){for(var Ae=[ie=de],me=void 0;ie&&ie._endsWithIsolInit&&null!=(me=A.get(ie._end));)for(var pe=he+1;pe<re.length;pe++)if(re[pe]._start===me){Ae.push(ie=re[pe]);break}for(var fe=[],ge=0;ge<Ae.length;ge++)for(var ye=Ae[ge],ve=ye._start;ve<=ye._end;ve++)fe.push(ve);for(var xe=d[fe[0]],Ee=p.level,we=fe[0]-1;we>=0;we--)if(!(n[we]&a)){Ee=d[we];break}var Ce=fe[fe.length-1],Ie=d[Ce],_e=p.level;if(!(n[Ce]&i))for(var be=Ce+1;be<=p.end;be++)if(!(n[be]&a)){_e=d[be];break}ue.push({_seqIndices:fe,_sosType:Math.max(Ee,xe)%2?E:x,_eosType:Math.max(_e,Ie)%2?E:x})}}for(var Be=0;Be<ue.length;Be++){var Me=ue[Be],Se=Me._seqIndices,De=Me._sosType,Te=Me._eosType,Qe=1&d[Se[0]]?E:x;if(l.get(T))for(var Pe=0;Pe<Se.length;Pe++){var ze=Se[Pe];if(n[ze]&T){for(var Re=De,Fe=Pe-1;Fe>=0;Fe--)if(!(n[Se[Fe]]&a)){Re=n[Se[Fe]];break}h(ze,Re&(i|N)?S:Re)}}if(l.get(w))for(var ke=0;ke<Se.length;ke++){var Le=Se[ke];if(n[Le]&w)for(var Oe=ke-1;Oe>=-1;Oe--){var Ue=-1===Oe?De:n[Se[Oe]];if(Ue&o){Ue===Q&&h(Le,_);break}}}if(l.get(Q))for(var Ne=0;Ne<Se.length;Ne++){var Ve=Se[Ne];n[Ve]&Q&&h(Ve,E)}if(l.get(C)||l.get(b))for(var Ge=1;Ge<Se.length-1;Ge++){var je=Se[Ge];if(n[je]&(C|b)){for(var He=0,qe=0,We=Ge-1;We>=0&&(He=n[Se[We]])&a;We--);for(var Ye=Ge+1;Ye<Se.length&&(qe=n[Se[Ye]])&a;Ye++);He===qe&&(n[je]===C?He===w:He&(w|_))&&h(je,He)}}if(l.get(w))for(var Xe=0;Xe<Se.length;Xe++){var Ze=Se[Xe];if(n[Ze]&w){for(var Ke=Xe-1;Ke>=0&&n[Se[Ke]]&(I|a);Ke--)h(Se[Ke],w);for(Xe++;Xe<Se.length&&n[Se[Xe]]&(I|a|w);Xe++)n[Se[Xe]]!==w&&h(Se[Xe],w)}}if(l.get(I)||l.get(C)||l.get(b))for(var Je=0;Je<Se.length;Je++){var $e=Se[Je];if(n[$e]&(I|C|b)){h($e,S);for(var et=Je-1;et>=0&&n[Se[et]]&a;et--)h(Se[et],S);for(var tt=Je+1;tt<Se.length&&n[Se[tt]]&a;tt++)h(Se[tt],S)}}if(l.get(w))for(var nt=0,rt=De;nt<Se.length;nt++){var it=Se[nt],ot=n[it];ot&w?rt===x&&h(it,x):ot&o&&(rt=ot)}if(l.get(s)){for(var st=E|w|_,at=st|x,ct=[],lt=[],ut=0;ut<Se.length;ut++)if(n[Se[ut]]&s){var ht=e[Se[ut]],dt=void 0;if(null!==g(ht)){if(!(lt.length<63))break;lt.push({char:ht,seqIndex:ut})}else if(null!==(dt=y(ht)))for(var At=lt.length-1;At>=0;At--){var mt=lt[At].char;if(mt===dt||mt===y(v(ht))||g(v(mt))===ht){ct.push([lt[At].seqIndex,ut]),lt.length=At;break}}}ct.sort((function(e,t){return e[0]-t[0]}));for(var pt=0;pt<ct.length;pt++){for(var ft=ct[pt],gt=ft[0],yt=ft[1],vt=!1,xt=0,Et=gt+1;Et<yt;Et++){var wt=Se[Et];if(n[wt]&at){vt=!0;var Ct=n[wt]&st?E:x;if(Ct===Qe){xt=Ct;break}}}if(vt&&!xt){xt=De;for(var It=gt-1;It>=0;It--){var _t=Se[It];if(n[_t]&at){var bt=n[_t]&st?E:x;xt=bt!==Qe?bt:Qe;break}}}if(xt){if(n[Se[gt]]=n[Se[yt]]=xt,xt!==Qe)for(var Bt=gt+1;Bt<Se.length;Bt++)if(!(n[Se[Bt]]&a)){u(e[Se[Bt]])&T&&(n[Se[Bt]]=xt);break}if(xt!==Qe)for(var Mt=yt+1;Mt<Se.length;Mt++)if(!(n[Se[Mt]]&a)){u(e[Se[Mt]])&T&&(n[Se[Mt]]=xt);break}}}for(var St=0;St<Se.length;St++)if(n[Se[St]]&s){for(var Dt=St,Tt=St,Qt=De,Pt=St-1;Pt>=0;Pt--){if(!(n[Se[Pt]]&a)){Qt=n[Se[Pt]]&st?E:x;break}Dt=Pt}for(var zt=Te,Rt=St+1;Rt<Se.length;Rt++){if(!(n[Se[Rt]]&(s|a))){zt=n[Se[Rt]]&st?E:x;break}Tt=Rt}for(var Ft=Dt;Ft<=Tt;Ft++)n[Se[Ft]]=Qt===zt?Qt:Qe;St=Tt}}}for(var kt=p.start;kt<=p.end;kt++){var Lt=d[kt],Ot=n[kt];if(1&Lt?Ot&(x|w|_)&&d[kt]++:Ot&E?d[kt]++:Ot&(_|w)&&(d[kt]+=2),Ot&a&&(d[kt]=0===kt?p.level:d[kt-1]),kt===p.end||u(e[kt])&(M|B))for(var Ut=kt;Ut>=0&&u(e[Ut])&c;Ut--)d[Ut]=p.level}}return{levels:d,paragraphs:m};function Nt(t,r){for(var o=t;o<e.length;o++){var s=n[o];if(s&(E|Q))return 1;if(s&(B|x)||r&&s===N)return 0;if(s&i){var a=Vt(o);o=-1===a?e.length:a}}return 0}function Vt(t){for(var r=1,o=t+1;o<e.length;o++){var s=n[o];if(s&B)break;if(s&N){if(0===--r)return o}else s&i&&r++}return-1}},e.getMirroredCharacter=j,e.getMirroredCharactersMap=function(e,t,n,r){var i=e.length;n=Math.max(0,null==n?0:+n),r=Math.min(i-1,null==r?i-1:+r);for(var o=new Map,s=n;s<=r;s++)if(1&t[s]){var a=j(e[s]);null!==a&&o.set(s,a)}return o},e.getReorderSegments=H,e.getReorderedIndices=q,e.getReorderedString=function(e,t,n,r){var i=q(e,t,n,r),o=[].concat(e);return i.forEach((function(n,r){o[r]=(1&t.levels[n]?j(e[n]):null)||e[n]})),o.join("")},e.openingToClosingBracket=g,Object.defineProperty(e,"__esModule",{value:!0}),e}({})}},50017:function(e,t,n){"use strict";function r(){var e=function(e){function t(e,t,n,r,i,o,s,a){var c=1-s;a.x=c*c*e+2*c*s*n+s*s*i,a.y=c*c*t+2*c*s*r+s*s*o}function n(e,t,n,r,i,o,s,a,c,l){var u=1-c;l.x=u*u*u*e+3*u*u*c*n+3*u*c*c*i+c*c*c*s,l.y=u*u*u*t+3*u*u*c*r+3*u*c*c*o+c*c*c*a}function r(e,t){for(var n,r,i,o,s,a=/([MLQCZ])([^MLQCZ]*)/g;n=a.exec(e);){var c=n[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map((function(e){return parseFloat(e)}));switch(n[1]){case"M":o=r=c[0],s=i=c[1];break;case"L":c[0]===o&&c[1]===s||t("L",o,s,o=c[0],s=c[1]);break;case"Q":t("Q",o,s,o=c[2],s=c[3],c[0],c[1]);break;case"C":t("C",o,s,o=c[4],s=c[5],c[0],c[1],c[2],c[3]);break;case"Z":o===r&&s===i||t("L",o,s,r,i)}}}function i(e,i,o){void 0===o&&(o=16);var s={x:0,y:0};r(e,(function(e,r,a,c,l,u,h,d,A){switch(e){case"L":i(r,a,c,l);break;case"Q":for(var m=r,p=a,f=1;f<o;f++)t(r,a,u,h,c,l,f/(o-1),s),i(m,p,s.x,s.y),m=s.x,p=s.y;break;case"C":for(var g=r,y=a,v=1;v<o;v++)n(r,a,u,h,d,A,c,l,v/(o-1),s),i(g,y,s.x,s.y),g=s.x,y=s.y}}))}var o="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",s="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",a=new WeakMap,c={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function l(e,t){var n=e.getContext?e.getContext("webgl",c):e,r=a.get(n);if(!r){var i="undefined"!==typeof WebGL2RenderingContext&&n instanceof WebGL2RenderingContext,o={},s={},l={},u=-1,h=[];function d(e){var t=o[e];if(!t&&!(t=o[e]=n.getExtension(e)))throw new Error(e+" not supported");return t}function A(e,t){var r=n.createShader(t);return n.shaderSource(r,e),n.compileShader(r),r}function m(e,t,r,o){if(!s[e]){var a={},c={},l=n.createProgram();n.attachShader(l,A(t,n.VERTEX_SHADER)),n.attachShader(l,A(r,n.FRAGMENT_SHADER)),n.linkProgram(l),s[e]={program:l,transaction:function(e){n.useProgram(l),e({setUniform:function(e,t){for(var r=[],i=arguments.length-2;i-- >0;)r[i]=arguments[i+2];var o=c[t]||(c[t]=n.getUniformLocation(l,t));n["uniform"+e].apply(n,[o].concat(r))},setAttribute:function(e,t,r,o,s){var c=a[e];c||(c=a[e]={buf:n.createBuffer(),loc:n.getAttribLocation(l,e),data:null}),n.bindBuffer(n.ARRAY_BUFFER,c.buf),n.vertexAttribPointer(c.loc,t,n.FLOAT,!1,0,0),n.enableVertexAttribArray(c.loc),i?n.vertexAttribDivisor(c.loc,o):d("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(c.loc,o),s!==c.data&&(n.bufferData(n.ARRAY_BUFFER,s,r),c.data=s)}})}}}s[e].transaction(o)}function p(e,t){u++;try{n.activeTexture(n.TEXTURE0+u);var r=l[e];r||(r=l[e]=n.createTexture(),n.bindTexture(n.TEXTURE_2D,r),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST)),n.bindTexture(n.TEXTURE_2D,r),t(r,u)}finally{u--}}function f(e,t,r){var i=n.createFramebuffer();h.push(i),n.bindFramebuffer(n.FRAMEBUFFER,i),n.activeTexture(n.TEXTURE0+t),n.bindTexture(n.TEXTURE_2D,e),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);try{r(i)}finally{n.deleteFramebuffer(i),n.bindFramebuffer(n.FRAMEBUFFER,h[--h.length-1]||null)}}function g(){o={},s={},l={},u=-1,h.length=0}n.canvas.addEventListener("webglcontextlost",(function(e){g(),e.preventDefault()}),!1),a.set(n,r={gl:n,isWebGL2:i,getExtension:d,withProgram:m,withTexture:p,withTextureFramebuffer:f,handleContextLoss:g})}t(r)}function u(e,t,n,r,i,a,c,u){void 0===c&&(c=15),void 0===u&&(u=null),l(e,(function(e){var l=e.gl,h=e.withProgram;(0,e.withTexture)("copy",(function(e,d){l.texImage2D(l.TEXTURE_2D,0,l.RGBA,i,a,0,l.RGBA,l.UNSIGNED_BYTE,t),h("copy",o,s,(function(e){var t=e.setUniform;(0,e.setAttribute)("aUV",2,l.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),t("1i","image",d),l.bindFramebuffer(l.FRAMEBUFFER,u||null),l.disable(l.BLEND),l.colorMask(8&c,4&c,2&c,1&c),l.viewport(n,r,i,a),l.scissor(n,r,i,a),l.drawArrays(l.TRIANGLES,0,3)}))}))}))}var h=Object.freeze({__proto__:null,withWebGLContext:l,renderImageData:u,resizeWebGLCanvasWithoutClearing:function(e,t,n){var r=e.width,i=e.height;l(e,(function(o){var s=o.gl,a=new Uint8Array(r*i*4);s.readPixels(0,0,r,i,s.RGBA,s.UNSIGNED_BYTE,a),e.width=t,e.height=n,u(s,a,0,0,r,i)}))}});function d(e,t,n,r,o,s){void 0===s&&(s=1);var a=new Uint8Array(e*t),c=r[2]-r[0],l=r[3]-r[1],u=[];i(n,(function(e,t,n,r){u.push({x1:e,y1:t,x2:n,y2:r,minX:Math.min(e,n),minY:Math.min(t,r),maxX:Math.max(e,n),maxY:Math.max(t,r)})})),u.sort((function(e,t){return e.maxX-t.maxX}));for(var h=0;h<e;h++)for(var d=0;d<t;d++){var A=f(r[0]+c*(h+.5)/e,r[1]+l*(d+.5)/t),m=Math.pow(1-Math.abs(A)/o,s)/2;A<0&&(m=1-m),m=Math.max(0,Math.min(255,Math.round(255*m))),a[d*e+h]=m}return a;function f(e,t){for(var n=1/0,r=1/0,i=u.length;i--;){var o=u[i];if(o.maxX+r<=e)break;if(e+r>o.minX&&t-r<o.maxY&&t+r>o.minY){var s=p(e,t,o.x1,o.y1,o.x2,o.y2);s<n&&(n=s,r=Math.sqrt(n))}}return function(e,t){for(var n=0,r=u.length;r--;){var i=u[r];if(i.maxX<=e)break;i.y1>t!==i.y2>t&&e<(i.x2-i.x1)*(t-i.y1)/(i.y2-i.y1)+i.x1&&(n+=i.y1<i.y2?1:-1)}return 0!==n}(e,t)&&(r=-r),r}}function A(e,t,n,r,i,o,s,a,c,l){void 0===o&&(o=1),void 0===a&&(a=0),void 0===c&&(c=0),void 0===l&&(l=0),m(e,t,n,r,i,o,s,null,a,c,l)}function m(e,t,n,r,i,o,s,a,c,l,h){void 0===o&&(o=1),void 0===c&&(c=0),void 0===l&&(l=0),void 0===h&&(h=0);for(var A=d(e,t,n,r,i,o),m=new Uint8Array(4*A.length),p=0;p<A.length;p++)m[4*p+h]=A[p];u(s,m,c,l,e,t,1<<3-h,a)}function p(e,t,n,r,i,o){var s=i-n,a=o-r,c=s*s+a*a,l=c?Math.max(0,Math.min(1,((e-n)*s+(t-r)*a)/c)):0,u=e-(n+l*s),h=t-(r+l*a);return u*u+h*h}var f=Object.freeze({__proto__:null,generate:d,generateIntoCanvas:A,generateIntoFramebuffer:m}),g="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",y="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",v="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",x=new Float32Array([0,0,2,0,0,2]),E=null,w=!1,C={},I=new WeakMap;function _(e){if(!w&&!S(e))throw new Error("WebGL generation not supported")}function b(e,t,n,r,i,o,s){if(void 0===o&&(o=1),void 0===s&&(s=null),!s&&!(s=E)){var a="function"===typeof OffscreenCanvas?new OffscreenCanvas(1,1):"undefined"!==typeof document?document.createElement("canvas"):null;if(!a)throw new Error("OffscreenCanvas or DOM canvas not supported");s=E=a.getContext("webgl",{depth:!1})}_(s);var c=new Uint8Array(e*t*4);l(s,(function(s){var a=s.gl,l=s.withTexture,u=s.withTextureFramebuffer;l("readable",(function(s,l){a.texImage2D(a.TEXTURE_2D,0,a.RGBA,e,t,0,a.RGBA,a.UNSIGNED_BYTE,null),u(s,l,(function(s){M(e,t,n,r,i,o,a,s,0,0,0),a.readPixels(0,0,e,t,a.RGBA,a.UNSIGNED_BYTE,c)}))}))}));for(var u=new Uint8Array(e*t),h=0,d=0;h<c.length;h+=4)u[d++]=c[h];return u}function B(e,t,n,r,i,o,s,a,c,l){void 0===o&&(o=1),void 0===a&&(a=0),void 0===c&&(c=0),void 0===l&&(l=0),M(e,t,n,r,i,o,s,null,a,c,l)}function M(e,t,n,r,s,a,c,u,h,d,A){void 0===a&&(a=1),void 0===h&&(h=0),void 0===d&&(d=0),void 0===A&&(A=0),_(c);var m=[];i(n,(function(e,t,n,r){m.push(e,t,n,r)})),m=new Float32Array(m),l(c,(function(n){var i=n.gl,c=n.isWebGL2,l=n.getExtension,p=n.withProgram,f=n.withTexture,E=n.withTextureFramebuffer,w=n.handleContextLoss;if(f("rawDistances",(function(n,f){e===n._lastWidth&&t===n._lastHeight||i.texImage2D(i.TEXTURE_2D,0,i.RGBA,n._lastWidth=e,n._lastHeight=t,0,i.RGBA,i.UNSIGNED_BYTE,null),p("main",g,y,(function(o){var u=o.setAttribute,h=o.setUniform,d=!c&&l("ANGLE_instanced_arrays"),A=!c&&l("EXT_blend_minmax");u("aUV",2,i.STATIC_DRAW,0,x),u("aLineSegment",4,i.DYNAMIC_DRAW,1,m),h.apply(void 0,["4f","uGlyphBounds"].concat(r)),h("1f","uMaxDistance",s),h("1f","uExponent",a),E(n,f,(function(n){i.enable(i.BLEND),i.colorMask(!0,!0,!0,!0),i.viewport(0,0,e,t),i.scissor(0,0,e,t),i.blendFunc(i.ONE,i.ONE),i.blendEquationSeparate(i.FUNC_ADD,c?i.MAX:A.MAX_EXT),i.clear(i.COLOR_BUFFER_BIT),c?i.drawArraysInstanced(i.TRIANGLES,0,3,m.length/4):d.drawArraysInstancedANGLE(i.TRIANGLES,0,3,m.length/4)}))})),p("post",o,v,(function(n){n.setAttribute("aUV",2,i.STATIC_DRAW,0,x),n.setUniform("1i","tex",f),i.bindFramebuffer(i.FRAMEBUFFER,u),i.disable(i.BLEND),i.colorMask(0===A,1===A,2===A,3===A),i.viewport(h,d,e,t),i.scissor(h,d,e,t),i.drawArrays(i.TRIANGLES,0,3)}))})),i.isContextLost())throw w(),new Error("webgl context lost")}))}function S(e){var t=e&&e!==E?e.canvas||e:C,n=I.get(t);if(void 0===n){w=!0;var r=null;try{var i=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],o=b(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,e);(n=o&&i.length===o.length&&o.every((function(e,t){return e===i[t]})))||(r="bad trial run results",console.info(i,o))}catch(s){n=!1,r=s.message}r&&console.warn("WebGL SDF generation not supported:",r),w=!1,I.set(t,n)}return n}var D=Object.freeze({__proto__:null,generate:b,generateIntoCanvas:B,generateIntoFramebuffer:M,isSupported:S});return e.forEachPathCommand=r,e.generate=function(e,t,n,r,i,o){void 0===i&&(i=Math.max(r[2]-r[0],r[3]-r[1])/2),void 0===o&&(o=1);try{return b.apply(D,arguments)}catch(s){return console.info("WebGL SDF generation failed, falling back to JS",s),d.apply(f,arguments)}},e.generateIntoCanvas=function(e,t,n,r,i,o,s,a,c,l){void 0===i&&(i=Math.max(r[2]-r[0],r[3]-r[1])/2),void 0===o&&(o=1),void 0===a&&(a=0),void 0===c&&(c=0),void 0===l&&(l=0);try{return B.apply(D,arguments)}catch(u){return console.info("WebGL SDF generation failed, falling back to JS",u),A.apply(f,arguments)}},e.javascript=f,e.pathToLineSegments=i,e.webgl=D,e.webglUtils=h,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return e}n.d(t,{Z:function(){return r}})}}]);